{"version":3,"file":"js/app.f65bd67a.js","mappings":"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","sources":["webpack://yellow_submarine/./src/App.vue?c4b5","webpack://yellow_submarine/./src/App.vue","webpack://yellow_submarine/./src/components/YellowSubmarine.vue?f8d7","webpack://yellow_submarine/./src/components/YellowSubmarine.vue","webpack://yellow_submarine/./src/YellowSubmarine/sky system/CelestialBody.ts","webpack://yellow_submarine/./src/YellowSubmarine/sky system/HemisphericCelestialBody.ts","webpack://yellow_submarine/./src/YellowSubmarine/sky system/Sun.ts","webpack://yellow_submarine/./src/YellowSubmarine/sky system/Moon.ts","webpack://yellow_submarine/./src/YellowSubmarine/sky system/SkyBox.ts","webpack://yellow_submarine/./src/YellowSubmarine/sky system/DayNightCycle.ts","webpack://yellow_submarine/./src/YellowSubmarine/sky system/Sky.ts","webpack://yellow_submarine/./src/YellowSubmarine/shader material/ReflectiveToonWaterMaterial.ts","webpack://yellow_submarine/./src/YellowSubmarine/Sea.ts","webpack://yellow_submarine/./src/YellowSubmarine/camera system/ConfigurableCamera.ts","webpack://yellow_submarine/./src/YellowSubmarine/camera system/CameraConfiguration.ts","webpack://yellow_submarine/./src/YellowSubmarine/interaction system/InteractionManager.ts","webpack://yellow_submarine/./src/YellowSubmarine/interaction system/interactions/AbstractInteraction.ts","webpack://yellow_submarine/./src/YellowSubmarine/dialogue system/interactions/DialogueInteraction.ts","webpack://yellow_submarine/./src/YellowSubmarine/ui system/UI.ts","webpack://yellow_submarine/./src/YellowSubmarine/Utils.ts","webpack://yellow_submarine/./src/YellowSubmarine/ui system/BBCode/BBTag.ts","webpack://yellow_submarine/./src/YellowSubmarine/ui system/BBCode/Tags/ItalicTag.ts","webpack://yellow_submarine/./src/YellowSubmarine/ui system/BBCode/Tags/BoldTag.ts","webpack://yellow_submarine/./src/YellowSubmarine/ui system/BBCode/Tags/ColorTag.ts","webpack://yellow_submarine/./src/YellowSubmarine/ui system/BBCode/Tags/SizeTag.ts","webpack://yellow_submarine/./src/YellowSubmarine/ui system/BBCode/BBParser.ts","webpack://yellow_submarine/./src/YellowSubmarine/ui system/TextLayoutManager.ts","webpack://yellow_submarine/./src/YellowSubmarine/sound system/SoundManager.ts","webpack://yellow_submarine/./src/YellowSubmarine/ui system/TextAnimator.ts","webpack://yellow_submarine/./src/YellowSubmarine/dialogue system/ui/DialogueInteractionUI.ts","webpack://yellow_submarine/./src/YellowSubmarine/dialogue system/interactions/NextDialogueInteraction.ts","webpack://yellow_submarine/./src/YellowSubmarine/dialogue system/Conversation.ts","webpack://yellow_submarine/./src/YellowSubmarine/Player.ts","webpack://yellow_submarine/./src/YellowSubmarine/shader material/CartoonShaderMaterial.ts","webpack://yellow_submarine/./src/YellowSubmarine/grappling system/Grappler.ts","webpack://yellow_submarine/./src/YellowSubmarine/Submarine.ts","webpack://yellow_submarine/./src/YellowSubmarine/keyzone system/KeyZone.ts","webpack://yellow_submarine/./src/YellowSubmarine/detection system/MeshDetectionZone.ts","webpack://yellow_submarine/./src/YellowSubmarine/detection system/SphericalDetectionZone.ts","webpack://yellow_submarine/./src/YellowSubmarine/interaction system/interactions/WorldInteraction.ts","webpack://yellow_submarine/./src/YellowSubmarine/dialogue system/interactions/StartConversationInteraction.ts","webpack://yellow_submarine/./src/YellowSubmarine/npcs/NPC.ts","webpack://yellow_submarine/./src/YellowSubmarine/detection system/CylindricalDetectionZone.ts","webpack://yellow_submarine/./src/YellowSubmarine/dialogue system/nodes/AbstractDialogueNode.ts","webpack://yellow_submarine/./src/YellowSubmarine/dialogue system/nodes/SimpleDialogueNode.ts","webpack://yellow_submarine/./src/YellowSubmarine/dialogue system/ConversationBuilder.ts","webpack://yellow_submarine/./src/YellowSubmarine/quest system/ui/QuestUI.ts","webpack://yellow_submarine/./src/YellowSubmarine/quest system/Quest.ts","webpack://yellow_submarine/./src/YellowSubmarine/quest system/QuestStep.ts","webpack://yellow_submarine/./src/YellowSubmarine/temple/interaction/RemoveTempleBallInteraction.ts","webpack://yellow_submarine/./src/YellowSubmarine/temple/interaction/PlaceTempleBallInteraction.ts","webpack://yellow_submarine/./src/YellowSubmarine/temple/Socle.ts","webpack://yellow_submarine/./src/YellowSubmarine/grappling system/interaction/GrappleInteraction.ts","webpack://yellow_submarine/./src/YellowSubmarine/temple/TempleBall.ts","webpack://yellow_submarine/./src/YellowSubmarine/interaction system/ui/WorldInteractionUI.ts","webpack://yellow_submarine/./src/YellowSubmarine/keyzone system/ui/ShowKeyZoneNameUI.ts","webpack://yellow_submarine/./src/YellowSubmarine/ui system/OptionsMenuUI.ts","webpack://yellow_submarine/./src/YellowSubmarine/ui system/ImageUI.ts","webpack://yellow_submarine/./src/YellowSubmarine/ui system/MainMenuUI.ts","webpack://yellow_submarine/./src/YellowSubmarine/keyzone system/ui/ShowConversationProviderUI.ts","webpack://yellow_submarine/./src/YellowSubmarine/ui system/UIManager.ts","webpack://yellow_submarine/./src/YellowSubmarine/ui system/SlideAnimationUI.ts","webpack://yellow_submarine/./src/YellowSubmarine/temple/TemplePuzzle.ts","webpack://yellow_submarine/./src/YellowSubmarine/quest system/QuestFactory.ts","webpack://yellow_submarine/./src/YellowSubmarine/quest system/QuestManager.ts","webpack://yellow_submarine/./src/YellowSubmarine/quest system/ui/JournalUI.ts","webpack://yellow_submarine/./src/YellowSubmarine/npcs/NPCFactory.ts","webpack://yellow_submarine/./src/YellowSubmarine/temple/Stele.ts","webpack://yellow_submarine/./src/YellowSubmarine/keyzone system/KeyZoneFactory.ts","webpack://yellow_submarine/./src/YellowSubmarine/World.ts","webpack://yellow_submarine/./src/YellowSubmarine/Game.ts","webpack://yellow_submarine/./src/components/YellowSubmarine.vue?d24b","webpack://yellow_submarine/./src/App.vue?7ccd","webpack://yellow_submarine/./src/main.ts","webpack://yellow_submarine/webpack/bootstrap","webpack://yellow_submarine/webpack/runtime/chunk loaded","webpack://yellow_submarine/webpack/runtime/define property getters","webpack://yellow_submarine/webpack/runtime/global","webpack://yellow_submarine/webpack/runtime/hasOwnProperty shorthand","webpack://yellow_submarine/webpack/runtime/make namespace object","webpack://yellow_submarine/webpack/runtime/publicPath","webpack://yellow_submarine/webpack/runtime/jsonp chunk loading","webpack://yellow_submarine/webpack/startup"],"sourcesContent":["import { resolveComponent as _resolveComponent, openBlock as _openBlock, createBlock as _createBlock } from \"vue\"\n\nexport function render(_ctx: any,_cache: any,$props: any,$setup: any,$data: any,$options: any) {\n  const _component_YellowSubmarine = _resolveComponent(\"YellowSubmarine\")!\n\n  return (_openBlock(), _createBlock(_component_YellowSubmarine))\n}","<template>\n  <YellowSubmarine/>\n</template>\n\n<script lang=\"ts\">\nimport { defineComponent } from 'vue';\nimport YellowSubmarine from './components/YellowSubmarine.vue';\n\nexport default defineComponent({\n  name: 'App',\n  components: {\n    YellowSubmarine\n  }\n});\n</script>\n\n<style>\nhtml, body, #app {\n  margin: 0;\n  padding: 0;\n  height: 100%;\n  width: 100%;\n  overflow: hidden;\n}\n</style>\n","import { createElementVNode as _createElementVNode, renderList as _renderList, Fragment as _Fragment, openBlock as _openBlock, createElementBlock as _createElementBlock, toDisplayString as _toDisplayString, normalizeStyle as _normalizeStyle, vShow as _vShow, normalizeClass as _normalizeClass, withDirectives as _withDirectives } from \"vue\"\n\nconst _hoisted_1 = [\"src\"]\nconst _hoisted_2 = { class: \"wave-text\" }\n\nexport function render(_ctx: any,_cache: any,$props: any,$setup: any,$data: any,$options: any) {\n  return (_openBlock(), _createElementBlock(\"div\", null, [\n    _withDirectives(_createElementVNode(\"div\", {\n      id: \"loadingScreen\",\n      class: _normalizeClass({ 'fade-out': _ctx.isFadingOut })\n    }, [\n      _createElementVNode(\"img\", {\n        src: _ctx.getLogoSrc(),\n        alt: \"Logo\",\n        class: \"logo\"\n      }, null, 8, _hoisted_1),\n      _cache[0] || (_cache[0] = _createElementVNode(\"p\", { class: \"fullscreen-tip\" }, \"Pour une meilleure expérience, activez le plein écran via la touche F11.\", -1)),\n      _createElementVNode(\"h1\", _hoisted_2, [\n        (_openBlock(true), _createElementBlock(_Fragment, null, _renderList(_ctx.loadingText, (letter, index) => {\n          return (_openBlock(), _createElementBlock(\"span\", {\n            key: index,\n            class: \"letter\",\n            style: _normalizeStyle({ animationDelay: `${index * 0.1}s` })\n          }, _toDisplayString(letter), 5))\n        }), 128))\n      ])\n    ], 2), [\n      [_vShow, _ctx.isLoading]\n    ]),\n    _cache[1] || (_cache[1] = _createElementVNode(\"canvas\", { id: \"mainCanvas\" }, null, -1))\n  ]))\n}","<template>\r\n  <div>\r\n    <div v-show=\"isLoading\" id=\"loadingScreen\" :class=\"{ 'fade-out': isFadingOut }\">\r\n      <img :src=\"getLogoSrc()\" alt=\"Logo\" class=\"logo\" />\r\n      <p class=\"fullscreen-tip\">Pour une meilleure expérience, activez le plein écran via la touche F11.</p>\r\n      <h1 class=\"wave-text\">\r\n        <span\r\n            v-for=\"(letter, index) in loadingText\"\r\n            :key=\"index\"\r\n            class=\"letter\"\r\n            :style=\"{ animationDelay: `${index * 0.1}s` }\"\r\n        >\r\n          {{ letter }}\r\n        </span>\r\n      </h1>\r\n    </div>\r\n\r\n    <canvas id=\"mainCanvas\"></canvas>\r\n  </div>\r\n</template>\r\n\r\n\r\n<script lang=\"ts\">\r\nimport { defineComponent, ref } from 'vue';\r\nimport { Game } from \"@/YellowSubmarine/Game\";\r\nimport { Effect, Engine, HavokPlugin } from \"@babylonjs/core\";\r\nimport HavokPhysics from \"@babylonjs/havok\";\r\n\r\nexport default defineComponent({\r\n  name: 'YellowSubmarine',\r\n  setup() {\r\n    const isLoading = ref(true);\r\n    const isFadingOut = ref(false);\r\n    const loadingText = 'Chargement...'.split('');\r\n\r\n    const getLogoSrc = () => {\r\n      return process.env.NODE_ENV === \"production\"\r\n          ? \"/YellowSubmarine/logo.png\"\r\n          : \"/logo.png\";\r\n    };\r\n\r\n    return { isLoading, isFadingOut, loadingText, getLogoSrc };\r\n  },\r\n  async mounted() {\r\n    const canvas = document.getElementById(\"mainCanvas\") as HTMLCanvasElement;\r\n    Effect.ShadersRepository = process.env.NODE_ENV === \"production\"\r\n        ? \"/YellowSubmarine/shaders/\"\r\n        : \"/shaders/\";\r\n    Engine.ShadersRepository = process.env.NODE_ENV === \"production\"\r\n        ? \"/YellowSubmarine/shaders/\"\r\n        : \"/shaders/\";\r\n\r\n    const havok = await HavokPhysics();\r\n    const havokPlugin = new HavokPlugin(true, havok);\r\n    const game = new Game(canvas, havokPlugin);\r\n\r\n    await game.init();\r\n\r\n    setTimeout(() => {\r\n      this.isFadingOut = true;\r\n      setTimeout(() => {\r\n        this.isLoading = false;\r\n      }, 1000);\r\n    }, 500);\r\n  },\r\n});\r\n</script>\r\n\r\n<style scoped>\r\ncanvas {\r\n  position: absolute;\r\n  top: 0;\r\n  left: 0;\r\n  width: 100vw;\r\n  height: 100vh;\r\n  display: block;\r\n}\r\n\r\n.fullscreen-tip {\r\n  font-size: 1rem;\r\n  color: #cccccc;\r\n  margin-bottom: 20px;\r\n  text-align: center;\r\n  max-width: 80%;\r\n}\r\n\r\n\r\n#loadingScreen {\r\n  position: fixed;\r\n  top: 0;\r\n  left: 0;\r\n  background: #0b1c1b;\r\n  width: 100vw;\r\n  height: 100vh;\r\n  z-index: 9999;\r\n  display: flex;\r\n  flex-direction: column;\r\n  align-items: center;\r\n  justify-content: center;\r\n  color: white;\r\n  transition: opacity 1s ease;\r\n  gap: 30px; /* espace entre logo et texte */\r\n}\r\n\r\n.fade-out {\r\n  opacity: 0;\r\n  pointer-events: none;\r\n}\r\n\r\n.logo {\r\n  width: 400px;\r\n  height: auto;\r\n}\r\n\r\n.wave-text {\r\n  font-size: 2.5rem;\r\n  display: flex;\r\n  gap: 4px;\r\n  justify-content: center;\r\n}\r\n\r\n.letter {\r\n  display: inline-block;\r\n  animation: bounce 1.4s infinite ease-in-out;\r\n}\r\n\r\n@keyframes bounce {\r\n  0%, 100% { transform: translateY(0); }\r\n  50% { transform: translateY(-8px); }\r\n}\r\n</style>\r\n","import {\r\n    Color3,\r\n    DirectionalLight,\r\n    GlowLayer,\r\n    Mesh,\r\n    MeshBuilder,\r\n    Scene,\r\n    StandardMaterial,\r\n    Vector3\r\n} from \"@babylonjs/core\";\r\nimport {Game} from \"@/YellowSubmarine/Game\";\r\n\r\nexport abstract class CelestialBody {\r\n\r\n    protected _bodyMesh : Mesh\r\n    protected _haloMesh : Mesh\r\n    private _light : DirectionalLight\r\n\r\n    // Physics Characteristic\r\n    public get _defaultPosition(): Vector3{\r\n        return new Vector3(1000, 200, -1000);\r\n    }\r\n\r\n    public get _diameter(): number {\r\n        return 40;\r\n    }\r\n\r\n    // Light Characteristic\r\n    public get _intensity(): number {\r\n        return 1.0;\r\n    }\r\n    public get _diffuse(): Color3 {\r\n        return new Color3(1.0, 1.0, 1.0);\r\n    }\r\n    public get _specular(): Color3 {\r\n        return new Color3(1.0, 1.0, 1.0);\r\n    }\r\n    public get _emissiveColor(): Color3 {\r\n        return new Color3(1.0, 1.0, 1.0);\r\n    }\r\n\r\n    constructor(){\r\n        this._bodyMesh = this.createBody(Game.scene);\r\n        this._haloMesh = this.createHalo(Game.scene);\r\n        this._light = this.createLight(Game.scene);\r\n        this.configMaterials(Game.scene);\r\n    }\r\n\r\n    private createBody(scene: Scene) : Mesh{\r\n        const body = MeshBuilder.CreateSphere(\"celestialBody\", {\r\n            diameter: this._diameter,\r\n            segments: 32\r\n        }, scene);\r\n        body.infiniteDistance = true;\r\n        body.isPickable = false;\r\n        body.position = this._defaultPosition;\r\n        return body;\r\n    }\r\n\r\n    private createHalo(scene: Scene) : Mesh{\r\n        const halo = MeshBuilder.CreateSphere(\"halo\", {\r\n            diameter: this._diameter * 1.05,\r\n            segments: 32\r\n        }, scene);\r\n        halo.infiniteDistance = true;\r\n        halo.isPickable = false;\r\n        halo.position = this._defaultPosition;\r\n        return halo;\r\n    }\r\n\r\n    private createLight(scene: Scene) : DirectionalLight{\r\n        let direction = new Vector3(0, 0, 0);\r\n        if (scene.activeCamera) {\r\n            direction = this._bodyMesh.position.subtract(scene.activeCamera.position).normalize();\r\n        }\r\n        const light = new DirectionalLight(\"sunLight\", direction.negate(), scene);\r\n        light.intensity = this._intensity;\r\n        light.shadowEnabled = true;\r\n        light.parent = this._bodyMesh;\r\n        light.diffuse = this._diffuse;\r\n        light.specular = this._specular;\r\n        const glowLayer = new GlowLayer(\"\", scene);\r\n        glowLayer.intensity = 0.3;\r\n        return light;\r\n    }\r\n\r\n    protected configMaterials(scene: Scene){\r\n        const bodyMaterial = new StandardMaterial(\"bodyMat\", scene);\r\n        bodyMaterial.emissiveColor = this._emissiveColor;\r\n        bodyMaterial.diffuseColor = this._diffuse;\r\n        bodyMaterial.specularColor = this._specular;\r\n        this._bodyMesh.material = bodyMaterial;\r\n\r\n        const haloMaterial = new StandardMaterial(\"haloMat\", scene);\r\n        haloMaterial.emissiveColor = this._emissiveColor;\r\n        haloMaterial.diffuseColor = this._diffuse;\r\n        haloMaterial.specularColor = this._specular;\r\n        haloMaterial.alpha = 0.5;\r\n        this._haloMesh.material = haloMaterial;\r\n    }\r\n\r\n    public get bodyMesh(): Mesh {\r\n        return this._bodyMesh;\r\n    }\r\n\r\n    public get haloMesh(): Mesh {\r\n        return this._haloMesh;\r\n    }\r\n\r\n    public get light(): DirectionalLight {\r\n        return this._light;\r\n    }\r\n\r\n    public get position(): Vector3 {\r\n        return this.bodyMesh.position;\r\n    }\r\n\r\n    public set position(position: Vector3){\r\n        this._bodyMesh.position = position;\r\n        this._haloMesh.position = position;\r\n        this.light.position = position;\r\n    }\r\n}","import {CelestialBody} from \"@/YellowSubmarine/sky system/CelestialBody\";\r\nimport {Color3, HemisphericLight, Scene, ShadowGenerator, Vector3} from \"@babylonjs/core\";\r\nimport {Game} from \"@/YellowSubmarine/Game\";\r\n\r\nexport abstract class HemisphericCelestialBody extends CelestialBody{\r\n\r\n    private _hemiLight : HemisphericLight\r\n    private shadowGenerator: ShadowGenerator;\r\n\r\n    public get hemiLight(){\r\n        return this._hemiLight;\r\n    }\r\n\r\n    public get hemiLightIntensity(){\r\n        return this._hemiLight.intensity;\r\n    }\r\n\r\n    public get _emissiveColor(): Color3 {\r\n        return new Color3(1.0, 1.0, 1.0);\r\n    }\r\n\r\n    public getPosition(){\r\n        return this._bodyMesh.position;\r\n    }\r\n\r\n    public get _direction(): Vector3{\r\n        if(Game.scene.activeCamera){\r\n            this.light.direction = this._bodyMesh.absolutePosition.subtract(Vector3.Zero()).normalize();\r\n            this._hemiLight.direction = this._bodyMesh.position.subtract(Game.scene.activeCamera.position).normalize();\r\n        }\r\n        return this.light.direction;\r\n    }\r\n\r\n    constructor() {\r\n        super();\r\n        this._hemiLight = this.createHemiLight(Game.scene);\r\n        this.configMaterials(Game.scene);\r\n        this._hemiLight.direction = Vector3.Up();\r\n        this._hemiLight.isEnabled(false);\r\n        this.shadowGenerator = new ShadowGenerator(1024, this.light);\r\n        this.shadowGenerator.useBlurExponentialShadowMap = true;\r\n        this.shadowGenerator.blurKernel = 16;\r\n        this.light.shadowEnabled = true;\r\n        Game.scene.onBeforeRenderObservable.add(() => {\r\n            if (Game.scene.activeCamera) {\r\n                const dir = this._bodyMesh.absolutePosition.subtract(Vector3.Zero()).normalize();\r\n                this.light.direction = dir.negate();\r\n            }\r\n        });\r\n    }\r\n\r\n    private createHemiLight(scene: Scene) : HemisphericLight{\r\n        const light = new HemisphericLight(\"hemisphericLight\", Vector3.Up(), scene);\r\n        light.intensity = 2;\r\n        light.diffuse = this._diffuse;\r\n        light.shadowEnabled = false;\r\n        light.parent = this._bodyMesh;\r\n        return light;\r\n    }\r\n\r\n}","import {\r\n    Color3,\r\n    Vector3\r\n} from \"@babylonjs/core\";\r\nimport {HemisphericCelestialBody} from \"@/YellowSubmarine/sky system/HemisphericCelestialBody\";\r\n\r\nexport class Sun extends HemisphericCelestialBody {\r\n\r\n    // Physics Characteristic\r\n    public override get _defaultPosition(): Vector3{\r\n        return new Vector3(1000, 200, -1000);\r\n    }\r\n    public override get _diameter(): number {\r\n        return 40;\r\n    }\r\n\r\n    // Light Characteristic\r\n    public override get _intensity(): number {\r\n        return 5;\r\n    }\r\n    public override get hemiLightIntensity(){\r\n        return 2;\r\n    }\r\n    public override get _diffuse(): Color3 {\r\n        return new Color3(1.0, 1.0, 1.0);\r\n    }\r\n    public override get _specular(): Color3 {\r\n        return new Color3(1.0, 1.0, 1.0);\r\n    }\r\n    public override get _emissiveColor(): Color3 {\r\n        return new Color3(1.0, 1.0, 1.0);\r\n    }\r\n\r\n    constructor() {\r\n        super();\r\n    }\r\n}","import {\r\n    Color3,\r\n    Vector3\r\n} from \"@babylonjs/core\";\r\nimport {HemisphericCelestialBody} from \"@/YellowSubmarine/sky system/HemisphericCelestialBody\";\r\n\r\nexport class Moon extends HemisphericCelestialBody {\r\n\r\n    // Physics Characteristic\r\n    public override get _defaultPosition(): Vector3{\r\n        return new Vector3(1000, 200, 1000);\r\n    }\r\n    public override get _diameter(): number {\r\n        return 40;\r\n    }\r\n\r\n    // Light Characteristic\r\n    public override get _intensity(): number {\r\n        return 2;\r\n    }\r\n    public override get hemiLightIntensity(){\r\n        return 1;\r\n    }\r\n    public override get _diffuse(): Color3 {\r\n        return new Color3(1.0, 1.0, 1.0);\r\n    }\r\n    public override get _specular(): Color3 {\r\n        return new Color3(1.0, 1.0, 1.0);\r\n    }\r\n    public override get _emissiveColor(): Color3 {\r\n        return new Color3(1.0, 1.0, 1.0);\r\n    }\r\n\r\n    constructor() {\r\n        super();\r\n    }\r\n}\r\n","import {\r\n    Color3, CubeTexture, Effect,\r\n    Mesh,\r\n    MeshBuilder,\r\n    ShaderMaterial, Texture\r\n} from \"@babylonjs/core\";\r\nimport {Game} from \"@/YellowSubmarine/Game\";\r\nimport {Sky} from \"@/YellowSubmarine/sky system/Sky\";\r\n\r\n\r\nexport class SkyBox {\r\n\r\n    private static _instance: SkyBox;\r\n    private _daySkyboxTexture: CubeTexture;\r\n    private _nightSkyboxTexture: CubeTexture;\r\n    private _shaderMaterial: ShaderMaterial;\r\n\r\n    public static get instance(): SkyBox {\r\n        return this._instance;\r\n    }\r\n\r\n    public get mesh(): Mesh {\r\n        return this._mesh;\r\n    }\r\n\r\n    private _mesh: Mesh;\r\n\r\n    constructor() {\r\n        SkyBox._instance = this;\r\n        this._mesh = MeshBuilder.CreateBox(\"skyBox\", { size: 10000 }, Game.scene);\r\n        this._mesh.infiniteDistance = true;\r\n        this._mesh.isPickable = false;\r\n\r\n        this._shaderMaterial = new ShaderMaterial(\"skyboxMaterial\", Game.scene, {\r\n            vertex: \"skyboxShader\",\r\n            fragment: \"skyboxShader\",\r\n        },{\r\n            attributes: [\"position\", \"uv\"],\r\n            uniforms: [\"worldViewProjection\", \"timeOfTheDay\"],\r\n            samplers: [\"daySkyboxTexture\", \"nightSkyboxTexture\"],\r\n        })\r\n\r\n        Game.scene.onBeforeRenderObservable.add(() => {\r\n            this._shaderMaterial.setFloat(\"timeOfTheDay\", Sky.instance.dayNightCycle.timeOfTheDay);\r\n        })\r\n\r\n        this._daySkyboxTexture = CubeTexture.CreateFromImages([\r\n            \"textures/skybox/alternate day/px.png\",\r\n            \"textures/skybox/alternate day/pz.png\",\r\n            \"textures/skybox/alternate day/py.png\",\r\n            \"textures/skybox/alternate day/nx.png\",\r\n            \"textures/skybox/alternate day/nz.png\",\r\n            \"textures/skybox/alternate day/ny.png\"\r\n        ], Game.scene);\r\n        this._daySkyboxTexture.coordinatesMode = Texture.SKYBOX_MODE;\r\n        this._nightSkyboxTexture = CubeTexture.CreateFromImages([\r\n            \"textures/skybox/alternate night/px.png\",\r\n            \"textures/skybox/alternate night/pz.png\",\r\n            \"textures/skybox/alternate night/py.png\",\r\n            \"textures/skybox/alternate night/nx.png\",\r\n            \"textures/skybox/alternate night/nz.png\",\r\n            \"textures/skybox/alternate night/ny.png\"\r\n        ], Game.scene);\r\n        this._nightSkyboxTexture.coordinatesMode = Texture.SKYBOX_MODE;\r\n\r\n        this._shaderMaterial.setTexture(\"daySkyboxTexture\", this._daySkyboxTexture);\r\n        this._shaderMaterial.setTexture(\"nightSkyboxTexture\", this._nightSkyboxTexture);\r\n        this._shaderMaterial.backFaceCulling = false;\r\n\r\n        this._mesh.material = this._shaderMaterial;\r\n\r\n\r\n/*\r\n        const material = new ShaderMaterial(\"skyShader\", Game.scene, {\r\n            vertex: \"sky\",\r\n            fragment: \"sky\",\r\n        }, {\r\n            attributes: [\"position\"],\r\n            uniforms: [\r\n                \"worldViewProjection\", \"timeOfDay\",\r\n                \"dayTop\", \"dayBottom\",\r\n                \"sunsetTop\", \"sunsetBottom\",\r\n                \"dayTop\", \"nightBottom\",\r\n                \"dawnTop\", \"dawnBottom\"\r\n            ],\r\n        });\r\n\r\n        material.backFaceCulling = false;\r\n        this._mesh.material = material;\r\n\r\n        this.initColors(material);\r\n\r\n        Game.scene.onBeforeRenderObservable.add(() => {\r\n            const secondsInCycle = 30;\r\n            const time = performance.now() / 1000;\r\n            const timeOfDay = (time % secondsInCycle) / secondsInCycle;\r\n            material.setFloat(\"timeOfDay\", timeOfDay);\r\n        });\r\n*/\r\n    }\r\n\r\n    private initColors(material: ShaderMaterial): void {\r\n        material.setColor3(\"dayTop\", new Color3(0.3, 0.78, 0.98));       // #3580d9\r\n        material.setColor3(\"dayBottom\", new Color3(1.0, 0.94, 0.80)); // bleu très clair avec un ton chaud\r\n\r\n        material.setColor3(\"sunsetTop\", new Color3(1.0, 0.69, 0.4));     // #ffb066 (anciennement #fff2ce)\r\n        material.setColor3(\"sunsetBottom\", new Color3(0.58, 0.55, 0.82)); // #938cd2\r\n\r\n        material.setColor3(\"dawnTop\", new Color3(0.65, 0.80, 1.0));      // Bleu clair doux #a6ccff\r\n        material.setColor3(\"dawnBottom\", new Color3(1.0, 0.69, 0.4));    // Orange doux #ffb066\r\n\r\n        material.setColor3(\"nightTop\", new Color3(0.043, 0.106, 0.212));    // #3a4a6b\r\n        material.setColor3(\"nightBottom\", new Color3(0.23, 0.29, 0.42)); // #0b1b36\r\n\r\n\r\n    }\r\n\r\n\r\n\r\n}","import {Moon} from \"@/YellowSubmarine/sky system/Moon\";\r\nimport {Sky} from \"@/YellowSubmarine/sky system/Sky\";\r\nimport {Sun} from \"@/YellowSubmarine/sky system/Sun\";\r\nimport {Color3, Observable, Vector3} from \"@babylonjs/core\";\r\nimport {Game} from \"@/YellowSubmarine/Game\";\r\n\r\nexport class DayNightCycle {\r\n    \r\n    private _sun : Sun;\r\n    private _moon : Moon;\r\n    private _time = 0;\r\n    public static onDayChanged = new Observable<boolean>();\r\n    private _isDayTime = true;\r\n\r\n    constructor(sky : Sky) {\r\n        this._sun = sky.sun;\r\n        this._moon = sky.moon;\r\n\r\n        Game.scene.onBeforeRenderObservable.add(() => {\r\n            this._time += Game.engine.getDeltaTime() * 0.00001;\r\n            if (this._time > 1) this._time -= 1;\r\n\r\n            this.updateBody(this._time);\r\n            this.updateLight();\r\n            this.updateMoonLight();\r\n        });\r\n    }\r\n\r\n    public get timeOfTheDay(): number{\r\n        return this._time;\r\n    }\r\n\r\n\r\n\r\n    private updateBody(time: number): void {\r\n        const sunAngle = time * 2.0 * Math.PI;\r\n        const moonAngle = (time * 2.0 * Math.PI) / 1.5 + Math.PI;\r\n\r\n        const sunRadius = this._sun._defaultPosition.length();\r\n        const moonRadius = this._moon._defaultPosition.length();\r\n\r\n        const inclination = Math.PI / 6;\r\n\r\n        const sunX = sunRadius * Math.cos(sunAngle);\r\n        const sunY = sunRadius * Math.sin(sunAngle) * Math.sin(inclination);\r\n        const sunZ = sunRadius * Math.sin(sunAngle) * Math.cos(inclination);\r\n\r\n        const moonInclination = Math.PI / 8;\r\n        const moonX = moonRadius * Math.cos(moonAngle);\r\n        const moonY = moonRadius * Math.sin(moonAngle) * Math.sin(moonInclination);\r\n        const moonZ = moonRadius * Math.sin(moonAngle) * Math.cos(moonInclination);\r\n\r\n        this._sun.position = new Vector3(sunX, sunY, sunZ);\r\n        this._moon.position = new Vector3(moonX, moonY, moonZ);\r\n    }\r\n\r\n    private updateLight(){\r\n        const sunPos = this._sun.position;\r\n        const sunRadius = this._sun._defaultPosition.length();\r\n        const sunHeight = sunPos.y;\r\n\r\n        const normalized = Math.max(0, Math.min(sunHeight / sunRadius, 1));\r\n        const smooth = Math.pow(normalized, 1.5);\r\n\r\n        this._sun.light.intensity = smooth * this._sun._intensity;\r\n\r\n        if (normalized <= 0.01) {\r\n            this._sun.light.setEnabled(false);\r\n        } else {\r\n            this._sun.light.setEnabled(true);\r\n        }\r\n\r\n        if (smooth > 0 && smooth < 0.3) {\r\n            const sunsetColor = Color3.FromHexString(\"#ff884d\");\r\n            this._sun.light.diffuse = Color3.Lerp(sunsetColor, Color3.White(), smooth / 0.3);\r\n        } else {\r\n            this._sun.light.diffuse = Color3.White();\r\n        }\r\n\r\n        const hemi = this._sun.hemiLight;\r\n        if (hemi) {\r\n            const dayColor = Color3.FromHexString(\"#a6fff5\");\r\n            const nightColor = Color3.FromHexString(\"#27274f\");\r\n            hemi.diffuse = Color3.Lerp(nightColor, dayColor, smooth);\r\n        }\r\n\r\n        if(this._isDayTime !== (normalized > 0.01)){\r\n            this._isDayTime = normalized > 0.01;\r\n            DayNightCycle.onDayChanged.notifyObservers(this._isDayTime);\r\n        }\r\n\r\n        Game.scene.ambientColor = new Color3(1, 0, 0);\r\n    }\r\n\r\n    private updateMoonLight(): void {\r\n        const moonPos = this._moon.position;\r\n        const moonRadius = this._moon._defaultPosition.length();\r\n        const moonHeight = moonPos.y;\r\n\r\n        const normalized = Math.max(0, Math.min(moonHeight / moonRadius, 1));\r\n        const smooth = Math.pow(normalized, 1.5);\r\n\r\n        if (this._moon.light) {\r\n            this._moon.light.intensity = smooth * this._moon._intensity;\r\n\r\n            if (normalized <= 0.01) {\r\n                this._moon.light.setEnabled(false);\r\n            } else {\r\n                this._moon.light.setEnabled(true);\r\n            }\r\n        }\r\n\r\n        const hemi = this._moon.hemiLight;\r\n        if (hemi) {\r\n            const nightColor = Color3.FromHexString(\"#818de3\");\r\n            const deepNightColor = Color3.FromHexString(\"#1a1a2e\");\r\n            hemi.diffuse = Color3.Lerp(deepNightColor, nightColor, smooth);\r\n            hemi.intensity = 0.1 + smooth * 0.3;\r\n        }\r\n\r\n    }\r\n}","import {Sun} from \"@/YellowSubmarine/sky system/Sun\";\r\nimport {Moon} from \"@/YellowSubmarine/sky system/Moon\";\r\nimport {SkyBox} from \"@/YellowSubmarine/sky system/SkyBox\";\r\nimport {DayNightCycle} from \"@/YellowSubmarine/sky system/DayNightCycle\";\r\n\r\nexport class Sky{\r\n    private static _instance: Sky;\r\n\r\n    private _sun : Sun;\r\n    private _moon : Moon;\r\n    private _skybox : SkyBox;\r\n    private _dayNightCycle: DayNightCycle;\r\n\r\n    public static get instance(): Sky{\r\n        return this._instance;\r\n    }\r\n\r\n    constructor() {\r\n        Sky._instance = this;\r\n        this._sun = new Sun();\r\n        this._moon = new Moon();\r\n        this._skybox = new SkyBox();\r\n        this._dayNightCycle = new DayNightCycle(this);\r\n    }\r\n\r\n    public get sun(): Sun {\r\n        return this._sun;\r\n    }\r\n\r\n    public set sun(value: Sun) {\r\n        this._sun = value;\r\n    }\r\n\r\n    public static get sun(){\r\n        return this._instance._sun;\r\n    }\r\n\r\n    public get skybox(): SkyBox {\r\n        return this._skybox;\r\n    }\r\n\r\n    public set skybox(value: SkyBox) {\r\n        this._skybox = value;\r\n    }\r\n\r\n    public get moon(): Moon {\r\n        return this._moon;\r\n    }\r\n\r\n    public set moon(value: Moon) {\r\n        this._moon = value;\r\n    }\r\n\r\n    public get dayNightCycle(): DayNightCycle {\r\n        return this._dayNightCycle;\r\n    }\r\n\r\n}","import {\r\n    AbstractMesh, DepthRenderer, Effect, GeometryBufferRenderer, Material, MirrorTexture,\r\n    MultiRenderTarget, Nullable, Plane, RenderTargetTexture, Scene,\r\n    ShaderMaterial, Texture, Vector2, Vector3, Vector4\r\n} from \"@babylonjs/core\";\r\nimport {Game} from \"@/YellowSubmarine/Game\";\r\nimport {Sky} from \"@/YellowSubmarine/sky system/Sky\";\r\n\r\nexport class ReflectiveToonWaterMaterial {\r\n\r\n    private static _instance: ReflectiveToonWaterMaterial;\r\n\r\n    protected _scene: Scene;\r\n    protected _material: ShaderMaterial;\r\n    private _depthRenderer: DepthRenderer;\r\n    private _depthMap: RenderTargetTexture;\r\n    private _geometryBufferRenderer: Nullable<GeometryBufferRenderer>;\r\n    private _gBuffer: Nullable<MultiRenderTarget> = null;\r\n    private _renderListPredicate: (mesh: AbstractMesh) => boolean;\r\n\r\n    protected constructor() {\r\n        ReflectiveToonWaterMaterial._instance = this;\r\n        this._scene = Game.scene;\r\n        const camera = this._scene.activeCamera;\r\n\r\n        this._material = new ShaderMaterial(\"toonWaterMaterial\", this._scene,{\r\n            vertex: this.shaderMaterialName, fragment: this.shaderMaterialName,\r\n        },{\r\n            attributes: [\"position\", \"normal\", \"uv\"],\r\n            uniforms: [\"world\",\"view\",\"projection\",\"depthShallowColor\", \"depthDeepColor\", \"depthMaximumDistance\",\r\n                \"surfaceNoiseST\", \"surfaceNoiseCutoff\", \"foamMaxDistance\", \"foamMinDistance\", \"surfaceNoiseScroll\", \"time\", \"surfaceDistortionST\",\r\n                \"surfaceDistortionAmount\", \"screensize\", \"timeOfTheDay\"],\r\n            samplers: [\"linearDepthTexture\", \"surfaceNoiseTexture\",\"surfaceDistortionTexture\",\"reflectionTexture\"],\r\n            needAlphaTesting: true,\r\n        });\r\n\r\n\r\n        this._depthRenderer = this._scene.enableDepthRenderer(undefined, false, undefined, undefined, true);\r\n        this._depthMap = this._depthRenderer.getDepthMap();\r\n        this._renderListPredicate = (m) => m.material !== this._material;\r\n        this._depthMap.renderListPredicate = this._renderListPredicate;\r\n\r\n        this._material.setVector4(\"depthShallowColor\", new Vector4(0.325, 0.807, 0.971, 0.725));\r\n        this._material.setVector4(\"depthDeepColor\", new Vector4(0.086, 0.407, 1, 0.749));\r\n        this._material.setFloat(\"depthMaximumDistance\", 10.0);\r\n        this._material.setTexture(\"linearDepthTexture\", this._depthMap);\r\n        this._material.setVector4(\"surfaceNoiseST\", new Vector4(1, 4, 0, 0));\r\n        this._material.setTexture(\"surfaceNoiseTexture\", new Texture(\"textures/PerlinNoise.png\"));\r\n        this._material.setFloat(\"surfaceNoiseCutoff\", 0.85);\r\n        this._material.setFloat(\"foamMaxDistance\", 0.6);\r\n        this._material.setFloat(\"foamMinDistance\", 0.04);\r\n        this._material.setVector2(\"surfaceNoiseScroll\", new Vector2(0.03, 0.03));\r\n        this._material.setVector4(\"surfaceDistortionST\", new Vector4(1,1,0,0));\r\n        this._material.setFloat(\"surfaceDistortionAmount\", 0.27);\r\n        this._material.setTexture(\"surfaceDistortionTexture\", new Texture(\"textures/WaterDistortion.png\"));\r\n        Game.scene.onBeforeRenderObservable.add(() => {\r\n            this._material.setFloat(\"timeOfTheDay\", Sky.instance.dayNightCycle.timeOfTheDay);\r\n        })\r\n        this._material.setVector2(\"screensize\", new Vector2(window.innerWidth, window.innerHeight));\r\n        window.addEventListener(\"resize\", () => this._material.setVector2(\"screensize\", new Vector2(window.innerWidth, window.innerHeight)) );\r\n        const mirrorTexture = new MirrorTexture(\"mirrorTexture\", 1024, Game.scene);\r\n        mirrorTexture.mirrorPlane = Plane.FromPositionAndNormal(Vector3.Zero(), Vector3.Down());\r\n        mirrorTexture.renderListPredicate = (m) => true;\r\n        this._material.setTexture(\"reflectionTexture\", mirrorTexture);\r\n        Game.scene.customRenderTargets.push(mirrorTexture);\r\n        // this._material.disableDepthWrite = false;\r\n\r\n        this._geometryBufferRenderer = this._scene.enableGeometryBufferRenderer();\r\n        if(this._geometryBufferRenderer != null) {\r\n            this._geometryBufferRenderer.enableNormal;\r\n            this._gBuffer = this._geometryBufferRenderer.getGBuffer();\r\n            this._gBuffer.renderListPredicate = this._renderListPredicate\r\n            const cameraNormalTexture = this._gBuffer.textures[GeometryBufferRenderer.NORMAL_TEXTURE_TYPE];\r\n            this._material.setTexture(\"cameraNormalTexture\", cameraNormalTexture);\r\n        }\r\n\r\n        let time = 0;\r\n        Game.scene.onBeforeRenderObservable.add(() => {\r\n            time += (Game.engine.getDeltaTime()/1000) * 0.01;\r\n            this._material.setFloat(\"time\", time);\r\n        })\r\n\r\n        /*this._material = new ShaderMaterial(\"mirror\", Game.scene, {\r\n            vertex: \"mirror\", fragment: \"mirror\"\r\n        },{\r\n            attributes: [\"position\", \"normal\", \"uv\"],\r\n            uniforms: [\"worldViewProjection\", \"screensize\"],\r\n            samplers: [\"mirrorSampler\"]\r\n        })\r\n\r\n        const mirrorTexture = new MirrorTexture(\"mirrorTex\",512, Game.scene);\r\n        mirrorTexture.mirrorPlane = Plane.FromPositionAndNormal(Vector3.Zero(), Vector3.Down());\r\n        mirrorTexture.renderListPredicate = (m) => m.material !== this._material;\r\n        this._material.setTexture(\"mirrorSampler\", mirrorTexture);\r\n        const canvas = Game.canvas;\r\n        this._material.setVector2(\"screensize\", new Vector2(canvas.width, canvas.height));\r\n        canvas.addEventListener(\"resize\", () => this._material.setVector2(\"screensize\", new Vector2(canvas.width, canvas.height)) );\r\n        Game.scene.customRenderTargets.push(mirrorTexture);*/\r\n\r\n    }\r\n\r\n    public static get instance(){\r\n        if(this._instance == null){\r\n            this._instance = new this();\r\n        }\r\n        return this._instance;\r\n    }\r\n\r\n    public static get material(){\r\n        return this.instance._material;\r\n    }\r\n\r\n    protected get shaderMaterialName(){ return \"toonWaterAndReflections\"; }\r\n\r\n}","import {\r\n    Mesh,\r\n    MeshBuilder,\r\n    PhysicsBody,\r\n    PhysicsMotionType,\r\n    PhysicsShape,\r\n    PhysicsShapeType,\r\n    Vector3,\r\n} from \"@babylonjs/core\";\r\nimport {Game} from \"@/YellowSubmarine/Game\";\r\nimport {ReflectiveToonWaterMaterial} from \"@/YellowSubmarine/shader material/ReflectiveToonWaterMaterial\";\r\n\r\nexport class Sea {\r\n\r\n        private static _instance: Sea;\r\n        private _seaMesh: Mesh;\r\n        private _invisiblePlane: Mesh;\r\n        private _invisiblePlaneBody: PhysicsBody;\r\n        private _invisiblePlaneShape: PhysicsShape;\r\n\r\n        constructor() {\r\n            Sea._instance = this;\r\n            this._seaMesh = MeshBuilder.CreateGround(\r\n                \"waterPlane\",\r\n                {\r\n                    width: 2548,\r\n                    height: 2548,\r\n                    subdivisions: 192,\r\n                },\r\n                Game.scene\r\n            );\r\n            this._invisiblePlane = MeshBuilder.CreateGround(\r\n                \"collisionPlane\",\r\n                {\r\n                    width: 2048,\r\n                    height: 2048,\r\n                    subdivisions: 128,\r\n                },\r\n                Game.scene\r\n            );\r\n            this._invisiblePlane.position = new Vector3(0,-2,0);\r\n            this._invisiblePlaneBody = new PhysicsBody(this._invisiblePlane, PhysicsMotionType.STATIC, false, Game.scene);\r\n            this._invisiblePlaneShape = new PhysicsShape({\r\n                type: PhysicsShapeType.BOX,\r\n                parameters: {\r\n                    mesh: this._invisiblePlane,\r\n                    extents: new Vector3(2048,2,2048),\r\n                }\r\n            }, Game.scene);\r\n            this._invisiblePlaneBody.shape = this._invisiblePlaneShape;\r\n            this._invisiblePlaneBody.setMassProperties({\r\n                mass: 0,\r\n            });\r\n            this._seaMesh.material = ReflectiveToonWaterMaterial.material;\r\n\r\n        }\r\n\r\n\r\n}","import {\r\n    Angle,\r\n    ArcRotateCamera,\r\n    Scalar,\r\n    Vector3\r\n} from \"@babylonjs/core\";\r\nimport {Game} from \"@/YellowSubmarine/Game\";\r\nimport {CameraConfiguration} from \"@/YellowSubmarine/camera system/CameraConfiguration\";\r\nimport {Lerp} from \"@babylonjs/core/Maths/math.scalar.functions\";\r\n\r\nexport class ConfigurableCamera {\r\n    private static _instance: ConfigurableCamera;\r\n\r\n    public static get instance(): ConfigurableCamera {\r\n        return this._instance;\r\n    }\r\n\r\n    private _cameraConfiguration?: CameraConfiguration;\r\n    private _arcRotateCamera: ArcRotateCamera;\r\n    private _positionLerpFactor = 2.0;\r\n    private _rotationLerpFactor = 2.0;\r\n\r\n    constructor() {\r\n        ConfigurableCamera._instance = this;\r\n        this._arcRotateCamera = new ArcRotateCamera(\"customCamera\", 0, 0, 0, Vector3.Zero(), Game.scene);\r\n        Game.scene.onBeforeRenderObservable.add( () => {\r\n            const deltaTimeInSeconds = Game.engine.getDeltaTime() / 1000;\r\n            this.update(deltaTimeInSeconds);\r\n        } );\r\n    }\r\n\r\n    public set cameraConfiguration(cameraParameter: CameraConfiguration | undefined) {\r\n        const oldCameraParameter = this._cameraConfiguration;\r\n        this._cameraConfiguration = cameraParameter;\r\n        if(!oldCameraParameter){\r\n            this.jumpToTarget();\r\n        }\r\n    }\r\n\r\n    public get cameraConfiguration(): CameraConfiguration | undefined {\r\n        return this._cameraConfiguration;\r\n    }\r\n\r\n    private update(deltaTimeInSec: number) {\r\n        this.updatePosition(deltaTimeInSec);\r\n        this.updateRotation(deltaTimeInSec);\r\n    }\r\n\r\n    private jumpToTarget(){\r\n        if(this._cameraConfiguration){\r\n            this._arcRotateCamera.target = this._cameraConfiguration.targetPosition;\r\n            this._arcRotateCamera.alpha = this._cameraConfiguration.wantedAlpha;\r\n            this._arcRotateCamera.beta = this._cameraConfiguration.wantedBeta;\r\n            this._arcRotateCamera.radius = this._cameraConfiguration.distanceFromTarget;\r\n        }\r\n    }\r\n\r\n    private updatePosition(deltaTimeInSec: number) {\r\n        if(this._cameraConfiguration) {\r\n            const target = this._cameraConfiguration.target;\r\n            if(target){\r\n                this._arcRotateCamera.target = Vector3.Lerp(this._arcRotateCamera.target, this._cameraConfiguration.targetPosition, deltaTimeInSec * this._positionLerpFactor);\r\n            }\r\n            this._arcRotateCamera.radius = Lerp(this._arcRotateCamera.radius, this._cameraConfiguration.distanceFromTarget, deltaTimeInSec * this._positionLerpFactor);\r\n            this._arcRotateCamera.lowerRadiusLimit = this._arcRotateCamera.radius;\r\n            this._arcRotateCamera.upperRadiusLimit = this._arcRotateCamera.radius;\r\n        }\r\n    }\r\n\r\n    private updateRotation(deltaTimeInSec: number) {\r\n        if(this._cameraConfiguration) {\r\n            const wantedAlpha = this._cameraConfiguration.wantedAlpha;\r\n            const wantedBeta = this._cameraConfiguration.wantedBeta;\r\n            this._arcRotateCamera.alpha =  Angle.FromDegrees( Scalar.LerpAngle(Angle.FromRadians(this._arcRotateCamera.alpha).degrees(), Angle.FromRadians(wantedAlpha).degrees(), deltaTimeInSec * this._rotationLerpFactor) ).radians();\r\n            this._arcRotateCamera.beta =  Angle.FromDegrees( Scalar.LerpAngle(Angle.FromRadians(this._arcRotateCamera.beta).degrees(), Angle.FromRadians(wantedBeta).degrees(), deltaTimeInSec * this._rotationLerpFactor) ).radians();\r\n        }\r\n    }\r\n\r\n}","import {Angle, Quaternion, TransformNode, Vector3} from \"@babylonjs/core\";\r\n\r\nexport class CameraConfiguration {\r\n\r\n    private _offset: Vector3 = Vector3.Zero();\r\n    private _wantedAlpha = 0;\r\n    private _wantedBeta = Angle.FromDegrees(80).radians();\r\n    private _distanceFromTarget = 10;\r\n    private _target?: TransformNode\r\n    private _currentLowerBetaLimit? : number;\r\n    private _currentUpperBetaLimit? : number;\r\n\r\n    public get targetPosition(): Vector3{\r\n        return ( this._target?.absolutePosition ?? Vector3.Zero() ).add( this._offset.rotateByQuaternionToRef(this._target?.absoluteRotationQuaternion ?? Quaternion.Identity(), Vector3.Zero() ) );\r\n    }\r\n\r\n    public get offset(): Vector3 {\r\n        return this._offset;\r\n    }\r\n\r\n    public set offset(offset: Vector3) {\r\n        this._offset = offset;\r\n    }\r\n\r\n    public get wantedAlpha(): number {\r\n        return this._wantedAlpha;\r\n    }\r\n\r\n    public set wantedAlpha(alpha: number) {\r\n        this._wantedAlpha = alpha;\r\n    }\r\n\r\n    public get wantedBeta(): number {\r\n        return this._wantedBeta;\r\n    }\r\n\r\n    public set wantedBeta(beta: number) {\r\n        this._wantedBeta = beta;\r\n        if(this._currentLowerBetaLimit){\r\n            this._wantedBeta = Math.max(this._wantedBeta, this._currentLowerBetaLimit);\r\n        }\r\n        if(this._currentUpperBetaLimit){\r\n            this._wantedBeta = Math.min(this._wantedBeta, this._currentUpperBetaLimit);\r\n        }\r\n    }\r\n\r\n    public get distanceFromTarget(): number {\r\n        return this._distanceFromTarget;\r\n    }\r\n\r\n    public set distanceFromTarget(distanceFromTarget: number) {\r\n        this._distanceFromTarget = distanceFromTarget;\r\n    }\r\n\r\n    public get target(): TransformNode | undefined {\r\n        return this._target;\r\n    }\r\n\r\n    public set target(target: TransformNode | undefined) {\r\n        this._target = target;\r\n    }\r\n\r\n    public get currentUpperBetaLimit(): number | undefined {\r\n        return this._currentUpperBetaLimit;\r\n    }\r\n\r\n    public set currentUpperBetaLimit(value: number | undefined) {\r\n        this._currentUpperBetaLimit = value;\r\n    }\r\n\r\n    public get currentLowerBetaLimit(): number | undefined {\r\n        return this._currentLowerBetaLimit;\r\n    }\r\n\r\n    public set currentLowerBetaLimit(value: number | undefined) {\r\n        this._currentLowerBetaLimit = value;\r\n    }\r\n\r\n}\r\n","import {AbstractInteraction} from \"@/YellowSubmarine/interaction system/interactions/AbstractInteraction\";\r\nimport {KeyboardEventTypes, Observable} from \"@babylonjs/core\";\r\nimport {Player} from \"@/YellowSubmarine/Player\";\r\n\r\nexport class InteractionManager{\r\n\r\n    private static _instance: InteractionManager;\r\n\r\n    public static get instance(): InteractionManager {\r\n        return this._instance;\r\n    }\r\n\r\n    // private _interactionArray: Array<AbstractInteraction> = new Array<AbstractInteraction>();\r\n    private _currentInteraction?: AbstractInteraction;\r\n\r\n    public onInteractionAvailable: Observable<AbstractInteraction>;\r\n    public onInteractionUnavailable: Observable<AbstractInteraction>;\r\n\r\n    constructor() {\r\n        InteractionManager._instance = this;\r\n        this.onInteractionAvailable = new Observable<AbstractInteraction>();\r\n        this.onInteractionUnavailable = new Observable<AbstractInteraction>();\r\n        Player.onPlayerPressedAKey.add( (eventData) => {\r\n\r\n            if(\r\n                eventData.type === KeyboardEventTypes.KEYDOWN &&\r\n                this._currentInteraction &&\r\n                eventData.event.code === this._currentInteraction.code\r\n            ) {\r\n                this.executeInteraction();\r\n            }\r\n        } )\r\n    }\r\n\r\n    public makeInteractionAvailable(interaction: AbstractInteraction){\r\n        if(this._currentInteraction) {\r\n            this.makeInteractionUnavailable(this._currentInteraction);\r\n        }\r\n        this._currentInteraction = interaction;\r\n        this.onInteractionAvailable.notifyObservers(interaction);\r\n    }\r\n\r\n    public makeInteractionUnavailable(interaction: AbstractInteraction){\r\n        this.onInteractionUnavailable.notifyObservers(interaction);\r\n        this._currentInteraction = undefined;\r\n    }\r\n\r\n    public executeInteraction(){\r\n        const interaction = this._currentInteraction;\r\n        if(interaction){\r\n            interaction.executeInteraction();\r\n        }\r\n    }\r\n\r\n}","import {InteractionManager} from \"@/YellowSubmarine/interaction system/InteractionManager\";\r\n\r\nexport abstract class AbstractInteraction {\r\n\r\n    protected _code:string;\r\n    protected  _simplifiedCode: string;\r\n\r\n    public get code(): string {\r\n        return this._code;\r\n    }\r\n\r\n    public get simplifiedCode(): string {\r\n        return this._simplifiedCode;\r\n    }\r\n\r\n    protected constructor(code: string, simplifiedCode: string) {\r\n        this._code = code;\r\n        this._simplifiedCode = simplifiedCode;\r\n    }\r\n\r\n    public makeAvailable(){\r\n        InteractionManager.instance.makeInteractionAvailable(this);\r\n    }\r\n\r\n    public makeUnavailable(){\r\n        InteractionManager.instance.makeInteractionUnavailable(this);\r\n    }\r\n\r\n    public abstract executeInteraction(): void;\r\n\r\n}","import {AbstractInteraction} from \"@/YellowSubmarine/interaction system/interactions/AbstractInteraction\";\r\nimport {AbstractMesh} from \"@babylonjs/core\";\r\n\r\nexport abstract class DialogueInteraction extends AbstractInteraction{\r\n    public abstract get mesh():AbstractMesh | undefined;\r\n}","import {Control} from \"@babylonjs/gui\";\r\n\r\nexport abstract class UI{\r\n\r\n    public abstract get controlNode(): Control;\r\n}","import {ImportMeshAsync, ImportMeshOptions, Scene} from \"@babylonjs/core\";\r\nimport {Game} from \"@/YellowSubmarine/Game\";\r\n\r\nexport class Utils {\r\n\r\n    public static loadMesh(path: string, scene?: Scene,  options?: ImportMeshOptions | undefined) {\r\n        return ImportMeshAsync(path, scene??Game.scene, options);\r\n    }\r\n\r\n    public static sleep(ms: number) {\r\n        return new Promise(resolve => setTimeout(resolve, ms));\r\n    }\r\n\r\n}","import {BBStyle} from \"@/YellowSubmarine/ui system/BBCode/BBStyle\";\r\n\r\nexport abstract class BBTag {\r\n\r\n    constructor(public param?: string){}\r\n\r\n    public abstract onOpen(style: BBStyle): BBStyle;\r\n\r\n    public onClose(style: BBStyle): BBStyle{\r\n        return style;\r\n    }\r\n\r\n}","import {BBTag} from \"@/YellowSubmarine/ui system/BBCode/BBTag\";\r\nimport {BBStyle} from \"@/YellowSubmarine/ui system/BBCode/BBStyle\";\r\n\r\nexport class ItalicTag extends BBTag {\r\n    onOpen(style: BBStyle): BBStyle {\r\n        return {...style, italic: true};\r\n    }\r\n}","import {BBTag} from \"@/YellowSubmarine/ui system/BBCode/BBTag\";\r\nimport {BBStyle} from \"@/YellowSubmarine/ui system/BBCode/BBStyle\";\r\n\r\nexport class BoldTag extends BBTag {\r\n    onOpen(style: BBStyle): BBStyle {\r\n        return {...style, bold: true};\r\n    }\r\n\r\n}","import {BBTag} from \"@/YellowSubmarine/ui system/BBCode/BBTag\";\r\nimport {BBStyle} from \"@/YellowSubmarine/ui system/BBCode/BBStyle\";\r\n\r\nexport class ColorTag extends BBTag {\r\n    onOpen(style: BBStyle): BBStyle {\r\n        return {...style, color: this.param || style.color};\r\n    }\r\n\r\n}","import {BBTag} from \"@/YellowSubmarine/ui system/BBCode/BBTag\";\r\nimport {BBStyle} from \"@/YellowSubmarine/ui system/BBCode/BBStyle\";\r\n\r\nexport class SizeTag extends BBTag {\r\n\r\n    onOpen(style: BBStyle): BBStyle {\r\n        const newStyle = {...style};\r\n        const parsedSize = parseInt(this.param || \"\");\r\n\r\n        if(!isNaN(parsedSize)){\r\n            newStyle.size = parsedSize;\r\n        }\r\n        return newStyle;\r\n    }\r\n\r\n}","import {BBStyle} from \"@/YellowSubmarine/ui system/BBCode/BBStyle\";\r\nimport {BBTag} from \"@/YellowSubmarine/ui system/BBCode/BBTag\";\r\nimport {ItalicTag} from \"@/YellowSubmarine/ui system/BBCode/Tags/ItalicTag\";\r\nimport {BoldTag} from \"@/YellowSubmarine/ui system/BBCode/Tags/BoldTag\";\r\nimport {ColorTag} from \"@/YellowSubmarine/ui system/BBCode/Tags/ColorTag\";\r\nimport {SizeTag} from \"@/YellowSubmarine/ui system/BBCode/Tags/SizeTag\";\r\n\r\ninterface Segment { text: string; style: BBStyle; }\r\n\r\nexport class BBParser {\r\n\r\n    private _registry = new Map<string, new (param?: string) => BBTag>();\r\n\r\n    constructor() {\r\n        this.initRegistry();\r\n    }\r\n\r\n    private initRegistry(): void{\r\n        this._registry.set(\"i\", ItalicTag);\r\n        this._registry.set(\"g\", BoldTag);\r\n        this._registry.set(\"c\", ColorTag);\r\n        this._registry.set(\"s\", SizeTag);\r\n    }\r\n\r\n    public parseBBCode(input: string): Segment[] {\r\n        const segments: Segment[] = [];\r\n        const tagStack: BBTag[] = [];\r\n        const styleStack: BBStyle[] = [];\r\n\r\n        let cursor = 0;\r\n        let currentStyle: BBStyle = {};\r\n\r\n        const regex = /\\[\\/?([a-z]+)(?:=([^\\]]+))?\\]/ig;\r\n        let match: RegExpExecArray | null;\r\n\r\n        while ((match = regex.exec(input))) {\r\n            const [full, name, param] = match;\r\n            const isClosing = full.startsWith(\"[/\");\r\n            const idx = match.index;\r\n\r\n            // 1) Texte avant le tag\r\n            if (idx > cursor) {\r\n                segments.push({ text: input.slice(cursor, idx), style: { ...currentStyle } });\r\n            }\r\n            cursor = idx + full.length;\r\n\r\n            if (!isClosing) {\r\n                const TagClass = this._registry.get(name);\r\n                if (TagClass) {\r\n                    const tagInstance = new TagClass(param);\r\n                    tagStack.push(tagInstance);\r\n                    styleStack.push({ ...currentStyle }); // snapshot du style\r\n                    currentStyle = tagInstance.onOpen(currentStyle);\r\n                }\r\n            } else {\r\n                const last = tagStack.pop();\r\n                const previousStyle = styleStack.pop();\r\n                if (last && previousStyle) {\r\n                    currentStyle = previousStyle; // restore snapshot\r\n                }\r\n            }\r\n        }\r\n\r\n        if (cursor < input.length) {\r\n            segments.push({ text: input.slice(cursor), style: { ...currentStyle } });\r\n        }\r\n\r\n        return segments;\r\n    }\r\n\r\n\r\n}","import { BBParser } from \"@/YellowSubmarine/ui system/BBCode/BBParser\";\r\nimport { BBStyle } from \"@/YellowSubmarine/ui system/BBCode/BBStyle\";\r\nimport { Control, TextBlock, StackPanel } from \"@babylonjs/gui\";\r\n\r\nexport interface StyledSegment {\r\n    text: string;\r\n    style: BBStyle;\r\n}\r\n\r\nexport interface StyledTextBlock {\r\n    tb: TextBlock;\r\n    full: string;\r\n}\r\n\r\nexport class TextLayoutManager {\r\n    private parser: BBParser;\r\n    private ctx: CanvasRenderingContext2D;\r\n    private defaultFontSize: number;\r\n    private horizontalPadding: number;\r\n\r\n    constructor(\r\n        ctx: CanvasRenderingContext2D,\r\n        defaultFontSize = 24,\r\n        horizontalPadding = 4\r\n    ) {\r\n        this.parser = new BBParser();\r\n        this.ctx = ctx;\r\n        this.defaultFontSize = defaultFontSize;\r\n        this.horizontalPadding = horizontalPadding;\r\n    }\r\n\r\n    public layout(text: string, maxWidth: number): { lines: StyledSegment[][]; segments: StyledSegment[] } {\r\n        const segments = this.parser.parseBBCode(text).map(s => ({\r\n            text: s.text,\r\n            style: s.style\r\n        }));\r\n\r\n        const lines = this.splitLines(segments, maxWidth);\r\n\r\n        return { lines, segments };\r\n    }\r\n\r\n    private getTextWidth(text: string, fontSize: number): number {\r\n        this.ctx.font = `${fontSize}px sans-serif`;\r\n        return this.ctx.measureText(text).width;\r\n    }\r\n\r\n    private splitLines(segments: StyledSegment[], maxWidth: number): StyledSegment[][] {\r\n        const lines: StyledSegment[][] = [];\r\n        let currentLine: StyledSegment[] = [];\r\n        let currentWidth = 0;\r\n\r\n        for (const segment of segments) {\r\n            const fontSize = segment.style.size || this.defaultFontSize;\r\n            const segWidth = this.getTextWidth(segment.text, fontSize) + this.horizontalPadding * 2;\r\n\r\n            if (currentWidth + segWidth <= maxWidth) {\r\n                currentLine.push(segment);\r\n                currentWidth += segWidth;\r\n            } else {\r\n                const parts = segment.text.split(/(\\s+)/);\r\n\r\n                for (const part of parts) {\r\n                    if (part === '' || (part.trim() === '' && currentLine.length === 0)) continue;\r\n\r\n                    const partWidth = this.getTextWidth(part, fontSize) + this.horizontalPadding * 2;\r\n\r\n                    if (currentWidth + partWidth > maxWidth && currentLine.length) {\r\n                        lines.push(currentLine);\r\n                        currentLine = [];\r\n                        currentWidth = 0;\r\n                        if (part.trim() === '') continue;\r\n                    }\r\n\r\n                    currentLine.push({ text: part, style: segment.style });\r\n                    currentWidth += partWidth;\r\n                }\r\n            }\r\n        }\r\n\r\n        if (currentLine.length) lines.push(currentLine);\r\n        return lines;\r\n    }\r\n\r\n    /**\r\n     * Crée les StackPanels (lignes) et TextBlocks (segments) formatés.\r\n     * Renvoie un tableau d'objets pour animer le texte.\r\n     */\r\n    public createTextBlocks(\r\n        lines: StyledSegment[][],\r\n        lineHeight: number,\r\n        textBlockHorizontalPadding: number,\r\n        defaultFontSize: number\r\n    ): { linesPanels: StackPanel[]; blocks: StyledTextBlock[] } {\r\n        const blocks: StyledTextBlock[] = [];\r\n        const linesPanels: StackPanel[] = [];\r\n\r\n        lines.forEach(lineSegments => {\r\n            const row = new StackPanel();\r\n            row.isVertical = false;\r\n            row.height = `${lineHeight}px`;\r\n            row.horizontalAlignment = Control.HORIZONTAL_ALIGNMENT_CENTER;\r\n            row.verticalAlignment = Control.VERTICAL_ALIGNMENT_BOTTOM;\r\n\r\n            lineSegments.forEach(segment => {\r\n                const tb = new TextBlock();\r\n                tb.text = \"\";\r\n                this.applyStyle(tb, segment.style, textBlockHorizontalPadding, defaultFontSize);\r\n                tb.textWrapping = false;\r\n                tb.resizeToFit = true;\r\n                tb.verticalAlignment = Control.VERTICAL_ALIGNMENT_BOTTOM;\r\n\r\n                row.addControl(tb);\r\n                blocks.push({ tb, full: segment.text });\r\n            });\r\n\r\n            linesPanels.push(row);\r\n        });\r\n\r\n        return { linesPanels, blocks };\r\n    }\r\n\r\n    private applyStyle(tb: TextBlock, style: BBStyle, padding: number, defaultFontSize: number) {\r\n        tb.fontWeight = style.bold ? \"bold\" : \"normal\";\r\n        tb.fontStyle = style.italic ? \"italic\" : \"normal\";\r\n        tb.color = style.color || \"black\";\r\n        tb.fontSize = style.size || defaultFontSize;\r\n        tb.paddingLeft = `${padding}px`;\r\n        tb.paddingRight = `${padding}px`;\r\n    }\r\n}\r\n","import {\r\n    AbstractMesh,\r\n    CreateAudioEngineAsync,\r\n    CreateSoundAsync, ISoundOptions, SoundState,\r\n    StaticSound\r\n} from \"@babylonjs/core\";\r\nimport {Game} from \"@/YellowSubmarine/Game\";\r\nexport class SoundManager {\r\n\r\n    public static instance: SoundManager;\r\n    private _audioEngine;\r\n    private _SFXsounds = new Map<string, StaticSound>();\r\n    private _UIsounds = new Map<string, StaticSound>();\r\n    private _MUSICsounds = new Map<string, StaticSound>();\r\n\r\n    private _SFXVolume : number;\r\n    private _UIVolume : number;\r\n    private _MUSICVolume : number;\r\n\r\n\r\n    constructor() {\r\n        SoundManager.instance = this;\r\n        this._SFXVolume = 0.5;\r\n        this._UIVolume = 1;\r\n        this._MUSICVolume = 0.5;\r\n        Game.scene.headphone = true;\r\n        this._audioEngine = CreateAudioEngineAsync();\r\n        this._audioEngine.then((engine) => {\r\n            engine.unlockAsync();\r\n            Game.scene.onBeforeRenderObservable.add(() => {\r\n                if(Game.scene.activeCamera !== null) {\r\n                    engine.listener.position = Game.scene.activeCamera?.position;\r\n                }\r\n            });\r\n        });\r\n        Game.scene.onReadyObservable.add(() => {\r\n            this.playSFX(\"wind\", {\r\n                loop: true,\r\n                autoplay: true,\r\n            });\r\n        })\r\n        Game.scene.onReadyObservable.add(() => {\r\n            this.playMUSIC(\"ambiant\", {\r\n                loop: true,\r\n                autoplay: true,\r\n            });\r\n        })\r\n    }\r\n\r\n    private async load(name: string, url: string, options?: Partial<ISoundOptions>) {\r\n        return CreateSoundAsync(name, `${url}/${name}.wav`, options);\r\n    }\r\n\r\n    protected async play(name: string, url: string, map: Map<string, StaticSound>, volume: number, options?: Partial<ISoundOptions>, mesh?: AbstractMesh) {\r\n        const sound = map.get(name);\r\n        if(sound) {\r\n            if(sound.state !== SoundState.Started) {\r\n                this.fadeIn(sound, volume, 100);\r\n                sound.play();\r\n            }\r\n        }\r\n        else{\r\n            const sound = await this.load(name, url, options);\r\n            map.set(name, sound)\r\n            if (options?.spatialSound && mesh) {\r\n                sound.spatial.attach(mesh);\r\n                sound.spatial.maxDistance = options.maxDistance ?? 100;\r\n                sound.spatial.distanceModel = \"linear\";\r\n                console.log(sound.spatial);\r\n            }\r\n            this.fadeIn(sound, volume, 1000);\r\n            sound.play();\r\n        }\r\n    }\r\n\r\n    public async playSFX(name: string, options?: Partial<ISoundOptions>, mesh?: AbstractMesh) {\r\n        await this.play(name, \"sounds/sfx\", this._SFXsounds, this.SFXVolume, options, mesh);\r\n    }\r\n\r\n    public async playUI(name: string, options?: Partial<ISoundOptions>, mesh?: AbstractMesh) {\r\n        await this.play(name, \"sounds/ui\", this._UIsounds, this.UIVolume, options, mesh);\r\n    }\r\n\r\n    public async playMUSIC(name: string, options?: Partial<ISoundOptions>, mesh?: AbstractMesh) {\r\n        await this.play(name, \"sounds/music\", this._MUSICsounds, this.MUSICVolume, options, mesh);\r\n    }\r\n\r\n    private fadeIn(sound: StaticSound, targetVolume: number, duration: number) {\r\n        sound.volume = 0;\r\n        const stepTime = 20;\r\n        const steps = duration / stepTime;\r\n        let currentStep = 0;\r\n\r\n        const interval = setInterval(() => {\r\n            currentStep++;\r\n            const volume = targetVolume * (currentStep / steps);\r\n            sound.volume = Math.min(volume, targetVolume);\r\n            if (currentStep >= steps) clearInterval(interval);\r\n        }, stepTime);\r\n    }\r\n\r\n    private fadeOutAndStop(sound: StaticSound, duration: number) {\r\n        const stepTime = 20;\r\n        const steps = duration / stepTime;\r\n        let currentStep = 0;\r\n        const initialVolume = sound.volume;\r\n\r\n        const interval = setInterval(() => {\r\n            currentStep++;\r\n            const volume = initialVolume * (1 - currentStep / steps);\r\n            sound.volume = Math.max(volume, 0);\r\n            if (currentStep >= steps) {\r\n                clearInterval(interval);\r\n                sound.stop();\r\n            }\r\n        }, stepTime);\r\n    }\r\n\r\n    public stopSFX(name: string) {\r\n        const sound = this._SFXsounds.get(name);\r\n        if (sound) this.fadeOutAndStop(sound, 100);\r\n    }\r\n\r\n    public stopUI(name: string) {\r\n        const sound = this._UIsounds.get(name);\r\n        if (sound) this.fadeOutAndStop(sound, 100);\r\n    }\r\n\r\n    public stopMUSIC(name: string) {\r\n        const sound = this._MUSICsounds.get(name);\r\n        if (sound) this.fadeOutAndStop(sound, 100);\r\n    }\r\n\r\n    public stopAll(map : Map<string, StaticSound>) {\r\n        map.forEach(sound => {sound.stop()});\r\n    }\r\n\r\n    public get SFXVolume(): number {\r\n        return this._SFXVolume;\r\n    }\r\n\r\n    public set SFXVolume(value: number) {\r\n        this._SFXVolume = value;\r\n        this._SFXsounds.forEach((sound) => {\r\n            sound.volume = this._SFXVolume;\r\n        })\r\n    }\r\n\r\n    public get UIVolume(): number {\r\n        return this._UIVolume;\r\n    }\r\n\r\n    public set UIVolume(value: number) {\r\n        this._UIVolume = value;\r\n        this._UIsounds.forEach((sound) => {\r\n            sound.volume = this._UIVolume;\r\n        })\r\n    }\r\n\r\n    public get MUSICVolume(): number {\r\n        return this._MUSICVolume;\r\n    }\r\n\r\n    public set MUSICVolume(value: number) {\r\n        this._MUSICVolume = value;\r\n        this._MUSICsounds.forEach((sound) => {\r\n            sound.volume = this._MUSICVolume;\r\n        })\r\n    }\r\n}","import { Utils } from \"@/YellowSubmarine/Utils\";\r\nimport {StyledTextBlock} from \"@/YellowSubmarine/ui system/TextLayoutManager\";\r\nimport {SoundManager} from \"@/YellowSubmarine/sound system/SoundManager\";\r\n\r\nexport class TextAnimator {\r\n    private _advanceRequested = false;\r\n\r\n    public get advanceRequested() {\r\n        return this._advanceRequested;\r\n    }\r\n\r\n\r\n    public requestAdvance() {\r\n        this._advanceRequested = true;\r\n    }\r\n\r\n    public resetAdvance() {\r\n        this._advanceRequested = false;\r\n    }\r\n\r\n    public async animateBlocks(blocks: StyledTextBlock[], speed: number) {\r\n        if(SoundManager.instance) SoundManager.instance.playSFX(\"text\", {loop: true, autoplay: true});\r\n        let skipped = false;\r\n        for (const { tb, full } of blocks) {\r\n            for (let i = 1; i <= full.length; i++) {\r\n                tb.text = full.slice(0, i);\r\n                if (this._advanceRequested) {\r\n                    skipped = true;\r\n                    break;\r\n                }\r\n                await Utils.sleep(speed);\r\n            }\r\n            if (skipped) break;\r\n        }\r\n        if(SoundManager.instance) SoundManager.instance.stopSFX(\"text\");\r\n    }\r\n}\r\n","import { UI } from \"@/YellowSubmarine/ui system/UI\";\r\nimport { Control, Rectangle, Image, StackPanel } from \"@babylonjs/gui\";\r\nimport { Conversation } from \"@/YellowSubmarine/dialogue system/Conversation\";\r\nimport { Utils } from \"@/YellowSubmarine/Utils\";\r\nimport { TextLayoutManager } from \"@/YellowSubmarine/ui system/TextLayoutManager\";\r\nimport {TextAnimator} from \"@/YellowSubmarine/ui system/TextAnimator\";\r\n\r\nexport class DialogueInteractionUI extends UI {\r\n\r\n    private readonly CONTAINER_WIDTH = 0.4;\r\n    private readonly CONTAINER_CORNER_RADIUS = 10;\r\n    private readonly CONTAINER_THICKNESS = 5;\r\n    private readonly CONTAINER_COLOR = \"rgb(168, 98, 68)\";\r\n    private readonly CONTAINER_BACKGROUND = \"rgb(255, 199, 130)\";\r\n    private readonly CONTAINER_OFFSET_Y = -200;\r\n\r\n    private readonly TEXT_PADDING = 8;\r\n    private readonly TEXT_BLOCK_HORIZONTAL_PADDING = 2;\r\n    private readonly TEXT_DEFAULT_FONT_SIZE = 24;\r\n    private readonly TEXT_LINE_SPACING = 8;\r\n    private readonly TEXT_EXTRA_CONTAINER_MARGIN = 20;\r\n    private readonly TEXT_SPEED = 20;\r\n\r\n    private readonly TRIANGLE_IMAGE_PATH = \"ui/triangle.png\";\r\n    private readonly TRIANGLE_SIZE = \"24px\";\r\n    private readonly TRIANGLE_BLINK_INTERVAL = 300;\r\n\r\n    private _container!: Rectangle;\r\n    private _verticalStack!: StackPanel;\r\n    private _triangle!: Image;\r\n\r\n    private static _isTextFullyDisplayed = false;\r\n\r\n\r\n    private _layoutManager: TextLayoutManager;\r\n    private _textAnimator: TextAnimator;\r\n\r\n    public get controlNode(): Control {\r\n        return this._container;\r\n    }\r\n\r\n    public static get isTextFullyDisplayed(): boolean {\r\n        return this._isTextFullyDisplayed;\r\n    }\r\n\r\n    constructor() {\r\n        super();\r\n\r\n        this.initContainer();\r\n        this.initStack();\r\n        this.initTriangle();\r\n\r\n        this._layoutManager = new TextLayoutManager(\r\n            (() => {\r\n                const canvas = document.createElement(\"canvas\");\r\n                return canvas.getContext(\"2d\")!;\r\n            })(),\r\n            this.TEXT_DEFAULT_FONT_SIZE,\r\n            this.TEXT_BLOCK_HORIZONTAL_PADDING\r\n        );\r\n\r\n        this._textAnimator = new TextAnimator();\r\n\r\n        Conversation.onAnyConversationStart.add((conv) => {\r\n            this._container.isVisible = true;\r\n            if (conv.conversationProvider?.mesh) {\r\n                this._container.linkWithMesh(conv.conversationProvider.mesh);\r\n                this._container.linkOffsetY = this.CONTAINER_OFFSET_Y;\r\n            }\r\n        });\r\n\r\n        Conversation.onAnyConversationEnd.add(() => {\r\n            this._stopBlink();\r\n            this._container.isVisible = false;\r\n        });\r\n\r\n        Conversation.onAnyDialogueStart.add((dialog) =>\r\n            this.showText(dialog.text, this.TEXT_SPEED)\r\n        );\r\n    }\r\n\r\n    private initContainer() {\r\n        this._container = new Rectangle();\r\n        this._container.width = `${this.CONTAINER_WIDTH * 100}%`;\r\n        this._container.cornerRadius = this.CONTAINER_CORNER_RADIUS;\r\n        this._container.thickness = this.CONTAINER_THICKNESS;\r\n        this._container.color = this.CONTAINER_COLOR;\r\n        this._container.background = this.CONTAINER_BACKGROUND;\r\n        this._container.verticalAlignment = Control.VERTICAL_ALIGNMENT_BOTTOM;\r\n        this._container.horizontalAlignment = Control.HORIZONTAL_ALIGNMENT_CENTER;\r\n        this._container.isVisible = false;\r\n        this._container.paddingLeft = `${this.TEXT_PADDING}px`;\r\n        this._container.paddingRight = `${this.TEXT_PADDING}px`;\r\n    }\r\n\r\n    private initStack() {\r\n        this._verticalStack = new StackPanel();\r\n        this._verticalStack.isVertical = true;\r\n        this._verticalStack.width = \"100%\";\r\n        this._verticalStack.paddingBottom = \"5px\";\r\n        this._container.addControl(this._verticalStack);\r\n    }\r\n\r\n    private initTriangle() {\r\n        this._triangle = new Image(\"nextTriangle\", this.TRIANGLE_IMAGE_PATH);\r\n        this._triangle.width = this.TRIANGLE_SIZE;\r\n        this._triangle.height = this.TRIANGLE_SIZE;\r\n        this._triangle.verticalAlignment = Control.VERTICAL_ALIGNMENT_BOTTOM;\r\n        this._triangle.horizontalAlignment = Control.HORIZONTAL_ALIGNMENT_RIGHT;\r\n        this._triangle.isVisible = false;\r\n        this._container.addControl(this._triangle);\r\n    }\r\n\r\n    private async showText(text: string, speed: number) {\r\n        DialogueInteractionUI._isTextFullyDisplayed = false;\r\n        this._stopBlink();\r\n        this._textAnimator.resetAdvance();\r\n        this._verticalStack.clearControls();\r\n\r\n        const advanceObserver = Conversation.onAdvanceDialogueRequested.add(() => {\r\n            this._textAnimator.requestAdvance();\r\n        });\r\n\r\n        const canvasWidth = document.querySelector(\"canvas\")!.clientWidth;\r\n        const containerPixelWidth = canvasWidth * this.CONTAINER_WIDTH;\r\n        const maxWidth =\r\n            containerPixelWidth -\r\n            this.TEXT_PADDING * 2 -\r\n            this.TEXT_BLOCK_HORIZONTAL_PADDING * 2;\r\n\r\n        const { lines, segments } = this._layoutManager.layout(text, maxWidth);\r\n\r\n        const maxFontSize = Math.max(\r\n            ...segments.map((s) => s.style.size || this.TEXT_DEFAULT_FONT_SIZE)\r\n        );\r\n        const lineHeight = maxFontSize * 1.2 + this.TEXT_LINE_SPACING;\r\n\r\n        const { linesPanels, blocks } = this._layoutManager.createTextBlocks(\r\n            lines,\r\n            lineHeight,\r\n            this.TEXT_BLOCK_HORIZONTAL_PADDING,\r\n            this.TEXT_DEFAULT_FONT_SIZE\r\n        );\r\n\r\n        linesPanels.forEach(linePanel => {\r\n            this._verticalStack.addControl(linePanel);\r\n        });\r\n\r\n        const contentHeight = lines.length * lineHeight;\r\n        const totalHeight =\r\n            contentHeight + this.TEXT_PADDING * 2 + this.TEXT_EXTRA_CONTAINER_MARGIN;\r\n        this._container.height = `${totalHeight}px`;\r\n\r\n        await this._textAnimator.animateBlocks(blocks, speed);\r\n\r\n        if (this._textAnimator.advanceRequested) {\r\n            blocks.forEach((b) => (b.tb.text = b.full));\r\n        }\r\n\r\n        DialogueInteractionUI._isTextFullyDisplayed = true;\r\n        Conversation.onAdvanceDialogueRequested.remove(advanceObserver);\r\n        await this._startBlink();\r\n    }\r\n\r\n    private async _startBlink() {\r\n        if(!DialogueInteractionUI._isTextFullyDisplayed) return;\r\n        this._triangle.isVisible = true;\r\n\r\n        while (DialogueInteractionUI.isTextFullyDisplayed) {\r\n            this._triangle.alpha = 1;\r\n            await Utils.sleep(this.TRIANGLE_BLINK_INTERVAL);\r\n            this._triangle.alpha = 0;\r\n            await Utils.sleep(this.TRIANGLE_BLINK_INTERVAL);\r\n        }\r\n\r\n\r\n    }\r\n\r\n    private _stopBlink() {\r\n        this._triangle.isVisible = false;\r\n    }\r\n}\r\n","import {Conversation} from \"@/YellowSubmarine/dialogue system/Conversation\";\r\nimport {DialogueInteraction} from \"@/YellowSubmarine/dialogue system/interactions/DialogueInteraction\";\r\nimport {AbstractMesh} from \"@babylonjs/core\";\r\nimport {DialogueInteractionUI} from \"@/YellowSubmarine/dialogue system/ui/DialogueInteractionUI\";\r\n\r\nexport class NextDialogueInteraction extends DialogueInteraction{\r\n\r\n    constructor(private _conversation:Conversation) {\r\n        super(\"Space\", \"_\");\r\n    }\r\n\r\n    executeInteraction(): void {\r\n        if(!DialogueInteractionUI.isTextFullyDisplayed){\r\n            Conversation.onAdvanceDialogueRequested.notifyObservers();\r\n            return;\r\n        }\r\n        this._conversation.next();\r\n    }\r\n\r\n    get mesh(): AbstractMesh | undefined {\r\n        return this._conversation.conversationProvider?.mesh;\r\n    }\r\n\r\n}","import {Observable} from \"@babylonjs/core\";\r\nimport {AbstractDialogueNode} from \"@/YellowSubmarine/dialogue system/nodes/AbstractDialogueNode\";\r\nimport {NextDialogueInteraction} from \"@/YellowSubmarine/dialogue system/interactions/NextDialogueInteraction\";\r\nimport {ConfigurableCamera} from \"@/YellowSubmarine/camera system/ConfigurableCamera\";\r\nimport {Player} from \"@/YellowSubmarine/Player\";\r\nimport {IConversationProvider} from \"@/YellowSubmarine/dialogue system/IConversationProvider\";\r\n\r\n\r\nexport class Conversation {\r\n\r\n    private _onEnding = (): void => {return};\r\n\r\n    private _conversationProvider?: IConversationProvider;\r\n    private _hasBeenRead = false;\r\n\r\n    public static onAnyDialogueStart:Observable<AbstractDialogueNode> = new Observable();\r\n    public static onAnyConversationStart: Observable<Conversation> = new Observable();\r\n    public static onAnyConversationEnd: Observable<Conversation> = new Observable();\r\n    public static onAdvanceDialogueRequested: Observable<void> = new Observable();\r\n\r\n    public onDialogueStart: Observable<AbstractDialogueNode> = new Observable();\r\n    public onConversationStart: Observable<Conversation> = new Observable();\r\n    public onConversationEnd: Observable<Conversation> = new Observable();\r\n\r\n    private _nextInteraction: NextDialogueInteraction = new NextDialogueInteraction(this);\r\n    private _currentNode: AbstractDialogueNode | undefined = undefined;\r\n    private _rootNode: AbstractDialogueNode | undefined = undefined;\r\n\r\n    public get conversationProvider(): IConversationProvider | undefined{\r\n        return this._conversationProvider;\r\n    }\r\n\r\n    public set conversationProvider(conversationProvider: IConversationProvider | undefined) {\r\n        this._conversationProvider = conversationProvider;\r\n    }\r\n\r\n    public get root(){\r\n        return this._rootNode;\r\n    }\r\n    public set root(value: AbstractDialogueNode | undefined){\r\n        this._rootNode = value;\r\n    }\r\n\r\n    public get onEnding(): () => void {\r\n        return this._onEnding;\r\n    }\r\n\r\n    public set onEnding(value: () => void) {\r\n        this._onEnding = value;\r\n    }\r\n\r\n    private enterNode(node: AbstractDialogueNode){\r\n        this._currentNode = node;\r\n        this._currentNode.execute();\r\n        this.onDialogueStart.notifyObservers(node);\r\n        Conversation.onAnyDialogueStart.notifyObservers(node);\r\n    }\r\n\r\n    public startConversation(): void {\r\n        this._currentNode = this.root;\r\n        this.onConversationStart.notifyObservers(this);\r\n        Conversation.onAnyConversationStart.notifyObservers(this);\r\n        this.enterNode(<AbstractDialogueNode>this._currentNode);\r\n        this._nextInteraction.makeAvailable();\r\n        const cameraConfiguration = this._conversationProvider?.cameraConfiguration\r\n        if(cameraConfiguration) {\r\n            ConfigurableCamera.instance.cameraConfiguration = cameraConfiguration;\r\n        }\r\n    }\r\n\r\n    public next(): void {\r\n        const nextNode = this._currentNode?.nextNode;\r\n        if (nextNode) {\r\n            this.enterNode(nextNode);\r\n        } else {\r\n            this.endConversation();\r\n        }\r\n    }\r\n\r\n    private endConversation() {\r\n        this._currentNode = undefined;\r\n        this._nextInteraction.makeUnavailable();\r\n        this.onConversationEnd.notifyObservers(this);\r\n        Conversation.onAnyConversationEnd.notifyObservers(this);\r\n        ConfigurableCamera.instance.cameraConfiguration = Player.playerCameraConfiguration;\r\n        if(!this._hasBeenRead) this._onEnding();\r\n        this._hasBeenRead = true;\r\n    }\r\n\r\n    public isInProgress(): boolean {\r\n        return !!this._currentNode;\r\n    }\r\n}","import {Game} from \"@/YellowSubmarine/Game\";\r\nimport {Angle, KeyboardEventTypes, KeyboardInfo, Observable, Scalar} from \"@babylonjs/core\";\r\nimport {ConfigurableCamera} from \"@/YellowSubmarine/camera system/ConfigurableCamera\";\r\nimport {CameraConfiguration} from \"@/YellowSubmarine/camera system/CameraConfiguration\";\r\nimport {Submarine} from \"@/YellowSubmarine/Submarine\";\r\nimport {Conversation} from \"@/YellowSubmarine/dialogue system/Conversation\";\r\n\r\ntype CameraRotationInfo = {movementX: number, movementY: number};\r\n\r\nexport class Player {\r\n\r\n\r\n    private static _instance: Player;\r\n    private static _onCameraRotationObservable: Observable<CameraRotationInfo> = new Observable();\r\n    private static _onPlayerPressedAKey: Observable<KeyboardInfo> = new Observable();\r\n    private static _playerCameraConfiguration: CameraConfiguration = new CameraConfiguration();\r\n    private static _horizontalCameraSensitivity = 5;\r\n    private static _verticalCameraSensitivity = 5;\r\n    private static _isMovementEnabled = true;\r\n\r\n\r\n    public static get instance() {\r\n        return this._instance;\r\n    }\r\n\r\n    public static get onCameraRotationObservable(){\r\n        return this._onCameraRotationObservable;\r\n    }\r\n\r\n    public static get onPlayerPressedAKey(): Observable<KeyboardInfo> {\r\n        return this._onPlayerPressedAKey;\r\n    }\r\n\r\n    public static get playerCameraConfiguration(): CameraConfiguration {\r\n        return this._playerCameraConfiguration;\r\n    }\r\n\r\n    private static _isForwardPressed = false;\r\n    private static _isBackwardPressed = false;\r\n    private static _isLeftPressed = false;\r\n    private static _isRightPressed = false;\r\n\r\n    constructor() {\r\n        Player._instance = this;\r\n        Player.initializeCameraParameter();\r\n        Player.registerKeyboardInputs();\r\n        Player.registerMouseMovementInputs();\r\n        Conversation.onAnyConversationStart.add(() => Player.disableMovement());\r\n        Conversation.onAnyConversationEnd.add(() => Player.enableMovement());\r\n    }\r\n\r\n    public static isMoveForwardPressed(): boolean {\r\n        return this._isForwardPressed && this._isMovementEnabled;\r\n    }\r\n\r\n    public static isMoveBackwardPressed(): boolean {\r\n        return this._isBackwardPressed && this._isMovementEnabled;\r\n    }\r\n\r\n    public static isTurnLeftPressed(): boolean {\r\n        return this._isLeftPressed && this._isMovementEnabled;\r\n    }\r\n\r\n    public static isTurnRightPressed(): boolean {\r\n        return this._isRightPressed && this._isMovementEnabled;\r\n    }\r\n\r\n    private static registerKeyboardInputs(){\r\n        const scene = Game.scene;\r\n        scene.onKeyboardObservable.add( (eventData) => {\r\n            if(Game.isGameFocused){\r\n                const state = eventData.type === KeyboardEventTypes.KEYDOWN;\r\n                if(eventData.event.code === \"KeyW\"){\r\n                    this._isForwardPressed = state;\r\n                }\r\n                else if(eventData.event.code === \"KeyS\"){\r\n                    this._isBackwardPressed = state;\r\n                }\r\n                else if(eventData.event.code === \"KeyA\"){\r\n                    this._isLeftPressed = state;\r\n                }\r\n                else if(eventData.event.code === \"KeyD\"){\r\n                    this._isRightPressed = state;\r\n                }\r\n                this.onPlayerPressedAKey.notifyObservers(eventData);\r\n\r\n            }\r\n        } );\r\n    }\r\n\r\n    private static registerMouseMovementInputs() {\r\n        const scene = Game.scene;\r\n        scene.onPointerObservable.add((pointerInfo) => {\r\n            if(Game.isGameFocused){\r\n                const event = pointerInfo.event as PointerEvent;\r\n                const movementX = event.movementX/window.screen.width;\r\n                const movementY = event.movementY/window.screen.height;\r\n                this._onCameraRotationObservable.notifyObservers({movementX, movementY});\r\n                this.updateCameraParameter(movementX, movementY);\r\n            }\r\n        })\r\n    }\r\n\r\n    public static enableMovement(){\r\n        this._isMovementEnabled = true;\r\n    }\r\n\r\n    public static disableMovement(){\r\n        this._isMovementEnabled = false;\r\n    }\r\n\r\n    private static initializeCameraParameter() {\r\n        Submarine.instance.meshCreationPromise.then((mesh) => {\r\n            this._playerCameraConfiguration.target = mesh;\r\n            this._playerCameraConfiguration.distanceFromTarget = 25;\r\n            this._playerCameraConfiguration.currentLowerBetaLimit = Angle.FromDegrees(30).radians();\r\n            this._playerCameraConfiguration.currentUpperBetaLimit = Angle.FromDegrees(85).radians();\r\n            this._playerCameraConfiguration.wantedAlpha = Angle.FromDegrees(-90).radians();\r\n            this._playerCameraConfiguration.wantedBeta = Angle.FromDegrees(45).radians();\r\n            ConfigurableCamera.instance.cameraConfiguration = this._playerCameraConfiguration;\r\n        })\r\n    }\r\n\r\n    private static updateCameraParameter(movementX: number, movementY: number) {\r\n        this._playerCameraConfiguration.wantedAlpha = Scalar.LerpAngle(this._playerCameraConfiguration.wantedBeta, this._playerCameraConfiguration.wantedAlpha - movementX * this._horizontalCameraSensitivity, 1);\r\n        this._playerCameraConfiguration.wantedBeta = Scalar.LerpAngle(this._playerCameraConfiguration.wantedBeta, this._playerCameraConfiguration.wantedBeta - movementY * this._verticalCameraSensitivity, 1);\r\n\r\n    }\r\n\r\n    private static isCurrentCamera(){\r\n        return ConfigurableCamera.instance.cameraConfiguration == this._playerCameraConfiguration;\r\n    }\r\n}","import {\r\n    AbstractMesh,\r\n    Color3,\r\n    InputBlock,\r\n    NodeMaterial,\r\n    Nullable,\r\n    PBRMaterial,\r\n    Texture,\r\n    TextureBlock,\r\n} from \"@babylonjs/core\";\r\nimport {Game} from \"@/YellowSubmarine/Game\";\r\n\r\nexport class CartoonShaderMaterial {\r\n\r\n    private _nodeMaterialPromise;\r\n    private _nodeMaterial!: NodeMaterial;\r\n\r\n    public async assignMaterial(mesh: AbstractMesh){\r\n        await this._nodeMaterialPromise.then(() => {\r\n            mesh.material = this._nodeMaterial;\r\n        })\r\n\r\n    }\r\n\r\n    public constructor() {\r\n        this._nodeMaterialPromise = NodeMaterial.ParseFromFileAsync(\"ToonShader\", \"shaders/PBRToonMaterial.json\", Game.scene).then((nodeMaterial) => {\r\n            this._nodeMaterial = nodeMaterial;\r\n            this._nodeMaterial.maxSimultaneousLights = 6;\r\n            this.saturationMultiplier = 1.5;\r\n            this._nodeMaterial.build();\r\n        })\r\n    }\r\n\r\n    public set saturationMultiplier(saturationMultiplier: number) {\r\n        this._nodeMaterialPromise.then(() => {\r\n            (this._nodeMaterial.getBlockByName(\"SaturationMultiplier\") as InputBlock).value = saturationMultiplier;\r\n        })\r\n    }\r\n\r\n    public set numberOfSteps(numberOfSteps: number) {\r\n        this._nodeMaterialPromise.then(() => {\r\n            (this._nodeMaterial.getBlockByName(\"NumberOfSteps\") as InputBlock).value = numberOfSteps;\r\n        })\r\n    }\r\n\r\n    public set luminanceEasingFactor(luminanceEasingFactor: number) {\r\n        this._nodeMaterialPromise.then(() => {\r\n            (this._nodeMaterial.getBlockByName(\"LuminanceEasingFactor\") as InputBlock).value = luminanceEasingFactor;\r\n        })\r\n    }\r\n\r\n    public set indexOfRefraction(indexOfRefraction: number) {\r\n        this._nodeMaterialPromise.then(() => {\r\n            (this._nodeMaterial.getBlockByName(\"IoR\") as InputBlock).value = indexOfRefraction;\r\n        })\r\n    }\r\n\r\n    public set albedoColor(albedoColor: Color3){\r\n        this._nodeMaterialPromise.then(() => {\r\n            (this._nodeMaterial.getBlockByName(\"AlbedoColor\") as InputBlock).value = albedoColor;\r\n        })\r\n    }\r\n\r\n    public set albedoTexture(albedoTexture: Texture){\r\n        this._nodeMaterialPromise.then(() => {\r\n            (this._nodeMaterial.getBlockByName(\"AlbedoTexture\") as TextureBlock).texture = albedoTexture;\r\n        })\r\n    }\r\n\r\n    public set opacity(opacity: number){\r\n        this._nodeMaterialPromise.then(() => {\r\n            (this._nodeMaterial.getBlockByName(\"OpacityFactor\") as InputBlock).value = opacity;\r\n        })\r\n    }\r\n\r\n    public set metallic(metallic: number){\r\n        this._nodeMaterialPromise.then(() => {\r\n            (this._nodeMaterial.getBlockByName(\"MetallicFactor\") as InputBlock).value = metallic;\r\n        })\r\n    }\r\n\r\n    public set metallicTexture(metallicTexture: Texture){\r\n        this._nodeMaterialPromise.then(() => {\r\n            (this._nodeMaterial.getBlockByName(\"MetallicTexture\") as TextureBlock).texture = metallicTexture;\r\n        })\r\n    }\r\n\r\n    public set roughness(roughness: number){\r\n        this._nodeMaterialPromise.then(() => {\r\n            (this._nodeMaterial.getBlockByName(\"RoughnessFactor\") as InputBlock).value = roughness;\r\n        })\r\n    }\r\n\r\n    public set roughnessTexture(roughnessTexture: Texture){\r\n        this._nodeMaterialPromise.then(() => {\r\n            (this._nodeMaterial.getBlockByName(\"RoughnessTexture\") as TextureBlock).texture = roughnessTexture;\r\n        })\r\n    }\r\n\r\n    public set emission(emission: number){\r\n        this._nodeMaterialPromise.then(() => {\r\n            (this._nodeMaterial.getBlockByName(\"EmissiveFactor\") as InputBlock).value = emission;\r\n        })\r\n    }\r\n\r\n    public set emissionColor(emissionColor: Color3){\r\n        this._nodeMaterialPromise.then(() => {\r\n            (this._nodeMaterial.getBlockByName(\"EmissiveColor\") as InputBlock).value = emissionColor;\r\n        })\r\n    }\r\n\r\n    public set emissionTexture(emissionTexture: Texture){\r\n        this._nodeMaterialPromise.then(() => {\r\n            (this._nodeMaterial.getBlockByName(\"EmissiveTexture\") as TextureBlock).texture = emissionTexture;\r\n        })\r\n    }\r\n\r\n    public set transparencyMode(transparencyMode: Nullable<number>){\r\n        this._nodeMaterialPromise.then(() => {\r\n            this._nodeMaterial.transparencyMode = transparencyMode;\r\n        })\r\n    }\r\n\r\n    public configureFromPBRMaterial(pbrMaterial: PBRMaterial){\r\n        this.albedoColor = pbrMaterial.albedoColor;\r\n        const albedoTexture = pbrMaterial.albedoTexture;\r\n        if(albedoTexture !== null){\r\n            this.albedoTexture = albedoTexture as Texture;\r\n        }\r\n\r\n        this.emission = pbrMaterial.emissiveIntensity;\r\n        const emissionTexture = pbrMaterial.emissiveTexture;\r\n        if(emissionTexture !== null){\r\n            this.emissionTexture = emissionTexture as Texture;\r\n        }\r\n        this.emissionColor = pbrMaterial.emissiveColor;\r\n\r\n        const metallic = pbrMaterial.metallic;\r\n        if(metallic !== null){\r\n            this.metallic = metallic;\r\n        }\r\n        const metallicTexture = pbrMaterial.metallicTexture;\r\n        if(metallicTexture !== null){\r\n            this.metallicTexture = metallicTexture as Texture;\r\n        }\r\n\r\n        const roughness = pbrMaterial.roughness;\r\n        if(roughness !== null){\r\n            this.roughness = roughness;\r\n        }\r\n\r\n        this.transparencyMode = pbrMaterial.transparencyMode;\r\n        this.indexOfRefraction = pbrMaterial.indexOfRefraction;\r\n\r\n        this._nodeMaterialPromise.then(() => {\r\n            this._nodeMaterial.backFaceCulling = pbrMaterial.backFaceCulling;\r\n            this._nodeMaterial.needDepthPrePass = pbrMaterial.needDepthPrePass;\r\n            this._nodeMaterial.cullBackFaces = pbrMaterial.cullBackFaces;\r\n            this._nodeMaterial.alpha = pbrMaterial.alpha;\r\n            this._nodeMaterial.alphaMode = pbrMaterial.alphaMode;\r\n            this._nodeMaterial.disableDepthWrite = pbrMaterial.disableDepthWrite;\r\n            this._nodeMaterial.disableColorWrite = pbrMaterial.disableColorWrite;\r\n            this._nodeMaterial.forceDepthWrite = pbrMaterial.forceDepthWrite;\r\n            this._nodeMaterial.depthFunction = pbrMaterial.depthFunction;\r\n        })\r\n\r\n\r\n    }\r\n\r\n}","import {DistanceConstraint, Observable, PhysicsBody, PhysicsConstraint, TransformNode, Vector3} from \"@babylonjs/core\";\r\nimport {Game} from \"@/YellowSubmarine/Game\";\r\nimport {TempleBall} from \"@/YellowSubmarine/temple/TempleBall\";\r\n\r\nexport class Grappler {\r\n\r\n    private static _instance: Grappler;\r\n\r\n    private _owner?: PhysicsBody;\r\n    private _grapplerLength = 1.5;\r\n    private _currentGrappledObject?: TempleBall;\r\n    private _localOffsetWithSubmarine: Vector3 = new Vector3(0, 0, -5);\r\n    private _pullingForce = 5;\r\n\r\n    public static get instance(): Grappler {\r\n        return this._instance;\r\n    }\r\n\r\n    constructor() {\r\n        Grappler._instance = this;\r\n        Game.scene.onBeforeRenderObservable.add(() => {\r\n            this.updateGrappledObject();\r\n        })\r\n    }\r\n\r\n    public grappleObject(object: TempleBall) {\r\n        if(this._currentGrappledObject) return;\r\n\r\n        this._currentGrappledObject = object;\r\n\r\n    }\r\n\r\n    public letGoOfObject() {\r\n        if(!this._currentGrappledObject) return;\r\n\r\n        this._currentGrappledObject = undefined;\r\n    }\r\n\r\n    public get grappledObject(): TempleBall | undefined {\r\n        return this._currentGrappledObject;\r\n    }\r\n\r\n    public get hasAnObjectGrappled(): boolean {\r\n        return this._currentGrappledObject !== undefined;\r\n    }\r\n\r\n    public get grapplerLength(): number {\r\n        return this._grapplerLength;\r\n    }\r\n\r\n    public set grapplerLength(length: number) {\r\n        this._grapplerLength = length;\r\n    }\r\n\r\n    public get owner(): PhysicsBody | undefined {\r\n        return this._owner;\r\n    }\r\n\r\n    public set owner(submarine: PhysicsBody | undefined) {\r\n        this._owner = submarine;\r\n    }\r\n\r\n    public get offset(): Vector3 {\r\n        return this._localOffsetWithSubmarine;\r\n    }\r\n\r\n    public set offset(offset: Vector3) {\r\n        this._localOffsetWithSubmarine = offset;\r\n    }\r\n\r\n    // -------------------------------------------------------------------------------------------------------------- //\r\n\r\n    private updateGrappledObject(){\r\n        if(this._currentGrappledObject !== undefined){\r\n            const parent = this._owner;\r\n            if(parent){\r\n                const positionWithOffset = parent.getObjectCenterWorld().add(this._localOffsetWithSubmarine.rotateByQuaternionToRef(parent.transformNode.absoluteRotationQuaternion, Vector3.Zero()));\r\n\r\n                const grappledObjectPosition = this._currentGrappledObject.physicsBody.getObjectCenterWorld();\r\n                const fromGrapplerToObject = grappledObjectPosition.subtract(positionWithOffset);\r\n                const distance = fromGrapplerToObject.length();\r\n                if(distance > this._grapplerLength){\r\n                    const pullingDirection = fromGrapplerToObject.normalizeToNew().scale(-1);\r\n                    this._currentGrappledObject.physicsBody.applyForce(pullingDirection.scale(this._pullingForce * (1 + (distance - this._grapplerLength)) ), grappledObjectPosition);\r\n                }\r\n\r\n            }\r\n\r\n        }\r\n    }\r\n\r\n}","import {\r\n    AbstractMesh, Color3, KeyboardEventTypes,\r\n    Mesh, MeshBuilder, PBRMaterial, PhysicsAggregate, PhysicsMotionType, PhysicsShapeType,\r\n    Scene,\r\n    SceneLoader, SpotLight, StandardMaterial, Texture,\r\n    Vector3, VolumetricLightScatteringPostProcess,\r\n} from \"@babylonjs/core\";\r\nimport {Game} from \"@/YellowSubmarine/Game\";\r\nimport \"@babylonjs/loaders/glTF\"\r\nimport {Player} from \"@/YellowSubmarine/Player\";\r\nimport {CartoonShaderMaterial} from \"@/YellowSubmarine/shader material/CartoonShaderMaterial\";\r\nimport {Grappler} from \"@/YellowSubmarine/grappling system/Grappler\";\r\nimport {TempleBall} from \"@/YellowSubmarine/temple/TempleBall\";\r\nimport {SoundManager} from \"@/YellowSubmarine/sound system/SoundManager\";\r\nimport { ParticleSystem, TransformNode, Color4 } from \"@babylonjs/core\";\r\n\r\n\r\nexport class Submarine {\r\n\r\n    private _physicsAggregate?: PhysicsAggregate;\r\n\r\n    public get mesh(): AbstractMesh{\r\n        return this._mesh;\r\n    }\r\n\r\n    public static get instance(): Submarine {\r\n        return this._instance;\r\n    }\r\n\r\n    private static _instance: Submarine;\r\n    private _mesh!: AbstractMesh;\r\n\r\n    private _movementForce = 1250000;\r\n\r\n    private _rotationForce = 300000;\r\n    private _grappler: Grappler;\r\n\r\n    public meshCreationPromise: Promise<AbstractMesh>;\r\n\r\n    private _spotLight?: SpotLight;\r\n\r\n    constructor() {\r\n        Submarine._instance = this;\r\n        this._grappler = new Grappler();\r\n        this.meshCreationPromise = this.createMesh(Game.scene);\r\n        this.meshCreationPromise.then((mesh) => {\r\n            this.createWaterParticles();\r\n            this._grappler.owner = mesh.physicsBody ?? undefined;\r\n            this._spotLight = this.createSpotlight();\r\n            this.addVolumetricLight();\r\n\r\n\r\n            const mapLimit = 1024;\r\n            Game.scene.onBeforeRenderObservable.add(() => {\r\n                if (!this._physicsAggregate) return;\r\n\r\n                const body = this._physicsAggregate.body;\r\n                const pos = body.transformNode.position.clone();\r\n\r\n                if (pos.x > mapLimit || pos.x < -mapLimit || pos.z > mapLimit || pos.z < -mapLimit) {\r\n                    body.setLinearVelocity(body.getLinearVelocity().negate());\r\n                    body.transformNode.position.copyFrom(pos);\r\n                }\r\n            });\r\n        });\r\n        Game.scene.onBeforeRenderObservable.add(() => {\r\n            this.update(/*Game.engine.getDeltaTime() / 1000*/);\r\n\r\n        });\r\n\r\n        const keysDown = new Set<string>();\r\n        Game.scene.onKeyboardObservable.add((eventData) => {\r\n            const key = eventData.event.key;\r\n            if (key === \"k\") {\r\n                if (eventData.type === KeyboardEventTypes.KEYDOWN) {\r\n                    if (!keysDown.has(key)) {\r\n                        keysDown.add(key);\r\n                        SoundManager.instance.playSFX(\"submarine_horn\", {\r\n                            loop : true\r\n                        }, this.mesh);\r\n                    }\r\n                } else if (eventData.type === KeyboardEventTypes.KEYUP) {\r\n                    keysDown.delete(key);\r\n                    SoundManager.instance.stopSFX(\"submarine_horn\");\r\n                }\r\n            }\r\n        });\r\n\r\n        Game.scene.onKeyboardObservable.add((eventData) => {\r\n            const key = eventData.event.key;\r\n            if(key === \"z\" || key === \"s\"){\r\n                if (eventData.type === KeyboardEventTypes.KEYDOWN) {\r\n                    if (!keysDown.has(key)) {\r\n                        keysDown.add(key);\r\n                        SoundManager.instance.playSFX(\"submarine\", {\r\n                            loop : true\r\n                        });\r\n                    }\r\n                } else if (eventData.type === KeyboardEventTypes.KEYUP) {\r\n                    keysDown.delete(key);\r\n                    SoundManager.instance.stopSFX(\"submarine\");\r\n                }\r\n            }\r\n        });\r\n\r\n        Game.scene.onKeyboardObservable.add( (eventData) => {\r\n            const state = eventData.type === KeyboardEventTypes.KEYDOWN;\r\n            if(eventData.event.key === \"l\" && state){\r\n                this._spotLight?.setEnabled(!this._spotLight?.isEnabled())\r\n            }\r\n        });\r\n    }\r\n\r\n    public get templeBall(): TempleBall | undefined {\r\n        return this._grappler.grappledObject;\r\n    }\r\n\r\n    public grabBall(ball: TempleBall): void {\r\n        this._grappler.grappleObject(ball);\r\n    }\r\n\r\n    public letGoOfBall(){\r\n        this._grappler.letGoOfObject();\r\n    }\r\n\r\n\r\n    private async createMesh(scene: Scene) {\r\n        const result = await SceneLoader.ImportMeshAsync(\"\", \"models/objects/\", \"submarine.glb\", scene);\r\n        const rootMesh = result.meshes[0] as Mesh;\r\n        const childMeshes = rootMesh.getChildMeshes<Mesh>();\r\n        for (const mesh of result.meshes) {\r\n            const mat = mesh.material as PBRMaterial;\r\n            if(mat){\r\n                const toonMat = new CartoonShaderMaterial();\r\n                await toonMat.assignMaterial(mesh).then(() => {\r\n                    toonMat.configureFromPBRMaterial(mat);\r\n                });\r\n            }\r\n        }\r\n        const mergedMesh = Mesh.MergeMeshes(childMeshes,true, undefined, undefined, undefined, true);\r\n        if(mergedMesh){\r\n            this._mesh = mergedMesh;\r\n            this._physicsAggregate = new PhysicsAggregate(this._mesh, PhysicsShapeType.BOX,{\r\n                mass: 1,\r\n                friction: 0,\r\n                restitution: 0,\r\n                mesh: mergedMesh,\r\n            }, Game.scene);\r\n            this._physicsAggregate.body.setMotionType(PhysicsMotionType.DYNAMIC);\r\n            this._physicsAggregate.body.setMassProperties({\r\n                inertia: new Vector3(0, 1, 0),\r\n                centerOfMass: this._mesh.absolutePosition,\r\n            });\r\n            this._physicsAggregate.body.setLinearDamping(1);\r\n            this._physicsAggregate.body.setAngularDamping(1);\r\n            this._physicsAggregate.body.getCollisionObservable();\r\n\r\n            this._mesh.name = \"submarine\";\r\n            this._mesh.position = new Vector3(0, 0, 0);\r\n        }\r\n        this.mesh.receiveShadows = true;\r\n        return this._mesh;\r\n    }\r\n\r\n\r\n    private _waveParticleSystem?: ParticleSystem;\r\n    private _waveEmitter?: TransformNode;\r\n\r\n    private createWaterParticles() {\r\n        const scene = Game.scene;\r\n\r\n        this._waveEmitter = new TransformNode(\"waveEmitter\", scene);\r\n        this._waveEmitter.parent = this._mesh;\r\n        this._waveEmitter.position = new Vector3(0, 0, -2.5); // ajuster si besoin\r\n\r\n        const particleSystem = new ParticleSystem(\"waves\", 1000, scene);\r\n        particleSystem.particleTexture = new Texture(\"textures/flare.png\", scene);\r\n\r\n        const emitterMesh = MeshBuilder.CreateSphere(\"waveEmitterMesh\", { diameter: 0.1 }, scene);\r\n        emitterMesh.parent = this._mesh;\r\n        emitterMesh.position = new Vector3(0, -0.1, -2.5);\r\n        emitterMesh.isVisible = false;\r\n        particleSystem.emitter = emitterMesh;\r\n\r\n        particleSystem.minEmitBox = new Vector3(-0.5, 0, 0); // zone de spawn\r\n        particleSystem.maxEmitBox = new Vector3(0.5, 0, 0);\r\n\r\n        particleSystem.color1 = new Color4(1, 1, 1, 1);\r\n        particleSystem.color2 = new Color4(1, 1, 1, 0.5);\r\n        particleSystem.colorDead = new Color4(1, 1, 1, 0);\r\n\r\n        particleSystem.minSize = 0.5;\r\n        particleSystem.maxSize = 0.7;\r\n        particleSystem.minLifeTime = 0.6;\r\n        particleSystem.maxLifeTime = 0.7;\r\n\r\n        particleSystem.emitRate = 5;\r\n        particleSystem.blendMode = ParticleSystem.BLENDMODE_ADD;\r\n\r\n        particleSystem.minEmitPower = 0.5;\r\n        particleSystem.maxEmitPower = 1;\r\n        particleSystem.updateSpeed = 0.02;\r\n\r\n        particleSystem.direction1 = new Vector3(0, 1, -0.5);\r\n        particleSystem.direction2 = new Vector3(0, 1.2, -1);\r\n\r\n\r\n        this._waveParticleSystem = particleSystem;\r\n    }\r\n\r\n\r\n\r\n    private createSpotlight() {\r\n        const spotLight = new SpotLight(\"spotLight\",\r\n            new Vector3(0, 0, 0),\r\n            new Vector3(0, 0, 1),\r\n            Math.PI / 3,\r\n            2,\r\n            Game.scene\r\n        );\r\n        spotLight.diffuse = new Color3(1, 1, 1);\r\n        spotLight.specular = new Color3(1, 1, 1);\r\n        spotLight.intensity = 5000;\r\n        spotLight.parent = this._mesh;\r\n        spotLight.setEnabled(false);\r\n\r\n        this._spotLight = spotLight;\r\n        Game.scene.onKeyboardObservable.add((eventData) => {\r\n            const state = eventData.type === KeyboardEventTypes.KEYDOWN;\r\n            if (eventData.event.key === \"l\" && state) {\r\n                const enabled = !this._spotLight?.isEnabled();\r\n                this._spotLight?.setEnabled(enabled);\r\n            }\r\n        });\r\n\r\n        return spotLight;\r\n    }\r\n\r\n    private addVolumetricLight() {\r\n        const camera = Game.scene.activeCamera!;\r\n\r\n        const lightEmitter = MeshBuilder.CreateSphere(\"lightEmitter\", {diameter: 0.8}, Game.scene);\r\n        const vl = new VolumetricLightScatteringPostProcess(\"vls\", 1.0, camera, lightEmitter);\r\n        lightEmitter.position = new Vector3(0, 0, 2.3);\r\n        lightEmitter.parent = this._mesh;\r\n\r\n        const mat = new StandardMaterial(\"lightMat\", Game.scene);\r\n        mat.emissiveTexture = new Texture(\"textures/lensflare/lens5.png\", Game.scene);\r\n        mat.diffuseColor = new Color3(0, 0, 0);\r\n        mat.specularColor = new Color3(0, 0, 0);\r\n        mat.emissiveColor = new Color3(1, 1, 1);\r\n        mat.alpha = 0.8;\r\n        lightEmitter.material = mat;\r\n\r\n        vl.mesh = lightEmitter;\r\n\r\n        vl.exposure = 1;\r\n        vl.decay = 0.96815;\r\n        vl.weight = 0.4;\r\n        vl.density = 0.99;\r\n\r\n        lightEmitter.setEnabled(false);\r\n\r\n        Game.scene.onKeyboardObservable.add((eventData) => {\r\n            const state = eventData.type === KeyboardEventTypes.KEYDOWN;\r\n            if (eventData.event.key === \"l\" && state) {\r\n                lightEmitter.setEnabled(!lightEmitter.isEnabled());\r\n            }\r\n        });\r\n    }\r\n\r\n    private update() {\r\n        this.updateRotationSpeed();\r\n        this.updateMovementSpeed();\r\n        this.updateWaveParticles();\r\n    }\r\n\r\n    private updateMovementSpeed() {\r\n            if (!this._physicsAggregate) return;\r\n\r\n            const body = this._physicsAggregate.body;\r\n\r\n            let direction = 0;\r\n            if (this.isForwardPressed()) direction += 1;\r\n            if (this.isBackwardPressed()) direction -= 1;\r\n\r\n            if (direction === 0) return;\r\n\r\n            body.applyForce(this._mesh.forward.scale(direction * this._movementForce), body.getObjectCenterWorld() );\r\n\r\n        }\r\n\r\n    private updateRotationSpeed() {\r\n            if (!this._physicsAggregate) return;\r\n\r\n            const body = this._physicsAggregate.body;\r\n\r\n            let direction = 0;\r\n            if (this.isRightPressed()) direction += 1;\r\n            if (this.isLeftPressed()) direction -= 1;\r\n\r\n            if(direction == 0) return;\r\n\r\n            body.applyForce(this._mesh.right.scale(direction * this._rotationForce), body.getObjectCenterWorld().add(this._mesh.forward));\r\n\r\n        }\r\n\r\n    private updateWaveParticles() {\r\n        if (!this._physicsAggregate || !this._waveParticleSystem) return;\r\n\r\n        const velocity = this._physicsAggregate.body.getLinearVelocity();\r\n        const speed = velocity.length();\r\n\r\n        if (speed > 0.6) {\r\n            if (!this._waveParticleSystem.isStarted()) {\r\n                this._waveParticleSystem.start();\r\n            }\r\n        } else {\r\n            if (this._waveParticleSystem.isStarted()) {\r\n                this._waveParticleSystem.stop();\r\n            }\r\n        }\r\n    }\r\n\r\n\r\n\r\n    private isForwardPressed() {\r\n        return Player.isMoveForwardPressed();\r\n    }\r\n\r\n    private isBackwardPressed() {\r\n        return Player.isMoveBackwardPressed();\r\n    }\r\n\r\n    private isRightPressed() {\r\n        return Player.isTurnRightPressed();\r\n    }\r\n\r\n    private isLeftPressed() {\r\n        return Player.isTurnLeftPressed();\r\n    }\r\n\r\n\r\n}","import {MeshDetectionZone} from \"@/YellowSubmarine/detection system/MeshDetectionZone\";\r\nimport {AbstractMesh, Observable, PhysicsAggregate} from \"@babylonjs/core\";\r\nimport {World} from \"@/YellowSubmarine/World\";\r\nimport {IConversationProvider} from \"@/YellowSubmarine/dialogue system/IConversationProvider\";\r\nimport {SoundManager} from \"@/YellowSubmarine/sound system/SoundManager\";\r\n\r\nexport class KeyZone {\r\n\r\n    private  _name!: string;\r\n    private _detectionZone!: MeshDetectionZone;\r\n    private  _discovered = false;\r\n    private  _disabled = false;\r\n    private _mesh!:AbstractMesh;\r\n    private _physicsAggregate?: PhysicsAggregate;\r\n    private _conversationProviders: IConversationProvider[] = [];\r\n\r\n    public static readonly onAnyKeyZoneEntered: Observable<KeyZone> = new Observable();\r\n    public static readonly onAnyKeyZoneExited: Observable<KeyZone> = new Observable();\r\n\r\n    public set name(value: string) {\r\n        this._name = value;\r\n    }\r\n    public get name(): string {\r\n        return this._name;\r\n    }\r\n\r\n\r\n    public set discovered(value: boolean) {\r\n        this._discovered = value;\r\n    }\r\n    public get discovered(): boolean {\r\n        return this._discovered;\r\n    }\r\n\r\n\r\n    public set detectionZone(value: MeshDetectionZone) {\r\n        this._detectionZone = value;\r\n        this.detectionZone.onMeshEnter.add( () => {\r\n            SoundManager.instance.playSFX(\"zone\", {\r\n                loop: false,\r\n                autoplay: true\r\n            });\r\n            KeyZone.onAnyKeyZoneEntered.notifyObservers(this);\r\n            this.discovered = true;\r\n        });\r\n        this.detectionZone.onMeshExit.add(() => {\r\n            KeyZone.onAnyKeyZoneExited.notifyObservers(this);\r\n        });\r\n    }\r\n    public get detectionZone(): MeshDetectionZone {\r\n        return this._detectionZone;\r\n    }\r\n\r\n\r\n    public set disabled(value: boolean) {\r\n        this._disabled = value;\r\n    }\r\n    public get disabled():boolean {\r\n        return this._disabled;\r\n    }\r\n\r\n    public set mesh(value: AbstractMesh) {\r\n        this._mesh = value;\r\n        this._detectionZone.zone.parent = this._mesh;\r\n        World.submarine.meshCreationPromise.then((mesh: AbstractMesh) => {\r\n            this.detectionZone.addMeshToDetect(mesh);\r\n        });\r\n    }\r\n    public get mesh() {\r\n        return this._mesh;\r\n    }\r\n\r\n    public get physicsAggregate(): PhysicsAggregate | undefined {\r\n        return this._physicsAggregate;\r\n    }\r\n\r\n    public set physicsAggregate(physicsAggregate: PhysicsAggregate | undefined){\r\n        this._physicsAggregate = physicsAggregate;\r\n    }\r\n\r\n    public get conversationProviders(): IConversationProvider[] {\r\n        return this._conversationProviders;\r\n    }\r\n\r\n    public addConversationProvider(conversationProvider: IConversationProvider) {\r\n        this._conversationProviders.push(conversationProvider);\r\n    }\r\n\r\n}","import {AbstractMesh, Observable} from \"@babylonjs/core\";\r\nimport {Game} from \"@/YellowSubmarine/Game\";\r\n\r\nexport class MeshDetectionZone {\r\n\r\n    private _zone : AbstractMesh\r\n    public onMeshEnter : Observable<AbstractMesh>;\r\n    public onMeshExit : Observable<AbstractMesh>;\r\n    private _meshToDetect : Map<AbstractMesh, boolean>;\r\n\r\n    public get zone(): AbstractMesh {\r\n        return this._zone;\r\n    }\r\n\r\n    constructor(zone : AbstractMesh, debug ?: boolean) {\r\n        this._zone = zone;\r\n        this._zone.visibility = debug ? 0.5 : 0;\r\n        this._meshToDetect = new Map<AbstractMesh, boolean>();\r\n        this.onMeshEnter = new Observable<AbstractMesh>();\r\n        this.onMeshExit = new Observable<AbstractMesh>();\r\n        Game.scene.onBeforeRenderObservable.add(() => this.checkAll());\r\n    }\r\n\r\n    public addMeshToDetect(mesh : AbstractMesh) : void {\r\n        this._meshToDetect.set(mesh, false);\r\n        this.checkAll();\r\n    }\r\n\r\n    public isInZone(mesh: AbstractMesh): boolean {\r\n        return this._zone.intersectsMesh(mesh, true);\r\n    }\r\n\r\n    private checkDetection(mesh : AbstractMesh) : boolean {\r\n        const state = this._zone.intersectsMesh(mesh, true);\r\n        if (state !== this._meshToDetect.get(mesh)) {\r\n            if(state) this.onMeshEnter.notifyObservers(mesh);\r\n            else this.onMeshExit.notifyObservers(mesh);\r\n            this._meshToDetect.set(mesh, state);\r\n        }\r\n        return state;\r\n    }\r\n\r\n    private checkAll(){\r\n        this._meshToDetect.forEach((state, mesh) => {this.checkDetection(mesh)})\r\n    }\r\n\r\n}","import {MeshDetectionZone} from \"@/YellowSubmarine/detection system/MeshDetectionZone\";\r\nimport {MeshBuilder, Vector4} from \"@babylonjs/core\";\r\n\r\nexport class SphericalDetectionZone extends MeshDetectionZone {\r\n\r\n    constructor(options ?: {segments?: number, diameter?: number,\r\n        diameterX?: number, diameterY?: number, diameterZ?: number, arc?: number,\r\n        slice?: number, sideOrientation?: number, frontUVs?: Vector4,\r\n        backUVs?: Vector4, updatable?: boolean}, debug ?: boolean) {\r\n\r\n        const mesh = MeshBuilder.CreateSphere(\"\", options);\r\n        super(mesh, false);\r\n    }\r\n}","import {AbstractInteraction} from \"@/YellowSubmarine/interaction system/interactions/AbstractInteraction\";\r\nimport {AbstractMesh} from \"@babylonjs/core\";\r\n\r\nexport abstract class WorldInteraction extends AbstractInteraction{\r\n\r\n    public abstract get description(): string\r\n\r\n    public abstract get mesh():AbstractMesh | undefined;\r\n\r\n}","import {Conversation} from \"@/YellowSubmarine/dialogue system/Conversation\";\r\nimport {WorldInteraction} from \"@/YellowSubmarine/interaction system/interactions/WorldInteraction\";\r\nimport {AbstractMesh} from \"@babylonjs/core\";\r\n\r\nexport class StartConversationInteraction extends WorldInteraction{\r\n\r\n    public get description(): string {\r\n        return `Parler`;\r\n    }\r\n\r\n    constructor(private _conversation: Conversation) {\r\n        super(\"KeyE\", \"E\");\r\n    }\r\n\r\n    executeInteraction(): void {\r\n        this._conversation.startConversation();\r\n    }\r\n\r\n    get mesh(): AbstractMesh | undefined {\r\n        return this._conversation.conversationProvider?.mesh;\r\n    }\r\n\r\n}","import {AbstractMesh, TransformNode} from \"@babylonjs/core\";\r\nimport {Conversation} from \"@/YellowSubmarine/dialogue system/Conversation\";\r\nimport {MeshDetectionZone} from \"@/YellowSubmarine/detection system/MeshDetectionZone\";\r\nimport {\r\n    StartConversationInteraction\r\n} from \"@/YellowSubmarine/dialogue system/interactions/StartConversationInteraction\";\r\nimport {World} from \"@/YellowSubmarine/World\";\r\nimport {CameraConfiguration} from \"@/YellowSubmarine/camera system/CameraConfiguration\";\r\nimport {IConversationProvider} from \"@/YellowSubmarine/dialogue system/IConversationProvider\";\r\n\r\nexport class NPC implements IConversationProvider {\r\n\r\n    private _name = \"undefined\";\r\n    private _mesh?: AbstractMesh;\r\n    private _conversation?: Conversation;\r\n    private _startConversationInteraction?: StartConversationInteraction;\r\n    private _playerDetectionZone?: MeshDetectionZone;\r\n    private _cameraConfiguration?: CameraConfiguration;\r\n\r\n    private _transformNode: TransformNode = new TransformNode(\"npcTransform\");\r\n\r\n    public get name(): string {\r\n        return this._name;\r\n    }\r\n    public set name(value: string) {\r\n        this._name = value;\r\n    }\r\n\r\n    public set mesh(value: AbstractMesh | undefined) {\r\n        this._mesh = value;\r\n        if(this._mesh) {\r\n            this._mesh.parent = this._transformNode;\r\n        }\r\n    }\r\n    public get mesh(): AbstractMesh | undefined {\r\n        return this._mesh;\r\n    }\r\n\r\n\r\n    public get cameraConfiguration(): CameraConfiguration | undefined{\r\n        return this._cameraConfiguration;\r\n    }\r\n    public set cameraConfiguration(value: CameraConfiguration | undefined) {\r\n        this._cameraConfiguration = value;\r\n    }\r\n\r\n    public set transformNode(value: TransformNode) {\r\n        this._transformNode = value;\r\n    }\r\n\r\n    public get transformNode(): TransformNode {\r\n        return this._transformNode;\r\n    }\r\n\r\n\r\n    public set detectionZone(value: MeshDetectionZone | undefined ) {\r\n        this._playerDetectionZone = value;\r\n        if(this._playerDetectionZone) {\r\n            this._playerDetectionZone.zone.parent = this._transformNode;\r\n            this.setSignals();\r\n        }\r\n    }\r\n    public get detectionZone(): MeshDetectionZone | undefined {\r\n        return this._playerDetectionZone;\r\n    }\r\n\r\n    public get conversation(): Conversation | undefined {\r\n        return this._conversation;\r\n    }\r\n\r\n    public set conversation(conversation: Conversation | undefined) {\r\n        if(conversation !== undefined) {\r\n            this._startConversationInteraction = new StartConversationInteraction(conversation);\r\n            this._conversation = conversation;\r\n            this._conversation.conversationProvider = this;\r\n\r\n            this._conversation?.onConversationEnd.add( () =>  {\r\n                if(this._playerDetectionZone?.isInZone(World.submarine.mesh)){\r\n                    this._startConversationInteraction?.makeAvailable();\r\n                }\r\n            });\r\n\r\n        }\r\n        else{\r\n            this._startConversationInteraction = undefined;\r\n            if(this._conversation){\r\n                this._conversation.conversationProvider = undefined;\r\n            }\r\n            this._conversation = undefined;\r\n        }\r\n    }\r\n\r\n    private setSignals(): void {\r\n        if(this._playerDetectionZone){\r\n            this._playerDetectionZone.onMeshEnter.add( () => {\r\n                if(this._startConversationInteraction && !this._conversation?.isInProgress()){\r\n                    this._startConversationInteraction.makeAvailable();\r\n                }\r\n            } );\r\n\r\n            this._playerDetectionZone.onMeshExit.add( () => {\r\n                if(this._startConversationInteraction){\r\n                    this._startConversationInteraction.makeUnavailable();\r\n                }\r\n            } );\r\n\r\n            World.submarine.meshCreationPromise.then((mesh: AbstractMesh) => {\r\n                if(this._playerDetectionZone){\r\n                    this._playerDetectionZone.addMeshToDetect(mesh);\r\n                }\r\n            });\r\n\r\n        }\r\n    }\r\n}","import {MeshDetectionZone} from \"@/YellowSubmarine/detection system/MeshDetectionZone\";\r\nimport {Color4, MeshBuilder, Vector4} from \"@babylonjs/core\";\r\n\r\nexport class CylindricalDetectionZone extends MeshDetectionZone {\r\n\r\n    constructor(options ?: {height?: number, diameterTop?: number, diameterBottom?: number, diameter?: number,\r\n        tessellation?: number, subdivisions?: number, arc?: number,\r\n        faceColors?: Color4[], faceUV?: Vector4[], updatable?: boolean,\r\n        hasRings?: boolean, enclose?: boolean, cap?: number, sideOrientation?: number,\r\n        frontUVs?: Vector4, backUVs?: Vector4}, debug ?: boolean) {\r\n\r\n        const mesh = MeshBuilder.CreateCylinder(\"\", options);\r\n        super(mesh, false);\r\n    }\r\n}","export abstract class AbstractDialogueNode {\r\n\r\n    private _text = \"\";\r\n    private _nextNode: AbstractDialogueNode | undefined = undefined;\r\n\r\n    public get text() : string {\r\n        return this._text;\r\n    }\r\n\r\n    public set text(text: string) {\r\n        this._text = text;\r\n    }\r\n\r\n    public set nextNode(value: AbstractDialogueNode | undefined) {\r\n        this._nextNode = value;\r\n    }\r\n\r\n    public get nextNode(): AbstractDialogueNode | undefined {\r\n        return this._nextNode;\r\n    }\r\n\r\n    public abstract execute(): void;\r\n\r\n}","import {AbstractDialogueNode} from \"@/YellowSubmarine/dialogue system/nodes/AbstractDialogueNode\";\r\n\r\nexport class SimpleDialogueNode extends AbstractDialogueNode{\r\n\r\n    execute(): void {return;}\r\n\r\n}","import {Conversation} from \"@/YellowSubmarine/dialogue system/Conversation\";\r\nimport {SimpleDialogueNode} from \"@/YellowSubmarine/dialogue system/nodes/SimpleDialogueNode\";\r\n\r\nexport class ConversationBuilder {\r\n    private root?: SimpleDialogueNode;\r\n    private current?: SimpleDialogueNode;\r\n    private _onEnding?: () => void;\r\n\r\n    public say(text: string): ConversationBuilder {\r\n        const node = new SimpleDialogueNode();\r\n        node.text = text;\r\n\r\n        if (!this.root) {\r\n            this.root = node;\r\n        } else if (this.current) {\r\n            this.current.nextNode = node;\r\n        }\r\n\r\n        this.current = node;\r\n        return this;\r\n    }\r\n\r\n    public then(text: string): ConversationBuilder {\r\n        return this.say(text);\r\n    }\r\n\r\n    public build(): Conversation {\r\n        const conversation = new Conversation();\r\n        if(this._onEnding) conversation.onEnding = this._onEnding;\r\n        if (this.root) {\r\n            conversation.root = this.root;\r\n        }\r\n        return conversation;\r\n    }\r\n\r\n    public setOnEnding(value: () => void): ConversationBuilder {\r\n        this._onEnding = value;\r\n        return this;\r\n    }\r\n}\r\n","import { UI } from \"@/YellowSubmarine/ui system/UI\";\r\nimport { Control, Rectangle, StackPanel, TextBlock } from \"@babylonjs/gui\";\r\nimport { QuestManager } from \"@/YellowSubmarine/quest system/QuestManager\";\r\nimport { Quest } from \"@/YellowSubmarine/quest system/Quest\";\r\nimport {Animation} from \"@babylonjs/core\";\r\nimport {Game} from \"@/YellowSubmarine/Game\";\r\nimport {DayNightCycle} from \"@/YellowSubmarine/sky system/DayNightCycle\";\r\n\r\nexport class QuestUI extends UI {\r\n\r\n    private readonly _panel: StackPanel;\r\n    private static _instance: QuestUI;\r\n\r\n\r\n    get controlNode(): Control {\r\n        return this._panel;\r\n    }\r\n\r\n    public static get instance(): QuestUI {\r\n        return this._instance;\r\n    }\r\n\r\n    private _isDay = true;\r\n\r\n    constructor() {\r\n        super();\r\n\r\n        QuestUI._instance = this;\r\n        this._panel = new StackPanel();\r\n        this._panel.horizontalAlignment = Control.HORIZONTAL_ALIGNMENT_RIGHT;\r\n        this._panel.verticalAlignment = Control.VERTICAL_ALIGNMENT_TOP;\r\n        this._panel.width = \"25%\";\r\n        this._panel.height = \"100%\";\r\n        this._panel.paddingRight = \"10px\";\r\n        this._panel.paddingTop = \"20px\";\r\n        this._panel.isVertical = true;\r\n        this._panel.spacing = 25;\r\n\r\n        DayNightCycle.onDayChanged.add(() => {\r\n            this._isDay = !this._isDay;\r\n            this.refresh();\r\n        })\r\n\r\n    }\r\n\r\n    public refresh() {\r\n        this._panel.clearControls();\r\n        const activeQuests = QuestManager.instance.getAllActiveQuests();\r\n\r\n        if (activeQuests.length === 0) {\r\n            this._panel.addControl(this.createSeparator());\r\n            return;\r\n        }\r\n\r\n        activeQuests.forEach((quest: Quest, index) => {\r\n            const container = new StackPanel();\r\n            container.isVertical = true;\r\n            container.width = \"100%\";\r\n            container.alpha = 0;\r\n\r\n            const titleText = new TextBlock();\r\n            titleText.text = `⛋ ${quest.name}`;\r\n            titleText.color = this._isDay ? \"black\" : \"white\";\r\n            titleText.fontSize = 20;\r\n            titleText.fontWeight = \"bold\";\r\n            titleText.textHorizontalAlignment = Control.HORIZONTAL_ALIGNMENT_LEFT;\r\n            titleText.height = \"40px\";\r\n\r\n            const stepText = new TextBlock();\r\n            stepText.text = quest.steps[quest.currentStepIndex].description;\r\n            stepText.color = this._isDay ? \"black\" : \"white\";\r\n            stepText.fontSize = 17;\r\n            stepText.textHorizontalAlignment = Control.HORIZONTAL_ALIGNMENT_CENTER;\r\n            stepText.height = \"40px\";\r\n            stepText.textWrapping = true;\r\n            stepText.paddingLeft = \"16px\";\r\n\r\n            container.addControl(titleText);\r\n            container.addControl(stepText);\r\n            container.addControl(this.createSeparator());\r\n\r\n            this._panel.addControl(container);\r\n\r\n            // Animation alpha\r\n            const fadeAnim = new Animation(\r\n                \"fadeInQuest\",\r\n                \"alpha\",\r\n                60,\r\n                Animation.ANIMATIONTYPE_FLOAT,\r\n                Animation.ANIMATIONLOOPMODE_CONSTANT\r\n            );\r\n            fadeAnim.setKeys([\r\n                { frame: 0, value: 0 },\r\n                { frame: 20, value: 1 }\r\n            ]);\r\n            container.animations = [fadeAnim];\r\n\r\n            setTimeout(() => {\r\n                Game.scene.beginAnimation(container, 0, 20, false);\r\n            }, index * 150);\r\n        });\r\n\r\n    }\r\n\r\n    private createSeparator(): Rectangle {\r\n        const separator = new Rectangle();\r\n        separator.height = \"5px\";\r\n        separator.width = \"100%\";\r\n        separator.background = \"white\";\r\n        separator.thickness = 0;\r\n        separator.paddingTop = \"4px\";\r\n        return separator;\r\n    }\r\n\r\n}\r\n","import {QuestStep} from \"@/YellowSubmarine/quest system/QuestStep\";\r\nimport {SoundManager} from \"@/YellowSubmarine/sound system/SoundManager\";\r\nimport {QuestUI} from \"@/YellowSubmarine/quest system/ui/QuestUI\";\r\n\r\nexport type QuestState = 'inactive' | 'active' | 'completed';\r\n\r\nexport class Quest{\r\n\r\n    private _id: string;\r\n    private _name: string;\r\n    private _state: QuestState;\r\n    private _currentStepIndex: number;\r\n    private _steps: QuestStep[];\r\n\r\n    public get id(): string {\r\n        return this._id;\r\n    }\r\n\r\n    public set id(value: string) {\r\n        this._id = value;\r\n    }\r\n\r\n    public get name(): string {\r\n        return this._name;\r\n    }\r\n\r\n    public set name(value: string) {\r\n        this._name = value;\r\n    }\r\n\r\n    public get state(): QuestState {\r\n        return this._state;\r\n    }\r\n\r\n    public set state(value: QuestState) {\r\n        this._state = value;\r\n    }\r\n\r\n    public get currentStepIndex(): number {\r\n        return this._currentStepIndex;\r\n    }\r\n\r\n    public set currentStepIndex(value: number) {\r\n        this._currentStepIndex = value;\r\n    }\r\n\r\n    public get steps(): QuestStep[] {\r\n        return this._steps;\r\n    }\r\n\r\n    public set steps(value: QuestStep[]) {\r\n        this._steps = value;\r\n    }\r\n\r\n    constructor(id: string, name: string, state: QuestState, currentStepIndex: number) {\r\n        this._id = id;\r\n        this._name = name;\r\n        this._state = state;\r\n        this._currentStepIndex = currentStepIndex;\r\n        this._steps = []\r\n    }\r\n\r\n    public startQuest() {\r\n        this._state = \"active\";\r\n        this.playQuestSound();\r\n        QuestUI.instance.refresh();\r\n    }\r\n\r\n    public stopQuest() {\r\n        this._state = \"completed\";\r\n        QuestUI.instance.refresh();\r\n    }\r\n\r\n    public nextStep() {\r\n        if(!(this._currentStepIndex === this._steps.length - 1)){\r\n            this._currentStepIndex++;\r\n            this.playQuestSound();\r\n        }\r\n        QuestUI.instance.refresh();\r\n\r\n    }\r\n\r\n    public updateCurrentStepStatus() {\r\n        this._steps[this._currentStepIndex].validate();\r\n    }\r\n\r\n    private playQuestSound(){\r\n        SoundManager.instance.playSFX(\"quest\", {\r\n            loop: false,\r\n            autoplay: true\r\n        });\r\n    }\r\n}\r\n","export class QuestStep {\r\n\r\n    public description: string;\r\n    public condition: boolean;\r\n\r\n    constructor(description: string) {\r\n        this.description = description;\r\n        this.condition = false;\r\n    }\r\n\r\n    public validate(){\r\n        this.condition = true;\r\n    }\r\n}","import {WorldInteraction} from \"@/YellowSubmarine/interaction system/interactions/WorldInteraction\";\r\nimport {Socle} from \"@/YellowSubmarine/temple/Socle\";\r\nimport {AbstractMesh} from \"@babylonjs/core\";\r\nimport {Submarine} from \"@/YellowSubmarine/Submarine\";\r\n\r\nexport class RemoveTempleBallInteraction extends WorldInteraction{\r\n\r\n    public constructor(private _socle: Socle) {\r\n        super(\"KeyF\", \"F\");\r\n    }\r\n\r\n    public get description(): string {\r\n        return \"Retirer\";\r\n    }\r\n\r\n    executeInteraction(): void {\r\n        const templeBall = this._socle.currentBall;\r\n        if(templeBall && !Submarine.instance.templeBall){\r\n            this._socle.letGoOfBall();\r\n            Submarine.instance.grabBall(templeBall);\r\n            console.log(\"REMOVING THE BALL !!!\")\r\n        }\r\n    }\r\n\r\n    public get mesh(): AbstractMesh | undefined {\r\n        return this._socle.mesh;\r\n    }\r\n\r\n\r\n\r\n}","import {WorldInteraction} from \"@/YellowSubmarine/interaction system/interactions/WorldInteraction\";\r\nimport {Socle} from \"@/YellowSubmarine/temple/Socle\";\r\nimport {AbstractMesh} from \"@babylonjs/core\";\r\nimport {Submarine} from \"@/YellowSubmarine/Submarine\";\r\n\r\nexport class PlaceTempleBallInteraction extends WorldInteraction{\r\n\r\n    public constructor(private _socle: Socle) {\r\n        super(\"KeyF\", \"F\");\r\n    }\r\n\r\n    public get description(): string {\r\n        return \"Poser\";\r\n    }\r\n\r\n    executeInteraction(): void {\r\n        const templeBall = Submarine.instance.templeBall;\r\n        if(templeBall) {\r\n            console.log(\"PLACING THE BALL !!!\", templeBall);\r\n            this._socle.placeBall(templeBall);\r\n            Submarine.instance.letGoOfBall();\r\n        }\r\n    }\r\n\r\n    public get mesh(): AbstractMesh | undefined {\r\n        return this._socle.mesh;\r\n    }\r\n\r\n}","import {\r\n    AbstractMesh,\r\n    Color3,\r\n    ImportMeshAsync, ISceneLoaderAsyncResult, LockConstraint,\r\n    Mesh,\r\n    PhysicsBody,\r\n    PhysicsMotionType,\r\n    PhysicsShape,\r\n    PhysicsShapeType, TransformNode, Vector3\r\n} from \"@babylonjs/core\";\r\nimport {MeshDetectionZone} from \"@/YellowSubmarine/detection system/MeshDetectionZone\";\r\nimport {Game} from \"@/YellowSubmarine/Game\";\r\nimport {SphericalDetectionZone} from \"@/YellowSubmarine/detection system/SphericalDetectionZone\";\r\nimport {Submarine} from \"@/YellowSubmarine/Submarine\";\r\nimport {TempleBall} from \"@/YellowSubmarine/temple/TempleBall\";\r\nimport {RemoveTempleBallInteraction} from \"@/YellowSubmarine/temple/interaction/RemoveTempleBallInteraction\";\r\nimport {PlaceTempleBallInteraction} from \"@/YellowSubmarine/temple/interaction/PlaceTempleBallInteraction\";\r\nimport {CellMaterial} from \"@babylonjs/materials\";\r\nimport {SoundManager} from \"@/YellowSubmarine/sound system/SoundManager\";\r\n\r\nexport class Socle{\r\n    public get currentBall(): TempleBall | undefined{\r\n        return this._currentBall;\r\n    }\r\n    public get mesh(): AbstractMesh {\r\n        return this._mesh;\r\n    }\r\n\r\n    private _transformNode: TransformNode = new TransformNode(\"socle\");\r\n    private _ballTransformNode: TransformNode = new TransformNode(\"ballPosition\");\r\n    private _mesh!: AbstractMesh;\r\n    private _material: CellMaterial;\r\n    private _socleDetectionZone: MeshDetectionZone;\r\n    private _validColor?: Color3;\r\n    private _currentBall?: TempleBall;\r\n    private _lockConstraint?: LockConstraint;\r\n    private _placeTempleBallInteraction: PlaceTempleBallInteraction;\r\n    private _removeTempleBallInteraction: RemoveTempleBallInteraction;\r\n\r\n    public readonly meshImportedPromise: Promise<void | ISceneLoaderAsyncResult>;\r\n\r\n    public constructor(parent: TransformNode, position: Vector3) {\r\n\r\n        this._material = new CellMaterial(\"socleMat\");\r\n        this._material.diffuseColor = new Color3(0.3,0.3,0.3);\r\n        this._transformNode.parent = parent;\r\n        this._transformNode.position = position;\r\n        this._ballTransformNode.parent = this._transformNode;\r\n        this._ballTransformNode.position = Vector3.Up().scale(5);\r\n        this._placeTempleBallInteraction = new PlaceTempleBallInteraction(this);\r\n        this._removeTempleBallInteraction = new RemoveTempleBallInteraction(this);\r\n\r\n\r\n        this._socleDetectionZone = new SphericalDetectionZone({\r\n            diameter: 8,\r\n        }, false);\r\n\r\n        Submarine.instance.meshCreationPromise.then((mesh) => {\r\n            this._socleDetectionZone?.addMeshToDetect(mesh);\r\n        });\r\n\r\n        this._socleDetectionZone.onMeshEnter.add(() => {\r\n            this.makeInteractionAvailable();\r\n        });\r\n\r\n        this._socleDetectionZone.onMeshExit.add(() => {\r\n            this.makeInteractionUnavailable();\r\n        });\r\n\r\n        this.meshImportedPromise = ImportMeshAsync(\"models/objects/socle.glb\", Game.scene).then((result) => {\r\n            this._mesh = result.meshes[1];\r\n            this._mesh.parent = this._transformNode;\r\n            this._mesh.material = this._material;\r\n            const physicsBody = new PhysicsBody(this._mesh, PhysicsMotionType.STATIC, false, Game.scene);\r\n            const physicsShape = new PhysicsShape({\r\n                type: PhysicsShapeType.MESH,\r\n                parameters:{\r\n                    mesh: this._mesh as Mesh\r\n                },\r\n            }, Game.scene);\r\n            physicsBody.shape = physicsShape;\r\n\r\n            this._socleDetectionZone.zone.parent = this._mesh;\r\n        });\r\n\r\n    }\r\n\r\n    public placeBall(ball: TempleBall) {\r\n        this._currentBall = ball;\r\n        this._lockConstraint = new LockConstraint(Vector3.Zero(), Vector3.Up().scale(4), Vector3.Up(), Vector3.Down(), Game.scene);\r\n        this._mesh.physicsBody?.addConstraint(ball.physicsBody, this._lockConstraint);\r\n        this._currentBall.socle = this;\r\n        this._material.diffuseColor = new Color3(5,5,5);\r\n        if(SoundManager.instance) SoundManager.instance.playSFX(\"socle\");\r\n    }\r\n\r\n    public letGoOfBall(){\r\n        if(this._currentBall){\r\n            this._currentBall = undefined;\r\n            this._lockConstraint?.dispose();\r\n            this._material.diffuseColor = new Color3(0.3,0.3,0.3);\r\n            if(SoundManager.instance) SoundManager.instance.playSFX(\"socle\");\r\n        }\r\n    }\r\n\r\n    public get validColor(): Color3 | undefined {\r\n        return this._validColor;\r\n    }\r\n\r\n    public set validColor(value: Color3 | undefined) {\r\n        this._validColor = value;\r\n    }\r\n\r\n    public get transformNode(): TransformNode {\r\n        return this._transformNode;\r\n    }\r\n\r\n    private makeInteractionAvailable(){\r\n        this._placeTempleBallInteraction.makeUnavailable();\r\n        this._removeTempleBallInteraction.makeUnavailable();\r\n        if(this._currentBall && !Submarine.instance.templeBall){\r\n            this._removeTempleBallInteraction.makeAvailable();\r\n        }\r\n        else if(!this._currentBall && Submarine.instance.templeBall){\r\n            this._placeTempleBallInteraction.makeAvailable();\r\n        }\r\n    }\r\n\r\n    private makeInteractionUnavailable(){\r\n        this._placeTempleBallInteraction.makeUnavailable();\r\n        this._removeTempleBallInteraction.makeUnavailable();\r\n    }\r\n\r\n}","import {WorldInteraction} from \"@/YellowSubmarine/interaction system/interactions/WorldInteraction\";\r\nimport {TempleBall} from \"@/YellowSubmarine/temple/TempleBall\";\r\nimport {AbstractMesh} from \"@babylonjs/core\";\r\nimport {Grappler} from \"@/YellowSubmarine/grappling system/Grappler\";\r\n\r\nexport class GrappleInteraction extends WorldInteraction{\r\n\r\n    public constructor(private _grabbableObject: TempleBall) {\r\n        super(\"KeyF\", \"F\");\r\n    }\r\n\r\n    public get grabbableObject(): TempleBall {\r\n        return this._grabbableObject;\r\n    }\r\n\r\n    public set grabbableObject(value: TempleBall) {\r\n        this._grabbableObject = value;\r\n    }\r\n\r\n    public get description(): string {\r\n        return \"Attraper\";\r\n    }\r\n\r\n    public executeInteraction(): void {\r\n        Grappler.instance.grappleObject(this._grabbableObject);\r\n        this.makeUnavailable();\r\n    }\r\n\r\n    public get mesh(): AbstractMesh | undefined {\r\n        return this._grabbableObject.mesh;\r\n    }\r\n\r\n\r\n}","import {SphericalDetectionZone} from \"@/YellowSubmarine/detection system/SphericalDetectionZone\";\r\nimport {GrappleInteraction} from \"@/YellowSubmarine/grappling system/interaction/GrappleInteraction\";\r\nimport {\r\n    AbstractMesh, Color3,\r\n    MeshBuilder, Observable,\r\n    PhysicsBody,\r\n    PhysicsMotionType,\r\n    PhysicsShape,\r\n    PhysicsShapeType, Vector3\r\n} from \"@babylonjs/core\";\r\nimport {Submarine} from \"@/YellowSubmarine/Submarine\";\r\nimport {Game} from \"@/YellowSubmarine/Game\";\r\nimport {Grappler} from \"@/YellowSubmarine/grappling system/Grappler\";\r\nimport {Socle} from \"@/YellowSubmarine/temple/Socle\";\r\nimport {CellMaterial} from \"@babylonjs/materials\";\r\nimport {TemplePuzzle} from \"@/YellowSubmarine/temple/TemplePuzzle\";\r\n\r\nexport class TempleBall {\r\n    private _detectionZone: SphericalDetectionZone;\r\n    private _grappleInteraction: GrappleInteraction;\r\n    private _mesh: AbstractMesh;\r\n    private _physicsBody: PhysicsBody;\r\n    private _physicsShape: PhysicsShape;\r\n    private _socle?: Socle;\r\n\r\n    public static onAnyBallPlacedOnAnySocle = new Observable<{ball: TempleBall, socle: Socle}>();\r\n    public onPlacedOnSocle = new Observable<Socle>();\r\n\r\n    public get mesh(): AbstractMesh {\r\n        return this._mesh;\r\n    }\r\n\r\n    public get physicsBody(): PhysicsBody {\r\n        return this._physicsBody;\r\n    }\r\n\r\n    public get socle(): Socle | undefined {\r\n        return this._socle;\r\n    }\r\n\r\n    public set socle(socle: Socle | undefined) {\r\n        this._socle = socle;\r\n        if(socle){\r\n            this.onPlacedOnSocle.notifyObservers(socle);\r\n        }\r\n    }\r\n\r\n    public constructor(position: Vector3, public readonly color: Color3) {\r\n        TemplePuzzle.registerBall(this);\r\n        this.onPlacedOnSocle.add((s) => TempleBall.onAnyBallPlacedOnAnySocle.notifyObservers({ball: this, socle: s}));\r\n        this._mesh = MeshBuilder.CreateSphere(\"templeBall\", {\r\n            diameter: 2,\r\n        });\r\n        this._mesh.position = position;\r\n        this._physicsShape = new PhysicsShape({\r\n            type: PhysicsShapeType.SPHERE,\r\n            parameters: {\r\n                radius: 1,\r\n            }\r\n        }, Game.scene);\r\n        const cellMaterial = new CellMaterial(\"templeBallMaterial\");\r\n        cellMaterial.diffuseColor = color;\r\n        this._mesh.material = cellMaterial;\r\n        this._physicsBody = new PhysicsBody(this._mesh, PhysicsMotionType.DYNAMIC, false, Game.scene);\r\n        this._physicsBody.shape = this._physicsShape;\r\n        this._physicsBody.setLinearDamping(1);\r\n        this._physicsBody.setMassProperties({\r\n            mass: 0.5,\r\n        });\r\n\r\n        this._grappleInteraction = new GrappleInteraction(this);\r\n        this._detectionZone = new SphericalDetectionZone({\r\n            diameter: 4,\r\n        },false);\r\n        this._detectionZone.zone.parent = this._mesh;\r\n        Submarine.instance.meshCreationPromise.then((mesh) => {\r\n           this._detectionZone.addMeshToDetect(mesh);\r\n        });\r\n        this._detectionZone.onMeshEnter.add(() => {\r\n            if(Grappler.instance.hasAnObjectGrappled || this._socle) return\r\n\r\n            this._grappleInteraction.makeAvailable();\r\n        })\r\n        this._detectionZone.onMeshExit.add(() => {\r\n            this._grappleInteraction.makeUnavailable();\r\n        })\r\n    }\r\n\r\n\r\n\r\n\r\n}","import {WorldInteraction} from \"@/YellowSubmarine/interaction system/interactions/WorldInteraction\";\r\nimport {UI} from \"@/YellowSubmarine/ui system/UI\";\r\nimport {Control, Rectangle, TextBlock} from \"@babylonjs/gui\";\r\nimport {InteractionManager} from \"@/YellowSubmarine/interaction system/InteractionManager\";\r\n\r\nexport class WorldInteractionUI extends UI{\r\n\r\n    private _container: Rectangle;\r\n\r\n    constructor() {\r\n        super();\r\n        this._container = new Rectangle();\r\n        this._container.width = \"300px\";\r\n        this._container.height = \"200px\";\r\n        this._container.thickness = 0;\r\n        this._container.scaleY = 0.5;\r\n        this._container.scaleX = 0.5;\r\n\r\n        InteractionManager.instance.onInteractionAvailable.add((interaction) => {\r\n            if(interaction instanceof WorldInteraction) {\r\n                this.show(interaction);\r\n            }\r\n        });\r\n        InteractionManager.instance.onInteractionUnavailable.add((interaction) => {\r\n            if(interaction instanceof WorldInteraction) {\r\n                this.hide();\r\n            }\r\n        });\r\n    }\r\n\r\n    public get controlNode(): Control {\r\n        return this._container;\r\n    }\r\n\r\n    private show(interaction: WorldInteraction): void {\r\n        this._container.isVisible = true;\r\n\r\n        const rec1 = new Rectangle();\r\n        rec1.width = \"180px\";\r\n        rec1.height = \"60px\";\r\n        rec1.cornerRadius = 60;\r\n        rec1.color = \"rgb(168, 98, 68)\";\r\n        rec1.thickness = 4;\r\n        rec1.background = \"rgb(255, 199, 130)\";\r\n        this._container.addControl(rec1);\r\n\r\n        const label1 = new TextBlock();\r\n        label1.fontSize = 30;\r\n        label1.text = `${interaction.description}`;\r\n        rec1.addControl(label1);\r\n\r\n        // Deuxième rectangle avec son label\r\n        const rec2 = new Rectangle();\r\n        rec2.width = \"80px\";\r\n        rec2.height = \"70px\";\r\n        rec2.cornerRadius = 60;\r\n        rec2.color = \"rgb(168, 98, 68)\";\r\n        rec2.thickness = 4;\r\n        rec2.background = \"rgb(255, 255, 255)\";\r\n        rec2.horizontalAlignment = Control.HORIZONTAL_ALIGNMENT_RIGHT;\r\n        rec2.verticalAlignment = Control.VERTICAL_ALIGNMENT_BOTTOM;\r\n        this._container.addControl(rec2);\r\n\r\n        const label2 = new TextBlock();\r\n        label2.fontSize = 45;\r\n        label2.text = `${interaction.simplifiedCode}`;\r\n        label2.fontWeight = \"bold\";\r\n        label2.paddingTop = \"6px\";\r\n        rec2.addControl(label2);\r\n\r\n        this._container.linkWithMesh(interaction.mesh ?? null);\r\n        this._container.linkOffsetY = \"-50px\";\r\n\r\n    }\r\n\r\n    private hide() {\r\n        this._container.isVisible = false;\r\n        this._container.linkWithMesh(null);\r\n    }\r\n}","import { UI } from \"@/YellowSubmarine/ui system/UI\";\r\nimport { Control, TextBlock, Rectangle } from \"@babylonjs/gui\";\r\nimport { KeyZone } from \"@/YellowSubmarine/keyzone system/KeyZone\";\r\n\r\nexport class ShowKeyZoneNameUI extends UI {\r\n\r\n    private _container: Rectangle;\r\n    private _textBlock: TextBlock;\r\n\r\n    get controlNode(): Control {\r\n        return this._container;\r\n    }\r\n\r\n    constructor() {\r\n        super();\r\n\r\n        this._textBlock = new TextBlock();\r\n        this._textBlock.color = \"white\";\r\n        this._textBlock.textWrapping = true;\r\n        this._textBlock.textHorizontalAlignment = Control.HORIZONTAL_ALIGNMENT_CENTER;\r\n        this._textBlock.textVerticalAlignment = Control.VERTICAL_ALIGNMENT_CENTER;\r\n\r\n        this._container = new Rectangle();\r\n        this._container.width = \"25%\";\r\n        this._container.height = \"80px\";\r\n        this._container.cornerRadius = 12;\r\n        this._container.color = \"white\";\r\n        this._container.thickness = 2;\r\n        this._container.background = \"rgba(0, 0, 0, 0.6)\";\r\n        this._container.alpha = 0;\r\n        this._container.addControl(this._textBlock);\r\n        this._container.zIndex = 1;\r\n\r\n        KeyZone.onAnyKeyZoneEntered.add((keyzone) => this.show(keyzone));\r\n    }\r\n\r\n    public show(keyzone: KeyZone) {\r\n        this._textBlock.text = keyzone.name;\r\n\r\n        if (keyzone.discovered) {\r\n            this._container.horizontalAlignment = Control.HORIZONTAL_ALIGNMENT_LEFT;\r\n            this._container.verticalAlignment = Control.VERTICAL_ALIGNMENT_BOTTOM;\r\n            this._container.left = \"20px\";\r\n            this._container.top = \"-20px\";\r\n\r\n            this._textBlock.fontSize = \"28px\";\r\n            this._textBlock.fontStyle = \"normal\";\r\n        } else {\r\n            this._container.horizontalAlignment = Control.HORIZONTAL_ALIGNMENT_CENTER;\r\n            this._container.verticalAlignment = Control.VERTICAL_ALIGNMENT_BOTTOM;\r\n            this._container.paddingBottom = \"30px\";\r\n\r\n            this._textBlock.fontSize = \"36px\";\r\n            this._textBlock.fontStyle = \"bold\";\r\n        }\r\n\r\n        this.fadeTo(1, 300);\r\n\r\n        setTimeout(() => {\r\n            this.fadeTo(0, 500);\r\n        }, 3000);\r\n    }\r\n\r\n    private fadeTo(targetAlpha: number, duration: number) {\r\n        const startAlpha = this._container.alpha;\r\n        const startTime = performance.now();\r\n\r\n        const animate = (time: number) => {\r\n            const elapsed = time - startTime;\r\n            const progress = Math.min(elapsed / duration, 1);\r\n            this._container.alpha = startAlpha + (targetAlpha - startAlpha) * progress;\r\n\r\n            if (progress < 1) {\r\n                requestAnimationFrame(animate);\r\n            }\r\n        };\r\n\r\n        requestAnimationFrame(animate);\r\n    }\r\n}\r\n","import { UI } from \"@/YellowSubmarine/ui system/UI\";\r\nimport { Button, Control, Slider, StackPanel, TextBlock, Rectangle, Grid } from \"@babylonjs/gui\";\r\nimport { MainMenuUI } from \"@/YellowSubmarine/ui system/MainMenuUI\";\r\nimport { Game } from \"@/YellowSubmarine/Game\";\r\nimport { KeyboardEventTypes } from \"@babylonjs/core\";\r\nimport { SoundManager } from \"@/YellowSubmarine/sound system/SoundManager\";\r\n\r\nexport class OptionsMenuUI extends UI {\r\n\r\n    private _panel: StackPanel;\r\n\r\n    get controlNode(): Control {\r\n        return this._panel;\r\n    }\r\n\r\n    constructor(private _mainMenu: MainMenuUI) {\r\n        super();\r\n        this._panel = new StackPanel();\r\n        this._panel.zIndex = 2;\r\n        this._panel.width = \"600px\";\r\n        this._panel.horizontalAlignment = Control.HORIZONTAL_ALIGNMENT_LEFT;\r\n        this._panel.verticalAlignment = Control.VERTICAL_ALIGNMENT_CENTER;\r\n        this._panel.spacing = 15;\r\n        this._panel.paddingLeft = \"60px\";\r\n        this.createSliderWithLabel(\"Volume SFX\", SoundManager.instance.SFXVolume, (value) => {\r\n            SoundManager.instance.SFXVolume = value;\r\n        });\r\n\r\n        this.createSliderWithLabel(\"Volume Musique\", SoundManager.instance.MUSICVolume, (value) => {\r\n            SoundManager.instance.MUSICVolume = value;\r\n        });\r\n\r\n        this.createSliderWithLabel(\"Volume UI\", SoundManager.instance.UIVolume, (value) => {\r\n            SoundManager.instance.UIVolume = value;\r\n        });\r\n\r\n        const backButton = MainMenuUI.createButton(\"Retour\", () => {\r\n            this.hide();\r\n        });\r\n        backButton.width = \"300px\";\r\n        backButton.height = \"40px\";\r\n        backButton.color = \"white\";\r\n        backButton.background = \"rgba(255, 255, 255, 0.05)\";\r\n        this._panel.addControl(backButton);\r\n\r\n        this._panel.isVisible = false;\r\n\r\n        Game.scene.onKeyboardObservable.add((eventData) => {\r\n            const state = eventData.type === KeyboardEventTypes.KEYDOWN;\r\n            if (eventData.event.key === \"Escape\" && state && this.controlNode.isVisible) {\r\n                this.hide();\r\n            }\r\n        });\r\n    }\r\n\r\n    private createSliderWithLabel(labelText: string, initialValue: number, onChange: (value: number) => void) {\r\n        const container = new StackPanel();\r\n        container.isVertical = false;\r\n        container.height = \"40px\";\r\n        container.paddingBottom = \"10px\";\r\n        container.horizontalAlignment = Control.HORIZONTAL_ALIGNMENT_CENTER;\r\n        container.verticalAlignment = Control.VERTICAL_ALIGNMENT_CENTER;\r\n\r\n        const label = new TextBlock();\r\n        label.text = labelText;\r\n        label.color = \"white\";\r\n        label.width = \"120px\";\r\n        label.fontSize = 14;\r\n        label.fontStyle = \"bold\";\r\n        label.textHorizontalAlignment = Control.HORIZONTAL_ALIGNMENT_LEFT;\r\n        label.paddingRight = \"10px\";\r\n\r\n        const slider = new Slider();\r\n        slider.minimum = 0;\r\n        slider.maximum = 1;\r\n        slider.value = initialValue;\r\n        slider.width = \"150px\";\r\n        slider.height = \"14px\";\r\n        slider.color = \"#FFF\";\r\n        slider.background = \"#333\";\r\n        slider.thumbWidth = \"18px\";\r\n        slider.thumbColor = \"#AAA\";\r\n        slider.borderColor = \"#888\";\r\n\r\n        const valueLabel = new TextBlock();\r\n        valueLabel.text = Math.round(initialValue * 100).toString() + \" %\";\r\n        valueLabel.width = \"50px\";\r\n        valueLabel.color = \"white\";\r\n        valueLabel.fontSize = 14;\r\n        valueLabel.textHorizontalAlignment = Control.HORIZONTAL_ALIGNMENT_RIGHT;\r\n        valueLabel.paddingLeft = \"10px\";\r\n\r\n        slider.onValueChangedObservable.add((value) => {\r\n            valueLabel.text = Math.round(value * 100).toString() + \" %\";\r\n            onChange(value);\r\n        });\r\n\r\n        container.addControl(label);\r\n        container.addControl(slider);\r\n        container.addControl(valueLabel);\r\n\r\n        this._panel.addControl(container);\r\n    }\r\n\r\n    public show() {\r\n        this._panel.isVisible = true;\r\n    }\r\n\r\n    public hide() {\r\n        this._panel.isVisible = false;\r\n        this._mainMenu.show();\r\n    }\r\n}","import { Control, Image } from \"@babylonjs/gui\";\r\nimport {UI} from \"@/YellowSubmarine/ui system/UI\";\r\nimport {Game} from \"@/YellowSubmarine/Game\";\r\n\r\nexport class ImageUI extends UI {\r\n\r\n    private _imageControl: Image;\r\n\r\n    constructor(imagePath: string) {\r\n        super();\r\n        this._imageControl = new Image(\"imageUI\", imagePath);\r\n        this._imageControl.width = 1;\r\n        this._imageControl.height = 1;\r\n        this._imageControl.stretch = Image.STRETCH_UNIFORM;\r\n    }\r\n\r\n    public get controlNode(): Control {\r\n        return this._imageControl;\r\n    }\r\n\r\n    public fadeIn(duration: number) {\r\n        const imageControl = this.controlNode as Image;\r\n        imageControl.alpha = 0;\r\n\r\n        const startTime = performance.now();\r\n\r\n        const fadeObserver = Game.scene.onBeforeRenderObservable.add(() => {\r\n            const elapsed = performance.now() - startTime;\r\n            const progress = Math.min(elapsed / duration, 1);\r\n            imageControl.alpha = progress;\r\n\r\n            if (progress >= 1) {\r\n                Game.scene.onBeforeRenderObservable.remove(fadeObserver);\r\n            }\r\n        });\r\n    }\r\n\r\n    public fadeOut(duration: number) {\r\n        const imageControl = this.controlNode as Image;\r\n        imageControl.alpha = 1;\r\n\r\n        const startTime = performance.now();\r\n\r\n        const fadeObserver = Game.scene.onBeforeRenderObservable.add(() => {\r\n            const elapsed = performance.now() - startTime;\r\n            const progress = Math.min(elapsed / duration, 1);\r\n            imageControl.alpha = 1 - progress;\r\n\r\n            if (progress >= 1) {\r\n                Game.scene.onBeforeRenderObservable.remove(fadeObserver);\r\n            }\r\n        });\r\n    }\r\n\r\n}","import {UI} from \"@/YellowSubmarine/ui system/UI\";\r\nimport {\r\n    Button,\r\n    Control,\r\n    StackPanel,\r\n    TextBlock\r\n} from \"@babylonjs/gui\";\r\nimport {Game} from \"@/YellowSubmarine/Game\";\r\nimport {KeyboardEventTypes} from \"@babylonjs/core\";\r\nimport {OptionsMenuUI} from \"@/YellowSubmarine/ui system/OptionsMenuUI\";\r\nimport {SoundManager} from \"@/YellowSubmarine/sound system/SoundManager\";\r\nimport {ImageUI} from \"@/YellowSubmarine/ui system/ImageUI\";\r\nimport {UIManager} from \"@/YellowSubmarine/ui system/UIManager\";\r\n\r\nexport class MainMenuUI extends UI {\r\n\r\n    private _panel: StackPanel;\r\n    private _optionMenuUI : OptionsMenuUI;\r\n    private _canvas?: HTMLCanvasElement;\r\n    private _howToPlay: ImageUI;\r\n\r\n    public set canvas(canvas : HTMLCanvasElement) {\r\n        this._canvas = canvas;\r\n    }\r\n\r\n    public get controlNode(): Control {\r\n        return this._panel;\r\n    }\r\n\r\n    public get optionsMenuUI(): OptionsMenuUI {\r\n        return this._optionMenuUI;\r\n    }\r\n\r\n    constructor() {\r\n        super();\r\n        this._howToPlay = new ImageUI(\"ui/how-to-play.png\");\r\n        this._howToPlay.controlNode.isVisible = false;\r\n        this._optionMenuUI = new OptionsMenuUI(this);\r\n        this._panel = new StackPanel();\r\n        this._panel.zIndex = 2;\r\n        this._panel.width = \"300px\";\r\n        this._panel.horizontalAlignment = Control.HORIZONTAL_ALIGNMENT_LEFT;\r\n        this._panel.verticalAlignment = Control.VERTICAL_ALIGNMENT_CENTER;\r\n        this._panel.paddingLeft = \"60px\";\r\n        this._panel.spacing = 20;\r\n\r\n        const playButton = MainMenuUI.createButton(\"Jouer\", () => this.onPlayPressed());\r\n        const optionsButton = MainMenuUI.createButton(\"Options\", () => this.onOptionsPressed());\r\n        const howToPlayButton = MainMenuUI.createButton(\"How to Play\", () => this.showHowToPlay());\r\n        const quitButton = MainMenuUI.createButton(\"Quitter\", () => this.onQuitPressed());\r\n\r\n        this._panel.addControl(playButton);\r\n        this._panel.addControl(optionsButton);\r\n        this._panel.addControl(howToPlayButton);\r\n        //this._panel.addControl(quitButton);\r\n\r\n        this.show();\r\n\r\n        Game.scene.onKeyboardObservable.add((eventData) => {\r\n            const state = eventData.type === KeyboardEventTypes.KEYDOWN;\r\n            if(eventData.event.key === \"Escape\" && state && !this.optionsMenuUI.controlNode.isVisible){\r\n                if(this._canvas && !this._panel.isVisible){\r\n                    this.show();\r\n                }\r\n            }\r\n            if(eventData.event.key === \"Escape\" && state && this._howToPlay.controlNode.isVisible){\r\n                if(this._canvas){\r\n                    this.hideHowToPlay();\r\n                    this.show();\r\n                }\r\n            }\r\n        });\r\n    }\r\n\r\n    public static createButton(text: string, callback: () => void): Button {\r\n        const button = Button.CreateSimpleButton(text.toLowerCase(), text);\r\n        button.width = \"100%\";\r\n        button.height = \"60px\";\r\n        button.color = \"white\";\r\n        button.background = \"rgba(255, 255, 255, 0.05)\";\r\n        button.fontSize = \"28px\";\r\n        button.fontStyle = \"bold\";\r\n        button.textBlock!.textHorizontalAlignment = Control.HORIZONTAL_ALIGNMENT_LEFT;\r\n        button.textBlock!.paddingLeft = \"20px\";\r\n        button.cornerRadius = 10;\r\n        button.thickness = 1;\r\n        button.paddingBottom = \"10px\";\r\n\r\n        button.onPointerEnterObservable.add(() => {\r\n            button.background = \"rgba(255, 255, 255, 0.2)\";\r\n        });\r\n        button.onPointerOutObservable.add(() => {\r\n            button.background = \"rgba(255, 255, 255, 0.05)\";\r\n        });\r\n\r\n        button.onPointerUpObservable.add(callback);\r\n        button.onPointerUpObservable.add(() => {\r\n            if (SoundManager.instance) {\r\n                SoundManager.instance.stopUI(\"click\");\r\n                SoundManager.instance.playUI(\"click\", {autoplay: true, loop: false});\r\n            }\r\n        });\r\n        return button;\r\n    }\r\n\r\n    public show() {\r\n        this._panel.isVisible = true;\r\n    }\r\n\r\n    public hide() {\r\n        this._panel.isVisible = false;\r\n    }\r\n\r\n    private onPlayPressed() {\r\n        if(this._canvas) {\r\n            this._canvas.requestPointerLock();\r\n            this.hide();\r\n        }\r\n    }\r\n\r\n    private onOptionsPressed() {\r\n        this._optionMenuUI.show();\r\n        this.hide();\r\n    }\r\n\r\n    private onQuitPressed() {\r\n        console.log(\"Quitter !\");\r\n    }\r\n\r\n    private showHowToPlay(): void {\r\n        this.hide();\r\n        this._howToPlay.controlNode.isVisible = true;\r\n        UIManager.instance.ui.addControl(this._howToPlay.controlNode);\r\n    }\r\n\r\n    private hideHowToPlay(): void {\r\n        this._howToPlay.controlNode.isVisible = false;\r\n        UIManager.instance.ui.removeControl(this._howToPlay.controlNode);\r\n    }\r\n}","import {UI} from \"@/YellowSubmarine/ui system/UI\";\r\nimport {Container, Control, Rectangle, TextBlock} from \"@babylonjs/gui\";\r\nimport {KeyZone} from \"@/YellowSubmarine/keyzone system/KeyZone\";\r\nimport {Conversation} from \"@/YellowSubmarine/dialogue system/Conversation\";\r\nimport {UIManager} from \"@/YellowSubmarine/ui system/UIManager\";\r\nimport {InteractionManager} from \"@/YellowSubmarine/interaction system/InteractionManager\";\r\nimport {\r\n    StartConversationInteraction\r\n} from \"@/YellowSubmarine/dialogue system/interactions/StartConversationInteraction\";\r\nimport {WorldInteraction} from \"@/YellowSubmarine/interaction system/interactions/WorldInteraction\";\r\nimport {NextDialogueInteraction} from \"@/YellowSubmarine/dialogue system/interactions/NextDialogueInteraction\";\r\nimport {DialogueInteraction} from \"@/YellowSubmarine/dialogue system/interactions/DialogueInteraction\";\r\n\r\nexport class ShowConversationProviderUI extends UI{\r\n\r\n    private _container: Container;\r\n    private _childControls: Control[] = [];\r\n\r\n    public constructor(){\r\n        super();\r\n        this._container = new Container();\r\n        this._container.isVisible = true;\r\n        KeyZone.onAnyKeyZoneEntered.add(this.createUIs.bind(this));\r\n        KeyZone.onAnyKeyZoneExited.add(this.destroyUIs.bind(this));\r\n        Conversation.onAnyConversationStart.add(this.hideUIs.bind(this));\r\n        Conversation.onAnyConversationEnd.add(this.showUIs.bind(this));\r\n        InteractionManager.instance.onInteractionAvailable.add( (interaction) => {\r\n            if(interaction instanceof StartConversationInteraction || interaction instanceof DialogueInteraction ){\r\n                this.hideUIs();\r\n            }\r\n        });\r\n        InteractionManager.instance.onInteractionUnavailable.add( (interaction) => {\r\n            if(interaction instanceof StartConversationInteraction || interaction instanceof DialogueInteraction ){\r\n                this.showUIs();\r\n            }\r\n        });\r\n    }\r\n\r\n    public get controlNode(): Control {\r\n        return this._container;\r\n    }\r\n\r\n    private createUIs(keyzone: KeyZone) {\r\n        const conversationProviders = keyzone.conversationProviders;\r\n        for (let i = 0; i < conversationProviders.length; i++) {\r\n            const conversationProvider = conversationProviders[i];\r\n\r\n            console.log(conversationProvider);\r\n\r\n            const rec1 = new Rectangle();\r\n            rec1.width = \"180px\";\r\n            rec1.height = \"60px\";\r\n            rec1.cornerRadius = 60;\r\n            rec1.color = \"rgb(168, 98, 68)\";\r\n            rec1.thickness = 4;\r\n            rec1.background = \"rgb(255, 199, 130)\";\r\n\r\n            const label1 = new TextBlock();\r\n            label1.fontSize = 30;\r\n            label1.text = `● ● ●`;\r\n            rec1.addControl(label1);\r\n\r\n            UIManager.instance.ui.addControl(rec1);\r\n            this._childControls.push(rec1);\r\n\r\n            const mesh = conversationProvider.mesh;\r\n            if(mesh){\r\n                rec1.linkWithMesh(mesh);\r\n                rec1.linkOffsetY = \"-50px\";\r\n            }\r\n\r\n        }\r\n\r\n    }\r\n\r\n    private destroyUIs(){\r\n        this._childControls.forEach((child) => child.dispose());\r\n        this._childControls = [];\r\n    }\r\n\r\n    private showUIs(){\r\n        this._childControls.forEach((child) => child.isVisible = true );\r\n    }\r\n\r\n    private hideUIs(){\r\n        this._childControls.forEach((child) => child.isVisible = false );\r\n    }\r\n\r\n}","import {AdvancedDynamicTexture} from \"@babylonjs/gui\";\r\nimport {Game} from \"@/YellowSubmarine/Game\";\r\nimport {DialogueInteractionUI} from \"@/YellowSubmarine/dialogue system/ui/DialogueInteractionUI\";\r\nimport {WorldInteractionUI} from \"@/YellowSubmarine/interaction system/ui/WorldInteractionUI\";\r\nimport {ShowKeyZoneNameUI} from \"@/YellowSubmarine/keyzone system/ui/ShowKeyZoneNameUI\";\r\nimport {MainMenuUI} from \"@/YellowSubmarine/ui system/MainMenuUI\";\r\nimport {OptionsMenuUI} from \"@/YellowSubmarine/ui system/OptionsMenuUI\";\r\nimport {QuestUI} from \"@/YellowSubmarine/quest system/ui/QuestUI\";\r\nimport {JournalUI} from \"@/YellowSubmarine/quest system/ui/JournalUI\";\r\nimport {ShowConversationProviderUI} from \"@/YellowSubmarine/keyzone system/ui/ShowConversationProviderUI\";\r\nimport {SlideAnimationUI} from \"@/YellowSubmarine/ui system/SlideAnimationUI\";\r\nimport {UI} from \"@/YellowSubmarine/ui system/UI\";\r\nimport {ImageUI} from \"@/YellowSubmarine/ui system/ImageUI\";\r\n\r\n\r\nexport class UIManager {\r\n\r\n    private _ui = AdvancedDynamicTexture.CreateFullscreenUI(\"_ui\", undefined, Game.scene);\r\n\r\n    private _worldInteractionUI: WorldInteractionUI = new WorldInteractionUI();\r\n    private _dialogueInteractionUI: DialogueInteractionUI = new DialogueInteractionUI();\r\n    private _showConversationProviderUI: ShowConversationProviderUI = new ShowConversationProviderUI();\r\n    private _islandsUI: ShowKeyZoneNameUI = new ShowKeyZoneNameUI();\r\n    private _mainMenuUI: MainMenuUI;\r\n    private _optionsMenuUI;\r\n    private _questUI: QuestUI = new QuestUI();\r\n    private _journalUI: JournalUI = new JournalUI();\r\n    private _slideAnimationUI: SlideAnimationUI;\r\n\r\n    private static _instance: UIManager;\r\n\r\n    public static get instance(): UIManager {\r\n        return this._instance;\r\n    }\r\n\r\n    constructor(private _canvas: HTMLCanvasElement) {\r\n        UIManager._instance = this;\r\n        this._ui.addControl(this._worldInteractionUI.controlNode);\r\n        this._ui.addControl(this._showConversationProviderUI.controlNode);\r\n        this._ui.addControl(this._dialogueInteractionUI.controlNode);\r\n        this._ui.addControl(this._islandsUI.controlNode);\r\n        this._mainMenuUI = new MainMenuUI();\r\n        this._optionsMenuUI = this._mainMenuUI.optionsMenuUI;\r\n        this._ui.addControl(this._optionsMenuUI.controlNode);\r\n        this._ui.addControl(this._mainMenuUI.controlNode);\r\n        this._mainMenuUI.canvas = _canvas;\r\n        this._ui.addControl(this._questUI.controlNode);\r\n        this._ui.addControl(this._journalUI.controlNode);\r\n        this._slideAnimationUI = new SlideAnimationUI();\r\n    }\r\n\r\n    public get ui(): AdvancedDynamicTexture {\r\n        return this._ui;\r\n    }\r\n\r\n    public showMainMenu(): void {\r\n        if(this._mainMenuUI)\r\n            this._mainMenuUI.show();\r\n    }\r\n}","import {Control, Rectangle, TextBlock} from \"@babylonjs/gui\";\r\nimport {Game} from \"@/YellowSubmarine/Game\";\r\nimport {UIManager} from \"@/YellowSubmarine/ui system/UIManager\";\r\nimport {ImageUI} from \"@/YellowSubmarine/ui system/ImageUI\";\r\nimport {KeyboardEventTypes} from \"@babylonjs/core\";\r\nimport {SoundManager} from \"@/YellowSubmarine/sound system/SoundManager\";\r\n\r\nexport class SlideAnimationUI {\r\n    private ui = UIManager.instance.ui;\r\n    private _slides!: ImageUI[];\r\n    private currentIndex = 0;\r\n\r\n    private slidePanel: Rectangle;\r\n    private spaceLabel: TextBlock;\r\n    private static _instance: SlideAnimationUI;\r\n\r\n    public static get instance(): SlideAnimationUI {\r\n        return this._instance;\r\n    }\r\n\r\n    constructor() {\r\n        SlideAnimationUI._instance = this;\r\n        this.setSlides();\r\n\r\n        this.slidePanel = new Rectangle(\"slidePanel\");\r\n        this.slidePanel.width = \"100%\";\r\n        this.slidePanel.height = \"100%\";\r\n        this.slidePanel.isVisible = true;\r\n        this.slidePanel.alpha = 0;\r\n        this.ui.addControl(this.slidePanel);\r\n\r\n        this.spaceLabel = new TextBlock();\r\n        this.spaceLabel.text = \"Space\";\r\n        this.spaceLabel.color = \"black\";\r\n        this.spaceLabel.fontSize = 32;\r\n        this.spaceLabel.textHorizontalAlignment = TextBlock.HORIZONTAL_ALIGNMENT_RIGHT;\r\n        this.spaceLabel.textVerticalAlignment = TextBlock.VERTICAL_ALIGNMENT_BOTTOM;\r\n        this.spaceLabel.paddingRight = \"40px\";\r\n        this.spaceLabel.paddingBottom = \"20px\";\r\n        this.spaceLabel.zIndex = 1;\r\n\r\n        this.animateBlinkingText(this.spaceLabel, 2000);\r\n\r\n        this.slidePanel.addControl(this.spaceLabel);\r\n    }\r\n\r\n    private animateBlinkingText(textControl: TextBlock, duration= 1000) {\r\n        let startTime: number | null = null;\r\n\r\n        const animate = (timestamp: number) => {\r\n            if (!startTime) startTime = timestamp;\r\n            const elapsed = timestamp - startTime;\r\n\r\n            const progress = (elapsed % duration) / duration;\r\n\r\n            textControl.alpha = 0.65 + 0.35 * Math.sin(progress * 2 * Math.PI);\r\n\r\n            requestAnimationFrame(animate);\r\n        };\r\n\r\n        requestAnimationFrame(animate);\r\n    }\r\n\r\n\r\n    public async startSlideshow(): Promise<void> {\r\n        if (this._slides.length === 0) return;\r\n\r\n        this.currentIndex = 0;\r\n\r\n        await this.fadeInPanel(500);\r\n\r\n        this.showSlide(this.currentIndex);\r\n\r\n        const onKeyDown = async (evt: KeyboardEvent) => {\r\n            if (evt.code === \"Space\") {\r\n                this.currentIndex++;\r\n                if (this.currentIndex < this._slides.length) {\r\n                    this.showSlide(this.currentIndex);\r\n                }\r\n            }\r\n        };\r\n\r\n        window.addEventListener(\"keydown\", onKeyDown);\r\n    }\r\n\r\n\r\n    private showSlide(index: number) {\r\n        if(index != 0) this._slides[index-1].fadeOut(500);\r\n        const slide = this._slides[index];\r\n        this.slidePanel.addControl(slide.controlNode);\r\n        this._slides[index].fadeIn(500);\r\n        switch(index) {\r\n            case 0:\r\n                SoundManager.instance.playSFX(\"snoring\", {autoplay: true, loop: true});\r\n                break;\r\n            case 1:\r\n                SoundManager.instance.stopSFX(\"snoring\");\r\n                SoundManager.instance.playSFX(\"earthquake\", {autoplay: true, loop: true});\r\n                break;\r\n            case 3:\r\n                SoundManager.instance.stopSFX(\"earthquake\");\r\n                SoundManager.instance.playSFX(\"whale\", {autoplay: true, loop: false});\r\n                break;\r\n            case 4:\r\n                SoundManager.instance.playSFX(\"plock\");\r\n                break;\r\n            case 5:\r\n                SoundManager.instance.playSFX(\"stars\", {autoplay: true, loop: false});\r\n                SoundManager.instance.playSFX(\"snoring\", {autoplay: true, loop: false});\r\n                break;\r\n            case 6:\r\n                SoundManager.instance.stopSFX(\"snoring\");\r\n\r\n        }\r\n    }\r\n\r\n    private fadeInPanel(duration: number): Promise<void> {\r\n        return new Promise((resolve) => {\r\n            this.slidePanel.alpha = 0;\r\n\r\n            const scene = Game.scene;\r\n            const startTime = performance.now();\r\n\r\n            const observer = scene.onBeforeRenderObservable.add(() => {\r\n                const elapsed = performance.now() - startTime;\r\n                const progress = Math.min(elapsed / duration, 1);\r\n                this.slidePanel.alpha = progress;\r\n\r\n                if (progress >= 1) {\r\n                    scene.onBeforeRenderObservable.remove(observer);\r\n                    resolve();\r\n                }\r\n            });\r\n        });\r\n    }\r\n\r\n    public setSlides() {\r\n        this._slides = [\r\n            new ImageUI(\"ui/slides/slide1.png\"),\r\n            new ImageUI(\"ui/slides/slide2.png\"),\r\n            new ImageUI(\"ui/slides/slide3.png\"),\r\n            new ImageUI(\"ui/slides/slide4.png\"),\r\n            new ImageUI(\"ui/slides/slide5.png\"),\r\n            new ImageUI(\"ui/slides/slide6.png\"),\r\n            new ImageUI(\"ui/slides/slide7.png\"),\r\n        ];\r\n    }\r\n}\r\n","import {Angle, Color3, Observable, TransformNode, Vector3} from \"@babylonjs/core\";\r\nimport {Socle} from \"@/YellowSubmarine/temple/Socle\";\r\nimport {TempleBall} from \"@/YellowSubmarine/temple/TempleBall\";\r\nimport {CameraConfiguration} from \"@/YellowSubmarine/camera system/CameraConfiguration\";\r\nimport {MeshDetectionZone} from \"@/YellowSubmarine/detection system/MeshDetectionZone\";\r\nimport {SphericalDetectionZone} from \"@/YellowSubmarine/detection system/SphericalDetectionZone\";\r\nimport {ConfigurableCamera} from \"@/YellowSubmarine/camera system/ConfigurableCamera\";\r\nimport {Submarine} from \"@/YellowSubmarine/Submarine\";\r\nimport {Player} from \"@/YellowSubmarine/Player\";\r\nimport {SlideAnimationUI} from \"@/YellowSubmarine/ui system/SlideAnimationUI\";\r\n\r\nexport class TemplePuzzle {\r\n    private _upperRightSocle: Socle;\r\n    private _middleRightSocle: Socle;\r\n    private _lowerRightSocle: Socle;\r\n    private _lowerMiddleSocle: Socle;\r\n    private _lowerLeftSocle: Socle;\r\n    private _middleLeftSocle: Socle;\r\n    private _upperLeftSocle: Socle;\r\n    private _upperMiddleSocle: Socle;\r\n    private _centerSocle: Socle;\r\n\r\n    public static get instance(): TemplePuzzle{\r\n        return this._instance;\r\n    }\r\n\r\n    public get transformNode(): TransformNode {\r\n        return this._transformNode;\r\n    }\r\n\r\n    public static onPuzzleResolved = new Observable<void>();\r\n    public static onPuzzleRejected = new Observable<void>();\r\n\r\n    private static _instance: TemplePuzzle;\r\n\r\n    private static _ball: TempleBall[] = new Array<TempleBall>();\r\n\r\n    public static registerBall(ball: TempleBall): void {\r\n        this._ball.push(ball);\r\n        ball.onPlacedOnSocle.add(() => {\r\n            this._instance.onBallPlacedOnSocle();\r\n        });\r\n    }\r\n\r\n    private _transformNode: TransformNode = new TransformNode(\"templePuzzle\");\r\n    private _cameraConfiguration: CameraConfiguration;\r\n    private _detectionZone: MeshDetectionZone;\r\n\r\n    public constructor(parent: TransformNode, position: Vector3) {\r\n        TemplePuzzle._instance = this;\r\n        this._transformNode.parent = parent;\r\n        this._transformNode.rotation = Vector3.Zero();\r\n        this._transformNode.position = position;\r\n        this._detectionZone = new SphericalDetectionZone({\r\n            diameter: 70,\r\n        }, false);\r\n        this._detectionZone.zone.parent = this._transformNode;\r\n        this._cameraConfiguration = new CameraConfiguration();\r\n        this._cameraConfiguration.target = this._transformNode;\r\n        this._cameraConfiguration.wantedBeta = Angle.FromDegrees(0).radians();\r\n        this._cameraConfiguration.wantedAlpha = Angle.FromDegrees(-90).radians();\r\n        this._cameraConfiguration.distanceFromTarget = 100;\r\n        this._detectionZone.onMeshEnter.add(() => {\r\n            ConfigurableCamera.instance.cameraConfiguration = this._cameraConfiguration;\r\n        });\r\n        this._detectionZone.onMeshExit.add(() => {\r\n            ConfigurableCamera.instance.cameraConfiguration = Player.playerCameraConfiguration;\r\n        })\r\n        Submarine.instance.meshCreationPromise.then((mesh) => {\r\n            this._detectionZone.addMeshToDetect(mesh);\r\n        })\r\n        this._upperRightSocle = this.createSocle(new Vector3(-1,0,-1).scale(20));\r\n        this._middleRightSocle = this.createSocle(new Vector3(-1,0,0).scale(20), Color3.Purple());\r\n        this._lowerRightSocle = this.createSocle(new Vector3(-1,0,1).scale(20), Color3.Blue());\r\n        this._lowerMiddleSocle = this.createSocle(new Vector3(0,0,1).scale(20), Color3.Green());\r\n        this._lowerLeftSocle = this.createSocle(new Vector3(1,0,1).scale(20), Color3.Red());\r\n        this._middleLeftSocle = this.createSocle(new Vector3(1,0,0).scale(20));\r\n        this._upperLeftSocle = this.createSocle(new Vector3(1,0,-1).scale(20), Color3.Gray());\r\n        this._upperMiddleSocle = this.createSocle(new Vector3(0,0,-1).scale(20), Color3.Yellow());\r\n        this._centerSocle = this.createSocle(Vector3.Zero());\r\n\r\n\r\n        this._lowerLeftSocle.meshImportedPromise.then(() => {\r\n            const yellowBall = new TempleBall(this._lowerLeftSocle.transformNode.absolutePosition.add(Vector3.Forward().scale(-10)).add(Vector3.Up().scale(50)), Color3.Yellow());\r\n        });\r\n        this._lowerRightSocle.meshImportedPromise.then(() => {\r\n            const grayBall = new TempleBall(this._lowerRightSocle.transformNode.absolutePosition.add(Vector3.Forward().scale(-10)).add(Vector3.Up().scale(50)), Color3.Gray());\r\n        })\r\n\r\n    }\r\n\r\n    private createSocle(position: Vector3, validColor?: Color3){\r\n        const socle = new Socle(this._transformNode, position);\r\n        socle.validColor = validColor;\r\n        return socle;\r\n    }\r\n\r\n    private onBallPlacedOnSocle(){\r\n        if(this.isAllBallPlacedOnASocle()){\r\n            if(this.checkConfiguration()){\r\n                TemplePuzzle.onPuzzleResolved.notifyObservers();\r\n                SlideAnimationUI.instance.startSlideshow();\r\n            }\r\n            else{\r\n                TemplePuzzle.onPuzzleRejected.notifyObservers();\r\n            }\r\n\r\n        }\r\n    }\r\n\r\n    private isAllBallPlacedOnASocle(){\r\n        let numberOfPlaced = 0;\r\n        TemplePuzzle._ball.forEach( (ball) => {\r\n            if(ball.socle){\r\n                numberOfPlaced++;\r\n            }\r\n        });\r\n        return numberOfPlaced == 6;\r\n    }\r\n\r\n    private checkConfiguration() {\r\n        for(let i = 0; i < TemplePuzzle._ball.length; i++) {\r\n            const ball = TemplePuzzle._ball[i];\r\n            const socle = ball.socle;\r\n            if (socle) {\r\n                const socleValidColor = socle.validColor;\r\n                if (socleValidColor === undefined || !ball.color.equals(socleValidColor) ) {\r\n                    return false;\r\n                }\r\n            } else {\r\n                console.log(\"Some ball are not placed\");\r\n                return false;\r\n            }\r\n        }\r\n        return true;\r\n    }\r\n\r\n}","import {Quest} from \"@/YellowSubmarine/quest system/Quest\";\r\nimport {QuestStep} from \"@/YellowSubmarine/quest system/QuestStep\";\r\nimport {TemplePuzzle} from \"@/YellowSubmarine/temple/TemplePuzzle\";\r\n\r\nexport class QuestFactory {\r\n\r\n    public static createAll(){\r\n        const quests: Quest[] = [];\r\n        quests.push(QuestFactory.createTalkToPedro());\r\n        quests.push(QuestFactory.createTempleQuest());\r\n        return quests;\r\n    }\r\n\r\n    private static createTalkToPedro(): Quest{\r\n        const quest = new Quest(\"dreamland\", \"Le monde des rêves\", \"active\", 0);\r\n        const steps: QuestStep[] = [];\r\n        steps.push(new QuestStep(\"Parlez à l'habitant de l'ile du Dophin\"));\r\n        steps.push(new QuestStep(\"Ouvrir le journal en appuyant sur la touche J\"));\r\n        steps.push(new QuestStep(\"Aller voir le temple\"));\r\n        steps.push(new QuestStep(\"Parler aux différents habitants de chaque île\"));\r\n        quest.steps = steps;\r\n        TemplePuzzle.onPuzzleResolved.add(() => {\r\n            quest.stopQuest();\r\n        });\r\n        return quest;\r\n    }\r\n\r\n    private static createTempleQuest(): Quest{\r\n        const quest = new Quest(\"temple_quest\", \"Le Temple\", \"inactive\", 0);\r\n        const steps: QuestStep[] = [];\r\n        steps.push(new QuestStep(\"A l'aide du journal, \\n Résoudre l'énigme du temple\"));\r\n        quest.steps = steps;\r\n        TemplePuzzle.onPuzzleResolved.add(() => {\r\n            quest.state = \"completed\";\r\n        });\r\n        return quest;\r\n    }\r\n}","import {Quest} from \"@/YellowSubmarine/quest system/Quest\";\r\nimport {Game} from \"@/YellowSubmarine/Game\";\r\nimport {QuestFactory} from \"@/YellowSubmarine/quest system/QuestFactory\";\r\n\r\nexport class QuestManager {\r\n\r\n    private quests: Quest[] = [];\r\n\r\n    private static _instance: QuestManager;\r\n\r\n    public static get instance(): QuestManager {\r\n        return this._instance;\r\n    }\r\n\r\n    constructor() {\r\n        this.quests = QuestFactory.createAll();\r\n        QuestManager._instance = this;\r\n        Game.scene.onBeforeRenderObservable.add(() => {\r\n            this.quests.forEach(quest => {\r\n                if(quest.steps[quest.currentStepIndex].condition && quest.state === \"active\") {\r\n                    quest.nextStep();\r\n                }\r\n            })\r\n        });\r\n        this.getQuest(\"dreamland\")?.startQuest();\r\n    }\r\n\r\n    public getQuest(id: string): Quest | undefined {\r\n        return this.quests.find(quest => quest.id === id);\r\n    }\r\n\r\n    public getAllActiveQuests(): Quest[] {\r\n        const quests: Quest[] = [];\r\n        this.quests.forEach(quest => {\r\n            if(quest.state === \"active\") {\r\n                quests.push(quest);\r\n            }\r\n        });\r\n        return quests;\r\n    }\r\n}","import { UI } from \"@/YellowSubmarine/ui system/UI\";\r\nimport { Control, StackPanel, TextBlock, Rectangle } from \"@babylonjs/gui\";\r\nimport { Quest } from \"@/YellowSubmarine/quest system/Quest\";\r\nimport { Game } from \"@/YellowSubmarine/Game\";\r\nimport { QuestManager } from \"@/YellowSubmarine/quest system/QuestManager\";\r\nimport { KeyboardEventTypes } from \"@babylonjs/core\";\r\nimport { SoundManager } from \"@/YellowSubmarine/sound system/SoundManager\";\r\n\r\nexport class JournalUI extends UI {\r\n    private _panel: StackPanel;\r\n    private _container: StackPanel;\r\n    private _journalEntry: Map<Quest, Array<string>> = new Map();\r\n    private static _instance: JournalUI;\r\n    private hasBeenOpened = false;\r\n\r\n    public static get instance(): JournalUI {\r\n        return this._instance;\r\n    }\r\n\r\n    get controlNode(): Control {\r\n        return this._panel;\r\n    }\r\n\r\n    constructor() {\r\n        super();\r\n\r\n        this._panel = new StackPanel();\r\n        this._panel.width = \"60%\";\r\n        this._panel.height = \"90%\";\r\n        this._panel.horizontalAlignment = Control.HORIZONTAL_ALIGNMENT_CENTER;\r\n        this._panel.verticalAlignment = Control.VERTICAL_ALIGNMENT_CENTER;\r\n        this._panel.isVisible = false;\r\n\r\n        const containerBg = new Rectangle();\r\n        containerBg.background = \"rgba(0, 0, 0, 0.6)\";\r\n        containerBg.thickness = 0;\r\n        containerBg.cornerRadius = 10;\r\n        containerBg.height = \"100%\";\r\n        containerBg.width = \"100%\";\r\n        containerBg.verticalAlignment = Control.VERTICAL_ALIGNMENT_TOP;\r\n\r\n        this._container = new StackPanel();\r\n        this._container.isVertical = true;\r\n        this._container.width = \"100%\";\r\n        this._container.spacing = 20;\r\n        this._container.verticalAlignment = Control.VERTICAL_ALIGNMENT_TOP;\r\n\r\n        containerBg.addControl(this._container);\r\n        this._panel.addControl(containerBg);\r\n\r\n        Game.scene.onKeyboardObservable.add((eventData) => {\r\n            const state = eventData.type === KeyboardEventTypes.KEYDOWN;\r\n            if (eventData.event.key === \"j\" && state) {\r\n                this._panel.isVisible ? this.hide() : this.show();\r\n            }\r\n        });\r\n\r\n        JournalUI._instance = this;\r\n    }\r\n\r\n    private refresh() {\r\n        if (!QuestManager.instance) return;\r\n\r\n        this._container.clearControls();\r\n\r\n        this._journalEntry.forEach((lines, quest) => {\r\n            const questBlock = new StackPanel();\r\n            questBlock.isVertical = true;\r\n            questBlock.width = \"80%\";\r\n            questBlock.paddingTop = \"10px\";\r\n            questBlock.paddingBottom = \"10px\";\r\n            questBlock.horizontalAlignment = Control.HORIZONTAL_ALIGNMENT_CENTER;\r\n\r\n            const titleText = new TextBlock();\r\n            titleText.text = `⛋ ${quest.name}`;\r\n            titleText.color = \"white\";\r\n            titleText.fontSize = 20;\r\n            titleText.fontWeight = \"bold\";\r\n            titleText.resizeToFit = true;\r\n            titleText.textHorizontalAlignment = Control.HORIZONTAL_ALIGNMENT_LEFT;\r\n\r\n            questBlock.addControl(titleText);\r\n\r\n            lines.forEach((line) => {\r\n                const entryText = new TextBlock();\r\n                entryText.text = `▣ ${line}`;\r\n                entryText.color = \"#FFFFFF\";\r\n                entryText.fontSize = 17;\r\n                entryText.textWrapping = true;\r\n                entryText.resizeToFit = true;\r\n                entryText.textHorizontalAlignment = Control.HORIZONTAL_ALIGNMENT_LEFT;\r\n\r\n                questBlock.addControl(entryText);\r\n            });\r\n\r\n            questBlock.addControl(this.createSeparator());\r\n            this._container.addControl(questBlock);\r\n        });\r\n    }\r\n\r\n    private createSeparator(): Rectangle {\r\n        const separator = new Rectangle();\r\n        separator.height = \"2px\";\r\n        separator.width = \"100%\";\r\n        separator.background = \"#888888\";\r\n        separator.thickness = 0;\r\n        separator.paddingTop = \"6px\";\r\n        return separator;\r\n    }\r\n\r\n    public show() {\r\n        this.refresh();\r\n        this._panel.isVisible = true;\r\n        if (!this.hasBeenOpened) {\r\n            QuestManager.instance.getQuest(\"dreamland\")?.updateCurrentStepStatus();\r\n        }\r\n        if (SoundManager.instance) {\r\n            SoundManager.instance.stopSFX(\"click\");\r\n            SoundManager.instance.playSFX(\"click\", { autoplay: true });\r\n        }\r\n        this.hasBeenOpened = true;\r\n    }\r\n\r\n    public hide() {\r\n        this._panel.isVisible = false;\r\n        if (SoundManager.instance) {\r\n            SoundManager.instance.stopSFX(\"click\");\r\n            SoundManager.instance.playSFX(\"click\", { autoplay: true });\r\n        }\r\n    }\r\n\r\n    public addEntryToQuest(quest: Quest | undefined, entry: string) {\r\n        if (!quest) return;\r\n\r\n        if (!this._journalEntry.has(quest)) {\r\n            this._journalEntry.set(quest, []);\r\n        }\r\n\r\n        const entries = this._journalEntry.get(quest)!;\r\n        if (!entries.includes(entry)) {\r\n            entries.push(entry);\r\n        }\r\n\r\n        this.refresh();\r\n    }\r\n}\r\n","import {NPC} from \"@/YellowSubmarine/npcs/NPC\";\r\nimport {Utils} from \"@/YellowSubmarine/Utils\";\r\nimport {CylindricalDetectionZone} from \"@/YellowSubmarine/detection system/CylindricalDetectionZone\";\r\nimport {CameraConfiguration} from \"@/YellowSubmarine/camera system/CameraConfiguration\";\r\nimport {Angle, PBRMaterial, Vector3} from \"@babylonjs/core\";\r\nimport {CartoonShaderMaterial} from \"@/YellowSubmarine/shader material/CartoonShaderMaterial\";\r\nimport {SoundManager} from \"@/YellowSubmarine/sound system/SoundManager\";\r\nimport {ConversationBuilder} from \"@/YellowSubmarine/dialogue system/ConversationBuilder\";\r\nimport {JournalUI} from \"@/YellowSubmarine/quest system/ui/JournalUI\";\r\nimport {QuestManager} from \"@/YellowSubmarine/quest system/QuestManager\";\r\n\r\nexport class NPCFactory {\r\n\r\n    public static async createPedro(): Promise<NPC>{\r\n        const pedro = new NPC();\r\n        pedro.name = \"Pedro\";\r\n        Utils.loadMesh(\"models/characters/pedro.glb\").then((result) => {\r\n            pedro.mesh = result.meshes[0];\r\n            result.meshes.forEach((mesh) => {\r\n                const mat = mesh.material as PBRMaterial;\r\n                if(mat){\r\n                    const toonMat = new CartoonShaderMaterial();\r\n                    toonMat.assignMaterial(mesh).then(() => {\r\n                        toonMat.configureFromPBRMaterial(mat);\r\n                    });\r\n                }\r\n            })\r\n        });\r\n        pedro.detectionZone = new CylindricalDetectionZone( {\r\n            height: 8,\r\n            diameterTop: 100,\r\n            diameterBottom: 100,\r\n        }, true);\r\n\r\n        pedro.detectionZone.zone.position.set(0, -11, 0);\r\n\r\n        pedro.conversation = new ConversationBuilder()\r\n            .say(\"[g]OH CA VA PAS DE ME REVEILLER COMME CA ! MAIS QUI ES TU !! [/g]\")\r\n            .then(\"Ca fais bien longtemps que j'ai pas vu quelqu'un comme toi ici ! Je me présente, je suis Pedro. Je pêche ici depuis bel lurette mon n'veu.\")\r\n            .then(\"Ici, eh beh ici je sais pas trop comment te le décrire. C'est assez [i]vide[/i] et ça mord pas trop au bout de ma canne... \")\r\n            .then(\"Mais ! Y'a un [c=blue]p'tit endroit au nord d'ici [/c] un peu particulier.\")\r\n            .then(\"[c=blue] Y'avait deux boules et plein de poteaux [/c], j'ai pas tout compris et j'étais fatigué Ducoup j'suis parti..\")\r\n            .then(\"Normalement tu devrais l'apercevoir d'ici ! Fais attention ! \")\r\n            .then(\"Aussi ! [g]Information capital !!! [/g] Si tu as un journal dans ton sous-marin [g]tu peux prendre des notes[/g] sur tout ce que tu vas découvrir pour ne pas oublier d'information\")\r\n            .then(\"Hésite pas à aller voir [g][c=blue]les habitants des autres îles[/c][/g], ils devraient pouvoir t'aider !\")\r\n            .then(\"Bon aller moi je retourne pêcher (et dormir au passage... ça fais bieeeen ..... loongt................zzZZZzzzzzZZzzzzzzzz)\")\r\n            .setOnEnding(() => {\r\n                JournalUI.instance.addEntryToQuest(QuestManager.instance.getQuest(\"dreamland\"), \"Pedro s'est endormie\");\r\n                JournalUI.instance.addEntryToQuest(QuestManager.instance.getQuest(\"dreamland\"), \"Il y aurait un endroit interessant au nord de l'ile des dauphins\");\r\n                JournalUI.instance.addEntryToQuest(QuestManager.instance.getQuest(\"dreamland\"), \"Deux boules ? seraient déjà présentes\");\r\n                JournalUI.instance.addEntryToQuest(QuestManager.instance.getQuest(\"dreamland\"), \"Vu le manque de place, je vais pouvoir en prendre qu'une seule à la fois..\");\r\n\r\n                QuestManager.instance.getQuest(\"dreamland\")?.updateCurrentStepStatus();\r\n            })\r\n            .build();\r\n\r\n        pedro.cameraConfiguration = new CameraConfiguration();\r\n        pedro.cameraConfiguration.target = pedro.transformNode;\r\n        pedro.cameraConfiguration.distanceFromTarget = 10;\r\n        pedro.cameraConfiguration.offset = Vector3.Up().scale(2);\r\n        pedro.cameraConfiguration.wantedAlpha = Angle.FromDegrees(-90).radians();\r\n\r\n        return pedro;\r\n    }\r\n\r\n    public static async createFox(): Promise<NPC>{\r\n        const fox = new NPC();\r\n        fox.name = \"Crimson\";\r\n        Utils.loadMesh(\"models/characters/fox.glb\").then((result) => {\r\n            fox.mesh = result.meshes[0];\r\n            result.meshes.forEach((mesh) => {\r\n                const mat = mesh.material as PBRMaterial;\r\n                if(mat){\r\n                    const toonMat = new CartoonShaderMaterial();\r\n                    toonMat.assignMaterial(mesh).then(() => {\r\n                        toonMat.configureFromPBRMaterial(mat);\r\n                    });\r\n                }\r\n            })\r\n        });\r\n        fox.detectionZone = new CylindricalDetectionZone( {\r\n            height: 8,\r\n            diameterTop: 45,\r\n            diameterBottom: 45,\r\n        }, true);\r\n\r\n        fox.conversation = new ConversationBuilder()\r\n            .say(\"Je sais pas si tu vois la même chose que moi [i](peut-être que c'est un mirage).[/i] Y'a une [g]piste de bowling là-bas[/g] où y'a les quilles qui sortent de l'eau.\")\r\n            .then(\"Y'a une sorte de boule de bowling qui était sur l'île. J'ai essayé de jouer avec des quilles en glace mais ça a pas trop marché.\")\r\n            .then(\"Parmi les quilles j'ai mis une bouteille que j'ai trouvée dans le coin et bizarrement, quand j'ai fait un STRIKE ! Y'a une note qui est sortie.\")\r\n            .then(\"Y'avait marqué ça : [c=blue]« Redina, la plus forte, restait en retrait afin de couvrir leurs arrières »[/c]\")\r\n            .then(\"Bizarre l'ambiance... J'en ai marre de jouer au bowling donc [g]j'te donne la boule[/g] ! Mais prends-en soin !\")\r\n            .then(\"Allez, je vais jouer à la pétanque moi...\")\r\n            .setOnEnding(() => {\r\n                JournalUI.instance.addEntryToQuest(QuestManager.instance.getQuest(\"dreamland\"), \"D'après Crimson : Redina, la plus forte, restait en retrait afin de couvrir leurs arrières\");\r\n            })\r\n            .build();\r\n\r\n        fox.cameraConfiguration = new CameraConfiguration();\r\n        fox.cameraConfiguration.target = fox.transformNode;\r\n        fox.cameraConfiguration.distanceFromTarget = 10;\r\n        fox.cameraConfiguration.wantedAlpha = Angle.FromDegrees(-90).radians();\r\n\r\n        return fox;\r\n    }\r\n\r\n    public static async createGirl(): Promise<NPC>{\r\n        const scientific = new NPC();\r\n        scientific.name = \"Rosa\";\r\n        Utils.loadMesh(\"models/characters/phare_girl.glb\").then((result) => {\r\n            scientific.mesh = result.meshes[0];\r\n            result.meshes.forEach((mesh) => {\r\n                const mat = mesh.material as PBRMaterial;\r\n                if(mat){\r\n                    const toonMat = new CartoonShaderMaterial();\r\n                    toonMat.assignMaterial(mesh).then(() => {\r\n                        toonMat.configureFromPBRMaterial(mat);\r\n                    });\r\n                }\r\n            })\r\n        });\r\n        scientific.detectionZone = new CylindricalDetectionZone( {\r\n            height: 8,\r\n            diameterTop: 45,\r\n            diameterBottom: 45,\r\n        }, true);\r\n\r\n\r\n        scientific.conversation = new ConversationBuilder()\r\n            .say(\"Si je suis la trajectoire de cette étoile, alors je peux peut-être réussir à démontrer que e = m6 !\")\r\n            .then(\"Oh salut toi ! T'as un sacré sous-marin ! [i]J'adore[/i] les sous-marins tu tombes à pic !\")\r\n            .then(\"Pour la peine, je vais te présenter les conclusions de mon expérience, prépare toi à en prendre plein la vue !\")\r\n            .then(\"J'ai trouvé [c=blue]une boule de couleurs avec deux parchemins[/c]. Commençons par les FAITS !\")\r\n            .then(\"Fait numéro 1 : la boule est [g]d'une couleur spécifique[/g]... Hmmmm...... Ok soit.\")\r\n            .then(\"Fait numéro 2 : les textes parlent de...je ne sais pas trop quoi à vrai dire. Mais ! J'ai l'impression que [g]les couleurs sont importantes ![/g]\")\r\n            .then(\"Fait numéro 3 : les deux parchemins racontes la chose suivante : \\n\" +\r\n                \" [c=blue] - Greina, la plus sage, veillait sur ses soeurs sans faillire à sa tâche[/c] \\n\" +\r\n                \" [c=blue] - Bluella, la plus téméraire, ouvrait la marche, portant un chapeau violet[/c] \")\r\n            .then(\"Maintenant, passons à la THEORIE !\")\r\n            .then(\"Théorie numéro 1 : une boule de couleur a une position unique. Mais où ??? AHHH Je ne comprends pas....\")\r\n            .then(\"Théorie numéro 2 : Si la théorie 1 est correcte, alors la solution du puzzle doit dépendre de ses boules et [g]EST UNIQUE[/g].\")\r\n            .then(\"Et voilà c'est un peu tout ce que j'ai, je suis dans une sacrée impasse. Je vais sûrement rater le prix Nobel cette année...\")\r\n            .then(\"Allez j'te laisse la boule, je suis passé à autre chose ! Tu me diras une prochaine fois si ça t'a été utile !\")\r\n            .then(\"À la revoyure !\")\r\n            .setOnEnding(() => {\r\n                JournalUI.instance.addEntryToQuest(QuestManager.instance.getQuest(\"dreamland\"), (\"Rosa a trouvée ces deux phrases :\" +\r\n                    \"\\n Bluella, la plus téméraire, ouvrait la marche, portant un chapeau violet\" +\r\n                    \"\\n Greina, la plus sage, veillait sur ses soeurs sans faillire à sa tâche\"));\r\n            })\r\n            .build();\r\n\r\n\r\n\r\n        scientific.cameraConfiguration = new CameraConfiguration();\r\n        scientific.cameraConfiguration.target = scientific.transformNode;\r\n        scientific.cameraConfiguration.distanceFromTarget = 40;\r\n        scientific.cameraConfiguration.wantedAlpha = Angle.FromDegrees(-120).radians();\r\n        scientific.cameraConfiguration.wantedBeta = Angle.FromDegrees(50).radians();\r\n\r\n        return scientific;\r\n    }\r\n\r\n    public static async createScribe(): Promise<NPC>{\r\n        const scribe = new NPC();\r\n        scribe.name = \"Marcel\";\r\n        Utils.loadMesh(\"models/characters/scribe.glb\").then((result) => {\r\n            scribe.mesh = result.meshes[0];\r\n            result.meshes.forEach((mesh) => {\r\n                const mat = mesh.material as PBRMaterial;\r\n                if(mat){\r\n                    const toonMat = new CartoonShaderMaterial();\r\n                    toonMat.assignMaterial(mesh).then(() => {\r\n                        toonMat.configureFromPBRMaterial(mat);\r\n                    });\r\n                }\r\n            })\r\n        });\r\n        scribe.detectionZone = new CylindricalDetectionZone( {\r\n            height: 8,\r\n            diameterTop: 45,\r\n            diameterBottom: 45,\r\n        }, true);\r\n\r\n        scribe.conversation = new ConversationBuilder()\r\n            .say(\"Que penses-tu de mon prochain poème jeune étranger ?\")\r\n            .then(\"[g]Ballade d’un Génie Naufragé[/g]\")\r\n            .then(\"[i]Je suis ce grand Marcel, qu’aucun vent ne dérange\\n, Poète illustre et fier, perdu sur cet étrange \\n Territoire obscur, bordé par l’inconnu, \\n Où des piliers sans fin soutiennent l’absolu.[/i]\")\r\n            .then(\"[i]Je ne sais point comment j’ai pu atterrir ici,\\n Mais l’endroit me salue d’un silence exquis.\\n Tantôt le ciel s’emplit de choses voltigeantes, \\n Tantôt le vide plane, en formes déchirantes.[/i]\")\r\n            .then(\"[i]Sur le rivage nu, comme un don du destin, \\n J’aperçus une orbe, d’un éclat si divin \\n Que mon esprit, troublé par tant de magnificence,\\n Faillit se noyer dans sa propre éloquence.[/i]\")\r\n            .then(\"[i]Juste à côté dormait, message dans bouteille,\\n Un parchemin d’échos, d’une main non pareille. \\n Il était écrit, sans honte ni limite : \\n [/i] [c=blue]« Pendant que le soleil était au zénith, Un nuage grisâtre s’approchait depuis l’ouest ».[/c] Ah ! Que cette phrase est d’un raffinement leste !\")\r\n            .then(\"[i]Moi seul, Marcel, pouvais en saisir l’essence, \\n Car mon verbe est plus fort que toute connaissance. [/i]\")\r\n            .then(\"[i]Je retourne à présent vers la fontaine noire,\\n Dont l’encre tachera les vers de ma mémoire.[/i]\")\r\n            .then(\"Voila ! J'espère que ce ne fut pas un peu trop long. \\n Maintenant file je dois me concentrer !\")\r\n            .setOnEnding(() => {\r\n                JournalUI.instance.addEntryToQuest(QuestManager.instance.getQuest(\"dreamland\"), \"Marcel nous indique dans son poeme interminable : \\n \" +\r\n                    \"Pendant que le soleil était au zénith, Un nuage grisâtre s’approchait depuis l’ouest\")\r\n            })\r\n            .build();\r\n\r\n\r\n        scribe.cameraConfiguration = new CameraConfiguration();\r\n        scribe.cameraConfiguration.target = scribe.transformNode;\r\n        scribe.cameraConfiguration.distanceFromTarget = 10;\r\n        scribe.cameraConfiguration.wantedAlpha = Angle.FromDegrees(150).radians();\r\n\r\n        return scribe;\r\n    }\r\n\r\n    public static async createRabbit(): Promise<NPC>{\r\n        const rabbit = new NPC();\r\n        rabbit.name = \"Matthew\";\r\n\r\n        Utils.loadMesh(\"models/characters/lapin.glb\").then((result) => {\r\n            rabbit.mesh = result.meshes[0];\r\n\r\n            result.meshes.forEach((mesh) => {\r\n\r\n                const mat = mesh.material as PBRMaterial;\r\n                if(mat){\r\n                    const toonMat = new CartoonShaderMaterial();\r\n                    toonMat.assignMaterial(mesh).then(() => {\r\n                        toonMat.configureFromPBRMaterial(mat);\r\n                    });\r\n                }\r\n            })\r\n        });\r\n\r\n        rabbit.detectionZone = new CylindricalDetectionZone( {\r\n            height: 8,\r\n            diameterTop: 45,\r\n            diameterBottom: 45,\r\n        }, true);\r\n\r\n        rabbit.detectionZone.zone.position.set(0, -2, 0);\r\n\r\n        rabbit.conversation = new ConversationBuilder()\r\n            .say(\"[i][c=blue]Trois sœurs, Redina, Greina, Bluella, voyant le nuage s'approcher, se dirigeaient à l'opposée....[/i][/c]\")\r\n            .then(\"Hmmmm... Qu'est-ce que ça peut vouloir dire....\")\r\n            .then(\"[g][c=red]AAAAAAAAAAAAAAAAAAAAHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHH[/c][/g]\")\r\n            .then(\"TU M'AS FAIS PEUR !!!!\")\r\n            .then(\"TIENS PREND ÇA ! ET PARS LOIN D'ICI SANS REVENIR !!!!!!!!!!!!!!!!\")\r\n            .setOnEnding(() => {\r\n                JournalUI.instance.addEntryToQuest(QuestManager.instance.getQuest(\"dreamland\"), \"Marcel nous indique dans son poeme interminable : \\n \" +\r\n                    \" - Trois sœurs, Redina, Greina, Bluella, voyant le nuage s'approcher, se dirigeaient à l'opposée...\")\r\n            })\r\n            .build();\r\n\r\n\r\n\r\n        rabbit.cameraConfiguration = new CameraConfiguration();\r\n        rabbit.cameraConfiguration.target = rabbit.transformNode;\r\n        rabbit.cameraConfiguration.distanceFromTarget = 10;\r\n        rabbit.cameraConfiguration.wantedAlpha = Angle.FromDegrees(-90).radians();\r\n\r\n        return rabbit;\r\n    }\r\n}","import {MeshDetectionZone} from \"@/YellowSubmarine/detection system/MeshDetectionZone\";\r\nimport {Conversation} from \"@/YellowSubmarine/dialogue system/Conversation\";\r\nimport {\r\n    StartConversationInteraction\r\n} from \"@/YellowSubmarine/dialogue system/interactions/StartConversationInteraction\";\r\nimport {ConversationBuilder} from \"@/YellowSubmarine/dialogue system/ConversationBuilder\";\r\nimport {SphericalDetectionZone} from \"@/YellowSubmarine/detection system/SphericalDetectionZone\";\r\nimport {Submarine} from \"@/YellowSubmarine/Submarine\";\r\nimport {QuestManager} from \"@/YellowSubmarine/quest system/QuestManager\";\r\nimport {IConversationProvider} from \"@/YellowSubmarine/dialogue system/IConversationProvider\";\r\nimport {AbstractMesh, Angle} from \"@babylonjs/core\";\r\nimport {CameraConfiguration} from \"@/YellowSubmarine/camera system/CameraConfiguration\";\r\nimport {JournalUI} from \"@/YellowSubmarine/quest system/ui/JournalUI\";\r\n\r\nexport class Stele implements IConversationProvider {\r\n    private _steleInteractionZone!: MeshDetectionZone;\r\n    private _conversation!: Conversation;\r\n    private _startConversationInteraction?: StartConversationInteraction\r\n    private _cameraConfiguration!: CameraConfiguration;\r\n\r\n    public constructor() {\r\n        this.steleInteractionZone = new SphericalDetectionZone({\r\n            diameter: 20\r\n        }, true);\r\n        this._cameraConfiguration = new CameraConfiguration();\r\n        this._cameraConfiguration.target = this._steleInteractionZone.zone;\r\n        this._cameraConfiguration.distanceFromTarget = 20;\r\n        this._cameraConfiguration.wantedAlpha = Angle.FromDegrees(-90).radians();\r\n\r\n        const conversationBuilder = new ConversationBuilder();\r\n        conversationBuilder.say(\"La ligne du haut regarde les cieux\")\r\n            .then(\"La ligne du milieu respire l’air\")\r\n            .then(\"La ligne du bas touche la terre\")\r\n            .setOnEnding(() => {\r\n                let quest = QuestManager.instance.getQuest(\"temple_quest\");\r\n                if(quest) quest.startQuest();\r\n                quest = QuestManager.instance.getQuest(\"dreamland\");\r\n                if(quest) quest.updateCurrentStepStatus();\r\n                JournalUI.instance.addEntryToQuest(QuestManager.instance.getQuest(\"temple_quest\"), \"La stèle nous a donnés des informations sur les rangés : `\\n\" +\r\n                    \" - La ligne du haut regarde les cieux \\n\" +\r\n                    \" - La ligne du milieu respire l’air \\n\" +\r\n                    \" - La ligne du bas touche la terre\");\r\n            })\r\n        this.conversation = conversationBuilder.build();\r\n        this.conversation.conversationProvider = this;\r\n    }\r\n\r\n    public get steleInteractionZone(): MeshDetectionZone {\r\n        return this._steleInteractionZone;\r\n    }\r\n\r\n    private set steleInteractionZone(value: MeshDetectionZone) {\r\n        this._steleInteractionZone = value;\r\n        if(this._steleInteractionZone) {\r\n            this._steleInteractionZone.onMeshEnter.add(() => {\r\n                if (this._startConversationInteraction) {\r\n                    this._startConversationInteraction.makeAvailable();\r\n                }\r\n            })\r\n            this._steleInteractionZone.onMeshExit.add(() => {\r\n                if(this._startConversationInteraction) {\r\n                    this._startConversationInteraction.makeUnavailable();\r\n                }\r\n            })\r\n            Submarine.instance.meshCreationPromise.then((mesh) => {\r\n                this._steleInteractionZone?.addMeshToDetect(mesh);\r\n            })\r\n        }\r\n    }\r\n\r\n    public get conversation(): Conversation {\r\n        return this._conversation;\r\n    }\r\n\r\n    private set conversation(value: Conversation) {\r\n        this._conversation = value;\r\n        if(this._conversation) {\r\n            this._startConversationInteraction = new StartConversationInteraction(this._conversation);\r\n        }\r\n    }\r\n\r\n    get mesh(): AbstractMesh | undefined {\r\n        return this._steleInteractionZone.zone;\r\n    }\r\n\r\n    get name(): string {\r\n        return \"Stele\";\r\n    }\r\n\r\n    get cameraConfiguration(): CameraConfiguration | undefined {\r\n        return this._cameraConfiguration;\r\n    }\r\n\r\n\r\n\r\n\r\n\r\n}","import {KeyZone} from \"@/YellowSubmarine/keyzone system/KeyZone\";\r\nimport {SphericalDetectionZone} from \"@/YellowSubmarine/detection system/SphericalDetectionZone\";\r\nimport {\r\n    Angle,\r\n    Color3,\r\n    Mesh,\r\n    PBRMaterial,\r\n    PhysicsAggregate,\r\n    PhysicsBody,\r\n    PhysicsMotionType,\r\n    PhysicsShape,\r\n    PhysicsShapeType,\r\n    Space, StandardMaterial,\r\n    TransformNode,\r\n    Vector3\r\n} from \"@babylonjs/core\";\r\nimport {Utils} from \"@/YellowSubmarine/Utils\";\r\nimport {NPCFactory} from \"@/YellowSubmarine/npcs/NPCFactory\";\r\nimport {CartoonShaderMaterial} from \"@/YellowSubmarine/shader material/CartoonShaderMaterial\";\r\nimport {Game} from \"@/YellowSubmarine/Game\";\r\nimport {Stele} from \"@/YellowSubmarine/temple/Stele\";\r\nimport {TemplePuzzle} from \"@/YellowSubmarine/temple/TemplePuzzle\";\r\nimport {CellMaterial} from \"@babylonjs/materials\";\r\nimport {TempleBall} from \"@/YellowSubmarine/temple/TempleBall\";\r\nimport {Submarine} from \"@/YellowSubmarine/Submarine\";\r\n\r\nexport class KeyZoneFactory {\r\n\r\n    private static readonly _dolphinPosition: Vector3 = new Vector3(0,0,160);\r\n    private static readonly _templePosition: Vector3 = new Vector3(0, 0, 500);\r\n    private static readonly _banquisePosition: Vector3 = new Vector3(-200, 0, 680);\r\n    private static readonly _archipelPosition: Vector3 = new Vector3(200, 0, 680);\r\n    private static readonly _pharePosition: Vector3 = new Vector3(-250, 0, 420);\r\n    private static readonly _poulpePosition: Vector3 = new Vector3(250, 0, 420);\r\n\r\n    public static async createDolphinIsland(): Promise<KeyZone> {\r\n        const _transformIsland: TransformNode = new TransformNode(\"island transform\");\r\n        const island = new KeyZone();\r\n\r\n        island.name = \"Dolphin island\";\r\n        island.detectionZone = new SphericalDetectionZone({\r\n            diameter : 200\r\n        }, true);\r\n\r\n        const result = await Utils.loadMesh(\"models/scenes/dolphinIsland.glb\");\r\n        const rootMesh = result.meshes[0];\r\n        rootMesh.position = Vector3.Zero();\r\n        rootMesh.parent = _transformIsland;\r\n        const childMeshes = rootMesh.getChildMeshes<Mesh>();\r\n        for (const mesh of result.meshes) {\r\n            const mat = mesh.material as PBRMaterial;\r\n            if(mat){\r\n                const toonMat = new CartoonShaderMaterial();\r\n                await toonMat.assignMaterial(mesh).then(() => {\r\n                    toonMat.configureFromPBRMaterial(mat);\r\n                });\r\n            }\r\n        }\r\n        const mergedMesh = Mesh.MergeMeshes(childMeshes,true, undefined, undefined, undefined, true);\r\n        if(mergedMesh){\r\n            mergedMesh.parent = _transformIsland;\r\n            island.mesh = mergedMesh;\r\n            _transformIsland.position = this._dolphinPosition;\r\n\r\n            const physicsBody = new PhysicsBody(mergedMesh, PhysicsMotionType.STATIC, false, Game.scene);\r\n            const physicsShape = new PhysicsShape({\r\n                type: PhysicsShapeType.MESH,\r\n                parameters: {\r\n                    mesh: mergedMesh,\r\n                }\r\n            }, Game.scene);\r\n\r\n            physicsBody.shape = physicsShape;\r\n            physicsBody.disablePreStep = false;\r\n            Game.scene.onBeforeRenderObservable.addOnce(() => physicsBody.disablePreStep = true);\r\n\r\n\r\n            NPCFactory.createPedro().then( (pedro) => {\r\n                pedro.transformNode.position = new Vector3(-30, 15, -14);\r\n                pedro.transformNode.parent = _transformIsland;\r\n\r\n                island.addConversationProvider(pedro);\r\n            });\r\n        }\r\n\r\n\r\n        /*island.physicsAggregate = new PhysicsAggregate(island.mesh, PhysicsShapeType.SPHERE, {\r\n            mass: 0,\r\n            radius: 30,\r\n        }, Game.scene);*/\r\n\r\n\r\n        return island;\r\n    }\r\n\r\n    public static async createTemple(){\r\n\r\n        const templeTransform: TransformNode = new TransformNode(\"temple transform\");\r\n        const temple = new KeyZone();\r\n\r\n        temple.name = \"Temple\";\r\n        temple.detectionZone = new SphericalDetectionZone({\r\n            diameter : 260,\r\n        }, true);\r\n\r\n        const result = await Utils.loadMesh(\"models/scenes/temple.glb\");\r\n        const rootMesh = result.meshes[0];\r\n        rootMesh.position = Vector3.Zero();\r\n        rootMesh.parent = templeTransform;\r\n        const childMeshes = rootMesh.getChildMeshes<Mesh>();\r\n        for (const mesh of result.meshes) {\r\n            const mat = mesh.material as PBRMaterial;\r\n            if(mat){\r\n                const toonMat = new CartoonShaderMaterial();\r\n                await toonMat.assignMaterial(mesh).then(() => {\r\n                    toonMat.configureFromPBRMaterial(mat);\r\n                });\r\n                toonMat.emissionColor = Color3.FromHexString(\"#4bf49f\")\r\n            }\r\n        }\r\n        const mergedMesh = Mesh.MergeMeshes(childMeshes,true, undefined, undefined, undefined, true);\r\n        if(mergedMesh){\r\n            mergedMesh.parent = templeTransform;\r\n            temple.mesh = mergedMesh;\r\n            templeTransform.position = this._templePosition;\r\n            templeTransform.rotate(Vector3.Up(), Angle.FromDegrees(180).radians(), Space.WORLD);\r\n\r\n            const physicsBody = new PhysicsBody(mergedMesh, PhysicsMotionType.STATIC, false, Game.scene);\r\n            const physicsShape = new PhysicsShape({\r\n                type: PhysicsShapeType.MESH,\r\n                parameters: {\r\n                    mesh: mergedMesh,\r\n                }\r\n            }, Game.scene);\r\n            physicsBody.shape = physicsShape;\r\n\r\n            physicsBody.disablePreStep = false;\r\n            Game.scene.onBeforeRenderObservable.addOnce(() => physicsBody.disablePreStep = true);\r\n\r\n        }\r\n\r\n        const stele = new Stele();\r\n        const steleInteractionZone = stele.steleInteractionZone;\r\n        steleInteractionZone.zone.parent = templeTransform;\r\n        steleInteractionZone.zone.position = new Vector3(0,0,50);\r\n\r\n        temple.addConversationProvider(stele);\r\n\r\n        const templePuzzle = new TemplePuzzle(templeTransform, new Vector3(0,0,0));\r\n\r\n    }\r\n\r\n    private static createStaticPhysicsAggregate(\r\n        transformNode: TransformNode,\r\n        type: PhysicsShapeType | PhysicsShape,\r\n    ){\r\n        const aggregate = new PhysicsAggregate(transformNode, type, {\r\n            mass: 0,\r\n        }, Game.scene);\r\n\r\n        return aggregate;\r\n    }\r\n\r\n    public static async createBanquise(){\r\n        const banquiseTransform: TransformNode = new TransformNode(\"banquise transform\");\r\n        const banquise = new KeyZone();\r\n\r\n        banquise.name = \"Fractisberg\";\r\n        banquise.detectionZone = new SphericalDetectionZone({\r\n            diameter : 200,\r\n        }, true);\r\n\r\n        const result = await Utils.loadMesh(\"models/scenes/banquise.glb\");\r\n        const rootMesh = result.meshes[0];\r\n        rootMesh.position = Vector3.Zero();\r\n        rootMesh.parent = banquiseTransform;\r\n        const childMeshes = rootMesh.getChildMeshes<Mesh>();\r\n        for (const mesh of result.meshes) {\r\n            const pbrMaterial = mesh.material as PBRMaterial;\r\n            const standardMat = mesh.material as StandardMaterial;\r\n            if(pbrMaterial){\r\n                const cellMaterial = new CellMaterial(\"banquiseMat\");\r\n                cellMaterial.needDepthPrePass = true;\r\n                cellMaterial.diffuseColor = pbrMaterial.albedoColor;\r\n                if(pbrMaterial.albedoTexture){\r\n                    cellMaterial.diffuseTexture = pbrMaterial.albedoTexture;\r\n                }\r\n                mesh.material = cellMaterial;\r\n                cellMaterial.cullBackFaces = false;\r\n\r\n            }\r\n            else if(standardMat){\r\n                const cellMaterial = new CellMaterial(\"banquiseMat\");\r\n                cellMaterial.needDepthPrePass = true;\r\n                cellMaterial.diffuseColor = standardMat.diffuseColor;\r\n                if(standardMat.diffuseTexture){\r\n                    cellMaterial.diffuseTexture = standardMat.diffuseTexture;\r\n                }\r\n                mesh.material = cellMaterial;\r\n                cellMaterial.cullBackFaces = false;\r\n            }\r\n\r\n        }\r\n        const mergedMesh = Mesh.MergeMeshes(childMeshes,true, undefined, undefined, undefined, true);\r\n        if(mergedMesh){\r\n            mergedMesh.parent = banquiseTransform;\r\n            banquise.mesh = mergedMesh;\r\n            banquiseTransform.position = this._banquisePosition;\r\n            banquiseTransform.rotate(Vector3.Up(), Angle.FromDegrees(-90).radians(), Space.WORLD);\r\n\r\n            const physicsBody = new PhysicsBody(mergedMesh, PhysicsMotionType.STATIC, false, Game.scene);\r\n            const physicsShape = new PhysicsShape({\r\n                type: PhysicsShapeType.MESH,\r\n                parameters: {\r\n                    mesh: mergedMesh,\r\n                }\r\n            }, Game.scene);\r\n            physicsBody.shape = physicsShape;\r\n\r\n            physicsBody.disablePreStep = false;\r\n            Game.scene.onBeforeRenderObservable.addOnce(() => physicsBody.disablePreStep = true);\r\n\r\n            NPCFactory.createFox().then( (fox) => {\r\n                fox.transformNode.position = new Vector3(-8, 1.4, 0);\r\n                fox.transformNode.parent = banquiseTransform;\r\n                const ball = new TempleBall(fox.transformNode.absolutePosition.add(new Vector3(0,20,0)), Color3.Green());\r\n                const callBack = fox.conversation?.onConversationEnd.add(() => {\r\n                    if(!Submarine.instance.templeBall){\r\n                        Submarine.instance.grabBall(ball);\r\n                        fox.conversation?.onConversationEnd.remove(callBack ?? null);\r\n                    }\r\n                });\r\n                banquise.addConversationProvider(fox);\r\n            });\r\n        }\r\n\r\n\r\n    }\r\n\r\n    public static async createArchipel(){\r\n        const archipelTransform: TransformNode = new TransformNode(\"archipel transform\");\r\n        const archipel = new KeyZone();\r\n\r\n        archipel.name = \"L'Archipel Carotte\";\r\n        archipel.detectionZone = new SphericalDetectionZone({\r\n            diameter : 200,\r\n        }, true);\r\n\r\n        const result = await Utils.loadMesh(\"models/scenes/archipel.glb\");\r\n        const rootMesh = result.meshes[0];\r\n        rootMesh.position = Vector3.Zero();\r\n        rootMesh.parent = archipelTransform;\r\n        const childMeshes = rootMesh.getChildMeshes<Mesh>();\r\n        for (const mesh of result.meshes) {\r\n            const pbrMaterial = mesh.material as PBRMaterial;\r\n            const standardMat = mesh.material as StandardMaterial;\r\n            if(pbrMaterial){\r\n                const cellMaterial = new CellMaterial(\"archipelMat\");\r\n                cellMaterial.needDepthPrePass = true;\r\n                cellMaterial.diffuseColor = pbrMaterial.albedoColor;\r\n                if(pbrMaterial.albedoTexture){\r\n                    cellMaterial.diffuseTexture = pbrMaterial.albedoTexture;\r\n                }\r\n                mesh.material = cellMaterial;\r\n            }\r\n            else if(standardMat){\r\n                const cellMaterial = new CellMaterial(\"archipelMat\");\r\n                cellMaterial.needDepthPrePass = true;\r\n                cellMaterial.diffuseColor = standardMat.diffuseColor;\r\n                if(standardMat.diffuseTexture){\r\n                    cellMaterial.diffuseTexture = standardMat.diffuseTexture;\r\n                }\r\n                mesh.material = cellMaterial;\r\n            }\r\n        }\r\n        const mergedMesh = Mesh.MergeMeshes(childMeshes,true, undefined, undefined, undefined, true);\r\n        if(mergedMesh){\r\n            mergedMesh.parent = archipelTransform;\r\n            archipel.mesh = mergedMesh;\r\n            archipelTransform.position = this._archipelPosition;\r\n            archipelTransform.rotate(Vector3.Up(), Angle.FromDegrees(-90).radians(), Space.WORLD);\r\n\r\n            const physicsBody = new PhysicsBody(mergedMesh, PhysicsMotionType.STATIC, false, Game.scene);\r\n            const physicsShape = new PhysicsShape({\r\n                type: PhysicsShapeType.MESH,\r\n                parameters: {\r\n                    mesh: mergedMesh,\r\n                }\r\n            }, Game.scene);\r\n            physicsBody.shape = physicsShape;\r\n\r\n            physicsBody.disablePreStep = false;\r\n            Game.scene.onBeforeRenderObservable.addOnce(() => physicsBody.disablePreStep = true);\r\n\r\n            NPCFactory.createRabbit().then( (rabbit) => {\r\n                rabbit.transformNode.position = new Vector3(-0.8, 5.2, -0.7);\r\n                rabbit.transformNode.parent = archipelTransform;\r\n                const ball = new TempleBall(rabbit.transformNode.absolutePosition.add(new Vector3(0,20,0)), Color3.Red());\r\n                const callBack = rabbit.conversation?.onConversationEnd.add(() => {\r\n                    if(!Submarine.instance.templeBall){\r\n                        Submarine.instance.grabBall(ball);\r\n                        rabbit.conversation?.onConversationEnd.remove(callBack ?? null);\r\n                    }\r\n                });\r\n                archipel.addConversationProvider(rabbit);\r\n            });\r\n\r\n\r\n        }\r\n\r\n\r\n    }\r\n\r\n    public static async createPoulpe(){\r\n        const poulpeTransform: TransformNode = new TransformNode(\"poulpe transform\");\r\n        const poulpe = new KeyZone();\r\n\r\n        poulpe.name = \"Le Poulpensant\";\r\n        poulpe.detectionZone = new SphericalDetectionZone({\r\n            diameter : 200,\r\n        }, true);\r\n\r\n        const result = await Utils.loadMesh(\"models/scenes/poulpe.glb\");\r\n        const rootMesh = result.meshes[0];\r\n        rootMesh.position = Vector3.Zero();\r\n        rootMesh.parent = poulpeTransform;\r\n        const childMeshes = rootMesh.getChildMeshes<Mesh>();\r\n        for (const mesh of result.meshes) {\r\n            const pbrMaterial = mesh.material as PBRMaterial;\r\n            const standardMat = mesh.material as StandardMaterial;\r\n            if(pbrMaterial){\r\n                const cellMaterial = new CellMaterial(\"poulpeMat\");\r\n                cellMaterial.needDepthPrePass = true;\r\n                cellMaterial.diffuseColor = pbrMaterial.albedoColor;\r\n                if(pbrMaterial.albedoTexture){\r\n                    cellMaterial.diffuseTexture = pbrMaterial.albedoTexture;\r\n                }\r\n                mesh.material = cellMaterial;\r\n            }\r\n            else if(standardMat){\r\n                const cellMaterial = new CellMaterial(\"poulpeMat\");\r\n                cellMaterial.needDepthPrePass = true;\r\n                cellMaterial.diffuseColor = standardMat.diffuseColor;\r\n                if(standardMat.diffuseTexture){\r\n                    cellMaterial.diffuseTexture = standardMat.diffuseTexture;\r\n                }\r\n                mesh.material = cellMaterial;\r\n            }\r\n\r\n        }\r\n        const mergedMesh = Mesh.MergeMeshes(childMeshes,true, undefined, undefined, undefined, true);\r\n        if(mergedMesh){\r\n            mergedMesh.parent = poulpeTransform;\r\n            poulpe.mesh = mergedMesh;\r\n            poulpeTransform.position = this._poulpePosition;\r\n\r\n            const physicsBody = new PhysicsBody(mergedMesh, PhysicsMotionType.STATIC, false, Game.scene);\r\n            const physicsShape = new PhysicsShape({\r\n                type: PhysicsShapeType.MESH,\r\n                parameters: {\r\n                    mesh: mergedMesh,\r\n                }\r\n            }, Game.scene);\r\n            physicsBody.shape = physicsShape;\r\n\r\n            physicsBody.disablePreStep = false;\r\n            Game.scene.onBeforeRenderObservable.addOnce(() => physicsBody.disablePreStep = true);\r\n\r\n            NPCFactory.createScribe().then( (scribe) => {\r\n                scribe.transformNode.position = new Vector3(-1.57, 0.8, 5.8);\r\n                scribe.transformNode.parent = poulpeTransform;\r\n                const ball = new TempleBall(scribe.transformNode.absolutePosition.add(new Vector3(0,20,0)), Color3.Purple());\r\n                const callBack = scribe.conversation?.onConversationEnd.add(() => {\r\n                    if(!Submarine.instance.templeBall){\r\n                        Submarine.instance.grabBall(ball);\r\n                        scribe.conversation?.onConversationEnd.remove(callBack ?? null);\r\n                    }\r\n                });\r\n                poulpe.addConversationProvider(scribe);\r\n            });\r\n        }\r\n\r\n\r\n    }\r\n\r\n    public static async createPhare(){\r\n        const phareTransform: TransformNode = new TransformNode(\"phare transform\");\r\n        const phare = new KeyZone();\r\n\r\n        phare.name = \"Le Phare Flashouille\";\r\n        phare.detectionZone = new SphericalDetectionZone({\r\n            diameter : 200,\r\n        }, true);\r\n\r\n        const result = await Utils.loadMesh(\"models/scenes/phare.glb\");\r\n        const rootMesh = result.meshes[0];\r\n        rootMesh.position = Vector3.Zero();\r\n        rootMesh.parent = phareTransform;\r\n        const childMeshes = rootMesh.getChildMeshes<Mesh>();\r\n        for (const mesh of result.meshes) {\r\n            const pbrMaterial = mesh.material as PBRMaterial;\r\n            const standardMat = mesh.material as StandardMaterial;\r\n            if(pbrMaterial){\r\n                const cellMaterial = new CellMaterial(\"phareMat\");\r\n                cellMaterial.needDepthPrePass = true;\r\n                cellMaterial.diffuseColor = pbrMaterial.albedoColor;\r\n                if(pbrMaterial.albedoTexture){\r\n                    cellMaterial.diffuseTexture = pbrMaterial.albedoTexture;\r\n                }\r\n                mesh.material = cellMaterial;\r\n            }\r\n            else if(standardMat){\r\n                const cellMaterial = new CellMaterial(\"phareMat\");\r\n                cellMaterial.needDepthPrePass = true;\r\n                cellMaterial.diffuseColor = standardMat.diffuseColor;\r\n                if(standardMat.diffuseTexture){\r\n                    cellMaterial.diffuseTexture = standardMat.diffuseTexture;\r\n                }\r\n                mesh.material = cellMaterial;\r\n            }\r\n        }\r\n        const mergedMesh = Mesh.MergeMeshes(childMeshes,true, undefined, undefined, undefined, true);\r\n        if(mergedMesh){\r\n            mergedMesh.parent = phareTransform;\r\n            phare.mesh = mergedMesh;\r\n            phareTransform.position = this._pharePosition;\r\n            //phareTransform.rotate(Vector3.Up(), Angle.FromDegrees(180).radians(), Space.WORLD);\r\n\r\n            const physicsBody = new PhysicsBody(mergedMesh, PhysicsMotionType.STATIC, false, Game.scene);\r\n            const physicsShape = new PhysicsShape({\r\n                type: PhysicsShapeType.MESH,\r\n                parameters: {\r\n                    mesh: mergedMesh,\r\n                }\r\n            }, Game.scene);\r\n            physicsBody.shape = physicsShape;\r\n\r\n            physicsBody.disablePreStep = false;\r\n            Game.scene.onBeforeRenderObservable.addOnce(() => physicsBody.disablePreStep = true);\r\n\r\n            NPCFactory.createGirl().then( (girl) => {\r\n                girl.transformNode.position = new Vector3(1.2, 1.26, -16.90);\r\n                girl.transformNode.parent = phareTransform;\r\n                const ball = new TempleBall(girl.transformNode.absolutePosition.add(new Vector3(-30,20,-30)), Color3.Blue());\r\n                const callBack = girl.conversation?.onConversationEnd.add(() => {\r\n                    if(!Submarine.instance.templeBall){\r\n                        Submarine.instance.grabBall(ball);\r\n                        girl.conversation?.onConversationEnd.remove(callBack ?? null);\r\n                    }\r\n                });\r\n                phare.addConversationProvider(girl);\r\n            });\r\n        }\r\n\r\n\r\n    }\r\n\r\n}","import {Sea} from \"@/YellowSubmarine/Sea\";\r\nimport {Submarine} from \"@/YellowSubmarine/Submarine\";\r\nimport {Sky} from \"@/YellowSubmarine/sky system/Sky\";\r\nimport {KeyZoneFactory} from \"@/YellowSubmarine/keyzone system/KeyZoneFactory\";\r\nimport {GlowLayer} from \"@babylonjs/core\";\r\nimport {Game} from \"@/YellowSubmarine/Game\";\r\nexport class World {\r\n    private _sky: Sky;\r\n\r\n    public get submarine(): Submarine{\r\n        return this._submarine;\r\n    }\r\n\r\n    public static get submarine(): Submarine {\r\n        return this.instance.submarine;\r\n    }\r\n\r\n    private static get instance(): World {\r\n        return this._instance;\r\n    }\r\n\r\n    private static _instance: World;\r\n\r\n    private _sea: Sea;\r\n    private _submarine: Submarine;\r\n\r\n    constructor() {\r\n        World._instance = this;\r\n        this._sea = new Sea();\r\n        this._submarine = new Submarine();\r\n        this._sky = new Sky();\r\n        const glowLayer = new GlowLayer(\"\", Game.scene);\r\n        glowLayer.intensity = 0.3;\r\n    }\r\n\r\n    public async init(): Promise<void> {\r\n\r\n        await Promise.all([\r\n            KeyZoneFactory.createDolphinIsland(),\r\n            KeyZoneFactory.createTemple(),\r\n            KeyZoneFactory.createBanquise(),\r\n            KeyZoneFactory.createPhare(),\r\n            KeyZoneFactory.createPoulpe(),\r\n            KeyZoneFactory.createArchipel()\r\n        ]);\r\n    }\r\n\r\n\r\n}","import {World} from \"@/YellowSubmarine/World\";\r\nimport {Engine, HavokPlugin, Observable, Scene, Vector3} from \"@babylonjs/core\";\r\nimport {Player} from \"@/YellowSubmarine/Player\";\r\nimport {ConfigurableCamera} from \"@/YellowSubmarine/camera system/ConfigurableCamera\";\r\nimport {InteractionManager} from \"@/YellowSubmarine/interaction system/InteractionManager\";\r\nimport {UIManager} from \"@/YellowSubmarine/ui system/UIManager\";\r\nimport {SoundManager} from \"@/YellowSubmarine/sound system/SoundManager\";\r\nimport {QuestManager} from \"@/YellowSubmarine/quest system/QuestManager\";\r\n\r\nexport class Game{\r\n\r\n    private static _instance: Game;\r\n\r\n    public static onGameFocusChange: Observable<boolean> = new Observable<boolean>();\r\n\r\n    private _scene: Scene;\r\n    private _engine: Engine;\r\n    private _world: World;\r\n    private _player!: Player;\r\n    private _isGameFocused = false;\r\n    private _camera: ConfigurableCamera;\r\n    private _interactionManager: InteractionManager;\r\n    private _uiManager!: UIManager;\r\n    private _soundManager!: SoundManager;\r\n    private _questManager!: QuestManager;\r\n\r\n    public static get canvas(){\r\n        return this._instance._canvas;\r\n    }\r\n\r\n    public static get engine(): Engine {\r\n        return Game._instance._engine;\r\n    }\r\n\r\n    public static get scene(): Scene {\r\n        return Game._instance._scene;\r\n    }\r\n\r\n    public static get uiManager(): UIManager {\r\n        return Game._instance._uiManager;\r\n    }\r\n\r\n    public static get isGameFocused(): boolean {\r\n        return Game._instance._isGameFocused;\r\n    }\r\n\r\n    public async init(): Promise<void> {\r\n        await this._world.init();\r\n        this._player = new Player();\r\n        this._soundManager = new SoundManager();\r\n        this._uiManager = new UIManager(this._canvas);\r\n        this._questManager = new QuestManager();\r\n    }\r\n\r\n\r\n    constructor(private _canvas: HTMLCanvasElement, private _havok: HavokPlugin) {\r\n        Game._instance = this;\r\n\r\n        this._engine = new Engine(this._canvas);\r\n        this._scene = new Scene(this._engine);\r\n        this._scene.enablePhysics(new Vector3(0,-9.81,0), _havok);\r\n        this._interactionManager = new InteractionManager();\r\n        this._camera = new ConfigurableCamera();\r\n        this._world = new World();\r\n\r\n\r\n        document.addEventListener(\"pointerlockchange\", () => {\r\n            this.updateFocusState(document.pointerLockElement === _canvas);\r\n        });\r\n\r\n        this._engine.runRenderLoop(() => {\r\n            this._scene.render();\r\n        })\r\n        window.addEventListener(\"resize\", () => this._engine.resize());\r\n    }\r\n\r\n    private updateFocusState(state: boolean) {\r\n        if(state != this._isGameFocused){\r\n            this._isGameFocused = state;\r\n            Game.onGameFocusChange.notifyObservers(this._isGameFocused);\r\n            if (!this._isGameFocused) {\r\n                Game.uiManager.showMainMenu();\r\n            }\r\n        }\r\n    }\r\n\r\n\r\n\r\n}","import { render } from \"./YellowSubmarine.vue?vue&type=template&id=121896b8&scoped=true&ts=true\"\nimport script from \"./YellowSubmarine.vue?vue&type=script&lang=ts\"\nexport * from \"./YellowSubmarine.vue?vue&type=script&lang=ts\"\n\nimport \"./YellowSubmarine.vue?vue&type=style&index=0&id=121896b8&scoped=true&lang=css\"\n\nimport exportComponent from \"../../node_modules/vue-loader/dist/exportHelper.js\"\nconst __exports__ = /*#__PURE__*/exportComponent(script, [['render',render],['__scopeId',\"data-v-121896b8\"]])\n\nexport default __exports__","import { render } from \"./App.vue?vue&type=template&id=091a8ae3&ts=true\"\nimport script from \"./App.vue?vue&type=script&lang=ts\"\nexport * from \"./App.vue?vue&type=script&lang=ts\"\n\nimport \"./App.vue?vue&type=style&index=0&id=091a8ae3&lang=css\"\n\nimport exportComponent from \"../node_modules/vue-loader/dist/exportHelper.js\"\nconst __exports__ = /*#__PURE__*/exportComponent(script, [['render',render]])\n\nexport default __exports__","import { createApp } from 'vue'\nimport App from './App.vue'\n\ncreateApp(App).mount('#app')\n","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId](module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n// expose the modules object (__webpack_modules__)\n__webpack_require__.m = __webpack_modules__;\n\n","var deferred = [];\n__webpack_require__.O = function(result, chunkIds, fn, priority) {\n\tif(chunkIds) {\n\t\tpriority = priority || 0;\n\t\tfor(var i = deferred.length; i > 0 && deferred[i - 1][2] > priority; i--) deferred[i] = deferred[i - 1];\n\t\tdeferred[i] = [chunkIds, fn, priority];\n\t\treturn;\n\t}\n\tvar notFulfilled = Infinity;\n\tfor (var i = 0; i < deferred.length; i++) {\n\t\tvar chunkIds = deferred[i][0];\n\t\tvar fn = deferred[i][1];\n\t\tvar priority = deferred[i][2];\n\t\tvar fulfilled = true;\n\t\tfor (var j = 0; j < chunkIds.length; j++) {\n\t\t\tif ((priority & 1 === 0 || notFulfilled >= priority) && Object.keys(__webpack_require__.O).every(function(key) { return __webpack_require__.O[key](chunkIds[j]); })) {\n\t\t\t\tchunkIds.splice(j--, 1);\n\t\t\t} else {\n\t\t\t\tfulfilled = false;\n\t\t\t\tif(priority < notFulfilled) notFulfilled = priority;\n\t\t\t}\n\t\t}\n\t\tif(fulfilled) {\n\t\t\tdeferred.splice(i--, 1)\n\t\t\tvar r = fn();\n\t\t\tif (r !== undefined) result = r;\n\t\t}\n\t}\n\treturn result;\n};","// define getter functions for harmony exports\n__webpack_require__.d = function(exports, definition) {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.g = (function() {\n\tif (typeof globalThis === 'object') return globalThis;\n\ttry {\n\t\treturn this || new Function('return this')();\n\t} catch (e) {\n\t\tif (typeof window === 'object') return window;\n\t}\n})();","__webpack_require__.o = function(obj, prop) { return Object.prototype.hasOwnProperty.call(obj, prop); }","// define __esModule on exports\n__webpack_require__.r = function(exports) {\n\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n\t}\n\tObject.defineProperty(exports, '__esModule', { value: true });\n};","__webpack_require__.p = \"/YellowSubmarine/\";","__webpack_require__.b = document.baseURI || self.location.href;\n\n// object to store loaded and loading chunks\n// undefined = chunk not loaded, null = chunk preloaded/prefetched\n// [resolve, reject, Promise] = chunk loading, 0 = chunk loaded\nvar installedChunks = {\n\t524: 0\n};\n\n// no chunk on demand loading\n\n// no prefetching\n\n// no preloaded\n\n// no HMR\n\n// no HMR manifest\n\n__webpack_require__.O.j = function(chunkId) { return installedChunks[chunkId] === 0; };\n\n// install a JSONP callback for chunk loading\nvar webpackJsonpCallback = function(parentChunkLoadingFunction, data) {\n\tvar chunkIds = data[0];\n\tvar moreModules = data[1];\n\tvar runtime = data[2];\n\t// add \"moreModules\" to the modules object,\n\t// then flag all \"chunkIds\" as loaded and fire callback\n\tvar moduleId, chunkId, i = 0;\n\tif(chunkIds.some(function(id) { return installedChunks[id] !== 0; })) {\n\t\tfor(moduleId in moreModules) {\n\t\t\tif(__webpack_require__.o(moreModules, moduleId)) {\n\t\t\t\t__webpack_require__.m[moduleId] = moreModules[moduleId];\n\t\t\t}\n\t\t}\n\t\tif(runtime) var result = runtime(__webpack_require__);\n\t}\n\tif(parentChunkLoadingFunction) parentChunkLoadingFunction(data);\n\tfor(;i < chunkIds.length; i++) {\n\t\tchunkId = chunkIds[i];\n\t\tif(__webpack_require__.o(installedChunks, chunkId) && installedChunks[chunkId]) {\n\t\t\tinstalledChunks[chunkId][0]();\n\t\t}\n\t\tinstalledChunks[chunkId] = 0;\n\t}\n\treturn __webpack_require__.O(result);\n}\n\nvar chunkLoadingGlobal = self[\"webpackChunkyellow_submarine\"] = self[\"webpackChunkyellow_submarine\"] || [];\nchunkLoadingGlobal.forEach(webpackJsonpCallback.bind(null, 0));\nchunkLoadingGlobal.push = webpackJsonpCallback.bind(null, chunkLoadingGlobal.push.bind(chunkLoadingGlobal));","// startup\n// Load entry module and return exports\n// This entry module depends on other loaded chunks and execution need to be delayed\nvar __webpack_exports__ = __webpack_require__.O(undefined, [504], function() { return __webpack_require__(99774); })\n__webpack_exports__ = __webpack_require__.O(__webpack_exports__);\n"],"names":["render","_ctx","_cache","$props","$setup","$data","$options","_component_YellowSubmarine","_hoisted_1","_hoisted_2","class","id","isFadingOut","src","getLogoSrc","alt","loadingText","letter","index","key","style","isLoading","this","_bodyMesh","createBody","Game","scene","_haloMesh","createHalo","_light","createLight","configMaterials","body","CreateSphere","diameter","_diameter","segments","infiniteDistance","isPickable","position","_defaultPosition","halo","direction","activeCamera","subtract","normalize","light","negate","intensity","_intensity","shadowEnabled","parent","diffuse","_diffuse","specular","_specular","glowLayer","bodyMaterial","emissiveColor","_emissiveColor","diffuseColor","specularColor","material","haloMaterial","alpha","bodyMesh","_hemiLight","createHemiLight","Up","isEnabled","shadowGenerator","useBlurExponentialShadowMap","blurKernel","onBeforeRenderObservable","add","dir","absolutePosition","Zero","CelestialBody","HemisphericCelestialBody","SkyBox","_instance","_mesh","CreateBox","size","_shaderMaterial","vertex","fragment","attributes","uniforms","samplers","setFloat","Sky","instance","dayNightCycle","timeOfTheDay","_daySkyboxTexture","CreateFromImages","coordinatesMode","SKYBOX_MODE","_nightSkyboxTexture","setTexture","backFaceCulling","setColor3","sky","_sun","sun","_moon","moon","_time","engine","getDeltaTime","updateBody","updateLight","updateMoonLight","time","sunAngle","Math","PI","moonAngle","sunRadius","length","moonRadius","inclination","sunX","cos","sunY","sin","sunZ","moonInclination","moonX","moonY","moonZ","sunPos","sunHeight","y","normalized","max","min","smooth","pow","setEnabled","sunsetColor","FromHexString","Lerp","White","hemi","hemiLight","dayColor","nightColor","_isDayTime","DayNightCycle","onDayChanged","notifyObservers","ambientColor","moonPos","moonHeight","deepNightColor","Sun","Moon","_skybox","_dayNightCycle","value","ReflectiveToonWaterMaterial","_scene","_material","shaderMaterialName","needAlphaTesting","_depthRenderer","enableDepthRenderer","undefined","_depthMap","getDepthMap","_renderListPredicate","m","renderListPredicate","setVector4","setVector2","window","innerWidth","innerHeight","addEventListener","mirrorTexture","mirrorPlane","FromPositionAndNormal","Down","customRenderTargets","push","_geometryBufferRenderer","enableGeometryBufferRenderer","enableNormal","_gBuffer","getGBuffer","cameraNormalTexture","textures","NORMAL_TEXTURE_TYPE","Sea","_seaMesh","CreateGround","width","height","subdivisions","_invisiblePlane","_invisiblePlaneBody","STATIC","_invisiblePlaneShape","type","BOX","parameters","mesh","extents","shape","setMassProperties","mass","ConfigurableCamera","_arcRotateCamera","deltaTimeInSeconds","update","_cameraConfiguration","cameraParameter","oldCameraParameter","jumpToTarget","deltaTimeInSec","updatePosition","updateRotation","target","targetPosition","wantedAlpha","beta","wantedBeta","radius","distanceFromTarget","_positionLerpFactor","lowerRadiusLimit","upperRadiusLimit","FromDegrees","LerpAngle","FromRadians","degrees","_rotationLerpFactor","radians","_target","_offset","rotateByQuaternionToRef","absoluteRotationQuaternion","Identity","offset","_wantedAlpha","_wantedBeta","_currentLowerBetaLimit","_currentUpperBetaLimit","_distanceFromTarget","InteractionManager","onInteractionAvailable","onInteractionUnavailable","Player","onPlayerPressedAKey","eventData","KEYDOWN","_currentInteraction","event","code","executeInteraction","interaction","makeInteractionUnavailable","simplifiedCode","_code","_simplifiedCode","makeInteractionAvailable","AbstractInteraction","path","options","ms","Promise","resolve","setTimeout","param","italic","BBTag","bold","color","newStyle","parsedSize","parseInt","isNaN","Map","initRegistry","_registry","set","ItalicTag","BoldTag","ColorTag","SizeTag","input","match","tagStack","styleStack","cursor","currentStyle","regex","exec","full","name","isClosing","startsWith","idx","text","slice","last","pop","previousStyle","TagClass","get","tagInstance","onOpen","ctx","defaultFontSize","horizontalPadding","parser","BBParser","maxWidth","parseBBCode","map","s","lines","splitLines","fontSize","font","measureText","currentLine","currentWidth","segment","segWidth","getTextWidth","parts","split","part","trim","partWidth","lineHeight","textBlockHorizontalPadding","blocks","linesPanels","forEach","lineSegments","row","isVertical","horizontalAlignment","HORIZONTAL_ALIGNMENT_CENTER","verticalAlignment","VERTICAL_ALIGNMENT_BOTTOM","tb","applyStyle","textWrapping","resizeToFit","addControl","padding","fontWeight","fontStyle","paddingLeft","paddingRight","SoundManager","_SFXVolume","_UIVolume","_MUSICVolume","headphone","_audioEngine","then","unlockAsync","listener","onReadyObservable","playSFX","loop","autoplay","playMUSIC","url","volume","sound","state","Started","fadeIn","play","load","spatialSound","spatial","attach","maxDistance","distanceModel","console","log","_SFXsounds","SFXVolume","_UIsounds","UIVolume","_MUSICsounds","MUSICVolume","targetVolume","duration","stepTime","steps","currentStep","interval","setInterval","clearInterval","initialVolume","stop","fadeOutAndStop","_advanceRequested","speed","skipped","i","Utils","sleep","stopSFX","initContainer","initStack","initTriangle","_layoutManager","TextLayoutManager","canvas","document","createElement","getContext","TEXT_DEFAULT_FONT_SIZE","TEXT_BLOCK_HORIZONTAL_PADDING","_textAnimator","TextAnimator","Conversation","onAnyConversationStart","conv","_container","isVisible","conversationProvider","linkWithMesh","linkOffsetY","CONTAINER_OFFSET_Y","onAnyConversationEnd","_stopBlink","onAnyDialogueStart","dialog","showText","TEXT_SPEED","_isTextFullyDisplayed","CONTAINER_WIDTH","cornerRadius","CONTAINER_CORNER_RADIUS","thickness","CONTAINER_THICKNESS","CONTAINER_COLOR","background","CONTAINER_BACKGROUND","TEXT_PADDING","_verticalStack","paddingBottom","_triangle","TRIANGLE_IMAGE_PATH","TRIANGLE_SIZE","HORIZONTAL_ALIGNMENT_RIGHT","DialogueInteractionUI","resetAdvance","clearControls","advanceObserver","onAdvanceDialogueRequested","requestAdvance","canvasWidth","querySelector","clientWidth","containerPixelWidth","layout","maxFontSize","TEXT_LINE_SPACING","createTextBlocks","linePanel","contentHeight","totalHeight","TEXT_EXTRA_CONTAINER_MARGIN","animateBlocks","advanceRequested","b","remove","_startBlink","isTextFullyDisplayed","TRIANGLE_BLINK_INTERVAL","UI","_conversation","next","DialogueInteraction","NextDialogueInteraction","_conversationProvider","_rootNode","_onEnding","node","_currentNode","execute","onDialogueStart","root","onConversationStart","enterNode","_nextInteraction","makeAvailable","cameraConfiguration","nextNode","endConversation","makeUnavailable","onConversationEnd","playerCameraConfiguration","_hasBeenRead","initializeCameraParameter","registerKeyboardInputs","registerMouseMovementInputs","disableMovement","enableMovement","_onCameraRotationObservable","_onPlayerPressedAKey","_playerCameraConfiguration","_isForwardPressed","_isMovementEnabled","_isBackwardPressed","_isLeftPressed","_isRightPressed","onKeyboardObservable","isGameFocused","onPointerObservable","pointerInfo","movementX","screen","movementY","updateCameraParameter","Submarine","meshCreationPromise","currentLowerBetaLimit","currentUpperBetaLimit","_horizontalCameraSensitivity","_verticalCameraSensitivity","CameraConfiguration","_nodeMaterialPromise","ParseFromFileAsync","nodeMaterial","_nodeMaterial","maxSimultaneousLights","saturationMultiplier","build","getBlockByName","numberOfSteps","luminanceEasingFactor","indexOfRefraction","albedoColor","albedoTexture","texture","opacity","metallic","metallicTexture","roughness","roughnessTexture","emission","emissionColor","emissionTexture","transparencyMode","pbrMaterial","emissiveIntensity","emissiveTexture","needDepthPrePass","cullBackFaces","alphaMode","disableDepthWrite","disableColorWrite","forceDepthWrite","depthFunction","Grappler","updateGrappledObject","object","_currentGrappledObject","_grapplerLength","_owner","submarine","_localOffsetWithSubmarine","positionWithOffset","getObjectCenterWorld","transformNode","grappledObjectPosition","physicsBody","fromGrapplerToObject","distance","pullingDirection","normalizeToNew","scale","applyForce","_pullingForce","_grappler","createMesh","createWaterParticles","owner","_spotLight","createSpotlight","addVolumetricLight","mapLimit","_physicsAggregate","pos","clone","x","z","setLinearVelocity","getLinearVelocity","copyFrom","keysDown","Set","has","KEYUP","delete","grappledObject","ball","grappleObject","letGoOfObject","ImportMeshAsync","result","rootMesh","meshes","childMeshes","getChildMeshes","mat","CartoonShaderMaterial","assignMaterial","configureFromPBRMaterial","mergedMesh","MergeMeshes","friction","restitution","setMotionType","DYNAMIC","inertia","centerOfMass","setLinearDamping","setAngularDamping","getCollisionObservable","receiveShadows","_waveEmitter","particleSystem","particleTexture","emitterMesh","emitter","minEmitBox","maxEmitBox","color1","color2","colorDead","minSize","maxSize","minLifeTime","maxLifeTime","emitRate","blendMode","BLENDMODE_ADD","minEmitPower","maxEmitPower","updateSpeed","direction1","direction2","_waveParticleSystem","spotLight","enabled","camera","lightEmitter","vl","exposure","decay","weight","density","updateRotationSpeed","updateMovementSpeed","updateWaveParticles","isForwardPressed","isBackwardPressed","forward","_movementForce","isRightPressed","isLeftPressed","right","_rotationForce","velocity","isStarted","start","isMoveForwardPressed","isMoveBackwardPressed","isTurnRightPressed","isTurnLeftPressed","_name","_discovered","_detectionZone","detectionZone","onMeshEnter","KeyZone","onAnyKeyZoneEntered","discovered","onMeshExit","onAnyKeyZoneExited","_disabled","zone","World","addMeshToDetect","physicsAggregate","_conversationProviders","debug","_zone","visibility","_meshToDetect","checkAll","intersectsMesh","checkDetection","MeshDetectionZone","startConversation","WorldInteraction","_transformNode","_playerDetectionZone","setSignals","conversation","_startConversationInteraction","StartConversationInteraction","isInZone","isInProgress","CreateCylinder","_text","_nextNode","AbstractDialogueNode","SimpleDialogueNode","current","say","onEnding","QuestUI","_panel","VERTICAL_ALIGNMENT_TOP","paddingTop","spacing","_isDay","refresh","activeQuests","QuestManager","getAllActiveQuests","quest","container","titleText","textHorizontalAlignment","HORIZONTAL_ALIGNMENT_LEFT","stepText","currentStepIndex","description","createSeparator","fadeAnim","ANIMATIONTYPE_FLOAT","ANIMATIONLOOPMODE_CONSTANT","setKeys","frame","animations","beginAnimation","separator","_id","_state","_currentStepIndex","_steps","playQuestSound","validate","condition","_socle","templeBall","currentBall","letGoOfBall","grabBall","placeBall","_ballTransformNode","_placeTempleBallInteraction","PlaceTempleBallInteraction","_removeTempleBallInteraction","RemoveTempleBallInteraction","_socleDetectionZone","SphericalDetectionZone","meshImportedPromise","physicsShape","MESH","_currentBall","_lockConstraint","addConstraint","socle","dispose","_validColor","_grabbableObject","TemplePuzzle","registerBall","onPlacedOnSocle","TempleBall","onAnyBallPlacedOnAnySocle","_physicsShape","SPHERE","cellMaterial","_physicsBody","_grappleInteraction","GrappleInteraction","hasAnObjectGrappled","scaleY","scaleX","show","hide","rec1","label1","rec2","label2","_textBlock","textVerticalAlignment","VERTICAL_ALIGNMENT_CENTER","zIndex","keyzone","left","top","fadeTo","targetAlpha","startAlpha","startTime","performance","now","animate","elapsed","progress","requestAnimationFrame","_mainMenu","createSliderWithLabel","backButton","MainMenuUI","createButton","controlNode","labelText","initialValue","onChange","label","slider","minimum","maximum","thumbWidth","thumbColor","borderColor","valueLabel","round","toString","onValueChangedObservable","imagePath","_imageControl","stretch","STRETCH_UNIFORM","imageControl","fadeObserver","_howToPlay","ImageUI","_optionMenuUI","OptionsMenuUI","playButton","onPlayPressed","optionsButton","onOptionsPressed","howToPlayButton","showHowToPlay","onQuitPressed","optionsMenuUI","_canvas","hideHowToPlay","callback","button","CreateSimpleButton","toLowerCase","textBlock","onPointerEnterObservable","onPointerOutObservable","onPointerUpObservable","stopUI","playUI","requestPointerLock","UIManager","ui","removeControl","createUIs","bind","destroyUIs","hideUIs","showUIs","conversationProviders","_childControls","child","CreateFullscreenUI","WorldInteractionUI","ShowConversationProviderUI","ShowKeyZoneNameUI","JournalUI","_ui","_worldInteractionUI","_showConversationProviderUI","_dialogueInteractionUI","_islandsUI","_mainMenuUI","_optionsMenuUI","_questUI","_journalUI","_slideAnimationUI","SlideAnimationUI","setSlides","slidePanel","spaceLabel","animateBlinkingText","textControl","timestamp","_slides","currentIndex","fadeInPanel","showSlide","onKeyDown","evt","fadeOut","slide","observer","rotation","_upperRightSocle","createSocle","_middleRightSocle","Purple","_lowerRightSocle","Blue","_lowerMiddleSocle","Green","_lowerLeftSocle","Red","_middleLeftSocle","_upperLeftSocle","Gray","_upperMiddleSocle","Yellow","_centerSocle","Forward","_ball","onBallPlacedOnSocle","validColor","Socle","isAllBallPlacedOnASocle","checkConfiguration","onPuzzleResolved","startSlideshow","onPuzzleRejected","numberOfPlaced","socleValidColor","equals","Array","quests","QuestFactory","createTalkToPedro","createTempleQuest","Quest","QuestStep","stopQuest","createAll","nextStep","getQuest","startQuest","find","containerBg","_journalEntry","questBlock","line","entryText","hasBeenOpened","updateCurrentStepStatus","entry","entries","includes","pedro","NPC","loadMesh","CylindricalDetectionZone","diameterTop","diameterBottom","ConversationBuilder","setOnEnding","addEntryToQuest","fox","scientific","scribe","rabbit","steleInteractionZone","_steleInteractionZone","conversationBuilder","_transformIsland","island","_dolphinPosition","disablePreStep","addOnce","NPCFactory","createPedro","addConversationProvider","templeTransform","temple","_templePosition","rotate","WORLD","stele","Stele","aggregate","banquiseTransform","banquise","standardMat","diffuseTexture","_banquisePosition","createFox","callBack","archipelTransform","archipel","_archipelPosition","createRabbit","poulpeTransform","poulpe","_poulpePosition","createScribe","phareTransform","phare","_pharePosition","createGirl","girl","_sea","_submarine","_sky","all","KeyZoneFactory","createDolphinIsland","createTemple","createBanquise","createPhare","createPoulpe","createArchipel","_havok","_engine","enablePhysics","_interactionManager","_camera","_world","updateFocusState","pointerLockElement","runRenderLoop","resize","_uiManager","_isGameFocused","init","_player","_soundManager","_questManager","onGameFocusChange","uiManager","showMainMenu","setup","mounted","getElementById","ShadersRepository","havok","havokPlugin","game","__exports__","components","YellowSubmarine","App","mount","__webpack_module_cache__","__webpack_require__","moduleId","cachedModule","exports","module","__webpack_modules__","deferred","O","chunkIds","fn","priority","notFulfilled","Infinity","fulfilled","j","Object","keys","every","splice","r","d","definition","o","defineProperty","enumerable","g","globalThis","Function","e","obj","prop","prototype","hasOwnProperty","call","Symbol","toStringTag","p","baseURI","self","location","href","installedChunks","chunkId","webpackJsonpCallback","parentChunkLoadingFunction","data","moreModules","runtime","some","chunkLoadingGlobal","__webpack_exports__"],"sourceRoot":""}