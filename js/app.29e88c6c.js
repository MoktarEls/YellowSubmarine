(function(){"use strict";var e={26811:function(e,t,n){var r=n(53751),i=n(20641);function a(e,t,n,r,a,o){var l=(0,i.g2)("YellowSubmarine");return(0,i.uX)(),(0,i.Wv)(l)}function o(e,t,n,r,a,o){return(0,i.uX)(),(0,i.CE)("div",null,t[0]||(t[0]=[(0,i.Lk)("canvas",{id:"mainCanvas"},null,-1)]))}var l=n(31635),s=n(60331),u=function(){function e(){Object.defineProperty(this,"_bodyMesh",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_haloMesh",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_light",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this._bodyMesh=this.createBody(Pe.scene),this._haloMesh=this.createHalo(Pe.scene),this._light=this.createLight(Pe.scene),this.configMaterials(Pe.scene)}return Object.defineProperty(e.prototype,"_defaultPosition",{get:function(){return new s.Pq0(1e3,200,-1e3)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"_diameter",{get:function(){return 40},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"_intensity",{get:function(){return 1},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"_diffuse",{get:function(){return new s.v9j(1,1,1)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"_specular",{get:function(){return new s.v9j(1,1,1)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"_emissiveColor",{get:function(){return new s.v9j(1,1,1)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"createBody",{enumerable:!1,configurable:!0,writable:!0,value:function(e){var t=s.PeD.CreateSphere("celestialBody",{diameter:this._diameter,segments:32},e);return t.infiniteDistance=!0,t.isPickable=!1,t.position=this._defaultPosition,t}}),Object.defineProperty(e.prototype,"createHalo",{enumerable:!1,configurable:!0,writable:!0,value:function(e){var t=s.PeD.CreateSphere("halo",{diameter:1.05*this._diameter,segments:32},e);return t.infiniteDistance=!0,t.isPickable=!1,t.position=this._defaultPosition,t}}),Object.defineProperty(e.prototype,"createLight",{enumerable:!1,configurable:!0,writable:!0,value:function(e){var t=new s.Pq0(0,0,0);e.activeCamera&&(t=this._bodyMesh.position.subtract(e.activeCamera.position).normalize());var n=new s.ZyN("sunLight",t.negate(),e);n.intensity=this._intensity,n.shadowEnabled=!0,n.parent=this._bodyMesh,n.diffuse=this._diffuse,n.specular=this._specular;var r=new s.VA("",e);return r.intensity=.3,n}}),Object.defineProperty(e.prototype,"configMaterials",{enumerable:!1,configurable:!0,writable:!0,value:function(e){var t=new s.FUi("bodyMat",e);t.emissiveColor=this._emissiveColor,t.diffuseColor=this._diffuse,t.specularColor=this._specular,this._bodyMesh.material=t;var n=new s.FUi("haloMat",e);n.emissiveColor=this._emissiveColor,n.diffuseColor=this._diffuse,n.specularColor=this._specular,n.alpha=.5,this._haloMesh.material=n}}),Object.defineProperty(e.prototype,"bodyMesh",{get:function(){return this._bodyMesh},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"haloMesh",{get:function(){return this._haloMesh},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"light",{get:function(){return this._light},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"position",{get:function(){return this.bodyMesh.position},set:function(e){this._bodyMesh.position=e,this._haloMesh.position=e,this.light.position=e},enumerable:!1,configurable:!0}),e}(),c=function(e){function t(){var t=e.call(this)||this;return Object.defineProperty(t,"_hemiLight",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(t,"shadowGenerator",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),t._hemiLight=t.createHemiLight(Pe.scene),t.configMaterials(Pe.scene),t._hemiLight.direction=s.Pq0.Up(),t._hemiLight.isEnabled(!1),t.shadowGenerator=new s.owA(1024,t.light),t.shadowGenerator.useBlurExponentialShadowMap=!0,t.shadowGenerator.blurKernel=16,t.light.shadowEnabled=!0,Pe.scene.onBeforeRenderObservable.add((function(){if(Pe.scene.activeCamera){var e=t._bodyMesh.absolutePosition.subtract(s.Pq0.Zero()).normalize();t.light.direction=e.negate()}})),t}return(0,l.C6)(t,e),Object.defineProperty(t.prototype,"hemiLight",{get:function(){return this._hemiLight},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"hemiLightIntensity",{get:function(){return this._hemiLight.intensity},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"_emissiveColor",{get:function(){return new s.v9j(1,1,1)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"getPosition",{enumerable:!1,configurable:!0,writable:!0,value:function(){return this._bodyMesh.position}}),Object.defineProperty(t.prototype,"_direction",{get:function(){return Pe.scene.activeCamera&&(this.light.direction=this._bodyMesh.absolutePosition.subtract(s.Pq0.Zero()).normalize(),this._hemiLight.direction=this._bodyMesh.position.subtract(Pe.scene.activeCamera.position).normalize()),this.light.direction},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"createHemiLight",{enumerable:!1,configurable:!0,writable:!0,value:function(e){var t=new s.g4z("hemisphericLight",s.Pq0.Up(),e);return t.intensity=2,t.diffuse=this._diffuse,t.shadowEnabled=!1,t.parent=this._bodyMesh,t}}),t}(u),b=function(e){function t(){return e.call(this)||this}return(0,l.C6)(t,e),Object.defineProperty(t.prototype,"_defaultPosition",{get:function(){return new s.Pq0(1e3,200,-1e3)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"_diameter",{get:function(){return 40},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"_intensity",{get:function(){return 5},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"hemiLightIntensity",{get:function(){return 2},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"_diffuse",{get:function(){return new s.v9j(1,1,1)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"_specular",{get:function(){return new s.v9j(1,1,1)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"_emissiveColor",{get:function(){return new s.v9j(1,1,1)},enumerable:!1,configurable:!0}),t}(c),f=function(e){function t(){return e.call(this)||this}return(0,l.C6)(t,e),Object.defineProperty(t.prototype,"_defaultPosition",{get:function(){return new s.Pq0(1e3,200,1e3)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"_diameter",{get:function(){return 40},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"_intensity",{get:function(){return 2},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"hemiLightIntensity",{get:function(){return 1},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"_diffuse",{get:function(){return new s.v9j(1,1,1)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"_specular",{get:function(){return new s.v9j(1,1,1)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"_emissiveColor",{get:function(){return new s.v9j(1,1,1)},enumerable:!1,configurable:!0}),t}(c),d=function(){function e(){var t=this;Object.defineProperty(this,"_daySkyboxTexture",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_nightSkyboxTexture",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_shaderMaterial",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_mesh",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),e._instance=this,this._mesh=s.PeD.CreateBox("skyBox",{size:1e4},Pe.scene),this._mesh.infiniteDistance=!0,this._mesh.isPickable=!1,this._shaderMaterial=new s.BKk("skyboxMaterial",Pe.scene,{vertex:"skyboxShader",fragment:"skyboxShader"},{attributes:["position","uv"],uniforms:["worldViewProjection","timeOfTheDay"],samplers:["daySkyboxTexture","nightSkyboxTexture"]}),Pe.scene.onBeforeRenderObservable.add((function(){t._shaderMaterial.setFloat("timeOfTheDay",p.instance.dayNightCycle.timeOfTheDay)})),this._daySkyboxTexture=s.b4q.CreateFromImages(["/textures/skybox/alternate day/px.png","/textures/skybox/alternate day/pz.png","/textures/skybox/alternate day/py.png","/textures/skybox/alternate day/nx.png","/textures/skybox/alternate day/nz.png","/textures/skybox/alternate day/ny.png"],Pe.scene),this._daySkyboxTexture.coordinatesMode=s.gPd.SKYBOX_MODE,this._nightSkyboxTexture=s.b4q.CreateFromImages(["/textures/skybox/alternate night/px.png","/textures/skybox/alternate night/pz.png","/textures/skybox/alternate night/py.png","/textures/skybox/alternate night/nx.png","/textures/skybox/alternate night/nz.png","/textures/skybox/alternate night/ny.png"],Pe.scene),this._nightSkyboxTexture.coordinatesMode=s.gPd.SKYBOX_MODE,this._shaderMaterial.setTexture("daySkyboxTexture",this._daySkyboxTexture),this._shaderMaterial.setTexture("nightSkyboxTexture",this._nightSkyboxTexture),this._shaderMaterial.backFaceCulling=!1,this._mesh.material=this._shaderMaterial}return Object.defineProperty(e,"instance",{get:function(){return this._instance},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"mesh",{get:function(){return this._mesh},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"initColors",{enumerable:!1,configurable:!0,writable:!0,value:function(e){e.setColor3("dayTop",new s.v9j(.3,.78,.98)),e.setColor3("dayBottom",new s.v9j(1,.94,.8)),e.setColor3("sunsetTop",new s.v9j(1,.69,.4)),e.setColor3("sunsetBottom",new s.v9j(.58,.55,.82)),e.setColor3("dawnTop",new s.v9j(.65,.8,1)),e.setColor3("dawnBottom",new s.v9j(1,.69,.4)),e.setColor3("nightTop",new s.v9j(.043,.106,.212)),e.setColor3("nightBottom",new s.v9j(.23,.29,.42))}}),e}(),h=function(){function e(e){var t=this;Object.defineProperty(this,"_sun",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_moon",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_time",{enumerable:!0,configurable:!0,writable:!0,value:0}),this._sun=e.sun,this._moon=e.moon,Pe.scene.onBeforeRenderObservable.add((function(){t._time+=1e-5*Pe.engine.getDeltaTime(),t._time>1&&(t._time-=1),t.updateBody(t._time),t.updateLight(),t.updateMoonLight()}))}return Object.defineProperty(e.prototype,"timeOfTheDay",{get:function(){return this._time},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"updateBody",{enumerable:!1,configurable:!0,writable:!0,value:function(e){var t=2*e*Math.PI,n=2*e*Math.PI/1.5+Math.PI,r=this._sun._defaultPosition.length(),i=this._moon._defaultPosition.length(),a=Math.PI/6,o=r*Math.cos(t),l=r*Math.sin(t)*Math.sin(a),u=r*Math.sin(t)*Math.cos(a),c=Math.PI/8,b=i*Math.cos(n),f=i*Math.sin(n)*Math.sin(c),d=i*Math.sin(n)*Math.cos(c);this._sun.position=new s.Pq0(o,l,u),this._moon.position=new s.Pq0(b,f,d)}}),Object.defineProperty(e.prototype,"updateLight",{enumerable:!1,configurable:!0,writable:!0,value:function(){var e=this._sun.position,t=this._sun._defaultPosition.length(),n=e.y,r=Math.max(0,Math.min(n/t,1)),i=Math.pow(r,1.5);if(this._sun.light.intensity=i*this._sun._intensity,r<=.01?this._sun.light.setEnabled(!1):this._sun.light.setEnabled(!0),i>0&&i<.3){var a=s.v9j.FromHexString("#ff884d");this._sun.light.diffuse=s.v9j.Lerp(a,s.v9j.White(),i/.3)}else this._sun.light.diffuse=s.v9j.White();var o=this._sun.hemiLight;if(o){var l=s.v9j.FromHexString("#b6e8ff"),u=s.v9j.FromHexString("#1a1a2e");o.diffuse=s.v9j.Lerp(u,l,i)}Pe.scene.ambientColor=new s.v9j(1,0,0)}}),Object.defineProperty(e.prototype,"updateMoonLight",{enumerable:!1,configurable:!0,writable:!0,value:function(){var e=this._moon.position,t=this._moon._defaultPosition.length(),n=e.y,r=Math.max(0,Math.min(n/t,1)),i=Math.pow(r,1.5);this._moon.light&&(this._moon.light.intensity=i*this._moon._intensity,r<=.01?this._moon.light.setEnabled(!1):this._moon.light.setEnabled(!0));var a=this._moon.hemiLight;if(a){var o=s.v9j.FromHexString("#818de3"),l=s.v9j.FromHexString("#1a1a2e");a.diffuse=s.v9j.Lerp(l,o,i),a.intensity=.1+.3*i}}}),e}(),p=function(){function e(){Object.defineProperty(this,"_sun",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_moon",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_skybox",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_dayNightCycle",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),e._instance=this,this._sun=new b,this._moon=new f,this._skybox=new d,this._dayNightCycle=new h(this)}return Object.defineProperty(e,"instance",{get:function(){return this._instance},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"sun",{get:function(){return this._sun},set:function(e){this._sun=e},enumerable:!1,configurable:!0}),Object.defineProperty(e,"sun",{get:function(){return this._instance._sun},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"skybox",{get:function(){return this._skybox},set:function(e){this._skybox=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"moon",{get:function(){return this._moon},set:function(e){this._moon=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"dayNightCycle",{get:function(){return this._dayNightCycle},enumerable:!1,configurable:!0}),e}(),m=function(){function e(){var t=this;Object.defineProperty(this,"_scene",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_material",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_depthRenderer",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_depthMap",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_geometryBufferRenderer",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_gBuffer",{enumerable:!0,configurable:!0,writable:!0,value:null}),Object.defineProperty(this,"_renderListPredicate",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),e._instance=this,this._scene=Pe.scene;this._scene.activeCamera;this._material=new s.BKk("toonWaterMaterial",this._scene,{vertex:this.shaderMaterialName,fragment:this.shaderMaterialName},{attributes:["position","normal","uv"],uniforms:["world","view","projection","depthShallowColor","depthDeepColor","depthMaximumDistance","surfaceNoiseST","surfaceNoiseCutoff","foamMaxDistance","foamMinDistance","surfaceNoiseScroll","time","surfaceDistortionST","surfaceDistortionAmount","screensize","timeOfTheDay"],samplers:["linearDepthTexture","surfaceNoiseTexture","surfaceDistortionTexture","reflectionTexture"],needAlphaTesting:!0}),this._depthRenderer=this._scene.enableDepthRenderer(void 0,!1,void 0,void 0,!0),this._depthMap=this._depthRenderer.getDepthMap(),this._renderListPredicate=function(e){return e.material!==t._material},this._depthMap.renderListPredicate=this._renderListPredicate,this._material.setVector4("depthShallowColor",new s.IUQ(.325,.807,.971,.725)),this._material.setVector4("depthDeepColor",new s.IUQ(.086,.407,1,.749)),this._material.setFloat("depthMaximumDistance",10),this._material.setTexture("linearDepthTexture",this._depthMap),this._material.setVector4("surfaceNoiseST",new s.IUQ(1,4,0,0)),this._material.setTexture("surfaceNoiseTexture",new s.gPd("/textures/PerlinNoise.png")),this._material.setFloat("surfaceNoiseCutoff",.85),this._material.setFloat("foamMaxDistance",.6),this._material.setFloat("foamMinDistance",.04),this._material.setVector2("surfaceNoiseScroll",new s.I9Y(.03,.03)),this._material.setVector4("surfaceDistortionST",new s.IUQ(1,1,0,0)),this._material.setFloat("surfaceDistortionAmount",.27),this._material.setTexture("surfaceDistortionTexture",new s.gPd("/textures/WaterDistortion.png")),Pe.scene.onBeforeRenderObservable.add((function(){t._material.setFloat("timeOfTheDay",p.instance.dayNightCycle.timeOfTheDay)})),this._material.setVector2("screensize",new s.I9Y(window.innerWidth,window.innerHeight)),window.addEventListener("resize",(function(){return t._material.setVector2("screensize",new s.I9Y(window.innerWidth,window.innerHeight))}));var n=new s.B2G("mirrorTexture",1024,Pe.scene);if(n.mirrorPlane=s.Zcv.FromPositionAndNormal(s.Pq0.Zero(),s.Pq0.Down()),n.renderListPredicate=function(e){return!0},this._material.setTexture("reflectionTexture",n),Pe.scene.customRenderTargets.push(n),this._geometryBufferRenderer=this._scene.enableGeometryBufferRenderer(),null!=this._geometryBufferRenderer){this._geometryBufferRenderer.enableNormal,this._gBuffer=this._geometryBufferRenderer.getGBuffer(),this._gBuffer.renderListPredicate=this._renderListPredicate;var r=this._gBuffer.textures[s.IzI.NORMAL_TEXTURE_TYPE];this._material.setTexture("cameraNormalTexture",r)}var i=0;Pe.scene.onBeforeRenderObservable.add((function(){i+=Pe.engine.getDeltaTime()/1e3*.01,t._material.setFloat("time",i)}))}return Object.defineProperty(e,"instance",{get:function(){return null==this._instance&&(this._instance=new this),this._instance},enumerable:!1,configurable:!0}),Object.defineProperty(e,"material",{get:function(){return this.instance._material},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"shaderMaterialName",{get:function(){return"toonWaterAndReflections"},enumerable:!1,configurable:!0}),e}(),g=function(){function e(){Object.defineProperty(this,"_seaMesh",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_invisiblePlane",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_invisiblePlaneBody",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_invisiblePlaneShape",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),e._instance=this,this._seaMesh=s.PeD.CreateGround("waterPlane",{width:2048,height:2048,subdivisions:128},Pe.scene),this._invisiblePlane=s.PeD.CreateGround("collisionPlane",{width:2048,height:2048,subdivisions:128},Pe.scene),this._invisiblePlane.position=new s.Pq0(0,-2,0),this._invisiblePlaneBody=new s.aZl(this._invisiblePlane,s.AHY.STATIC,!1,Pe.scene),this._invisiblePlaneShape=new s.JNI({type:s.DKo.BOX,parameters:{mesh:this._invisiblePlane,extents:new s.Pq0(2048,2,2048)}},Pe.scene),this._invisiblePlaneBody.shape=this._invisiblePlaneShape,this._invisiblePlaneBody.setMassProperties({mass:0}),this._seaMesh.material=m.material}return e}(),v=(n(1389),n(84867)),y=function(){function e(){var t=this;Object.defineProperty(this,"_cameraConfiguration",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_arcRotateCamera",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_positionLerpFactor",{enumerable:!0,configurable:!0,writable:!0,value:2}),Object.defineProperty(this,"_rotationLerpFactor",{enumerable:!0,configurable:!0,writable:!0,value:2}),e._instance=this,this._arcRotateCamera=new s.Lqh("customCamera",0,0,0,s.Pq0.Zero(),Pe.scene),Pe.scene.onBeforeRenderObservable.add((function(){var e=Pe.engine.getDeltaTime()/1e3;t.update(e)}))}return Object.defineProperty(e,"instance",{get:function(){return this._instance},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"cameraConfiguration",{get:function(){return this._cameraConfiguration},set:function(e){var t=this._cameraConfiguration;this._cameraConfiguration=e,t||this.jumpToTarget()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"update",{enumerable:!1,configurable:!0,writable:!0,value:function(e){this.updatePosition(e),this.updateRotation(e)}}),Object.defineProperty(e.prototype,"jumpToTarget",{enumerable:!1,configurable:!0,writable:!0,value:function(){this._cameraConfiguration&&(this._arcRotateCamera.target=this._cameraConfiguration.targetPosition,this._arcRotateCamera.alpha=this._cameraConfiguration.wantedAlpha,this._arcRotateCamera.beta=this._cameraConfiguration.wantedBeta,this._arcRotateCamera.radius=this._cameraConfiguration.distanceFromTarget)}}),Object.defineProperty(e.prototype,"updatePosition",{enumerable:!1,configurable:!0,writable:!0,value:function(e){if(this._cameraConfiguration){var t=this._cameraConfiguration.target;t&&(this._arcRotateCamera.target=s.Pq0.Lerp(this._arcRotateCamera.target,this._cameraConfiguration.targetPosition,e*this._positionLerpFactor)),this._arcRotateCamera.radius=(0,v.Lerp)(this._arcRotateCamera.radius,this._cameraConfiguration.distanceFromTarget,e*this._positionLerpFactor),this._arcRotateCamera.lowerRadiusLimit=this._arcRotateCamera.radius,this._arcRotateCamera.upperRadiusLimit=this._arcRotateCamera.radius}}}),Object.defineProperty(e.prototype,"updateRotation",{enumerable:!1,configurable:!0,writable:!0,value:function(e){if(this._cameraConfiguration){var t=this._cameraConfiguration.wantedAlpha,n=this._cameraConfiguration.wantedBeta;this._arcRotateCamera.alpha=s.uMQ.FromDegrees(s.X5X.LerpAngle(s.uMQ.FromRadians(this._arcRotateCamera.alpha).degrees(),s.uMQ.FromRadians(t).degrees(),e*this._rotationLerpFactor)).radians(),this._arcRotateCamera.beta=s.uMQ.FromDegrees(s.X5X.LerpAngle(s.uMQ.FromRadians(this._arcRotateCamera.beta).degrees(),s.uMQ.FromRadians(n).degrees(),e*this._rotationLerpFactor)).radians()}}}),e}(),_=function(){function e(){Object.defineProperty(this,"_offset",{enumerable:!0,configurable:!0,writable:!0,value:s.Pq0.Zero()}),Object.defineProperty(this,"_wantedAlpha",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"_wantedBeta",{enumerable:!0,configurable:!0,writable:!0,value:s.uMQ.FromDegrees(80).radians()}),Object.defineProperty(this,"_distanceFromTarget",{enumerable:!0,configurable:!0,writable:!0,value:10}),Object.defineProperty(this,"_target",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_currentLowerBetaLimit",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_currentUpperBetaLimit",{enumerable:!0,configurable:!0,writable:!0,value:void 0})}return Object.defineProperty(e.prototype,"targetPosition",{get:function(){var e,t,n,r;return(null!==(t=null===(e=this._target)||void 0===e?void 0:e.absolutePosition)&&void 0!==t?t:s.Pq0.Zero()).add(this._offset.rotateByQuaternionToRef(null!==(r=null===(n=this._target)||void 0===n?void 0:n.absoluteRotationQuaternion)&&void 0!==r?r:s.PTz.Identity(),s.Pq0.Zero()))},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"offset",{get:function(){return this._offset},set:function(e){this._offset=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"wantedAlpha",{get:function(){return this._wantedAlpha},set:function(e){this._wantedAlpha=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"wantedBeta",{get:function(){return this._wantedBeta},set:function(e){this._wantedBeta=e,this._currentLowerBetaLimit&&(this._wantedBeta=Math.max(this._wantedBeta,this._currentLowerBetaLimit)),this._currentUpperBetaLimit&&(this._wantedBeta=Math.min(this._wantedBeta,this._currentUpperBetaLimit))},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"distanceFromTarget",{get:function(){return this._distanceFromTarget},set:function(e){this._distanceFromTarget=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"target",{get:function(){return this._target},set:function(e){this._target=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"currentUpperBetaLimit",{get:function(){return this._currentUpperBetaLimit},set:function(e){this._currentUpperBetaLimit=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"currentLowerBetaLimit",{get:function(){return this._currentLowerBetaLimit},set:function(e){this._currentLowerBetaLimit=e},enumerable:!1,configurable:!0}),e}(),P=function(){function e(){var t=this;Object.defineProperty(this,"_currentInteraction",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"onInteractionAvailable",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"onInteractionUnavailable",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),e._instance=this,this.onInteractionAvailable=new s.cPK,this.onInteractionUnavailable=new s.cPK,D.onPlayerPressedAKey.add((function(e){e.type===s.TBB.KEYDOWN&&t._currentInteraction&&e.event.code===t._currentInteraction.code&&t.executeInteraction()}))}return Object.defineProperty(e,"instance",{get:function(){return this._instance},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"makeInteractionAvailable",{enumerable:!1,configurable:!0,writable:!0,value:function(e){this._currentInteraction&&this.makeInteractionUnavailable(this._currentInteraction),this._currentInteraction=e,this.onInteractionAvailable.notifyObservers(e)}}),Object.defineProperty(e.prototype,"makeInteractionUnavailable",{enumerable:!1,configurable:!0,writable:!0,value:function(e){this._currentInteraction=void 0,this.onInteractionUnavailable.notifyObservers(e)}}),Object.defineProperty(e.prototype,"executeInteraction",{enumerable:!1,configurable:!0,writable:!0,value:function(){var e=this._currentInteraction;e&&e.executeInteraction()}}),e}(),w=function(){function e(e,t){Object.defineProperty(this,"_code",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_simplifiedCode",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this._code=e,this._simplifiedCode=t}return Object.defineProperty(e.prototype,"code",{get:function(){return this._code},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"simplifiedCode",{get:function(){return this._simplifiedCode},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"makeAvailable",{enumerable:!1,configurable:!0,writable:!0,value:function(){P.instance.makeInteractionAvailable(this)}}),Object.defineProperty(e.prototype,"makeUnavailable",{enumerable:!1,configurable:!0,writable:!0,value:function(){P.instance.makeInteractionUnavailable(this)}}),e}(),O=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return(0,l.C6)(t,e),t}(w),j=function(){function e(){}return e}(),C=n(4037),M=function(){function e(){}return Object.defineProperty(e,"loadMesh",{enumerable:!1,configurable:!0,writable:!0,value:function(e,t,n){return(0,s.TkY)(e,null!==t&&void 0!==t?t:Pe.scene,n)}}),Object.defineProperty(e,"sleep",{enumerable:!1,configurable:!0,writable:!0,value:function(e){return new Promise((function(t){return setTimeout(t,e)}))}}),e}(),T=function(){function e(e){Object.defineProperty(this,"param",{enumerable:!0,configurable:!0,writable:!0,value:e})}return Object.defineProperty(e.prototype,"onClose",{enumerable:!1,configurable:!0,writable:!0,value:function(e){return e}}),e}(),x=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return(0,l.C6)(t,e),Object.defineProperty(t.prototype,"onOpen",{enumerable:!1,configurable:!0,writable:!0,value:function(e){return(0,l.Cl)((0,l.Cl)({},e),{italic:!0})}}),t}(T),I=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return(0,l.C6)(t,e),Object.defineProperty(t.prototype,"onOpen",{enumerable:!1,configurable:!0,writable:!0,value:function(e){return(0,l.Cl)((0,l.Cl)({},e),{bold:!0})}}),t}(T),A=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return(0,l.C6)(t,e),Object.defineProperty(t.prototype,"onOpen",{enumerable:!1,configurable:!0,writable:!0,value:function(e){return(0,l.Cl)((0,l.Cl)({},e),{color:this.param||e.color})}}),t}(T),E=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return(0,l.C6)(t,e),Object.defineProperty(t.prototype,"onOpen",{enumerable:!1,configurable:!0,writable:!0,value:function(e){var t=(0,l.Cl)({},e),n=parseInt(this.param||"");return isNaN(n)||(t.size=n),t}}),t}(T),N=function(){function e(){Object.defineProperty(this,"_registry",{enumerable:!0,configurable:!0,writable:!0,value:new Map}),this.initRegistry()}return Object.defineProperty(e.prototype,"initRegistry",{enumerable:!1,configurable:!0,writable:!0,value:function(){this._registry.set("i",x),this._registry.set("g",I),this._registry.set("c",A),this._registry.set("s",E)}}),Object.defineProperty(e.prototype,"parseBBCode",{enumerable:!1,configurable:!0,writable:!0,value:function(e){var t,n=[],r=[],i=[],a=0,o={},s=/\[\/?([a-z]+)(?:=([^\]]+))?\]/gi;while(t=s.exec(e)){var u=t[0],c=t[1],b=t[2],f=u.startsWith("[/"),d=t.index;if(d>a&&n.push({text:e.slice(a,d),style:(0,l.Cl)({},o)}),a=d+u.length,f){var h=r.pop(),p=i.pop();h&&p&&(o=p)}else{var m=this._registry.get(c);if(m){var g=new m(b);r.push(g),i.push((0,l.Cl)({},o)),o=g.onOpen(o)}}}return a<e.length&&n.push({text:e.slice(a),style:(0,l.Cl)({},o)}),n}}),e}(),S=function(){function e(e,t,n){void 0===t&&(t=24),void 0===n&&(n=4),Object.defineProperty(this,"parser",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"ctx",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"defaultFontSize",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"horizontalPadding",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.parser=new N,this.ctx=e,this.defaultFontSize=t,this.horizontalPadding=n}return Object.defineProperty(e.prototype,"layout",{enumerable:!1,configurable:!0,writable:!0,value:function(e,t){var n=this.parser.parseBBCode(e).map((function(e){return{text:e.text,style:e.style}})),r=this.splitLines(n,t);return{lines:r,segments:n}}}),Object.defineProperty(e.prototype,"getTextWidth",{enumerable:!1,configurable:!0,writable:!0,value:function(e,t){return this.ctx.font="".concat(t,"px sans-serif"),this.ctx.measureText(e).width}}),Object.defineProperty(e.prototype,"splitLines",{enumerable:!1,configurable:!0,writable:!0,value:function(e,t){for(var n=[],r=[],i=0,a=0,o=e;a<o.length;a++){var l=o[a],s=l.style.size||this.defaultFontSize,u=this.getTextWidth(l.text,s)+2*this.horizontalPadding;if(i+u<=t)r.push(l),i+=u;else for(var c=l.text.split(/(\s+)/),b=0,f=c;b<f.length;b++){var d=f[b];if(""!==d&&(""!==d.trim()||0!==r.length)){var h=this.getTextWidth(d,s)+2*this.horizontalPadding;i+h>t&&r.length&&(n.push(r),r=[],i=0,""===d.trim())||(r.push({text:d,style:l.style}),i+=h)}}}return r.length&&n.push(r),n}}),Object.defineProperty(e.prototype,"createTextBlocks",{enumerable:!1,configurable:!0,writable:!0,value:function(e,t,n,r){var i=this,a=[],o=[];return e.forEach((function(e){var l=new C.Pc;l.isVertical=!1,l.height="".concat(t,"px"),l.horizontalAlignment=C.Ec.HORIZONTAL_ALIGNMENT_CENTER,l.verticalAlignment=C.Ec.VERTICAL_ALIGNMENT_BOTTOM,e.forEach((function(e){var t=new C.VJ;t.text="",i.applyStyle(t,e.style,n,r),t.textWrapping=!1,t.resizeToFit=!0,t.verticalAlignment=C.Ec.VERTICAL_ALIGNMENT_BOTTOM,l.addControl(t),a.push({tb:t,full:e.text})})),o.push(l)})),{linesPanels:o,blocks:a}}}),Object.defineProperty(e.prototype,"applyStyle",{enumerable:!1,configurable:!0,writable:!0,value:function(e,t,n,r){e.fontWeight=t.bold?"bold":"normal",e.fontStyle=t.italic?"italic":"normal",e.color=t.color||"black",e.fontSize=t.size||r,e.paddingLeft="".concat(n,"px"),e.paddingRight="".concat(n,"px")}}),e}(),B=function(){function e(){Object.defineProperty(this,"_advanceRequested",{enumerable:!0,configurable:!0,writable:!0,value:!1})}return Object.defineProperty(e.prototype,"advanceRequested",{get:function(){return this._advanceRequested},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"requestAdvance",{enumerable:!1,configurable:!0,writable:!0,value:function(){this._advanceRequested=!0}}),Object.defineProperty(e.prototype,"resetAdvance",{enumerable:!1,configurable:!0,writable:!0,value:function(){this._advanceRequested=!1}}),Object.defineProperty(e.prototype,"animateBlocks",{enumerable:!1,configurable:!0,writable:!0,value:function(e,t){return(0,l.sH)(this,void 0,void 0,(function(){var n,r,i,a,o,s,u;return(0,l.YH)(this,(function(l){switch(l.label){case 0:n=!1,r=0,i=e,l.label=1;case 1:if(!(r<i.length))return[3,7];a=i[r],o=a.tb,s=a.full,u=1,l.label=2;case 2:return u<=s.length?(o.text=s.slice(0,u),this._advanceRequested?(n=!0,[3,5]):[4,M.sleep(t)]):[3,5];case 3:l.sent(),l.label=4;case 4:return u++,[3,2];case 5:if(n)return[3,7];l.label=6;case 6:return r++,[3,1];case 7:return[2]}}))}))}}),e}(),R=function(e){function t(){var t=e.call(this)||this;return Object.defineProperty(t,"CONTAINER_WIDTH",{enumerable:!0,configurable:!0,writable:!0,value:.4}),Object.defineProperty(t,"CONTAINER_CORNER_RADIUS",{enumerable:!0,configurable:!0,writable:!0,value:10}),Object.defineProperty(t,"CONTAINER_THICKNESS",{enumerable:!0,configurable:!0,writable:!0,value:5}),Object.defineProperty(t,"CONTAINER_COLOR",{enumerable:!0,configurable:!0,writable:!0,value:"rgb(168, 98, 68)"}),Object.defineProperty(t,"CONTAINER_BACKGROUND",{enumerable:!0,configurable:!0,writable:!0,value:"rgb(255, 199, 130)"}),Object.defineProperty(t,"CONTAINER_OFFSET_Y",{enumerable:!0,configurable:!0,writable:!0,value:-200}),Object.defineProperty(t,"TEXT_PADDING",{enumerable:!0,configurable:!0,writable:!0,value:8}),Object.defineProperty(t,"TEXT_BLOCK_HORIZONTAL_PADDING",{enumerable:!0,configurable:!0,writable:!0,value:2}),Object.defineProperty(t,"TEXT_DEFAULT_FONT_SIZE",{enumerable:!0,configurable:!0,writable:!0,value:24}),Object.defineProperty(t,"TEXT_LINE_SPACING",{enumerable:!0,configurable:!0,writable:!0,value:8}),Object.defineProperty(t,"TEXT_EXTRA_CONTAINER_MARGIN",{enumerable:!0,configurable:!0,writable:!0,value:20}),Object.defineProperty(t,"TEXT_SPEED",{enumerable:!0,configurable:!0,writable:!0,value:20}),Object.defineProperty(t,"TRIANGLE_IMAGE_PATH",{enumerable:!0,configurable:!0,writable:!0,value:"ui/triangle.png"}),Object.defineProperty(t,"TRIANGLE_SIZE",{enumerable:!0,configurable:!0,writable:!0,value:"24px"}),Object.defineProperty(t,"TRIANGLE_BLINK_INTERVAL",{enumerable:!0,configurable:!0,writable:!0,value:300}),Object.defineProperty(t,"_container",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(t,"_verticalStack",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(t,"_triangle",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(t,"_layoutManager",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(t,"_textAnimator",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),t.initContainer(),t.initStack(),t.initTriangle(),t._layoutManager=new S(function(){var e=document.createElement("canvas");return e.getContext("2d")}(),t.TEXT_DEFAULT_FONT_SIZE,t.TEXT_BLOCK_HORIZONTAL_PADDING),t._textAnimator=new B,F.onAnyConversationStart.add((function(e){var n;t._container.isVisible=!0,(null===(n=e.conversationProvider)||void 0===n?void 0:n.mesh)&&(t._container.linkWithMesh(e.conversationProvider.mesh),t._container.linkOffsetY=t.CONTAINER_OFFSET_Y)})),F.onAnyConversationEnd.add((function(){t._stopBlink(),t._container.isVisible=!1})),F.onAnyDialogueStart.add((function(e){return t.showText(e.text,t.TEXT_SPEED)})),t}return(0,l.C6)(t,e),Object.defineProperty(t.prototype,"controlNode",{get:function(){return this._container},enumerable:!1,configurable:!0}),Object.defineProperty(t,"isTextFullyDisplayed",{get:function(){return this._isTextFullyDisplayed},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"initContainer",{enumerable:!1,configurable:!0,writable:!0,value:function(){this._container=new C.tN,this._container.width="".concat(100*this.CONTAINER_WIDTH,"%"),this._container.cornerRadius=this.CONTAINER_CORNER_RADIUS,this._container.thickness=this.CONTAINER_THICKNESS,this._container.color=this.CONTAINER_COLOR,this._container.background=this.CONTAINER_BACKGROUND,this._container.verticalAlignment=C.Ec.VERTICAL_ALIGNMENT_BOTTOM,this._container.horizontalAlignment=C.Ec.HORIZONTAL_ALIGNMENT_CENTER,this._container.isVisible=!1,this._container.paddingLeft="".concat(this.TEXT_PADDING,"px"),this._container.paddingRight="".concat(this.TEXT_PADDING,"px")}}),Object.defineProperty(t.prototype,"initStack",{enumerable:!1,configurable:!0,writable:!0,value:function(){this._verticalStack=new C.Pc,this._verticalStack.isVertical=!0,this._verticalStack.width="100%",this._verticalStack.paddingBottom="5px",this._container.addControl(this._verticalStack)}}),Object.defineProperty(t.prototype,"initTriangle",{enumerable:!1,configurable:!0,writable:!0,value:function(){this._triangle=new C._V("nextTriangle",this.TRIANGLE_IMAGE_PATH),this._triangle.width=this.TRIANGLE_SIZE,this._triangle.height=this.TRIANGLE_SIZE,this._triangle.verticalAlignment=C.Ec.VERTICAL_ALIGNMENT_BOTTOM,this._triangle.horizontalAlignment=C.Ec.HORIZONTAL_ALIGNMENT_RIGHT,this._triangle.isVisible=!1,this._container.addControl(this._triangle)}}),Object.defineProperty(t.prototype,"showText",{enumerable:!1,configurable:!0,writable:!0,value:function(e,n){return(0,l.sH)(this,void 0,void 0,(function(){var r,i,a,o,s,u,c,b,f,d,h,p,m,g,v=this;return(0,l.YH)(this,(function(l){switch(l.label){case 0:return t._isTextFullyDisplayed=!1,this._stopBlink(),this._textAnimator.resetAdvance(),this._verticalStack.clearControls(),r=F.onAdvanceDialogueRequested.add((function(){v._textAnimator.requestAdvance()})),i=document.querySelector("canvas").clientWidth,a=i*this.CONTAINER_WIDTH,o=a-2*this.TEXT_PADDING-2*this.TEXT_BLOCK_HORIZONTAL_PADDING,s=this._layoutManager.layout(e,o),u=s.lines,c=s.segments,b=Math.max.apply(Math,c.map((function(e){return e.style.size||v.TEXT_DEFAULT_FONT_SIZE}))),f=1.2*b+this.TEXT_LINE_SPACING,d=this._layoutManager.createTextBlocks(u,f,this.TEXT_BLOCK_HORIZONTAL_PADDING,this.TEXT_DEFAULT_FONT_SIZE),h=d.linesPanels,p=d.blocks,h.forEach((function(e){v._verticalStack.addControl(e)})),m=u.length*f,g=m+2*this.TEXT_PADDING+this.TEXT_EXTRA_CONTAINER_MARGIN,this._container.height="".concat(g,"px"),[4,this._textAnimator.animateBlocks(p,n)];case 1:return l.sent(),this._textAnimator.advanceRequested&&p.forEach((function(e){return e.tb.text=e.full})),t._isTextFullyDisplayed=!0,F.onAdvanceDialogueRequested.remove(r),[4,this._startBlink()];case 2:return l.sent(),[2]}}))}))}}),Object.defineProperty(t.prototype,"_startBlink",{enumerable:!1,configurable:!0,writable:!0,value:function(){return(0,l.sH)(this,void 0,void 0,(function(){return(0,l.YH)(this,(function(e){switch(e.label){case 0:if(!t._isTextFullyDisplayed)return[2];this._triangle.isVisible=!0,e.label=1;case 1:return t.isTextFullyDisplayed?(this._triangle.alpha=1,[4,M.sleep(this.TRIANGLE_BLINK_INTERVAL)]):[3,4];case 2:return e.sent(),this._triangle.alpha=0,[4,M.sleep(this.TRIANGLE_BLINK_INTERVAL)];case 3:return e.sent(),[3,1];case 4:return[2]}}))}))}}),Object.defineProperty(t.prototype,"_stopBlink",{enumerable:!1,configurable:!0,writable:!0,value:function(){this._triangle.isVisible=!1}}),Object.defineProperty(t,"_isTextFullyDisplayed",{enumerable:!0,configurable:!0,writable:!0,value:!1}),t}(j),L=function(e){function t(t){var n=e.call(this,"Space","_")||this;return Object.defineProperty(n,"_conversation",{enumerable:!0,configurable:!0,writable:!0,value:t}),n}return(0,l.C6)(t,e),Object.defineProperty(t.prototype,"executeInteraction",{enumerable:!1,configurable:!0,writable:!0,value:function(){R.isTextFullyDisplayed?this._conversation.next():F.onAdvanceDialogueRequested.notifyObservers()}}),Object.defineProperty(t.prototype,"mesh",{get:function(){var e;return null===(e=this._conversation.conversationProvider)||void 0===e?void 0:e.mesh},enumerable:!1,configurable:!0}),t}(O),F=function(){function e(){Object.defineProperty(this,"_onEnding",{enumerable:!0,configurable:!0,writable:!0,value:function(){}}),Object.defineProperty(this,"_conversationProvider",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"onDialogueStart",{enumerable:!0,configurable:!0,writable:!0,value:new s.cPK}),Object.defineProperty(this,"onConversationStart",{enumerable:!0,configurable:!0,writable:!0,value:new s.cPK}),Object.defineProperty(this,"onConversationEnd",{enumerable:!0,configurable:!0,writable:!0,value:new s.cPK}),Object.defineProperty(this,"_nextInteraction",{enumerable:!0,configurable:!0,writable:!0,value:new L(this)}),Object.defineProperty(this,"_currentNode",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_rootNode",{enumerable:!0,configurable:!0,writable:!0,value:void 0})}return Object.defineProperty(e.prototype,"conversationProvider",{get:function(){return this._conversationProvider},set:function(e){this._conversationProvider=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"root",{get:function(){return this._rootNode},set:function(e){this._rootNode=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"onEnding",{get:function(){return this._onEnding},set:function(e){this._onEnding=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"enterNode",{enumerable:!1,configurable:!0,writable:!0,value:function(t){this._currentNode=t,this._currentNode.execute(),this.onDialogueStart.notifyObservers(t),e.onAnyDialogueStart.notifyObservers(t)}}),Object.defineProperty(e.prototype,"startConversation",{enumerable:!1,configurable:!0,writable:!0,value:function(){var t;this._currentNode=this.root,this.onConversationStart.notifyObservers(this),e.onAnyConversationStart.notifyObservers(this),this.enterNode(this._currentNode),this._nextInteraction.makeAvailable();var n=null===(t=this._conversationProvider)||void 0===t?void 0:t.cameraConfiguration;n&&(y.instance.cameraConfiguration=n)}}),Object.defineProperty(e.prototype,"next",{enumerable:!1,configurable:!0,writable:!0,value:function(){var e,t=null===(e=this._currentNode)||void 0===e?void 0:e.nextNode;t?this.enterNode(t):this.endConversation()}}),Object.defineProperty(e.prototype,"endConversation",{enumerable:!1,configurable:!0,writable:!0,value:function(){this._currentNode=void 0,this._nextInteraction.makeUnavailable(),this.onConversationEnd.notifyObservers(this),e.onAnyConversationEnd.notifyObservers(this),y.instance.cameraConfiguration=D.playerCameraConfiguration,this._onEnding()}}),Object.defineProperty(e.prototype,"isInProgress",{enumerable:!1,configurable:!0,writable:!0,value:function(){return!!this._currentNode}}),Object.defineProperty(e,"onAnyDialogueStart",{enumerable:!0,configurable:!0,writable:!0,value:new s.cPK}),Object.defineProperty(e,"onAnyConversationStart",{enumerable:!0,configurable:!0,writable:!0,value:new s.cPK}),Object.defineProperty(e,"onAnyConversationEnd",{enumerable:!0,configurable:!0,writable:!0,value:new s.cPK}),Object.defineProperty(e,"onAdvanceDialogueRequested",{enumerable:!0,configurable:!0,writable:!0,value:new s.cPK}),e}(),D=function(){function e(){e._instance=this,e.initializeCameraParameter(),e.registerKeyboardInputs(),e.registerMouseMovementInputs(),F.onAnyConversationStart.add((function(){return e.disableMovement()})),F.onAnyConversationEnd.add((function(){return e.enableMovement()}))}return Object.defineProperty(e,"instance",{get:function(){return this._instance},enumerable:!1,configurable:!0}),Object.defineProperty(e,"onCameraRotationObservable",{get:function(){return this._onCameraRotationObservable},enumerable:!1,configurable:!0}),Object.defineProperty(e,"onPlayerPressedAKey",{get:function(){return this._onPlayerPressedAKey},enumerable:!1,configurable:!0}),Object.defineProperty(e,"playerCameraConfiguration",{get:function(){return this._playerCameraConfiguration},enumerable:!1,configurable:!0}),Object.defineProperty(e,"isMoveForwardPressed",{enumerable:!1,configurable:!0,writable:!0,value:function(){return this._isForwardPressed&&this._isMovementEnabled}}),Object.defineProperty(e,"isMoveBackwardPressed",{enumerable:!1,configurable:!0,writable:!0,value:function(){return this._isBackwardPressed&&this._isMovementEnabled}}),Object.defineProperty(e,"isTurnLeftPressed",{enumerable:!1,configurable:!0,writable:!0,value:function(){return this._isLeftPressed&&this._isMovementEnabled}}),Object.defineProperty(e,"isTurnRightPressed",{enumerable:!1,configurable:!0,writable:!0,value:function(){return this._isRightPressed&&this._isMovementEnabled}}),Object.defineProperty(e,"registerKeyboardInputs",{enumerable:!1,configurable:!0,writable:!0,value:function(){var e=this,t=Pe.scene;t.onKeyboardObservable.add((function(t){if(Pe.isGameFocused){var n=t.type===s.TBB.KEYDOWN;"KeyW"===t.event.code?e._isForwardPressed=n:"KeyS"===t.event.code?e._isBackwardPressed=n:"KeyA"===t.event.code?e._isLeftPressed=n:"KeyD"===t.event.code&&(e._isRightPressed=n),e.onPlayerPressedAKey.notifyObservers(t)}}))}}),Object.defineProperty(e,"registerMouseMovementInputs",{enumerable:!1,configurable:!0,writable:!0,value:function(){var e=this,t=Pe.scene;t.onPointerObservable.add((function(t){if(Pe.isGameFocused){var n=t.event,r=n.movementX/window.screen.width,i=n.movementY/window.screen.height;e._onCameraRotationObservable.notifyObservers({movementX:r,movementY:i}),e.updateCameraParameter(r,i)}}))}}),Object.defineProperty(e,"enableMovement",{enumerable:!1,configurable:!0,writable:!0,value:function(){this._isMovementEnabled=!0}}),Object.defineProperty(e,"disableMovement",{enumerable:!1,configurable:!0,writable:!0,value:function(){this._isMovementEnabled=!1}}),Object.defineProperty(e,"initializeCameraParameter",{enumerable:!1,configurable:!0,writable:!0,value:function(){var e=this;Z.instance.meshCreationPromise.then((function(t){e._playerCameraConfiguration.target=t,e._playerCameraConfiguration.distanceFromTarget=25,e._playerCameraConfiguration.currentLowerBetaLimit=s.uMQ.FromDegrees(30).radians(),e._playerCameraConfiguration.currentUpperBetaLimit=s.uMQ.FromDegrees(85).radians(),e._playerCameraConfiguration.wantedAlpha=s.uMQ.FromDegrees(-90).radians(),e._playerCameraConfiguration.wantedBeta=s.uMQ.FromDegrees(45).radians(),y.instance.cameraConfiguration=e._playerCameraConfiguration}))}}),Object.defineProperty(e,"updateCameraParameter",{enumerable:!1,configurable:!0,writable:!0,value:function(e,t){this._playerCameraConfiguration.wantedAlpha=s.X5X.LerpAngle(this._playerCameraConfiguration.wantedBeta,this._playerCameraConfiguration.wantedAlpha-e*this._horizontalCameraSensitivity,1),this._playerCameraConfiguration.wantedBeta=s.X5X.LerpAngle(this._playerCameraConfiguration.wantedBeta,this._playerCameraConfiguration.wantedBeta-t*this._verticalCameraSensitivity,1)}}),Object.defineProperty(e,"isCurrentCamera",{enumerable:!1,configurable:!0,writable:!0,value:function(){return y.instance.cameraConfiguration==this._playerCameraConfiguration}}),Object.defineProperty(e,"_onCameraRotationObservable",{enumerable:!0,configurable:!0,writable:!0,value:new s.cPK}),Object.defineProperty(e,"_onPlayerPressedAKey",{enumerable:!0,configurable:!0,writable:!0,value:new s.cPK}),Object.defineProperty(e,"_playerCameraConfiguration",{enumerable:!0,configurable:!0,writable:!0,value:new _}),Object.defineProperty(e,"_horizontalCameraSensitivity",{enumerable:!0,configurable:!0,writable:!0,value:5}),Object.defineProperty(e,"_verticalCameraSensitivity",{enumerable:!0,configurable:!0,writable:!0,value:5}),Object.defineProperty(e,"_isMovementEnabled",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(e,"_isForwardPressed",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(e,"_isBackwardPressed",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(e,"_isLeftPressed",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(e,"_isRightPressed",{enumerable:!0,configurable:!0,writable:!0,value:!1}),e}(),H=function(){function e(){var e=this;Object.defineProperty(this,"_nodeMaterialPromise",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_nodeMaterial",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this._nodeMaterialPromise=s.MBv.ParseFromFileAsync("ToonShader","shaders/PBRToonMaterial.json",Pe.scene).then((function(t){e._nodeMaterial=t,e._nodeMaterial.maxSimultaneousLights=6,e.saturationMultiplier=1.5,e._nodeMaterial.build()}))}return Object.defineProperty(e.prototype,"assignMaterial",{enumerable:!1,configurable:!0,writable:!0,value:function(e){return(0,l.sH)(this,void 0,void 0,(function(){var t=this;return(0,l.YH)(this,(function(n){switch(n.label){case 0:return[4,this._nodeMaterialPromise.then((function(){e.material=t._nodeMaterial}))];case 1:return n.sent(),[2]}}))}))}}),Object.defineProperty(e.prototype,"saturationMultiplier",{set:function(e){var t=this;this._nodeMaterialPromise.then((function(){t._nodeMaterial.getBlockByName("SaturationMultiplier").value=e}))},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"numberOfSteps",{set:function(e){var t=this;this._nodeMaterialPromise.then((function(){t._nodeMaterial.getBlockByName("NumberOfSteps").value=e}))},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"luminanceEasingFactor",{set:function(e){var t=this;this._nodeMaterialPromise.then((function(){t._nodeMaterial.getBlockByName("LuminanceEasingFactor").value=e}))},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"indexOfRefraction",{set:function(e){var t=this;this._nodeMaterialPromise.then((function(){t._nodeMaterial.getBlockByName("IoR").value=e}))},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"albedoColor",{set:function(e){var t=this;this._nodeMaterialPromise.then((function(){t._nodeMaterial.getBlockByName("AlbedoColor").value=e}))},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"albedoTexture",{set:function(e){var t=this;this._nodeMaterialPromise.then((function(){t._nodeMaterial.getBlockByName("AlbedoTexture").texture=e}))},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"opacity",{set:function(e){var t=this;this._nodeMaterialPromise.then((function(){t._nodeMaterial.getBlockByName("OpacityFactor").value=e}))},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"metallic",{set:function(e){var t=this;this._nodeMaterialPromise.then((function(){t._nodeMaterial.getBlockByName("MetallicFactor").value=e}))},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"metallicTexture",{set:function(e){var t=this;this._nodeMaterialPromise.then((function(){t._nodeMaterial.getBlockByName("MetallicTexture").texture=e}))},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"roughness",{set:function(e){var t=this;this._nodeMaterialPromise.then((function(){t._nodeMaterial.getBlockByName("RoughnessFactor").value=e}))},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"roughnessTexture",{set:function(e){var t=this;this._nodeMaterialPromise.then((function(){t._nodeMaterial.getBlockByName("RoughnessTexture").texture=e}))},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"emission",{set:function(e){var t=this;this._nodeMaterialPromise.then((function(){t._nodeMaterial.getBlockByName("EmissiveFactor").value=e}))},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"emissionColor",{set:function(e){var t=this;this._nodeMaterialPromise.then((function(){t._nodeMaterial.getBlockByName("EmissiveColor").value=e}))},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"emissionTexture",{set:function(e){var t=this;this._nodeMaterialPromise.then((function(){t._nodeMaterial.getBlockByName("EmissiveTexture").texture=e}))},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"transparencyMode",{set:function(e){var t=this;this._nodeMaterialPromise.then((function(){t._nodeMaterial.transparencyMode=e}))},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"configureFromPBRMaterial",{enumerable:!1,configurable:!0,writable:!0,value:function(e){var t=this;this.albedoColor=e.albedoColor;var n=e.albedoTexture;null!==n&&(this.albedoTexture=n),this.emission=e.emissiveIntensity;var r=e.emissiveTexture;null!==r&&(this.emissionTexture=r),this.emissionColor=e.emissiveColor;var i=e.metallic;null!==i&&(this.metallic=i);var a=e.metallicTexture;null!==a&&(this.metallicTexture=a);var o=e.roughness;null!==o&&(this.roughness=o),this.transparencyMode=e.transparencyMode,this.indexOfRefraction=e.indexOfRefraction,this._nodeMaterialPromise.then((function(){t._nodeMaterial.backFaceCulling=e.backFaceCulling,t._nodeMaterial.needDepthPrePass=e.needDepthPrePass,t._nodeMaterial.cullBackFaces=e.cullBackFaces,t._nodeMaterial.alpha=e.alpha,t._nodeMaterial.alphaMode=e.alphaMode,t._nodeMaterial.disableDepthWrite=e.disableDepthWrite,t._nodeMaterial.disableColorWrite=e.disableColorWrite,t._nodeMaterial.forceDepthWrite=e.forceDepthWrite,t._nodeMaterial.depthFunction=e.depthFunction}))}}),e}(),k=function(){function e(){var t=this;Object.defineProperty(this,"_owner",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_grapplerLength",{enumerable:!0,configurable:!0,writable:!0,value:1.5}),Object.defineProperty(this,"_currentGrappledObject",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_localOffsetWithSubmarine",{enumerable:!0,configurable:!0,writable:!0,value:new s.Pq0(0,0,-5)}),Object.defineProperty(this,"_pullingForce",{enumerable:!0,configurable:!0,writable:!0,value:5}),e._instance=this,Pe.scene.onBeforeRenderObservable.add((function(){t.updateGrappledObject()}))}return Object.defineProperty(e,"instance",{get:function(){return this._instance},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"grappleObject",{enumerable:!1,configurable:!0,writable:!0,value:function(e){this._currentGrappledObject||(this._currentGrappledObject=e)}}),Object.defineProperty(e.prototype,"letGoOfObject",{enumerable:!1,configurable:!0,writable:!0,value:function(){this._currentGrappledObject&&(this._currentGrappledObject=void 0)}}),Object.defineProperty(e.prototype,"grappledObject",{get:function(){return this._currentGrappledObject},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"hasAnObjectGrappled",{get:function(){return void 0!==this._currentGrappledObject},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"grapplerLength",{get:function(){return this._grapplerLength},set:function(e){this._grapplerLength=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"owner",{get:function(){return this._owner},set:function(e){this._owner=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"offset",{get:function(){return this._localOffsetWithSubmarine},set:function(e){this._localOffsetWithSubmarine=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"updateGrappledObject",{enumerable:!1,configurable:!0,writable:!0,value:function(){if(void 0!==this._currentGrappledObject){var e=this._owner;if(e){var t=e.getObjectCenterWorld().add(this._localOffsetWithSubmarine.rotateByQuaternionToRef(e.transformNode.absoluteRotationQuaternion,s.Pq0.Zero())),n=this._currentGrappledObject.physicsBody.getObjectCenterWorld(),r=n.subtract(t),i=r.length();if(i>this._grapplerLength){var a=r.normalizeToNew().scale(-1);this._currentGrappledObject.physicsBody.applyForce(a.scale(this._pullingForce*(i-this._grapplerLength+1)),n)}}}}}),e}(),q=function(){function e(){var t=this;Object.defineProperty(this,"_audioEngine",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_SFXsounds",{enumerable:!0,configurable:!0,writable:!0,value:new Map}),Object.defineProperty(this,"_UIsounds",{enumerable:!0,configurable:!0,writable:!0,value:new Map}),Object.defineProperty(this,"_MUSICsounds",{enumerable:!0,configurable:!0,writable:!0,value:new Map}),Object.defineProperty(this,"_SFXVolume",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_UIVolume",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_MUSICVolume",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),e.instance=this,this._SFXVolume=.8,this._UIVolume=1,this._MUSICVolume=0,Pe.scene.headphone=!0,this._audioEngine=(0,s.XdT)(),this._audioEngine.then((function(e){e.unlockAsync(),Pe.scene.onBeforeRenderObservable.add((function(){var t;null!==Pe.scene.activeCamera&&(e.listener.position=null===(t=Pe.scene.activeCamera)||void 0===t?void 0:t.position)}))})),Pe.scene.onReadyObservable.add((function(){t.playSFX("wind",{loop:!0,autoplay:!0})}))}return Object.defineProperty(e.prototype,"load",{enumerable:!1,configurable:!0,writable:!0,value:function(e,t,n){return(0,l.sH)(this,void 0,void 0,(function(){return(0,l.YH)(this,(function(r){return[2,(0,s.KcJ)(e,"".concat(t,"/").concat(e,".wav"),n)]}))}))}}),Object.defineProperty(e.prototype,"play",{enumerable:!1,configurable:!0,writable:!0,value:function(e,t,n,r,i,a){var o;return(0,l.sH)(this,void 0,void 0,(function(){var u,c;return(0,l.YH)(this,(function(l){switch(l.label){case 0:return u=n.get(e),u?(u.state!==s.F6F.Started&&(this.fadeIn(u,r,100),u.play()),[3,3]):[3,1];case 1:return[4,this.load(e,t,i)];case 2:c=l.sent(),n.set(e,c),(null===i||void 0===i?void 0:i.spatialSound)&&a&&(c.spatial.attach(a),c.spatial.maxDistance=null!==(o=i.maxDistance)&&void 0!==o?o:100,c.spatial.distanceModel="linear",console.log(c.spatial)),this.fadeIn(c,r,1e3),c.play(),l.label=3;case 3:return[2]}}))}))}}),Object.defineProperty(e.prototype,"playSFX",{enumerable:!1,configurable:!0,writable:!0,value:function(e,t,n){return(0,l.sH)(this,void 0,void 0,(function(){return(0,l.YH)(this,(function(r){switch(r.label){case 0:return[4,this.play(e,"sounds/sfx",this._SFXsounds,this.SFXVolume,t,n)];case 1:return r.sent(),[2]}}))}))}}),Object.defineProperty(e.prototype,"playUI",{enumerable:!1,configurable:!0,writable:!0,value:function(e,t,n){return(0,l.sH)(this,void 0,void 0,(function(){return(0,l.YH)(this,(function(r){switch(r.label){case 0:return[4,this.play(e,"sounds/ui",this._UIsounds,this.UIVolume,t,n)];case 1:return r.sent(),[2]}}))}))}}),Object.defineProperty(e.prototype,"playMUSIC",{enumerable:!1,configurable:!0,writable:!0,value:function(e,t,n){return(0,l.sH)(this,void 0,void 0,(function(){return(0,l.YH)(this,(function(r){switch(r.label){case 0:return[4,this.play(e,"sounds/music",this._MUSICsounds,this.MUSICVolume,t,n)];case 1:return r.sent(),[2]}}))}))}}),Object.defineProperty(e.prototype,"fadeIn",{enumerable:!1,configurable:!0,writable:!0,value:function(e,t,n){e.volume=0;var r=20,i=n/r,a=0,o=setInterval((function(){a++;var n=t*(a/i);e.volume=Math.min(n,t),a>=i&&clearInterval(o)}),r)}}),Object.defineProperty(e.prototype,"fadeOutAndStop",{enumerable:!1,configurable:!0,writable:!0,value:function(e,t){var n=20,r=t/n,i=0,a=e.volume,o=setInterval((function(){i++;var t=a*(1-i/r);e.volume=Math.max(t,0),i>=r&&(clearInterval(o),e.stop())}),n)}}),Object.defineProperty(e.prototype,"stopSFX",{enumerable:!1,configurable:!0,writable:!0,value:function(e){var t=this._SFXsounds.get(e);t&&this.fadeOutAndStop(t,100)}}),Object.defineProperty(e.prototype,"stopUI",{enumerable:!1,configurable:!0,writable:!0,value:function(e){var t=this._UIsounds.get(e);t&&this.fadeOutAndStop(t,100)}}),Object.defineProperty(e.prototype,"stopMUSIC",{enumerable:!1,configurable:!0,writable:!0,value:function(e){var t=this._MUSICsounds.get(e);t&&this.fadeOutAndStop(t,100)}}),Object.defineProperty(e.prototype,"stopAll",{enumerable:!1,configurable:!0,writable:!0,value:function(e){e.forEach((function(e){e.stop()}))}}),Object.defineProperty(e.prototype,"SFXVolume",{get:function(){return this._SFXVolume},set:function(e){var t=this;this._SFXVolume=e,this._SFXsounds.forEach((function(e){e.volume=t._SFXVolume}))},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"UIVolume",{get:function(){return this._UIVolume},set:function(e){var t=this;this._UIVolume=e,this._UIsounds.forEach((function(e){e.volume=t._UIVolume}))},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"MUSICVolume",{get:function(){return this._MUSICVolume},set:function(e){var t=this;this._MUSICVolume=e,this._MUSICsounds.forEach((function(e){e.volume=t._MUSICVolume}))},enumerable:!1,configurable:!0}),e}(),Z=function(){function e(){var t=this;Object.defineProperty(this,"_physicsAggregate",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_mesh",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_movementForce",{enumerable:!0,configurable:!0,writable:!0,value:3e6}),Object.defineProperty(this,"_rotationForce",{enumerable:!0,configurable:!0,writable:!0,value:5e5}),Object.defineProperty(this,"_grappler",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"meshCreationPromise",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_spotLight",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),e._instance=this,this._grappler=new k,this.meshCreationPromise=this.createMesh(Pe.scene),this.meshCreationPromise.then((function(e){var n;t._grappler.owner=null!==(n=e.physicsBody)&&void 0!==n?n:void 0,t._spotLight=t.createSpotlight(),t.addVolumetricLight();var r=1024;Pe.scene.onBeforeRenderObservable.add((function(){if(t._physicsAggregate){var e=t._physicsAggregate.body,n=e.transformNode.position.clone();(n.x>r||n.x<-r||n.z>r||n.z<-r)&&(e.setLinearVelocity(e.getLinearVelocity().negate()),e.transformNode.position.copyFrom(n))}}))})),Pe.scene.onBeforeRenderObservable.add((function(){t.update()}));var n=new Set;Pe.scene.onKeyboardObservable.add((function(e){var r=e.event.key;"k"===r&&(e.type===s.TBB.KEYDOWN?n.has(r)||(n.add(r),q.instance.playSFX("submarine_horn",{loop:!0},t.mesh)):e.type===s.TBB.KEYUP&&(n.delete(r),q.instance.stopSFX("submarine_horn")))})),Pe.scene.onKeyboardObservable.add((function(e){var t=e.event.key;"z"!==t&&"s"!==t||(e.type===s.TBB.KEYDOWN?n.has(t)||(n.add(t),q.instance.playSFX("submarine",{loop:!0})):e.type===s.TBB.KEYUP&&(n.delete(t),q.instance.stopSFX("submarine")))})),Pe.scene.onKeyboardObservable.add((function(e){var n,r,i=e.type===s.TBB.KEYDOWN;"l"===e.event.key&&i&&(null===(n=t._spotLight)||void 0===n||n.setEnabled(!(null===(r=t._spotLight)||void 0===r?void 0:r.isEnabled())))}))}return Object.defineProperty(e.prototype,"mesh",{get:function(){return this._mesh},enumerable:!1,configurable:!0}),Object.defineProperty(e,"instance",{get:function(){return this._instance},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"templeBall",{get:function(){return this._grappler.grappledObject},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"grabBall",{enumerable:!1,configurable:!0,writable:!0,value:function(e){this._grappler.grappleObject(e)}}),Object.defineProperty(e.prototype,"letGoOfBall",{enumerable:!1,configurable:!0,writable:!0,value:function(){this._grappler.letGoOfObject()}}),Object.defineProperty(e.prototype,"createMesh",{enumerable:!1,configurable:!0,writable:!0,value:function(e){return(0,l.sH)(this,void 0,void 0,(function(){var t,n,r,i,a,o,u,c;return(0,l.YH)(this,(function(b){switch(b.label){case 0:return[4,s.cng.ImportMeshAsync("","models/objects/","submarine.glb",e)];case 1:t=b.sent(),n=t.meshes[0],r=n.getChildMeshes(),i=function(e){var t,n;return(0,l.YH)(this,(function(r){switch(r.label){case 0:return t=e.material,t?(n=new H,[4,n.assignMaterial(e).then((function(){n.configureFromPBRMaterial(t)}))]):[3,2];case 1:r.sent(),r.label=2;case 2:return[2]}}))},a=0,o=t.meshes,b.label=2;case 2:return a<o.length?(u=o[a],[5,i(u)]):[3,5];case 3:b.sent(),b.label=4;case 4:return a++,[3,2];case 5:return c=s.eaF.MergeMeshes(r,!0,void 0,void 0,void 0,!0),c&&(this._mesh=c,this._physicsAggregate=new s.Lfv(this._mesh,s.DKo.BOX,{mass:1,friction:0,restitution:0,mesh:c},Pe.scene),this._physicsAggregate.body.setMotionType(s.AHY.DYNAMIC),this._physicsAggregate.body.setMassProperties({inertia:new s.Pq0(0,1,0),centerOfMass:this._mesh.absolutePosition}),this._physicsAggregate.body.setLinearDamping(1),this._physicsAggregate.body.setAngularDamping(1),this._physicsAggregate.body.getCollisionObservable(),this._mesh.name="submarine",this._mesh.position=new s.Pq0(0,0,0)),this.mesh.receiveShadows=!0,[2,this._mesh]}}))}))}}),Object.defineProperty(e.prototype,"createSpotlight",{enumerable:!1,configurable:!0,writable:!0,value:function(){var e=this,t=new s.nCl("spotLight",new s.Pq0(0,0,0),new s.Pq0(0,0,1),Math.PI/3,2,Pe.scene);return t.diffuse=new s.v9j(1,1,1),t.specular=new s.v9j(1,1,1),t.intensity=5e3,t.parent=this._mesh,t.setEnabled(!1),this._spotLight=t,Pe.scene.onKeyboardObservable.add((function(t){var n,r,i=t.type===s.TBB.KEYDOWN;if("l"===t.event.key&&i){var a=!(null===(n=e._spotLight)||void 0===n?void 0:n.isEnabled());null===(r=e._spotLight)||void 0===r||r.setEnabled(a)}})),t}}),Object.defineProperty(e.prototype,"addVolumetricLight",{enumerable:!1,configurable:!0,writable:!0,value:function(){var e=Pe.scene.activeCamera,t=s.PeD.CreateSphere("lightEmitter",{diameter:.8},Pe.scene),n=new s.gRT("vls",1,e,t);t.position=new s.Pq0(0,0,2.3),t.parent=this._mesh;var r=new s.FUi("lightMat",Pe.scene);r.emissiveTexture=new s.gPd("textures/lensflare/lens5.png",Pe.scene),r.diffuseColor=new s.v9j(0,0,0),r.specularColor=new s.v9j(0,0,0),r.emissiveColor=new s.v9j(1,1,1),r.alpha=.8,t.material=r,n.mesh=t,n.exposure=1,n.decay=.96815,n.weight=.4,n.density=.99,t.setEnabled(!1),Pe.scene.onKeyboardObservable.add((function(e){var n=e.type===s.TBB.KEYDOWN;"l"===e.event.key&&n&&t.setEnabled(!t.isEnabled())}))}}),Object.defineProperty(e.prototype,"update",{enumerable:!1,configurable:!0,writable:!0,value:function(){this.updateRotationSpeed(),this.updateMovementSpeed()}}),Object.defineProperty(e.prototype,"updateMovementSpeed",{enumerable:!1,configurable:!0,writable:!0,value:function(){if(this._physicsAggregate){var e=this._physicsAggregate.body,t=0;this.isForwardPressed()&&(t+=1),this.isBackwardPressed()&&(t-=1),0!==t&&e.applyForce(this._mesh.forward.scale(t*this._movementForce),e.getObjectCenterWorld())}}}),Object.defineProperty(e.prototype,"updateRotationSpeed",{enumerable:!1,configurable:!0,writable:!0,value:function(){if(this._physicsAggregate){var e=this._physicsAggregate.body,t=0;this.isRightPressed()&&(t+=1),this.isLeftPressed()&&(t-=1),0!=t&&e.applyForce(this._mesh.right.scale(t*this._rotationForce),e.getObjectCenterWorld().add(this._mesh.forward))}}}),Object.defineProperty(e.prototype,"isForwardPressed",{enumerable:!1,configurable:!0,writable:!0,value:function(){return D.isMoveForwardPressed()}}),Object.defineProperty(e.prototype,"isBackwardPressed",{enumerable:!1,configurable:!0,writable:!0,value:function(){return D.isMoveBackwardPressed()}}),Object.defineProperty(e.prototype,"isRightPressed",{enumerable:!1,configurable:!0,writable:!0,value:function(){return D.isTurnRightPressed()}}),Object.defineProperty(e.prototype,"isLeftPressed",{enumerable:!1,configurable:!0,writable:!0,value:function(){return D.isTurnLeftPressed()}}),e}(),z=function(){function e(){Object.defineProperty(this,"_name",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_detectionZone",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_discovered",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"_disabled",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"_mesh",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_physicsAggregate",{enumerable:!0,configurable:!0,writable:!0,value:void 0})}return Object.defineProperty(e.prototype,"name",{get:function(){return this._name},set:function(e){this._name=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"discovered",{get:function(){return this._discovered},set:function(e){this._discovered=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"detectionZone",{get:function(){return this._detectionZone},set:function(t){var n=this;this._detectionZone=t,this.detectionZone.onMeshEnter.add((function(){e.onAnyKeyZoneEntered.notifyObservers(n),n.discovered=!0}))},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"disabled",{get:function(){return this._disabled},set:function(e){this._disabled=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"mesh",{get:function(){return this._mesh},set:function(e){var t=this;this._mesh=e,this._detectionZone.zone.parent=this._mesh,he.submarine.meshCreationPromise.then((function(e){t.detectionZone.addMeshToDetect(e)}))},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"physicsAggregate",{get:function(){return this._physicsAggregate},set:function(e){this._physicsAggregate=e},enumerable:!1,configurable:!0}),Object.defineProperty(e,"onAnyKeyZoneEntered",{enumerable:!0,configurable:!0,writable:!0,value:new s.cPK}),e}(),G=function(){function e(e,t){var n=this;Object.defineProperty(this,"_zone",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"onMeshEnter",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"onMeshExit",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_meshToDetect",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this._zone=e,this._zone.visibility=t?.5:0,this._meshToDetect=new Map,this.onMeshEnter=new s.cPK,this.onMeshExit=new s.cPK,Pe.scene.onBeforeRenderObservable.add((function(){return n.checkAll()}))}return Object.defineProperty(e.prototype,"zone",{get:function(){return this._zone},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"addMeshToDetect",{enumerable:!1,configurable:!0,writable:!0,value:function(e){this._meshToDetect.set(e,!1),this.checkAll()}}),Object.defineProperty(e.prototype,"isInZone",{enumerable:!1,configurable:!0,writable:!0,value:function(e){return this._zone.intersectsMesh(e,!0)}}),Object.defineProperty(e.prototype,"checkDetection",{enumerable:!1,configurable:!0,writable:!0,value:function(e){var t=this._zone.intersectsMesh(e,!0);return t!==this._meshToDetect.get(e)&&(t?this.onMeshEnter.notifyObservers(e):this.onMeshExit.notifyObservers(e),this._meshToDetect.set(e,t)),t}}),Object.defineProperty(e.prototype,"checkAll",{enumerable:!1,configurable:!0,writable:!0,value:function(){var e=this;this._meshToDetect.forEach((function(t,n){e.checkDetection(n)}))}}),e}(),U=function(e){function t(t,n){var r=this,i=s.PeD.CreateSphere("",t);return r=e.call(this,i,n)||this,r}return(0,l.C6)(t,e),t}(G),V=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return(0,l.C6)(t,e),t}(w),K=function(e){function t(t){var n=e.call(this,"KeyE","E")||this;return Object.defineProperty(n,"_conversation",{enumerable:!0,configurable:!0,writable:!0,value:t}),n}return(0,l.C6)(t,e),Object.defineProperty(t.prototype,"description",{get:function(){return"Talk"},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"executeInteraction",{enumerable:!1,configurable:!0,writable:!0,value:function(){this._conversation.startConversation()}}),Object.defineProperty(t.prototype,"mesh",{get:function(){var e;return null===(e=this._conversation.conversationProvider)||void 0===e?void 0:e.mesh},enumerable:!1,configurable:!0}),t}(V),Y=function(){function e(){Object.defineProperty(this,"_name",{enumerable:!0,configurable:!0,writable:!0,value:"undefined"}),Object.defineProperty(this,"_mesh",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_conversation",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_startConversationInteraction",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_playerDetectionZone",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_cameraConfiguration",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_transformNode",{enumerable:!0,configurable:!0,writable:!0,value:new s.VR0("npcTransform")})}return Object.defineProperty(e.prototype,"name",{get:function(){return this._name},set:function(e){this._name=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"mesh",{get:function(){return this._mesh},set:function(e){this._mesh=e,this._mesh&&(this._mesh.parent=this._transformNode)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"cameraConfiguration",{get:function(){return this._cameraConfiguration},set:function(e){this._cameraConfiguration=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"transformNode",{get:function(){return this._transformNode},set:function(e){this._transformNode=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"detectionZone",{get:function(){return this._playerDetectionZone},set:function(e){this._playerDetectionZone=e,this._playerDetectionZone&&(this._playerDetectionZone.zone.parent=this._transformNode,this.setSignals())},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"conversation",{get:function(){return this._conversation},set:function(e){var t,n=this;void 0!==e?(this._startConversationInteraction=new K(e),this._conversation=e,this._conversation.conversationProvider=this,null===(t=this._conversation)||void 0===t||t.onConversationEnd.add((function(){var e,t;(null===(e=n._playerDetectionZone)||void 0===e?void 0:e.isInZone(he.submarine.mesh))&&(null===(t=n._startConversationInteraction)||void 0===t||t.makeAvailable())}))):(this._startConversationInteraction=void 0,this._conversation&&(this._conversation.conversationProvider=void 0),this._conversation=void 0)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"setSignals",{enumerable:!1,configurable:!0,writable:!0,value:function(){var e=this;this._playerDetectionZone&&(this._playerDetectionZone.onMeshEnter.add((function(){var t;e._startConversationInteraction&&!(null===(t=e._conversation)||void 0===t?void 0:t.isInProgress())&&e._startConversationInteraction.makeAvailable()})),this._playerDetectionZone.onMeshExit.add((function(){e._startConversationInteraction&&e._startConversationInteraction.makeUnavailable()})),he.submarine.meshCreationPromise.then((function(t){e._playerDetectionZone&&e._playerDetectionZone.addMeshToDetect(t)})))}}),e}(),X=function(e){function t(t,n){var r=this,i=s.PeD.CreateCylinder("",t);return r=e.call(this,i,n)||this,r}return(0,l.C6)(t,e),t}(G),Q=function(){function e(){Object.defineProperty(this,"_text",{enumerable:!0,configurable:!0,writable:!0,value:""}),Object.defineProperty(this,"_nextNode",{enumerable:!0,configurable:!0,writable:!0,value:void 0})}return Object.defineProperty(e.prototype,"text",{get:function(){return this._text},set:function(e){this._text=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"nextNode",{get:function(){return this._nextNode},set:function(e){this._nextNode=e},enumerable:!1,configurable:!0}),e}(),W=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return(0,l.C6)(t,e),Object.defineProperty(t.prototype,"execute",{enumerable:!1,configurable:!0,writable:!0,value:function(){}}),t}(Q),J=function(){function e(){Object.defineProperty(this,"root",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"current",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_onEnding",{enumerable:!0,configurable:!0,writable:!0,value:void 0})}return Object.defineProperty(e.prototype,"say",{enumerable:!1,configurable:!0,writable:!0,value:function(e){var t=new W;return t.text=e,this.root?this.current&&(this.current.nextNode=t):this.root=t,this.current=t,this}}),Object.defineProperty(e.prototype,"then",{enumerable:!1,configurable:!0,writable:!0,value:function(e){return this.say(e)}}),Object.defineProperty(e.prototype,"build",{enumerable:!1,configurable:!0,writable:!0,value:function(){var e=new F;return this._onEnding&&(e.onEnding=this._onEnding),this.root&&(e.root=this.root),e}}),Object.defineProperty(e.prototype,"setOnEnding",{enumerable:!1,configurable:!0,writable:!0,value:function(e){return this._onEnding=e,this}}),e}(),$=function(){function e(e,t,n,r){Object.defineProperty(this,"_id",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_name",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_state",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_currentStepIndex",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_steps",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this._id=e,this._name=t,this._state=n,this._currentStepIndex=r,this._steps=[]}return Object.defineProperty(e.prototype,"id",{get:function(){return this._id},set:function(e){this._id=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"name",{get:function(){return this._name},set:function(e){this._name=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"state",{get:function(){return this._state},set:function(e){this._state=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"currentStepIndex",{get:function(){return this._currentStepIndex},set:function(e){this._currentStepIndex=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"steps",{get:function(){return this._steps},set:function(e){this._steps=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"startQuest",{enumerable:!1,configurable:!0,writable:!0,value:function(){this._state="active",console.log('Quête "'.concat(this._name,'" commencée'))}}),Object.defineProperty(e.prototype,"stopQuest",{enumerable:!1,configurable:!0,writable:!0,value:function(){this._state="completed",console.log('Quête "'.concat(this._name,'" fini'))}}),Object.defineProperty(e.prototype,"nextStep",{enumerable:!1,configurable:!0,writable:!0,value:function(){this._currentStepIndex===this._steps.length-1?this.stopQuest():(this._currentStepIndex++,console.log('Quête "'.concat(this._name,"\" passe à l'étape suivante")))}}),Object.defineProperty(e.prototype,"updateCurrentStepStatus",{enumerable:!1,configurable:!0,writable:!0,value:function(){this._steps[this._currentStepIndex].validate()}}),e}(),ee=function(){function e(e){Object.defineProperty(this,"description",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"condition",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.description=e,this.condition=!1}return Object.defineProperty(e.prototype,"validate",{enumerable:!1,configurable:!0,writable:!0,value:function(){this.condition=!0}}),e}(),te=function(e){function t(t){var n=e.call(this,"KeyF","F")||this;return Object.defineProperty(n,"_socle",{enumerable:!0,configurable:!0,writable:!0,value:t}),n}return(0,l.C6)(t,e),Object.defineProperty(t.prototype,"description",{get:function(){return"Remove"},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"executeInteraction",{enumerable:!1,configurable:!0,writable:!0,value:function(){var e=this._socle.currentBall;e&&!Z.instance.templeBall&&(this._socle.letGoOfBall(),Z.instance.grabBall(e),console.log("REMOVING THE BALL !!!"))}}),Object.defineProperty(t.prototype,"mesh",{get:function(){return this._socle.mesh},enumerable:!1,configurable:!0}),t}(V),ne=function(e){function t(t){var n=e.call(this,"KeyF","F")||this;return Object.defineProperty(n,"_socle",{enumerable:!0,configurable:!0,writable:!0,value:t}),n}return(0,l.C6)(t,e),Object.defineProperty(t.prototype,"description",{get:function(){return"Place"},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"executeInteraction",{enumerable:!1,configurable:!0,writable:!0,value:function(){var e=Z.instance.templeBall;e&&(console.log("PLACING THE BALL !!!",e),this._socle.placeBall(e),Z.instance.letGoOfBall())}}),Object.defineProperty(t.prototype,"mesh",{get:function(){return this._socle.mesh},enumerable:!1,configurable:!0}),t}(V),re=n(25135),ie=function(){function e(e,t){var n=this;Object.defineProperty(this,"_transformNode",{enumerable:!0,configurable:!0,writable:!0,value:new s.VR0("socle")}),Object.defineProperty(this,"_ballTransformNode",{enumerable:!0,configurable:!0,writable:!0,value:new s.VR0("ballPosition")}),Object.defineProperty(this,"_mesh",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_material",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_socleDetectionZone",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_validColor",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_currentBall",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_lockConstraint",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_placeTempleBallInteraction",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_removeTempleBallInteraction",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"meshImportedPromise",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this._material=new re.G("socleMat"),this._material.diffuseColor=new s.v9j(.3,.3,.3),this._transformNode.parent=e,this._transformNode.position=t,this._ballTransformNode.parent=this._transformNode,this._ballTransformNode.position=s.Pq0.Up().scale(5),this._placeTempleBallInteraction=new ne(this),this._removeTempleBallInteraction=new te(this),this._socleDetectionZone=new U({diameter:8},!1),Z.instance.meshCreationPromise.then((function(e){var t;null===(t=n._socleDetectionZone)||void 0===t||t.addMeshToDetect(e)})),this._socleDetectionZone.onMeshEnter.add((function(){n.makeInteractionAvailable()})),this._socleDetectionZone.onMeshExit.add((function(){n.makeInteractionUnavailable()})),this.meshImportedPromise=(0,s.TkY)("models/objects/socle.glb",Pe.scene).then((function(e){n._mesh=e.meshes[1],n._mesh.parent=n._transformNode,n._mesh.material=n._material;var t=new s.aZl(n._mesh,s.AHY.STATIC,!1,Pe.scene),r=new s.JNI({type:s.DKo.MESH,parameters:{mesh:n._mesh}},Pe.scene);t.shape=r,n._socleDetectionZone.zone.parent=n._mesh}))}return Object.defineProperty(e.prototype,"currentBall",{get:function(){return this._currentBall},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"mesh",{get:function(){return this._mesh},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"placeBall",{enumerable:!1,configurable:!0,writable:!0,value:function(e){var t;this._currentBall=e,this._lockConstraint=new s.lCF(s.Pq0.Zero(),s.Pq0.Up().scale(4),s.Pq0.Up(),s.Pq0.Down(),Pe.scene),null===(t=this._mesh.physicsBody)||void 0===t||t.addConstraint(e.physicsBody,this._lockConstraint),this._currentBall.socle=this,this._material.diffuseColor=new s.v9j(5,5,5)}}),Object.defineProperty(e.prototype,"letGoOfBall",{enumerable:!1,configurable:!0,writable:!0,value:function(){var e;this._currentBall&&(this._currentBall=void 0,null===(e=this._lockConstraint)||void 0===e||e.dispose(),this._material.diffuseColor=new s.v9j(.3,.3,.3))}}),Object.defineProperty(e.prototype,"validColor",{get:function(){return this._validColor},set:function(e){this._validColor=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"transformNode",{get:function(){return this._transformNode},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"makeInteractionAvailable",{enumerable:!1,configurable:!0,writable:!0,value:function(){this._placeTempleBallInteraction.makeUnavailable(),this._removeTempleBallInteraction.makeUnavailable(),this._currentBall&&!Z.instance.templeBall?this._removeTempleBallInteraction.makeAvailable():!this._currentBall&&Z.instance.templeBall&&this._placeTempleBallInteraction.makeAvailable()}}),Object.defineProperty(e.prototype,"makeInteractionUnavailable",{enumerable:!1,configurable:!0,writable:!0,value:function(){this._placeTempleBallInteraction.makeUnavailable(),this._removeTempleBallInteraction.makeUnavailable()}}),e}(),ae=function(e){function t(t){var n=e.call(this,"KeyF","F")||this;return Object.defineProperty(n,"_grabbableObject",{enumerable:!0,configurable:!0,writable:!0,value:t}),n}return(0,l.C6)(t,e),Object.defineProperty(t.prototype,"grabbableObject",{get:function(){return this._grabbableObject},set:function(e){this._grabbableObject=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"description",{get:function(){return"Grapple"},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"executeInteraction",{enumerable:!1,configurable:!0,writable:!0,value:function(){k.instance.grappleObject(this._grabbableObject),this.makeUnavailable()}}),Object.defineProperty(t.prototype,"mesh",{get:function(){return this._grabbableObject.mesh},enumerable:!1,configurable:!0}),t}(V),oe=function(){function e(t,n){var r=this;Object.defineProperty(this,"color",{enumerable:!0,configurable:!0,writable:!0,value:n}),Object.defineProperty(this,"_detectionZone",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_grappleInteraction",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_mesh",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_physicsBody",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_physicsShape",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_socle",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"onPlacedOnSocle",{enumerable:!0,configurable:!0,writable:!0,value:new s.cPK}),le.registerBall(this),this.onPlacedOnSocle.add((function(t){return e.onAnyBallPlacedOnAnySocle.notifyObservers({ball:r,socle:t})})),this._mesh=s.PeD.CreateSphere("templeBall",{diameter:2}),this._mesh.position=t,this._physicsShape=new s.JNI({type:s.DKo.SPHERE,parameters:{radius:1}},Pe.scene);var i=new re.G("templeBallMaterial");i.diffuseColor=n,this._mesh.material=i,this._physicsBody=new s.aZl(this._mesh,s.AHY.DYNAMIC,!1,Pe.scene),this._physicsBody.shape=this._physicsShape,this._physicsBody.setLinearDamping(1),this._physicsBody.setMassProperties({mass:.5}),this._grappleInteraction=new ae(this),this._detectionZone=new U({diameter:4},!1),this._detectionZone.zone.parent=this._mesh,Z.instance.meshCreationPromise.then((function(e){r._detectionZone.addMeshToDetect(e)})),this._detectionZone.onMeshEnter.add((function(){k.instance.hasAnObjectGrappled||r._socle||r._grappleInteraction.makeAvailable()})),this._detectionZone.onMeshExit.add((function(){r._grappleInteraction.makeUnavailable()}))}return Object.defineProperty(e.prototype,"mesh",{get:function(){return this._mesh},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"physicsBody",{get:function(){return this._physicsBody},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"socle",{get:function(){return this._socle},set:function(e){this._socle=e,e&&this.onPlacedOnSocle.notifyObservers(e)},enumerable:!1,configurable:!0}),Object.defineProperty(e,"onAnyBallPlacedOnAnySocle",{enumerable:!0,configurable:!0,writable:!0,value:new s.cPK}),e}(),le=function(){function e(t,n){var r=this;Object.defineProperty(this,"_upperRightSocle",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_middleRightSocle",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_lowerRightSocle",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_lowerMiddleSocle",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_lowerLeftSocle",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_middleLeftSocle",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_upperLeftSocle",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_upperMiddleSocle",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_centerSocle",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_transformNode",{enumerable:!0,configurable:!0,writable:!0,value:new s.VR0("templePuzzle")}),Object.defineProperty(this,"_cameraConfiguration",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_detectionZone",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),e._instance=this,this._transformNode.parent=t,this._transformNode.rotation=s.Pq0.Zero(),this._transformNode.position=n,this._detectionZone=new U({diameter:70},!1),this._detectionZone.zone.parent=this._transformNode,this._cameraConfiguration=new _,this._cameraConfiguration.target=this._transformNode,this._cameraConfiguration.wantedBeta=s.uMQ.FromDegrees(0).radians(),this._cameraConfiguration.wantedAlpha=s.uMQ.FromDegrees(-90).radians(),this._cameraConfiguration.distanceFromTarget=100,this._detectionZone.onMeshEnter.add((function(){y.instance.cameraConfiguration=r._cameraConfiguration})),this._detectionZone.onMeshExit.add((function(){y.instance.cameraConfiguration=D.playerCameraConfiguration})),Z.instance.meshCreationPromise.then((function(e){r._detectionZone.addMeshToDetect(e)})),this._upperRightSocle=this.createSocle(new s.Pq0(-1,0,-1).scale(20)),this._middleRightSocle=this.createSocle(new s.Pq0(-1,0,0).scale(20),s.v9j.Purple()),this._lowerRightSocle=this.createSocle(new s.Pq0(-1,0,1).scale(20),s.v9j.Blue()),this._lowerMiddleSocle=this.createSocle(new s.Pq0(0,0,1).scale(20),s.v9j.Green()),this._lowerLeftSocle=this.createSocle(new s.Pq0(1,0,1).scale(20),s.v9j.Red()),this._middleLeftSocle=this.createSocle(new s.Pq0(1,0,0).scale(20)),this._upperLeftSocle=this.createSocle(new s.Pq0(1,0,-1).scale(20),s.v9j.Gray()),this._upperMiddleSocle=this.createSocle(new s.Pq0(0,0,-1).scale(20),s.v9j.Yellow()),this._centerSocle=this.createSocle(s.Pq0.Zero());var i=new oe(new s.Pq0(40,0,20),s.v9j.Gray()),a=new oe(new s.Pq0(50,0,20),s.v9j.Yellow());this._lowerLeftSocle.meshImportedPromise.then((function(){r._lowerLeftSocle.placeBall(a)})),this._lowerRightSocle.meshImportedPromise.then((function(){r._lowerRightSocle.placeBall(i)}))}return Object.defineProperty(e,"instance",{get:function(){return this._instance},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"transformNode",{get:function(){return this._transformNode},enumerable:!1,configurable:!0}),Object.defineProperty(e,"registerBall",{enumerable:!1,configurable:!0,writable:!0,value:function(e){var t=this;this._ball.push(e),e.onPlacedOnSocle.add((function(){t._instance.onBallPlacedOnSocle()}))}}),Object.defineProperty(e.prototype,"createSocle",{enumerable:!1,configurable:!0,writable:!0,value:function(e,t){var n=new ie(this._transformNode,e);return n.validColor=t,n}}),Object.defineProperty(e.prototype,"onBallPlacedOnSocle",{enumerable:!1,configurable:!0,writable:!0,value:function(){this.isAllBallPlacedOnASocle()&&(this.checkConfiguration()?e.onPuzzleResolved.notifyObservers():e.onPuzzleRejected.notifyObservers())}}),Object.defineProperty(e.prototype,"isAllBallPlacedOnASocle",{enumerable:!1,configurable:!0,writable:!0,value:function(){var t=0;return e._ball.forEach((function(e){e.socle&&t++})),6==t}}),Object.defineProperty(e.prototype,"checkConfiguration",{enumerable:!1,configurable:!0,writable:!0,value:function(){for(var t=0;t<e._ball.length;t++){var n=e._ball[t],r=n.socle;if(!r)return console.log("Some ball are not placed"),!1;var i=r.validColor;if(void 0===i||!n.color.equals(i))return!1}return!0}}),Object.defineProperty(e,"onPuzzleResolved",{enumerable:!0,configurable:!0,writable:!0,value:new s.cPK}),Object.defineProperty(e,"onPuzzleRejected",{enumerable:!0,configurable:!0,writable:!0,value:new s.cPK}),Object.defineProperty(e,"_ball",{enumerable:!0,configurable:!0,writable:!0,value:new Array}),e}(),se=function(){function e(){}return Object.defineProperty(e,"createAll",{enumerable:!1,configurable:!0,writable:!0,value:function(){var t=[];return t.push(e.createTalkToPedro()),t.push(e.createTempleQuest()),t}}),Object.defineProperty(e,"createTalkToPedro",{enumerable:!1,configurable:!0,writable:!0,value:function(){var e=new $("dreamland","Le monde des rêves","active",0),t=[];return t.push(new ee("Parlez à l'habitant de l'ile du Dophin")),t.push(new ee("Aller voir le temple")),t.push(new ee("Parler aux différents habitants de chaque île")),e.steps=t,le.onPuzzleResolved.add((function(){e.state="completed"})),e}}),Object.defineProperty(e,"createTempleQuest",{enumerable:!1,configurable:!0,writable:!0,value:function(){var e=new $("temple_quest","Le Temple","inactive",0),t=[];return t.push(new ee("Résoudre l'énigme du temple")),e.steps=t,le.onPuzzleResolved.add((function(){e.state="completed"})),e}}),e}(),ue=function(){function e(){var t=this;Object.defineProperty(this,"quests",{enumerable:!0,configurable:!0,writable:!0,value:[]}),this.quests=se.createAll(),e._instance=this,Pe.scene.onBeforeRenderObservable.add((function(){t.quests.forEach((function(e){e.steps[e.currentStepIndex].condition&&"active"===e.state&&e.nextStep()}))}))}return Object.defineProperty(e,"instance",{get:function(){return this._instance},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"getQuest",{enumerable:!1,configurable:!0,writable:!0,value:function(e){return this.quests.find((function(t){return t.id===e}))}}),Object.defineProperty(e.prototype,"getAllActiveQuests",{enumerable:!1,configurable:!0,writable:!0,value:function(){var e=[];return this.quests.forEach((function(t){"active"===t.state&&e.push(t)})),e}}),e}(),ce=function(e){function t(){var n=e.call(this)||this;return Object.defineProperty(n,"_panel",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(n,"_journalEntry",{enumerable:!0,configurable:!0,writable:!0,value:new Map}),n._panel=new C.Pc,n._panel.width="60%",n._panel.height="80%",n._panel.isVertical=!0,n._panel.horizontalAlignment=C.Ec.HORIZONTAL_ALIGNMENT_CENTER,n._panel.verticalAlignment=C.Ec.VERTICAL_ALIGNMENT_CENTER,n._panel.spacing=20,n._panel.isVisible=!1,Pe.scene.onKeyboardObservable.add((function(e){var t=e.type===s.TBB.KEYDOWN;"j"===e.event.key&&t&&(n._panel.isVisible?n.hide():n.show())})),t._instance=n,n}return(0,l.C6)(t,e),Object.defineProperty(t,"instance",{get:function(){return this._instance},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"controlNode",{get:function(){return this._panel},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"refresh",{enumerable:!1,configurable:!0,writable:!0,value:function(){var e=this;ue.instance&&(this._panel.clearControls(),this._journalEntry.forEach((function(t,n){var r=new C.VJ;r.text=n.name,r.fontSize="24px",r.color="white",r.textHorizontalAlignment=C.Ec.HORIZONTAL_ALIGNMENT_CENTER,r.paddingTop="10px",r.paddingBottom="5px",e._panel.addControl(r),t.forEach((function(t){var n=new C.VJ;n.text="- "+t,n.fontSize="18px",n.color="white",n.textHorizontalAlignment=C.Ec.HORIZONTAL_ALIGNMENT_LEFT,n.height="30px",e._panel.addControl(n)}))})))}}),Object.defineProperty(t.prototype,"show",{enumerable:!1,configurable:!0,writable:!0,value:function(){this._panel.isVisible=!0}}),Object.defineProperty(t.prototype,"hide",{enumerable:!1,configurable:!0,writable:!0,value:function(){this._panel.isVisible=!1}}),Object.defineProperty(t.prototype,"addEntryToQuest",{enumerable:!1,configurable:!0,writable:!0,value:function(e,t){var n;e&&(this._journalEntry.has(e)||this._journalEntry.set(e,[]),null===(n=this._journalEntry.get(e))||void 0===n||n.push(t)),this.refresh()}}),t}(j),be=function(){function e(){}return Object.defineProperty(e,"createPedro",{enumerable:!1,configurable:!0,writable:!0,value:function(){return(0,l.sH)(this,void 0,Promise,(function(){var e;return(0,l.YH)(this,(function(t){return e=new Y,e.name="Pedro",M.loadMesh("models/characters/pedro.glb").then((function(t){e.mesh=t.meshes[0],t.meshes.forEach((function(e){var t=e.material;if(t){var n=new H;n.assignMaterial(e).then((function(){n.configureFromPBRMaterial(t)}))}})),q.instance.playMUSIC("pedro",{spatialSound:!0,loop:!0,autoplay:!0,maxDistance:80,rolloffFactor:1.5},e.mesh)})),e.detectionZone=new X({height:8,diameterTop:45,diameterBottom:45},!0),e.detectionZone.zone.position.set(0,-11,0),e.conversation=(new J).say("OH CA VA PAS DE ME REVEILLER COMME CA ! MAIS QUI ES TU !!!!!").then("Ca fais bien longtemps que j'ai pas vu quelqu'un comme toi ici ! Je me présente, je suis Pedro. Je pêche ici depuis bel lurette mon n'veu.").then("Ici, eh beh ici je sais pas trop comment te le décrire. C'est assez vide et ça mord pas trop au bout de ma canne... ").then("Mais ! Y'a un p'tit endroit au nord d'ici un peu particulier.").then("Y'avait deux boules et plein de poteaux, j'ai pas tout compris et j'étais fatigué Ducoup j'suis parti..").then("Normalement tu devrais l'apercevoir d'ici ! Fais attention ! ").then("Hésite pas à aller voir les habitants des autres, ils devraient pouvoir t'aider !").then("Bon aller moi je retourne pêcher (et dormir au passage... ça fais bieeeen ..... loongt....................... zzZZZzzzzzZZzzzzzzzz)").setOnEnding((function(){var e;ce.instance.addEntryToQuest(ue.instance.getQuest("dreamland"),"Pedro s'est endormie"),null===(e=ue.instance.getQuest("dreamland"))||void 0===e||e.updateCurrentStepStatus()})).build(),e.cameraConfiguration=new _,e.cameraConfiguration.target=e.transformNode,e.cameraConfiguration.distanceFromTarget=10,e.cameraConfiguration.offset=s.Pq0.Up().scale(2),e.cameraConfiguration.wantedAlpha=s.uMQ.FromDegrees(-90).radians(),[2,e]}))}))}}),Object.defineProperty(e,"createFox",{enumerable:!1,configurable:!0,writable:!0,value:function(){return(0,l.sH)(this,void 0,Promise,(function(){var e;return(0,l.YH)(this,(function(t){return e=new Y,e.name="Crimson",M.loadMesh("models/characters/fox.glb").then((function(t){e.mesh=t.meshes[0],t.meshes.forEach((function(e){var t=e.material;if(t){var n=new H;n.assignMaterial(e).then((function(){n.configureFromPBRMaterial(t)}))}}))})),e.detectionZone=new X({height:8,diameterTop:45,diameterBottom:45},!0),e.conversation=(new J).say("Je sais pas si tu vois la même chose que moi (peut-être que c'est un mirage). Y'a une piste de bowling là-bas où y'a les quilles qui sortent de l'eau.").then("Y'a une sorte de boule de bowling qui était sur l'île. J'ai essayé de jouer avec des quilles en glace mais ça a pas trop marché.").then("Parmi les quilles j'ai mis une bouteille que j'ai trouvée dans le coin et bizarrement, quand j'ai fait un STRIKE ! Y'a une note qui est sortie.").then("Y'avait marqué ça : « Redina, la plus forte, restait en retrait afin de couvrir leurs arrières »").then("Bizarre l'ambiance... J'en ai marre de jouer au bowling donc j'te donne la boule ! Mais prends-en soin !").then("Allez, je vais jouer à la pétanque moi...").build(),e.cameraConfiguration=new _,e.cameraConfiguration.target=e.transformNode,e.cameraConfiguration.distanceFromTarget=10,e.cameraConfiguration.wantedAlpha=s.uMQ.FromDegrees(-90).radians(),[2,e]}))}))}}),Object.defineProperty(e,"createGirl",{enumerable:!1,configurable:!0,writable:!0,value:function(){return(0,l.sH)(this,void 0,Promise,(function(){var e;return(0,l.YH)(this,(function(t){return e=new Y,e.name="Rosa",M.loadMesh("models/characters/phare_girl.glb").then((function(t){e.mesh=t.meshes[0],t.meshes.forEach((function(e){var t=e.material;if(t){var n=new H;n.assignMaterial(e).then((function(){n.configureFromPBRMaterial(t)}))}}))})),e.detectionZone=new X({height:8,diameterTop:45,diameterBottom:45},!0),e.conversation=(new J).say("Si je suis la trajectoire de cette étoile, alors je peux peut-être réussir à démontrer que e = m6 !").then("Oh salut toi ! T'as un sacré sous-marin ! J'adore les sous-marins tu tombes à pic !").then("Pour la peine, je vais te présenter les conclusions de mon expérience AHAH prépare toi à en prendre plein la vue !").then("J'ai trouvé une boule de couleurs avec deux parchemins. Commençons par les FAITS !").then("Fait numéro 1 : la boule est d'une couleur spécifique... Hmmmm...... Ok soit.").then("Fait numéro 2 : les textes parlent de je ne sais pas trop quoi à vrai dire. Mais ! J'ai l'impression que les couleurs sont importantes !").then("Maintenant, passons à la THEORIE !").then("Théorie numéro 1 : une boule de couleur a une position unique. Mais où ??? AHHH Je ne comprends pas....").then("Théorie numéro 2 : il existe d'autres boules de couleur car mes deux indices parlent de couleurs différentes de celle de ma boule !").then("Et voilà c'est un peu tout ce que j'ai, je suis dans une sacrée impasse. Je vais sûrement rater le prix Nobel cette année.....").then("Allez j'te laisse la boule, je suis passé à autre chose ! Tu me diras une prochaine fois si ça t'a été utile !").then("À la revoyure !").build(),e.cameraConfiguration=new _,e.cameraConfiguration.target=e.transformNode,e.cameraConfiguration.distanceFromTarget=40,e.cameraConfiguration.wantedAlpha=s.uMQ.FromDegrees(-120).radians(),e.cameraConfiguration.wantedBeta=s.uMQ.FromDegrees(50).radians(),[2,e]}))}))}}),Object.defineProperty(e,"createScribe",{enumerable:!1,configurable:!0,writable:!0,value:function(){return(0,l.sH)(this,void 0,Promise,(function(){var e;return(0,l.YH)(this,(function(t){return e=new Y,e.name="Marcel",M.loadMesh("models/characters/scribe.glb").then((function(t){e.mesh=t.meshes[0],t.meshes.forEach((function(e){var t=e.material;if(t){var n=new H;n.assignMaterial(e).then((function(){n.configureFromPBRMaterial(t)}))}}))})),e.detectionZone=new X({height:8,diameterTop:45,diameterBottom:45},!0),e.conversation=(new J).say("Que penses-tu de mon prochain poème jeune étranger ?").then("[g]Ballade d’un Génie Naufragé[/g]").then("[i]Je suis ce grand Marcel, qu’aucun vent ne dérange, Poète illustre et fier, perdu sur cet étrange Territoire obscur, bordé par l’inconnu, Où des piliers sans fin soutiennent l’absolu.[/i]").then("[i]Je ne sais point comment j’ai pu atterrir ici, Mais l’endroit me salue d’un silence exquis. Tantôt le ciel s’emplit de choses voltigeantes, Tantôt le vide plane, en formes déchirantes.[/i]").then("[i]Sur le rivage nu, comme un don du destin, J’aperçus une orbe, d’un éclat si divin Que mon esprit, troublé par tant de magnificence, Faillit se noyer dans sa propre éloquence.[/i]").then("[i]Juste à côté dormait, message dans bouteille, Un parchemin d’échos, d’une main non pareille. Il était écrit, sans honte ni limite : [/i] [c=blue]« Pendant que le soleil était au zénith, Un nuage grisâtre s’approchait depuis l’ouest ». Ah ! Que cette phrase est d’un raffinement leste ![/c]").then("[i]Moi seul, Marcel, pouvais en saisir l’essence, Car mon verbe est plus fort que toute connaissance.[/i]").then("[i]Je retourne à présent vers la fontaine noire, Dont l’encre tachera les vers de ma mémoire.[/i]").then("Voila ! J'espère que ce ne fut pas un peu trop long. Maintenant file je dois me concentrer !").build(),e.cameraConfiguration=new _,e.cameraConfiguration.target=e.transformNode,e.cameraConfiguration.distanceFromTarget=10,e.cameraConfiguration.wantedAlpha=s.uMQ.FromDegrees(150).radians(),[2,e]}))}))}}),Object.defineProperty(e,"createRabbit",{enumerable:!1,configurable:!0,writable:!0,value:function(){return(0,l.sH)(this,void 0,Promise,(function(){var e;return(0,l.YH)(this,(function(t){return e=new Y,e.name="Matthew",M.loadMesh("models/characters/lapin.glb").then((function(t){e.mesh=t.meshes[0],t.meshes.forEach((function(e){var t=e.material;if(t){var n=new H;n.assignMaterial(e).then((function(){n.configureFromPBRMaterial(t)}))}}))})),e.detectionZone=new X({height:8,diameterTop:45,diameterBottom:45},!0),e.detectionZone.zone.position.set(0,-2,0),e.conversation=(new J).say("[i][c=blue]Trois sœurs, Redina, Greina, Bluella, voyant le nuage s'approcher, se dirigeaient à l'opposée....[/i][/c]").then("Hmmmm... Qu'est-ce que ça peut vouloir dire....").then("AAAAAAAAAAAAAAAAAAAAHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHH").then("TU M'AS FAIS PEUR !!!!").then("TIENS PREND ÇA ! ET PARS LOIN D'ICI SANS REVENIR !!!!!!!!!!!!!!!!").build(),e.cameraConfiguration=new _,e.cameraConfiguration.target=e.transformNode,e.cameraConfiguration.distanceFromTarget=10,e.cameraConfiguration.wantedAlpha=s.uMQ.FromDegrees(-90).radians(),[2,e]}))}))}}),e}(),fe=function(){function e(){Object.defineProperty(this,"_steleInteractionZone",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_conversation",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_startConversationInteraction",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_cameraConfiguration",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.steleInteractionZone=new U({diameter:20},!0),this._cameraConfiguration=new _,this._cameraConfiguration.target=this._steleInteractionZone.zone,this._cameraConfiguration.distanceFromTarget=20,this._cameraConfiguration.wantedAlpha=s.uMQ.FromDegrees(-90).radians();var e=new J;e.say("La ligne du haut regarde les cieux").then("La ligne du milieu respire l’air").then("La ligne du bas touche la terre").setOnEnding((function(){var e=ue.instance.getQuest("temple_quest");e&&(e.state="active"),e=ue.instance.getQuest("dreamland"),e&&e.updateCurrentStepStatus()})),this.conversation=e.build(),this.conversation.conversationProvider=this}return Object.defineProperty(e.prototype,"steleInteractionZone",{get:function(){return this._steleInteractionZone},set:function(e){var t=this;this._steleInteractionZone=e,this._steleInteractionZone&&(this._steleInteractionZone.onMeshEnter.add((function(){t._startConversationInteraction&&t._startConversationInteraction.makeAvailable()})),this._steleInteractionZone.onMeshExit.add((function(){t._startConversationInteraction&&t._startConversationInteraction.makeUnavailable()})),Z.instance.meshCreationPromise.then((function(e){var n;null===(n=t._steleInteractionZone)||void 0===n||n.addMeshToDetect(e)})))},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"conversation",{get:function(){return this._conversation},set:function(e){this._conversation=e,this._conversation&&(this._startConversationInteraction=new K(this._conversation))},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"mesh",{get:function(){return this._steleInteractionZone.zone},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"name",{get:function(){return"Stele"},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"cameraConfiguration",{get:function(){return this._cameraConfiguration},enumerable:!1,configurable:!0}),e}(),de=function(){function e(){}return Object.defineProperty(e,"createDolphinIsland",{enumerable:!1,configurable:!0,writable:!0,value:function(){return(0,l.sH)(this,void 0,Promise,(function(){var e,t,n,r,i,a,o,u,c,b,f,d;return(0,l.YH)(this,(function(h){switch(h.label){case 0:return e=new s.VR0("island transform"),t=new z,t.name="Dolphin island",t.detectionZone=new U({diameter:200},!0),[4,M.loadMesh("models/scenes/dolphinIsland.glb")];case 1:n=h.sent(),r=n.meshes[0],r.position=s.Pq0.Zero(),r.parent=e,i=r.getChildMeshes(),a=function(e){var t,n;return(0,l.YH)(this,(function(r){switch(r.label){case 0:return t=e.material,t?(n=new H,[4,n.assignMaterial(e).then((function(){n.configureFromPBRMaterial(t)}))]):[3,2];case 1:r.sent(),r.label=2;case 2:return[2]}}))},o=0,u=n.meshes,h.label=2;case 2:return o<u.length?(c=u[o],[5,a(c)]):[3,5];case 3:h.sent(),h.label=4;case 4:return o++,[3,2];case 5:return b=s.eaF.MergeMeshes(i,!0,void 0,void 0,void 0,!0),b&&(b.parent=e,t.mesh=b,e.position=this._dolphinPosition,f=new s.aZl(b,s.AHY.STATIC,!1,Pe.scene),d=new s.JNI({type:s.DKo.MESH,parameters:{mesh:b}},Pe.scene),f.shape=d,f.disablePreStep=!1,Pe.scene.onBeforeRenderObservable.addOnce((function(){return f.disablePreStep=!0})),be.createPedro().then((function(t){t.transformNode.position=new s.Pq0(-30,15,-14),t.transformNode.parent=e}))),[2,t]}}))}))}}),Object.defineProperty(e,"createTemple",{enumerable:!1,configurable:!0,writable:!0,value:function(){return(0,l.sH)(this,void 0,void 0,(function(){var e,t,n,r,i,a,o,u,c,b,f,d,h,p;return(0,l.YH)(this,(function(m){switch(m.label){case 0:return e=new s.VR0("temple transform"),t=new z,t.name="Temple",t.detectionZone=new U({diameter:260},!0),[4,M.loadMesh("models/scenes/temple.glb")];case 1:n=m.sent(),r=n.meshes[0],r.position=s.Pq0.Zero(),r.parent=e,i=r.getChildMeshes(),a=function(e){var t,n;return(0,l.YH)(this,(function(r){switch(r.label){case 0:return t=e.material,t?(n=new H,[4,n.assignMaterial(e).then((function(){n.configureFromPBRMaterial(t)}))]):[3,2];case 1:r.sent(),n.emissionColor=s.v9j.FromHexString("#4bf49f"),r.label=2;case 2:return[2]}}))},o=0,u=n.meshes,m.label=2;case 2:return o<u.length?(c=u[o],[5,a(c)]):[3,5];case 3:m.sent(),m.label=4;case 4:return o++,[3,2];case 5:return b=s.eaF.MergeMeshes(i,!0,void 0,void 0,void 0,!0),b&&(b.parent=e,t.mesh=b,e.position=this._templePosition,e.rotate(s.Pq0.Up(),s.uMQ.FromDegrees(180).radians(),s.$xS.WORLD),f=new s.aZl(b,s.AHY.STATIC,!1,Pe.scene),d=new s.JNI({type:s.DKo.MESH,parameters:{mesh:b}},Pe.scene),f.shape=d,f.disablePreStep=!1,Pe.scene.onBeforeRenderObservable.addOnce((function(){return f.disablePreStep=!0}))),h=new fe,p=h.steleInteractionZone,p.zone.parent=e,p.zone.position=new s.Pq0(0,0,50),new le(e,new s.Pq0(0,0,0)),[2]}}))}))}}),Object.defineProperty(e,"createStaticPhysicsAggregate",{enumerable:!1,configurable:!0,writable:!0,value:function(e,t){var n=new s.Lfv(e,t,{mass:0},Pe.scene);return n}}),Object.defineProperty(e,"createBanquise",{enumerable:!1,configurable:!0,writable:!0,value:function(){return(0,l.sH)(this,void 0,void 0,(function(){var e,t,n,r,i,a,o,u,c,b,f,d,h,p;return(0,l.YH)(this,(function(l){switch(l.label){case 0:return e=new s.VR0("banquise transform"),t=new z,t.name="Fractisberg",t.detectionZone=new U({diameter:200},!0),[4,M.loadMesh("models/scenes/banquise.glb")];case 1:for(n=l.sent(),r=n.meshes[0],r.position=s.Pq0.Zero(),r.parent=e,i=r.getChildMeshes(),a=0,o=n.meshes;a<o.length;a++)u=o[a],c=u.material,b=u.material,c?(f=new re.G("banquiseMat"),f.needDepthPrePass=!0,f.diffuseColor=c.albedoColor,c.albedoTexture&&(f.diffuseTexture=c.albedoTexture),u.material=f,f.cullBackFaces=!1):b&&(f=new re.G("banquiseMat"),f.needDepthPrePass=!0,f.diffuseColor=b.diffuseColor,b.diffuseTexture&&(f.diffuseTexture=b.diffuseTexture),u.material=f,f.cullBackFaces=!1);return d=s.eaF.MergeMeshes(i,!0,void 0,void 0,void 0,!0),d&&(d.parent=e,t.mesh=d,e.position=this._banquisePosition,e.rotate(s.Pq0.Up(),s.uMQ.FromDegrees(-90).radians(),s.$xS.WORLD),h=new s.aZl(d,s.AHY.STATIC,!1,Pe.scene),p=new s.JNI({type:s.DKo.MESH,parameters:{mesh:d}},Pe.scene),h.shape=p,h.disablePreStep=!1,Pe.scene.onBeforeRenderObservable.addOnce((function(){return h.disablePreStep=!0})),be.createFox().then((function(t){var n;t.transformNode.position=new s.Pq0(-8,1.4,0),t.transformNode.parent=e;var r=new oe(t.transformNode.absolutePosition.add(new s.Pq0(0,20,0)),s.v9j.Green()),i=null===(n=t.conversation)||void 0===n?void 0:n.onConversationEnd.add((function(){var e;Z.instance.templeBall||(Z.instance.grabBall(r),null===(e=t.conversation)||void 0===e||e.onConversationEnd.remove(null!==i&&void 0!==i?i:null))}))}))),[2]}}))}))}}),Object.defineProperty(e,"createArchipel",{enumerable:!1,configurable:!0,writable:!0,value:function(){return(0,l.sH)(this,void 0,void 0,(function(){var e,t,n,r,i,a,o,u,c,b,f,d,h,p;return(0,l.YH)(this,(function(l){switch(l.label){case 0:return e=new s.VR0("archipel transform"),t=new z,t.name="L'Archipel Carotte",t.detectionZone=new U({diameter:200},!0),[4,M.loadMesh("models/scenes/archipel.glb")];case 1:for(n=l.sent(),r=n.meshes[0],r.position=s.Pq0.Zero(),r.parent=e,i=r.getChildMeshes(),a=0,o=n.meshes;a<o.length;a++)u=o[a],c=u.material,b=u.material,c?(f=new re.G("archipelMat"),f.needDepthPrePass=!0,f.diffuseColor=c.albedoColor,c.albedoTexture&&(f.diffuseTexture=c.albedoTexture),u.material=f):b&&(f=new re.G("archipelMat"),f.needDepthPrePass=!0,f.diffuseColor=b.diffuseColor,b.diffuseTexture&&(f.diffuseTexture=b.diffuseTexture),u.material=f);return d=s.eaF.MergeMeshes(i,!0,void 0,void 0,void 0,!0),d&&(d.parent=e,t.mesh=d,e.position=this._archipelPosition,e.rotate(s.Pq0.Up(),s.uMQ.FromDegrees(-90).radians(),s.$xS.WORLD),h=new s.aZl(d,s.AHY.STATIC,!1,Pe.scene),p=new s.JNI({type:s.DKo.MESH,parameters:{mesh:d}},Pe.scene),h.shape=p,h.disablePreStep=!1,Pe.scene.onBeforeRenderObservable.addOnce((function(){return h.disablePreStep=!0})),be.createRabbit().then((function(t){var n;t.transformNode.position=new s.Pq0(-.8,5.2,-.7),t.transformNode.parent=e;var r=new oe(t.transformNode.absolutePosition.add(new s.Pq0(0,20,0)),s.v9j.Red()),i=null===(n=t.conversation)||void 0===n?void 0:n.onConversationEnd.add((function(){var e;Z.instance.templeBall||(Z.instance.grabBall(r),null===(e=t.conversation)||void 0===e||e.onConversationEnd.remove(null!==i&&void 0!==i?i:null))}))}))),[2]}}))}))}}),Object.defineProperty(e,"createPoulpe",{enumerable:!1,configurable:!0,writable:!0,value:function(){return(0,l.sH)(this,void 0,void 0,(function(){var e,t,n,r,i,a,o,u,c,b,f,d,h,p;return(0,l.YH)(this,(function(l){switch(l.label){case 0:return e=new s.VR0("poulpe transform"),t=new z,t.name="Le Poulpensant",t.detectionZone=new U({diameter:200},!0),[4,M.loadMesh("models/scenes/poulpe.glb")];case 1:for(n=l.sent(),r=n.meshes[0],r.position=s.Pq0.Zero(),r.parent=e,i=r.getChildMeshes(),a=0,o=n.meshes;a<o.length;a++)u=o[a],c=u.material,b=u.material,c?(f=new re.G("poulpeMat"),f.needDepthPrePass=!0,f.diffuseColor=c.albedoColor,c.albedoTexture&&(f.diffuseTexture=c.albedoTexture),u.material=f):b&&(f=new re.G("poulpeMat"),f.needDepthPrePass=!0,f.diffuseColor=b.diffuseColor,b.diffuseTexture&&(f.diffuseTexture=b.diffuseTexture),u.material=f);return d=s.eaF.MergeMeshes(i,!0,void 0,void 0,void 0,!0),d&&(d.parent=e,t.mesh=d,e.position=this._poulpePosition,h=new s.aZl(d,s.AHY.STATIC,!1,Pe.scene),p=new s.JNI({type:s.DKo.MESH,parameters:{mesh:d}},Pe.scene),h.shape=p,h.disablePreStep=!1,Pe.scene.onBeforeRenderObservable.addOnce((function(){return h.disablePreStep=!0})),be.createScribe().then((function(t){var n;t.transformNode.position=new s.Pq0(-1.57,.8,5.8),t.transformNode.parent=e;var r=new oe(t.transformNode.absolutePosition.add(new s.Pq0(0,20,0)),s.v9j.Purple()),i=null===(n=t.conversation)||void 0===n?void 0:n.onConversationEnd.add((function(){var e;Z.instance.templeBall||(Z.instance.grabBall(r),null===(e=t.conversation)||void 0===e||e.onConversationEnd.remove(null!==i&&void 0!==i?i:null))}))}))),[2]}}))}))}}),Object.defineProperty(e,"createPhare",{enumerable:!1,configurable:!0,writable:!0,value:function(){return(0,l.sH)(this,void 0,void 0,(function(){var e,t,n,r,i,a,o,u,c,b,f,d,h,p;return(0,l.YH)(this,(function(l){switch(l.label){case 0:return e=new s.VR0("phare transform"),t=new z,t.name="Le Phare Flashouille",t.detectionZone=new U({diameter:200},!0),[4,M.loadMesh("models/scenes/phare.glb")];case 1:for(n=l.sent(),r=n.meshes[0],r.position=s.Pq0.Zero(),r.parent=e,i=r.getChildMeshes(),a=0,o=n.meshes;a<o.length;a++)u=o[a],c=u.material,b=u.material,c?(f=new re.G("phareMat"),f.needDepthPrePass=!0,f.diffuseColor=c.albedoColor,c.albedoTexture&&(f.diffuseTexture=c.albedoTexture),u.material=f):b&&(f=new re.G("phareMat"),f.needDepthPrePass=!0,f.diffuseColor=b.diffuseColor,b.diffuseTexture&&(f.diffuseTexture=b.diffuseTexture),u.material=f);return d=s.eaF.MergeMeshes(i,!0,void 0,void 0,void 0,!0),d&&(d.parent=e,t.mesh=d,e.position=this._pharePosition,h=new s.aZl(d,s.AHY.STATIC,!1,Pe.scene),p=new s.JNI({type:s.DKo.MESH,parameters:{mesh:d}},Pe.scene),h.shape=p,h.disablePreStep=!1,Pe.scene.onBeforeRenderObservable.addOnce((function(){return h.disablePreStep=!0})),be.createGirl().then((function(t){var n;t.transformNode.position=new s.Pq0(1.2,1.26,-16.9),t.transformNode.parent=e;var r=new oe(t.transformNode.absolutePosition.add(new s.Pq0(0,20,0)),s.v9j.Blue()),i=null===(n=t.conversation)||void 0===n?void 0:n.onConversationEnd.add((function(){var e;Z.instance.templeBall||(Z.instance.grabBall(r),null===(e=t.conversation)||void 0===e||e.onConversationEnd.remove(null!==i&&void 0!==i?i:null))}))}))),[2]}}))}))}}),Object.defineProperty(e,"_dolphinPosition",{enumerable:!0,configurable:!0,writable:!0,value:new s.Pq0(0,0,160)}),Object.defineProperty(e,"_templePosition",{enumerable:!0,configurable:!0,writable:!0,value:new s.Pq0(0,0,500)}),Object.defineProperty(e,"_banquisePosition",{enumerable:!0,configurable:!0,writable:!0,value:new s.Pq0(-200,0,680)}),Object.defineProperty(e,"_archipelPosition",{enumerable:!0,configurable:!0,writable:!0,value:new s.Pq0(200,0,680)}),Object.defineProperty(e,"_pharePosition",{enumerable:!0,configurable:!0,writable:!0,value:new s.Pq0(-250,0,420)}),Object.defineProperty(e,"_poulpePosition",{enumerable:!0,configurable:!0,writable:!0,value:new s.Pq0(250,0,420)}),e}(),he=function(){function e(){Object.defineProperty(this,"_sky",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_sea",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_submarine",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),e._instance=this,this._sea=new g,this._submarine=new Z,this._sky=new p,de.createDolphinIsland(),de.createTemple(),de.createBanquise(),de.createPhare(),de.createPoulpe(),de.createArchipel()}return Object.defineProperty(e.prototype,"submarine",{get:function(){return this._submarine},enumerable:!1,configurable:!0}),Object.defineProperty(e,"submarine",{get:function(){return this.instance.submarine},enumerable:!1,configurable:!0}),Object.defineProperty(e,"instance",{get:function(){return this._instance},enumerable:!1,configurable:!0}),e}(),pe=function(e){function t(){var t=e.call(this)||this;return Object.defineProperty(t,"_container",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),t._container=new C.tN,t._container.width="300px",t._container.height="200px",t._container.thickness=0,t._container.scaleY=.5,t._container.scaleX=.5,P.instance.onInteractionAvailable.add((function(e){e instanceof V&&t.show(e)})),P.instance.onInteractionUnavailable.add((function(e){e instanceof V&&t.hide()})),t}return(0,l.C6)(t,e),Object.defineProperty(t.prototype,"controlNode",{get:function(){return this._container},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"show",{enumerable:!1,configurable:!0,writable:!0,value:function(e){var t;this._container.isVisible=!0;var n=new C.tN;n.width="280px",n.height="100px",n.cornerRadius=60,n.color="rgb(168, 98, 68)",n.thickness=4,n.background="rgb(255, 199, 130)",this._container.addControl(n);var r=new C.VJ;r.fontSize=45,r.text="".concat(e.description),n.addControl(r);var i=new C.tN;i.width="100px",i.height="85px",i.cornerRadius=60,i.color="rgb(168, 98, 68)",i.thickness=4,i.background="rgb(255, 255, 255)",i.horizontalAlignment=C.Ec.HORIZONTAL_ALIGNMENT_RIGHT,i.verticalAlignment=C.Ec.VERTICAL_ALIGNMENT_BOTTOM,this._container.addControl(i);var a=new C.VJ;a.fontSize=60,a.text="".concat(e.simplifiedCode),a.fontWeight="bold",a.paddingTop="6px",i.addControl(a),this._container.linkWithMesh(null!==(t=e.mesh)&&void 0!==t?t:null),this._container.linkOffsetY="-140px"}}),Object.defineProperty(t.prototype,"hide",{enumerable:!1,configurable:!0,writable:!0,value:function(){this._container.isVisible=!1,this._container.linkWithMesh(null)}}),t}(j),me=function(e){function t(){var t=e.call(this)||this;return Object.defineProperty(t,"_textBlock",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),t._textBlock=new C.VJ,z.onAnyKeyZoneEntered.add((function(e){return t.show(e)})),t}return(0,l.C6)(t,e),Object.defineProperty(t.prototype,"controlNode",{get:function(){return this._textBlock},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"show",{enumerable:!1,configurable:!0,writable:!0,value:function(e){var t=this;this._textBlock.isVisible=!0,this._textBlock.text=e.name,e.discovered?(this._textBlock.horizontalAlignment=C.Ec.HORIZONTAL_ALIGNMENT_LEFT,this._textBlock.verticalAlignment=C.Ec.VERTICAL_ALIGNMENT_BOTTOM,this._textBlock.paddingLeft="20px",this._textBlock.paddingBottom="20px",this._textBlock.color="white",this._textBlock.fontSize="24px",this._textBlock.textHorizontalAlignment=C.Ec.HORIZONTAL_ALIGNMENT_LEFT):(this._textBlock.color="white",this._textBlock.fontSize="48px",this._textBlock.fontStyle="bold",this._textBlock.textHorizontalAlignment=C.Ec.HORIZONTAL_ALIGNMENT_CENTER,this._textBlock.textVerticalAlignment=C.Ec.VERTICAL_ALIGNMENT_TOP,this._textBlock.paddingTop="30px"),setTimeout((function(){t._textBlock.isVisible=!1}),3e3)}}),t}(j),ge=function(e){function t(t){var n=e.call(this)||this;Object.defineProperty(n,"_mainMenu",{enumerable:!0,configurable:!0,writable:!0,value:t}),Object.defineProperty(n,"_panel",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),n._panel=new C.Pc,n._panel.width="600px",n._panel.horizontalAlignment=C.Ec.HORIZONTAL_ALIGNMENT_LEFT,n._panel.verticalAlignment=C.Ec.VERTICAL_ALIGNMENT_CENTER,n._panel.spacing=15,n._panel.paddingLeft="60px",n.createSliderWithLabel("Volume SFX",q.instance.SFXVolume,(function(e){q.instance.SFXVolume=e})),n.createSliderWithLabel("Volume Musique",q.instance.MUSICVolume,(function(e){q.instance.MUSICVolume=e})),n.createSliderWithLabel("Volume UI",q.instance.UIVolume,(function(e){q.instance.UIVolume=e}));var r=ve.createButton("Retour",(function(){n.hide()}));return r.width="300px",r.height="40px",r.color="white",r.background="rgba(255, 255, 255, 0.05)",n._panel.addControl(r),n._panel.isVisible=!1,Pe.scene.onKeyboardObservable.add((function(e){var t=e.type===s.TBB.KEYDOWN;"Escape"===e.event.key&&t&&n.controlNode.isVisible&&n.hide()})),n}return(0,l.C6)(t,e),Object.defineProperty(t.prototype,"controlNode",{get:function(){return this._panel},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"createSliderWithLabel",{enumerable:!1,configurable:!0,writable:!0,value:function(e,t,n){var r=new C.Pc;r.isVertical=!1,r.height="40px",r.paddingBottom="10px",r.horizontalAlignment=C.Ec.HORIZONTAL_ALIGNMENT_CENTER,r.verticalAlignment=C.Ec.VERTICAL_ALIGNMENT_CENTER;var i=new C.VJ;i.text=e,i.color="white",i.width="120px",i.fontSize=14,i.fontStyle="bold",i.textHorizontalAlignment=C.Ec.HORIZONTAL_ALIGNMENT_LEFT,i.paddingRight="10px";var a=new C.Ap;a.minimum=0,a.maximum=1,a.value=t,a.width="150px",a.height="14px",a.color="#FFF",a.background="#333",a.thumbWidth="18px",a.thumbColor="#AAA",a.borderColor="#888";var o=new C.VJ;o.text=Math.round(100*t).toString()+" %",o.width="50px",o.color="white",o.fontSize=14,o.textHorizontalAlignment=C.Ec.HORIZONTAL_ALIGNMENT_RIGHT,o.paddingLeft="10px",a.onValueChangedObservable.add((function(e){o.text=Math.round(100*e).toString()+" %",n(e)})),r.addControl(i),r.addControl(a),r.addControl(o),this._panel.addControl(r)}}),Object.defineProperty(t.prototype,"show",{enumerable:!1,configurable:!0,writable:!0,value:function(){this._panel.isVisible=!0}}),Object.defineProperty(t.prototype,"hide",{enumerable:!1,configurable:!0,writable:!0,value:function(){this._panel.isVisible=!1,this._mainMenu.show()}}),t}(j),ve=function(e){function t(){var n=e.call(this)||this;Object.defineProperty(n,"_panel",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(n,"_optionMenuUI",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(n,"_canvas",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),n._optionMenuUI=new ge(n),n._panel=new C.Pc,n._panel.width="300px",n._panel.horizontalAlignment=C.Ec.HORIZONTAL_ALIGNMENT_LEFT,n._panel.verticalAlignment=C.Ec.VERTICAL_ALIGNMENT_CENTER,n._panel.paddingLeft="60px",n._panel.spacing=20;var r=t.createButton("Jouer",(function(){return n.onPlayPressed()})),i=t.createButton("Options",(function(){return n.onOptionsPressed()}));t.createButton("Quitter",(function(){return n.onQuitPressed()}));return n._panel.addControl(r),n._panel.addControl(i),n.show(),Pe.scene.onKeyboardObservable.add((function(e){var t=e.type===s.TBB.KEYDOWN;"Escape"===e.event.key&&t&&!n.optionsMenuUI.controlNode.isVisible&&n._canvas&&(n._panel.isVisible?n.onPlayPressed():n.show())})),n}return(0,l.C6)(t,e),Object.defineProperty(t.prototype,"canvas",{set:function(e){this._canvas=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"controlNode",{get:function(){return this._panel},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"optionsMenuUI",{get:function(){return this._optionMenuUI},enumerable:!1,configurable:!0}),Object.defineProperty(t,"createButton",{enumerable:!1,configurable:!0,writable:!0,value:function(e,t){var n=C.$n.CreateSimpleButton(e.toLowerCase(),e);return n.width="100%",n.height="60px",n.color="white",n.background="rgba(255, 255, 255, 0.05)",n.fontSize="28px",n.fontStyle="bold",n.textBlock.textHorizontalAlignment=C.Ec.HORIZONTAL_ALIGNMENT_LEFT,n.textBlock.paddingLeft="20px",n.cornerRadius=10,n.thickness=1,n.paddingBottom="10px",n.onPointerEnterObservable.add((function(){n.background="rgba(255, 255, 255, 0.2)"})),n.onPointerOutObservable.add((function(){n.background="rgba(255, 255, 255, 0.05)"})),n.onPointerUpObservable.add(t),n}}),Object.defineProperty(t.prototype,"show",{enumerable:!1,configurable:!0,writable:!0,value:function(){this._panel.isVisible=!0}}),Object.defineProperty(t.prototype,"hide",{enumerable:!1,configurable:!0,writable:!0,value:function(){this._panel.isVisible=!1}}),Object.defineProperty(t.prototype,"onPlayPressed",{enumerable:!1,configurable:!0,writable:!0,value:function(){this._canvas&&(this._canvas.requestPointerLock(),this.hide())}}),Object.defineProperty(t.prototype,"onOptionsPressed",{enumerable:!1,configurable:!0,writable:!0,value:function(){this._optionMenuUI.show(),this.hide()}}),Object.defineProperty(t.prototype,"onQuitPressed",{enumerable:!1,configurable:!0,writable:!0,value:function(){console.log("Quitter !")}}),t}(j),ye=function(e){function t(){var t=e.call(this)||this;return Object.defineProperty(t,"_panel",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),t._panel=new C.Pc,t._panel.horizontalAlignment=C.Ec.HORIZONTAL_ALIGNMENT_RIGHT,t._panel.verticalAlignment=C.Ec.VERTICAL_ALIGNMENT_TOP,t._panel.width="25%",t._panel.height="100%",t._panel.paddingRight="10px",t._panel.paddingTop="20px",t._panel.isVertical=!0,t._panel.spacing=10,Pe.scene.onBeforeRenderObservable.add((function(){t.refresh()})),t}return(0,l.C6)(t,e),Object.defineProperty(t.prototype,"controlNode",{get:function(){return this._panel},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"refresh",{enumerable:!1,configurable:!0,writable:!0,value:function(){var e=this;this._panel.clearControls();var t=ue.instance.getAllActiveQuests();0!==t.length?t.forEach((function(t){var n=new C.Pc;n.isVertical=!0,n.width="100%";var r=new C.VJ;r.text="⛋ ".concat(t.name),r.color="white",r.fontSize=20,r.fontWeight="bold",r.textHorizontalAlignment=C.Ec.HORIZONTAL_ALIGNMENT_LEFT,r.height="28px",r.paddingBottom="6px";var i=new C.VJ;i.text=t.steps[t.currentStepIndex].description,i.color="#FFFFFF",i.fontSize=17,i.textHorizontalAlignment=C.Ec.HORIZONTAL_ALIGNMENT_CENTER,i.height="28px",i.textWrapping=!0,i.paddingLeft="16px",i.paddingBottom="10px",n.addControl(r),n.addControl(i),n.addControl(e.createSeparator()),e._panel.addControl(n)})):this._panel.addControl(this.createSeparator())}}),Object.defineProperty(t.prototype,"createSeparator",{enumerable:!1,configurable:!0,writable:!0,value:function(){var e=new C.tN;return e.height="5px",e.width="100%",e.background="white",e.thickness=0,e.paddingTop="4px",e}}),t}(j),_e=function(){function e(e){Object.defineProperty(this,"_canvas",{enumerable:!0,configurable:!0,writable:!0,value:e}),Object.defineProperty(this,"_ui",{enumerable:!0,configurable:!0,writable:!0,value:C.vs.CreateFullscreenUI("_ui",void 0,Pe.scene)}),Object.defineProperty(this,"_worldInteractionUI",{enumerable:!0,configurable:!0,writable:!0,value:new pe}),Object.defineProperty(this,"_dialogueInteractionUI",{enumerable:!0,configurable:!0,writable:!0,value:new R}),Object.defineProperty(this,"_islandsUI",{enumerable:!0,configurable:!0,writable:!0,value:new me}),Object.defineProperty(this,"_mainMenuUI",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_optionsMenuUI",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_questUI",{enumerable:!0,configurable:!0,writable:!0,value:new ye}),Object.defineProperty(this,"_journalUI",{enumerable:!0,configurable:!0,writable:!0,value:new ce}),this._ui.addControl(this._worldInteractionUI.controlNode),this._ui.addControl(this._dialogueInteractionUI.controlNode),this._ui.addControl(this._islandsUI.controlNode),this._mainMenuUI=new ve,this._optionsMenuUI=this._mainMenuUI.optionsMenuUI,this._ui.addControl(this._optionsMenuUI.controlNode),this._ui.addControl(this._mainMenuUI.controlNode),this._mainMenuUI.canvas=e,this._ui.addControl(this._questUI.controlNode),this._ui.addControl(this._journalUI.controlNode)}return Object.defineProperty(e.prototype,"showMainMenu",{enumerable:!1,configurable:!0,writable:!0,value:function(){this._mainMenuUI&&this._mainMenuUI.show()}}),e}(),Pe=function(){function e(t,n){var r=this;Object.defineProperty(this,"_canvas",{enumerable:!0,configurable:!0,writable:!0,value:t}),Object.defineProperty(this,"_havok",{enumerable:!0,configurable:!0,writable:!0,value:n}),Object.defineProperty(this,"_scene",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_engine",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_world",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_player",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_isGameFocused",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"_camera",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_interactionManager",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_uiManager",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_soundManager",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_questManager",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),e._instance=this,this._engine=new s.N$8(this._canvas),this._scene=new s.Z58(this._engine),this._scene.enablePhysics(new s.Pq0(0,-9.81,0),n),this._interactionManager=new P,this._camera=new y,this._world=new he,this._player=new D,this._soundManager=new q,this._uiManager=new _e(t),this._questManager=new ue,document.addEventListener("pointerlockchange",(function(){r.updateFocusState(document.pointerLockElement===t)})),this._engine.runRenderLoop((function(){r._scene.render()})),window.addEventListener("resize",(function(){return r._engine.resize()}))}return Object.defineProperty(e,"canvas",{get:function(){return this._instance._canvas},enumerable:!1,configurable:!0}),Object.defineProperty(e,"engine",{get:function(){return e._instance._engine},enumerable:!1,configurable:!0}),Object.defineProperty(e,"scene",{get:function(){return e._instance._scene},enumerable:!1,configurable:!0}),Object.defineProperty(e,"uiManager",{get:function(){return e._instance._uiManager},enumerable:!1,configurable:!0}),Object.defineProperty(e,"isGameFocused",{get:function(){return e._instance._isGameFocused},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"updateFocusState",{enumerable:!1,configurable:!0,writable:!0,value:function(t){t!=this._isGameFocused&&(this._isGameFocused=t,e.onGameFocusChange.notifyObservers(this._isGameFocused),this._isGameFocused||e.uiManager.showMainMenu())}}),Object.defineProperty(e,"onGameFocusChange",{enumerable:!0,configurable:!0,writable:!0,value:new s.cPK}),e}(),we=n(61823),Oe=(0,i.pM)({name:"YellowSubmarine",props:{msg:String},mounted:function(){return(0,l.sH)(this,void 0,void 0,(function(){var e;return(0,l.YH)(this,(function(t){switch(t.label){case 0:return e=document.getElementById("mainCanvas"),s.N$8.ShadersRepository="../shaders/",[4,(0,we.A)().then((function(t){var n=new s.P3(!0,t);new Pe(e,n)}))];case 1:return t.sent(),[2]}}))}))}}),je=n(66262);const Ce=(0,je.A)(Oe,[["render",o],["__scopeId","data-v-65f31b32"]]);var Me=Ce,Te=(0,i.pM)({name:"App",components:{YellowSubmarine:Me}});const xe=(0,je.A)(Te,[["render",a]]);var Ie=xe;(0,r.Ef)(Ie).mount("#app")}},t={};function n(r){var i=t[r];if(void 0!==i)return i.exports;var a=t[r]={exports:{}};return e[r](a,a.exports,n),a.exports}n.m=e,function(){var e=[];n.O=function(t,r,i,a){if(!r){var o=1/0;for(c=0;c<e.length;c++){r=e[c][0],i=e[c][1],a=e[c][2];for(var l=!0,s=0;s<r.length;s++)(!1&a||o>=a)&&Object.keys(n.O).every((function(e){return n.O[e](r[s])}))?r.splice(s--,1):(l=!1,a<o&&(o=a));if(l){e.splice(c--,1);var u=i();void 0!==u&&(t=u)}}return t}a=a||0;for(var c=e.length;c>0&&e[c-1][2]>a;c--)e[c]=e[c-1];e[c]=[r,i,a]}}(),function(){n.d=function(e,t){for(var r in t)n.o(t,r)&&!n.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})}}(),function(){n.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}()}(),function(){n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)}}(),function(){n.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}}(),function(){n.p="/YellowSubmarine/"}(),function(){n.b=document.baseURI||self.location.href;var e={524:0};n.O.j=function(t){return 0===e[t]};var t=function(t,r){var i,a,o=r[0],l=r[1],s=r[2],u=0;if(o.some((function(t){return 0!==e[t]}))){for(i in l)n.o(l,i)&&(n.m[i]=l[i]);if(s)var c=s(n)}for(t&&t(r);u<o.length;u++)a=o[u],n.o(e,a)&&e[a]&&e[a][0](),e[a]=0;return n.O(c)},r=self["webpackChunkyellow_submarine"]=self["webpackChunkyellow_submarine"]||[];r.forEach(t.bind(null,0)),r.push=t.bind(null,r.push.bind(r))}();var r=n.O(void 0,[504],(function(){return n(26811)}));r=n.O(r)})();
//# sourceMappingURL=app.29e88c6c.js.map