(function(){"use strict";var e={99774:function(e,t,n){var r=n(53751),i=n(20641);function a(e,t,n,r,a,o){var l=(0,i.g2)("YellowSubmarine");return(0,i.uX)(),(0,i.Wv)(l)}var o=n(90033),l=["src"],s={class:"wave-text"};function u(e,t,n,a,u,c){return(0,i.uX)(),(0,i.CE)("div",null,[(0,i.bo)((0,i.Lk)("div",{id:"loadingScreen",class:(0,o.C4)({"fade-out":e.isFadingOut})},[(0,i.Lk)("img",{src:e.getLogoSrc(),alt:"Logo",class:"logo"},null,8,l),t[0]||(t[0]=(0,i.Lk)("p",{class:"fullscreen-tip"},"Pour une meilleure expérience, activez le plein écran via la touche F11.",-1)),(0,i.Lk)("h1",s,[((0,i.uX)(!0),(0,i.CE)(i.FK,null,(0,i.pI)(e.loadingText,(function(e,t){return(0,i.uX)(),(0,i.CE)("span",{key:t,class:"letter",style:(0,o.Tr)({animationDelay:"".concat(.1*t,"s")})},(0,o.v_)(e),5)})),128))])],2),[[r.aG,e.isLoading]]),t[1]||(t[1]=(0,i.Lk)("canvas",{id:"mainCanvas"},null,-1))])}var c=n(31635),b=n(50953),d=n(60331),f=function(){function e(){Object.defineProperty(this,"_bodyMesh",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_haloMesh",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_light",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this._bodyMesh=this.createBody(Ie.scene),this._haloMesh=this.createHalo(Ie.scene),this._light=this.createLight(Ie.scene),this.configMaterials(Ie.scene)}return Object.defineProperty(e.prototype,"_defaultPosition",{get:function(){return new d.Pq0(1e3,200,-1e3)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"_diameter",{get:function(){return 40},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"_intensity",{get:function(){return 1},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"_diffuse",{get:function(){return new d.v9j(1,1,1)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"_specular",{get:function(){return new d.v9j(1,1,1)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"_emissiveColor",{get:function(){return new d.v9j(1,1,1)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"createBody",{enumerable:!1,configurable:!0,writable:!0,value:function(e){var t=d.PeD.CreateSphere("celestialBody",{diameter:this._diameter,segments:32},e);return t.infiniteDistance=!0,t.isPickable=!1,t.position=this._defaultPosition,t}}),Object.defineProperty(e.prototype,"createHalo",{enumerable:!1,configurable:!0,writable:!0,value:function(e){var t=d.PeD.CreateSphere("halo",{diameter:1.05*this._diameter,segments:32},e);return t.infiniteDistance=!0,t.isPickable=!1,t.position=this._defaultPosition,t}}),Object.defineProperty(e.prototype,"createLight",{enumerable:!1,configurable:!0,writable:!0,value:function(e){var t=new d.Pq0(0,0,0);e.activeCamera&&(t=this._bodyMesh.position.subtract(e.activeCamera.position).normalize());var n=new d.ZyN("sunLight",t.negate(),e);n.intensity=this._intensity,n.shadowEnabled=!0,n.parent=this._bodyMesh,n.diffuse=this._diffuse,n.specular=this._specular;var r=new d.VA("",e);return r.intensity=.3,n}}),Object.defineProperty(e.prototype,"configMaterials",{enumerable:!1,configurable:!0,writable:!0,value:function(e){var t=new d.FUi("bodyMat",e);t.emissiveColor=this._emissiveColor,t.diffuseColor=this._diffuse,t.specularColor=this._specular,this._bodyMesh.material=t;var n=new d.FUi("haloMat",e);n.emissiveColor=this._emissiveColor,n.diffuseColor=this._diffuse,n.specularColor=this._specular,n.alpha=.5,this._haloMesh.material=n}}),Object.defineProperty(e.prototype,"bodyMesh",{get:function(){return this._bodyMesh},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"haloMesh",{get:function(){return this._haloMesh},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"light",{get:function(){return this._light},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"position",{get:function(){return this.bodyMesh.position},set:function(e){this._bodyMesh.position=e,this._haloMesh.position=e,this.light.position=e},enumerable:!1,configurable:!0}),e}(),h=function(e){function t(){var t=e.call(this)||this;return Object.defineProperty(t,"_hemiLight",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(t,"shadowGenerator",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),t._hemiLight=t.createHemiLight(Ie.scene),t.configMaterials(Ie.scene),t._hemiLight.direction=d.Pq0.Up(),t._hemiLight.isEnabled(!1),t.shadowGenerator=new d.owA(1024,t.light),t.shadowGenerator.useBlurExponentialShadowMap=!0,t.shadowGenerator.blurKernel=16,t.light.shadowEnabled=!0,Ie.scene.onBeforeRenderObservable.add((function(){if(Ie.scene.activeCamera){var e=t._bodyMesh.absolutePosition.subtract(d.Pq0.Zero()).normalize();t.light.direction=e.negate()}})),t}return(0,c.C6)(t,e),Object.defineProperty(t.prototype,"hemiLight",{get:function(){return this._hemiLight},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"hemiLightIntensity",{get:function(){return this._hemiLight.intensity},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"_emissiveColor",{get:function(){return new d.v9j(1,1,1)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"getPosition",{enumerable:!1,configurable:!0,writable:!0,value:function(){return this._bodyMesh.position}}),Object.defineProperty(t.prototype,"_direction",{get:function(){return Ie.scene.activeCamera&&(this.light.direction=this._bodyMesh.absolutePosition.subtract(d.Pq0.Zero()).normalize(),this._hemiLight.direction=this._bodyMesh.position.subtract(Ie.scene.activeCamera.position).normalize()),this.light.direction},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"createHemiLight",{enumerable:!1,configurable:!0,writable:!0,value:function(e){var t=new d.g4z("hemisphericLight",d.Pq0.Up(),e);return t.intensity=2,t.diffuse=this._diffuse,t.shadowEnabled=!1,t.parent=this._bodyMesh,t}}),t}(f),p=function(e){function t(){return e.call(this)||this}return(0,c.C6)(t,e),Object.defineProperty(t.prototype,"_defaultPosition",{get:function(){return new d.Pq0(1e3,200,-1e3)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"_diameter",{get:function(){return 40},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"_intensity",{get:function(){return 5},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"hemiLightIntensity",{get:function(){return 2},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"_diffuse",{get:function(){return new d.v9j(1,1,1)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"_specular",{get:function(){return new d.v9j(1,1,1)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"_emissiveColor",{get:function(){return new d.v9j(1,1,1)},enumerable:!1,configurable:!0}),t}(h),m=function(e){function t(){return e.call(this)||this}return(0,c.C6)(t,e),Object.defineProperty(t.prototype,"_defaultPosition",{get:function(){return new d.Pq0(1e3,200,1e3)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"_diameter",{get:function(){return 40},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"_intensity",{get:function(){return 2},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"hemiLightIntensity",{get:function(){return 1},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"_diffuse",{get:function(){return new d.v9j(1,1,1)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"_specular",{get:function(){return new d.v9j(1,1,1)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"_emissiveColor",{get:function(){return new d.v9j(1,1,1)},enumerable:!1,configurable:!0}),t}(h),g=function(){function e(){var t=this;Object.defineProperty(this,"_daySkyboxTexture",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_nightSkyboxTexture",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_shaderMaterial",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_mesh",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),e._instance=this,this._mesh=d.PeD.CreateBox("skyBox",{size:1e4},Ie.scene),this._mesh.infiniteDistance=!0,this._mesh.isPickable=!1,this._shaderMaterial=new d.BKk("skyboxMaterial",Ie.scene,{vertex:"skyboxShader",fragment:"skyboxShader"},{attributes:["position","uv"],uniforms:["worldViewProjection","timeOfTheDay"],samplers:["daySkyboxTexture","nightSkyboxTexture"]}),Ie.scene.onBeforeRenderObservable.add((function(){t._shaderMaterial.setFloat("timeOfTheDay",y.instance.dayNightCycle.timeOfTheDay)})),this._daySkyboxTexture=d.b4q.CreateFromImages(["textures/skybox/alternate day/px.png","textures/skybox/alternate day/pz.png","textures/skybox/alternate day/py.png","textures/skybox/alternate day/nx.png","textures/skybox/alternate day/nz.png","textures/skybox/alternate day/ny.png"],Ie.scene),this._daySkyboxTexture.coordinatesMode=d.gPd.SKYBOX_MODE,this._nightSkyboxTexture=d.b4q.CreateFromImages(["textures/skybox/alternate night/px.png","textures/skybox/alternate night/pz.png","textures/skybox/alternate night/py.png","textures/skybox/alternate night/nx.png","textures/skybox/alternate night/nz.png","textures/skybox/alternate night/ny.png"],Ie.scene),this._nightSkyboxTexture.coordinatesMode=d.gPd.SKYBOX_MODE,this._shaderMaterial.setTexture("daySkyboxTexture",this._daySkyboxTexture),this._shaderMaterial.setTexture("nightSkyboxTexture",this._nightSkyboxTexture),this._shaderMaterial.backFaceCulling=!1,this._mesh.material=this._shaderMaterial}return Object.defineProperty(e,"instance",{get:function(){return this._instance},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"mesh",{get:function(){return this._mesh},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"initColors",{enumerable:!1,configurable:!0,writable:!0,value:function(e){e.setColor3("dayTop",new d.v9j(.3,.78,.98)),e.setColor3("dayBottom",new d.v9j(1,.94,.8)),e.setColor3("sunsetTop",new d.v9j(1,.69,.4)),e.setColor3("sunsetBottom",new d.v9j(.58,.55,.82)),e.setColor3("dawnTop",new d.v9j(.65,.8,1)),e.setColor3("dawnBottom",new d.v9j(1,.69,.4)),e.setColor3("nightTop",new d.v9j(.043,.106,.212)),e.setColor3("nightBottom",new d.v9j(.23,.29,.42))}}),e}(),v=function(){function e(e){var t=this;Object.defineProperty(this,"_sun",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_moon",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_time",{enumerable:!0,configurable:!0,writable:!0,value:0}),this._sun=e.sun,this._moon=e.moon,Ie.scene.onBeforeRenderObservable.add((function(){t._time+=1e-5*Ie.engine.getDeltaTime(),t._time>1&&(t._time-=1),t.updateBody(t._time),t.updateLight(),t.updateMoonLight()}))}return Object.defineProperty(e.prototype,"timeOfTheDay",{get:function(){return this._time},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"updateBody",{enumerable:!1,configurable:!0,writable:!0,value:function(e){var t=2*e*Math.PI,n=2*e*Math.PI/1.5+Math.PI,r=this._sun._defaultPosition.length(),i=this._moon._defaultPosition.length(),a=Math.PI/6,o=r*Math.cos(t),l=r*Math.sin(t)*Math.sin(a),s=r*Math.sin(t)*Math.cos(a),u=Math.PI/8,c=i*Math.cos(n),b=i*Math.sin(n)*Math.sin(u),f=i*Math.sin(n)*Math.cos(u);this._sun.position=new d.Pq0(o,l,s),this._moon.position=new d.Pq0(c,b,f)}}),Object.defineProperty(e.prototype,"updateLight",{enumerable:!1,configurable:!0,writable:!0,value:function(){var e=this._sun.position,t=this._sun._defaultPosition.length(),n=e.y,r=Math.max(0,Math.min(n/t,1)),i=Math.pow(r,1.5);if(this._sun.light.intensity=i*this._sun._intensity,r<=.01?this._sun.light.setEnabled(!1):this._sun.light.setEnabled(!0),i>0&&i<.3){var a=d.v9j.FromHexString("#ff884d");this._sun.light.diffuse=d.v9j.Lerp(a,d.v9j.White(),i/.3)}else this._sun.light.diffuse=d.v9j.White();var o=this._sun.hemiLight;if(o){var l=d.v9j.FromHexString("#b6e8ff"),s=d.v9j.FromHexString("#1a1a2e");o.diffuse=d.v9j.Lerp(s,l,i)}Ie.scene.ambientColor=new d.v9j(1,0,0)}}),Object.defineProperty(e.prototype,"updateMoonLight",{enumerable:!1,configurable:!0,writable:!0,value:function(){var e=this._moon.position,t=this._moon._defaultPosition.length(),n=e.y,r=Math.max(0,Math.min(n/t,1)),i=Math.pow(r,1.5);this._moon.light&&(this._moon.light.intensity=i*this._moon._intensity,r<=.01?this._moon.light.setEnabled(!1):this._moon.light.setEnabled(!0));var a=this._moon.hemiLight;if(a){var o=d.v9j.FromHexString("#818de3"),l=d.v9j.FromHexString("#1a1a2e");a.diffuse=d.v9j.Lerp(l,o,i),a.intensity=.1+.3*i}}}),e}(),y=function(){function e(){Object.defineProperty(this,"_sun",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_moon",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_skybox",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_dayNightCycle",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),e._instance=this,this._sun=new p,this._moon=new m,this._skybox=new g,this._dayNightCycle=new v(this)}return Object.defineProperty(e,"instance",{get:function(){return this._instance},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"sun",{get:function(){return this._sun},set:function(e){this._sun=e},enumerable:!1,configurable:!0}),Object.defineProperty(e,"sun",{get:function(){return this._instance._sun},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"skybox",{get:function(){return this._skybox},set:function(e){this._skybox=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"moon",{get:function(){return this._moon},set:function(e){this._moon=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"dayNightCycle",{get:function(){return this._dayNightCycle},enumerable:!1,configurable:!0}),e}(),_=function(){function e(){var t=this;Object.defineProperty(this,"_scene",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_material",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_depthRenderer",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_depthMap",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_geometryBufferRenderer",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_gBuffer",{enumerable:!0,configurable:!0,writable:!0,value:null}),Object.defineProperty(this,"_renderListPredicate",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),e._instance=this,this._scene=Ie.scene;this._scene.activeCamera;this._material=new d.BKk("toonWaterMaterial",this._scene,{vertex:this.shaderMaterialName,fragment:this.shaderMaterialName},{attributes:["position","normal","uv"],uniforms:["world","view","projection","depthShallowColor","depthDeepColor","depthMaximumDistance","surfaceNoiseST","surfaceNoiseCutoff","foamMaxDistance","foamMinDistance","surfaceNoiseScroll","time","surfaceDistortionST","surfaceDistortionAmount","screensize","timeOfTheDay"],samplers:["linearDepthTexture","surfaceNoiseTexture","surfaceDistortionTexture","reflectionTexture"],needAlphaTesting:!0}),this._depthRenderer=this._scene.enableDepthRenderer(void 0,!1,void 0,void 0,!0),this._depthMap=this._depthRenderer.getDepthMap(),this._renderListPredicate=function(e){return e.material!==t._material},this._depthMap.renderListPredicate=this._renderListPredicate,this._material.setVector4("depthShallowColor",new d.IUQ(.325,.807,.971,.725)),this._material.setVector4("depthDeepColor",new d.IUQ(.086,.407,1,.749)),this._material.setFloat("depthMaximumDistance",10),this._material.setTexture("linearDepthTexture",this._depthMap),this._material.setVector4("surfaceNoiseST",new d.IUQ(1,4,0,0)),this._material.setTexture("surfaceNoiseTexture",new d.gPd("textures/PerlinNoise.png")),this._material.setFloat("surfaceNoiseCutoff",.85),this._material.setFloat("foamMaxDistance",.6),this._material.setFloat("foamMinDistance",.04),this._material.setVector2("surfaceNoiseScroll",new d.I9Y(.03,.03)),this._material.setVector4("surfaceDistortionST",new d.IUQ(1,1,0,0)),this._material.setFloat("surfaceDistortionAmount",.27),this._material.setTexture("surfaceDistortionTexture",new d.gPd("textures/WaterDistortion.png")),Ie.scene.onBeforeRenderObservable.add((function(){t._material.setFloat("timeOfTheDay",y.instance.dayNightCycle.timeOfTheDay)})),this._material.setVector2("screensize",new d.I9Y(window.innerWidth,window.innerHeight)),window.addEventListener("resize",(function(){return t._material.setVector2("screensize",new d.I9Y(window.innerWidth,window.innerHeight))}));var n=new d.B2G("mirrorTexture",1024,Ie.scene);if(n.mirrorPlane=d.Zcv.FromPositionAndNormal(d.Pq0.Zero(),d.Pq0.Down()),n.renderListPredicate=function(e){return!0},this._material.setTexture("reflectionTexture",n),Ie.scene.customRenderTargets.push(n),this._geometryBufferRenderer=this._scene.enableGeometryBufferRenderer(),null!=this._geometryBufferRenderer){this._geometryBufferRenderer.enableNormal,this._gBuffer=this._geometryBufferRenderer.getGBuffer(),this._gBuffer.renderListPredicate=this._renderListPredicate;var r=this._gBuffer.textures[d.IzI.NORMAL_TEXTURE_TYPE];this._material.setTexture("cameraNormalTexture",r)}var i=0;Ie.scene.onBeforeRenderObservable.add((function(){i+=Ie.engine.getDeltaTime()/1e3*.01,t._material.setFloat("time",i)}))}return Object.defineProperty(e,"instance",{get:function(){return null==this._instance&&(this._instance=new this),this._instance},enumerable:!1,configurable:!0}),Object.defineProperty(e,"material",{get:function(){return this.instance._material},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"shaderMaterialName",{get:function(){return"toonWaterAndReflections"},enumerable:!1,configurable:!0}),e}(),P=function(){function e(){Object.defineProperty(this,"_seaMesh",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_invisiblePlane",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_invisiblePlaneBody",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_invisiblePlaneShape",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),e._instance=this,this._seaMesh=d.PeD.CreateGround("waterPlane",{width:2548,height:2548,subdivisions:192},Ie.scene),this._invisiblePlane=d.PeD.CreateGround("collisionPlane",{width:2048,height:2048,subdivisions:128},Ie.scene),this._invisiblePlane.position=new d.Pq0(0,-2,0),this._invisiblePlaneBody=new d.aZl(this._invisiblePlane,d.AHY.STATIC,!1,Ie.scene),this._invisiblePlaneShape=new d.JNI({type:d.DKo.BOX,parameters:{mesh:this._invisiblePlane,extents:new d.Pq0(2048,2,2048)}},Ie.scene),this._invisiblePlaneBody.shape=this._invisiblePlaneShape,this._invisiblePlaneBody.setMassProperties({mass:0}),this._seaMesh.material=_.material}return e}(),w=(n(1389),n(84867)),O=function(){function e(){var t=this;Object.defineProperty(this,"_cameraConfiguration",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_arcRotateCamera",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_positionLerpFactor",{enumerable:!0,configurable:!0,writable:!0,value:2}),Object.defineProperty(this,"_rotationLerpFactor",{enumerable:!0,configurable:!0,writable:!0,value:2}),e._instance=this,this._arcRotateCamera=new d.Lqh("customCamera",0,0,0,d.Pq0.Zero(),Ie.scene),Ie.scene.onBeforeRenderObservable.add((function(){var e=Ie.engine.getDeltaTime()/1e3;t.update(e)}))}return Object.defineProperty(e,"instance",{get:function(){return this._instance},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"cameraConfiguration",{get:function(){return this._cameraConfiguration},set:function(e){var t=this._cameraConfiguration;this._cameraConfiguration=e,t||this.jumpToTarget()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"update",{enumerable:!1,configurable:!0,writable:!0,value:function(e){this.updatePosition(e),this.updateRotation(e)}}),Object.defineProperty(e.prototype,"jumpToTarget",{enumerable:!1,configurable:!0,writable:!0,value:function(){this._cameraConfiguration&&(this._arcRotateCamera.target=this._cameraConfiguration.targetPosition,this._arcRotateCamera.alpha=this._cameraConfiguration.wantedAlpha,this._arcRotateCamera.beta=this._cameraConfiguration.wantedBeta,this._arcRotateCamera.radius=this._cameraConfiguration.distanceFromTarget)}}),Object.defineProperty(e.prototype,"updatePosition",{enumerable:!1,configurable:!0,writable:!0,value:function(e){if(this._cameraConfiguration){var t=this._cameraConfiguration.target;t&&(this._arcRotateCamera.target=d.Pq0.Lerp(this._arcRotateCamera.target,this._cameraConfiguration.targetPosition,e*this._positionLerpFactor)),this._arcRotateCamera.radius=(0,w.Lerp)(this._arcRotateCamera.radius,this._cameraConfiguration.distanceFromTarget,e*this._positionLerpFactor),this._arcRotateCamera.lowerRadiusLimit=this._arcRotateCamera.radius,this._arcRotateCamera.upperRadiusLimit=this._arcRotateCamera.radius}}}),Object.defineProperty(e.prototype,"updateRotation",{enumerable:!1,configurable:!0,writable:!0,value:function(e){if(this._cameraConfiguration){var t=this._cameraConfiguration.wantedAlpha,n=this._cameraConfiguration.wantedBeta;this._arcRotateCamera.alpha=d.uMQ.FromDegrees(d.X5X.LerpAngle(d.uMQ.FromRadians(this._arcRotateCamera.alpha).degrees(),d.uMQ.FromRadians(t).degrees(),e*this._rotationLerpFactor)).radians(),this._arcRotateCamera.beta=d.uMQ.FromDegrees(d.X5X.LerpAngle(d.uMQ.FromRadians(this._arcRotateCamera.beta).degrees(),d.uMQ.FromRadians(n).degrees(),e*this._rotationLerpFactor)).radians()}}}),e}(),j=function(){function e(){Object.defineProperty(this,"_offset",{enumerable:!0,configurable:!0,writable:!0,value:d.Pq0.Zero()}),Object.defineProperty(this,"_wantedAlpha",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"_wantedBeta",{enumerable:!0,configurable:!0,writable:!0,value:d.uMQ.FromDegrees(80).radians()}),Object.defineProperty(this,"_distanceFromTarget",{enumerable:!0,configurable:!0,writable:!0,value:10}),Object.defineProperty(this,"_target",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_currentLowerBetaLimit",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_currentUpperBetaLimit",{enumerable:!0,configurable:!0,writable:!0,value:void 0})}return Object.defineProperty(e.prototype,"targetPosition",{get:function(){var e,t,n,r;return(null!==(t=null===(e=this._target)||void 0===e?void 0:e.absolutePosition)&&void 0!==t?t:d.Pq0.Zero()).add(this._offset.rotateByQuaternionToRef(null!==(r=null===(n=this._target)||void 0===n?void 0:n.absoluteRotationQuaternion)&&void 0!==r?r:d.PTz.Identity(),d.Pq0.Zero()))},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"offset",{get:function(){return this._offset},set:function(e){this._offset=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"wantedAlpha",{get:function(){return this._wantedAlpha},set:function(e){this._wantedAlpha=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"wantedBeta",{get:function(){return this._wantedBeta},set:function(e){this._wantedBeta=e,this._currentLowerBetaLimit&&(this._wantedBeta=Math.max(this._wantedBeta,this._currentLowerBetaLimit)),this._currentUpperBetaLimit&&(this._wantedBeta=Math.min(this._wantedBeta,this._currentUpperBetaLimit))},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"distanceFromTarget",{get:function(){return this._distanceFromTarget},set:function(e){this._distanceFromTarget=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"target",{get:function(){return this._target},set:function(e){this._target=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"currentUpperBetaLimit",{get:function(){return this._currentUpperBetaLimit},set:function(e){this._currentUpperBetaLimit=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"currentLowerBetaLimit",{get:function(){return this._currentLowerBetaLimit},set:function(e){this._currentLowerBetaLimit=e},enumerable:!1,configurable:!0}),e}(),C=function(){function e(){var t=this;Object.defineProperty(this,"_currentInteraction",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"onInteractionAvailable",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"onInteractionUnavailable",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),e._instance=this,this.onInteractionAvailable=new d.cPK,this.onInteractionUnavailable=new d.cPK,z.onPlayerPressedAKey.add((function(e){e.type===d.TBB.KEYDOWN&&t._currentInteraction&&e.event.code===t._currentInteraction.code&&t.executeInteraction()}))}return Object.defineProperty(e,"instance",{get:function(){return this._instance},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"makeInteractionAvailable",{enumerable:!1,configurable:!0,writable:!0,value:function(e){this._currentInteraction&&this.makeInteractionUnavailable(this._currentInteraction),this._currentInteraction=e,this.onInteractionAvailable.notifyObservers(e)}}),Object.defineProperty(e.prototype,"makeInteractionUnavailable",{enumerable:!1,configurable:!0,writable:!0,value:function(e){this.onInteractionUnavailable.notifyObservers(e),this._currentInteraction=void 0}}),Object.defineProperty(e.prototype,"executeInteraction",{enumerable:!1,configurable:!0,writable:!0,value:function(){var e=this._currentInteraction;e&&e.executeInteraction()}}),e}(),T=function(){function e(e,t){Object.defineProperty(this,"_code",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_simplifiedCode",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this._code=e,this._simplifiedCode=t}return Object.defineProperty(e.prototype,"code",{get:function(){return this._code},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"simplifiedCode",{get:function(){return this._simplifiedCode},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"makeAvailable",{enumerable:!1,configurable:!0,writable:!0,value:function(){C.instance.makeInteractionAvailable(this)}}),Object.defineProperty(e.prototype,"makeUnavailable",{enumerable:!1,configurable:!0,writable:!0,value:function(){C.instance.makeInteractionUnavailable(this)}}),e}(),M=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return(0,c.C6)(t,e),t}(T),I=function(){function e(){}return e}(),E=n(4037),x=function(){function e(){}return Object.defineProperty(e,"loadMesh",{enumerable:!1,configurable:!0,writable:!0,value:function(e,t,n){return(0,d.TkY)(e,null!==t&&void 0!==t?t:Ie.scene,n)}}),Object.defineProperty(e,"sleep",{enumerable:!1,configurable:!0,writable:!0,value:function(e){return new Promise((function(t){return setTimeout(t,e)}))}}),e}(),A=function(){function e(e){Object.defineProperty(this,"param",{enumerable:!0,configurable:!0,writable:!0,value:e})}return Object.defineProperty(e.prototype,"onClose",{enumerable:!1,configurable:!0,writable:!0,value:function(e){return e}}),e}(),N=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return(0,c.C6)(t,e),Object.defineProperty(t.prototype,"onOpen",{enumerable:!1,configurable:!0,writable:!0,value:function(e){return(0,c.Cl)((0,c.Cl)({},e),{italic:!0})}}),t}(A),S=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return(0,c.C6)(t,e),Object.defineProperty(t.prototype,"onOpen",{enumerable:!1,configurable:!0,writable:!0,value:function(e){return(0,c.Cl)((0,c.Cl)({},e),{bold:!0})}}),t}(A),B=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return(0,c.C6)(t,e),Object.defineProperty(t.prototype,"onOpen",{enumerable:!1,configurable:!0,writable:!0,value:function(e){return(0,c.Cl)((0,c.Cl)({},e),{color:this.param||e.color})}}),t}(A),L=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return(0,c.C6)(t,e),Object.defineProperty(t.prototype,"onOpen",{enumerable:!1,configurable:!0,writable:!0,value:function(e){var t=(0,c.Cl)({},e),n=parseInt(this.param||"");return isNaN(n)||(t.size=n),t}}),t}(A),R=function(){function e(){Object.defineProperty(this,"_registry",{enumerable:!0,configurable:!0,writable:!0,value:new Map}),this.initRegistry()}return Object.defineProperty(e.prototype,"initRegistry",{enumerable:!1,configurable:!0,writable:!0,value:function(){this._registry.set("i",N),this._registry.set("g",S),this._registry.set("c",B),this._registry.set("s",L)}}),Object.defineProperty(e.prototype,"parseBBCode",{enumerable:!1,configurable:!0,writable:!0,value:function(e){var t,n=[],r=[],i=[],a=0,o={},l=/\[\/?([a-z]+)(?:=([^\]]+))?\]/gi;while(t=l.exec(e)){var s=t[0],u=t[1],b=t[2],d=s.startsWith("[/"),f=t.index;if(f>a&&n.push({text:e.slice(a,f),style:(0,c.Cl)({},o)}),a=f+s.length,d){var h=r.pop(),p=i.pop();h&&p&&(o=p)}else{var m=this._registry.get(u);if(m){var g=new m(b);r.push(g),i.push((0,c.Cl)({},o)),o=g.onOpen(o)}}}return a<e.length&&n.push({text:e.slice(a),style:(0,c.Cl)({},o)}),n}}),e}(),F=function(){function e(e,t,n){void 0===t&&(t=24),void 0===n&&(n=4),Object.defineProperty(this,"parser",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"ctx",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"defaultFontSize",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"horizontalPadding",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.parser=new R,this.ctx=e,this.defaultFontSize=t,this.horizontalPadding=n}return Object.defineProperty(e.prototype,"layout",{enumerable:!1,configurable:!0,writable:!0,value:function(e,t){var n=this.parser.parseBBCode(e).map((function(e){return{text:e.text,style:e.style}})),r=this.splitLines(n,t);return{lines:r,segments:n}}}),Object.defineProperty(e.prototype,"getTextWidth",{enumerable:!1,configurable:!0,writable:!0,value:function(e,t){return this.ctx.font="".concat(t,"px sans-serif"),this.ctx.measureText(e).width}}),Object.defineProperty(e.prototype,"splitLines",{enumerable:!1,configurable:!0,writable:!0,value:function(e,t){for(var n=[],r=[],i=0,a=0,o=e;a<o.length;a++){var l=o[a],s=l.style.size||this.defaultFontSize,u=this.getTextWidth(l.text,s)+2*this.horizontalPadding;if(i+u<=t)r.push(l),i+=u;else for(var c=l.text.split(/(\s+)/),b=0,d=c;b<d.length;b++){var f=d[b];if(""!==f&&(""!==f.trim()||0!==r.length)){var h=this.getTextWidth(f,s)+2*this.horizontalPadding;i+h>t&&r.length&&(n.push(r),r=[],i=0,""===f.trim())||(r.push({text:f,style:l.style}),i+=h)}}}return r.length&&n.push(r),n}}),Object.defineProperty(e.prototype,"createTextBlocks",{enumerable:!1,configurable:!0,writable:!0,value:function(e,t,n,r){var i=this,a=[],o=[];return e.forEach((function(e){var l=new E.Pc;l.isVertical=!1,l.height="".concat(t,"px"),l.horizontalAlignment=E.Ec.HORIZONTAL_ALIGNMENT_CENTER,l.verticalAlignment=E.Ec.VERTICAL_ALIGNMENT_BOTTOM,e.forEach((function(e){var t=new E.VJ;t.text="",i.applyStyle(t,e.style,n,r),t.textWrapping=!1,t.resizeToFit=!0,t.verticalAlignment=E.Ec.VERTICAL_ALIGNMENT_BOTTOM,l.addControl(t),a.push({tb:t,full:e.text})})),o.push(l)})),{linesPanels:o,blocks:a}}}),Object.defineProperty(e.prototype,"applyStyle",{enumerable:!1,configurable:!0,writable:!0,value:function(e,t,n,r){e.fontWeight=t.bold?"bold":"normal",e.fontStyle=t.italic?"italic":"normal",e.color=t.color||"black",e.fontSize=t.size||r,e.paddingLeft="".concat(n,"px"),e.paddingRight="".concat(n,"px")}}),e}(),k=function(){function e(){var t=this;Object.defineProperty(this,"_audioEngine",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_SFXsounds",{enumerable:!0,configurable:!0,writable:!0,value:new Map}),Object.defineProperty(this,"_UIsounds",{enumerable:!0,configurable:!0,writable:!0,value:new Map}),Object.defineProperty(this,"_MUSICsounds",{enumerable:!0,configurable:!0,writable:!0,value:new Map}),Object.defineProperty(this,"_SFXVolume",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_UIVolume",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_MUSICVolume",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),e.instance=this,this._SFXVolume=.5,this._UIVolume=1,this._MUSICVolume=.5,Ie.scene.headphone=!0,this._audioEngine=(0,d.XdT)(),this._audioEngine.then((function(e){e.unlockAsync(),Ie.scene.onBeforeRenderObservable.add((function(){var t;null!==Ie.scene.activeCamera&&(e.listener.position=null===(t=Ie.scene.activeCamera)||void 0===t?void 0:t.position)}))})),Ie.scene.onReadyObservable.add((function(){t.playSFX("wind",{loop:!0,autoplay:!0})})),Ie.scene.onReadyObservable.add((function(){t.playMUSIC("ambiant",{loop:!0,autoplay:!0})}))}return Object.defineProperty(e.prototype,"load",{enumerable:!1,configurable:!0,writable:!0,value:function(e,t,n){return(0,c.sH)(this,void 0,void 0,(function(){return(0,c.YH)(this,(function(r){return[2,(0,d.KcJ)(e,"".concat(t,"/").concat(e,".wav"),n)]}))}))}}),Object.defineProperty(e.prototype,"play",{enumerable:!1,configurable:!0,writable:!0,value:function(e,t,n,r,i,a){var o;return(0,c.sH)(this,void 0,void 0,(function(){var l,s;return(0,c.YH)(this,(function(u){switch(u.label){case 0:return l=n.get(e),l?(l.state!==d.F6F.Started&&(this.fadeIn(l,r,100),l.play()),[3,3]):[3,1];case 1:return[4,this.load(e,t,i)];case 2:s=u.sent(),n.set(e,s),(null===i||void 0===i?void 0:i.spatialSound)&&a&&(s.spatial.attach(a),s.spatial.maxDistance=null!==(o=i.maxDistance)&&void 0!==o?o:100,s.spatial.distanceModel="linear",console.log(s.spatial)),this.fadeIn(s,r,1e3),s.play(),u.label=3;case 3:return[2]}}))}))}}),Object.defineProperty(e.prototype,"playSFX",{enumerable:!1,configurable:!0,writable:!0,value:function(e,t,n){return(0,c.sH)(this,void 0,void 0,(function(){return(0,c.YH)(this,(function(r){switch(r.label){case 0:return[4,this.play(e,"sounds/sfx",this._SFXsounds,this.SFXVolume,t,n)];case 1:return r.sent(),[2]}}))}))}}),Object.defineProperty(e.prototype,"playUI",{enumerable:!1,configurable:!0,writable:!0,value:function(e,t,n){return(0,c.sH)(this,void 0,void 0,(function(){return(0,c.YH)(this,(function(r){switch(r.label){case 0:return[4,this.play(e,"sounds/ui",this._UIsounds,this.UIVolume,t,n)];case 1:return r.sent(),[2]}}))}))}}),Object.defineProperty(e.prototype,"playMUSIC",{enumerable:!1,configurable:!0,writable:!0,value:function(e,t,n){return(0,c.sH)(this,void 0,void 0,(function(){return(0,c.YH)(this,(function(r){switch(r.label){case 0:return[4,this.play(e,"sounds/music",this._MUSICsounds,this.MUSICVolume,t,n)];case 1:return r.sent(),[2]}}))}))}}),Object.defineProperty(e.prototype,"fadeIn",{enumerable:!1,configurable:!0,writable:!0,value:function(e,t,n){e.volume=0;var r=20,i=n/r,a=0,o=setInterval((function(){a++;var n=t*(a/i);e.volume=Math.min(n,t),a>=i&&clearInterval(o)}),r)}}),Object.defineProperty(e.prototype,"fadeOutAndStop",{enumerable:!1,configurable:!0,writable:!0,value:function(e,t){var n=20,r=t/n,i=0,a=e.volume,o=setInterval((function(){i++;var t=a*(1-i/r);e.volume=Math.max(t,0),i>=r&&(clearInterval(o),e.stop())}),n)}}),Object.defineProperty(e.prototype,"stopSFX",{enumerable:!1,configurable:!0,writable:!0,value:function(e){var t=this._SFXsounds.get(e);t&&this.fadeOutAndStop(t,100)}}),Object.defineProperty(e.prototype,"stopUI",{enumerable:!1,configurable:!0,writable:!0,value:function(e){var t=this._UIsounds.get(e);t&&this.fadeOutAndStop(t,100)}}),Object.defineProperty(e.prototype,"stopMUSIC",{enumerable:!1,configurable:!0,writable:!0,value:function(e){var t=this._MUSICsounds.get(e);t&&this.fadeOutAndStop(t,100)}}),Object.defineProperty(e.prototype,"stopAll",{enumerable:!1,configurable:!0,writable:!0,value:function(e){e.forEach((function(e){e.stop()}))}}),Object.defineProperty(e.prototype,"SFXVolume",{get:function(){return this._SFXVolume},set:function(e){var t=this;this._SFXVolume=e,this._SFXsounds.forEach((function(e){e.volume=t._SFXVolume}))},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"UIVolume",{get:function(){return this._UIVolume},set:function(e){var t=this;this._UIVolume=e,this._UIsounds.forEach((function(e){e.volume=t._UIVolume}))},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"MUSICVolume",{get:function(){return this._MUSICVolume},set:function(e){var t=this;this._MUSICVolume=e,this._MUSICsounds.forEach((function(e){e.volume=t._MUSICVolume}))},enumerable:!1,configurable:!0}),e}(),D=function(){function e(){Object.defineProperty(this,"_advanceRequested",{enumerable:!0,configurable:!0,writable:!0,value:!1})}return Object.defineProperty(e.prototype,"advanceRequested",{get:function(){return this._advanceRequested},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"requestAdvance",{enumerable:!1,configurable:!0,writable:!0,value:function(){this._advanceRequested=!0}}),Object.defineProperty(e.prototype,"resetAdvance",{enumerable:!1,configurable:!0,writable:!0,value:function(){this._advanceRequested=!1}}),Object.defineProperty(e.prototype,"animateBlocks",{enumerable:!1,configurable:!0,writable:!0,value:function(e,t){return(0,c.sH)(this,void 0,void 0,(function(){var n,r,i,a,o,l,s;return(0,c.YH)(this,(function(u){switch(u.label){case 0:k.instance&&k.instance.playSFX("text",{loop:!0,autoplay:!0}),n=!1,r=0,i=e,u.label=1;case 1:if(!(r<i.length))return[3,7];a=i[r],o=a.tb,l=a.full,s=1,u.label=2;case 2:return s<=l.length?(o.text=l.slice(0,s),this._advanceRequested?(n=!0,[3,5]):[4,x.sleep(t)]):[3,5];case 3:u.sent(),u.label=4;case 4:return s++,[3,2];case 5:if(n)return[3,7];u.label=6;case 6:return r++,[3,1];case 7:return k.instance&&k.instance.stopSFX("text"),[2]}}))}))}}),e}(),H=function(e){function t(){var t=e.call(this)||this;return Object.defineProperty(t,"CONTAINER_WIDTH",{enumerable:!0,configurable:!0,writable:!0,value:.4}),Object.defineProperty(t,"CONTAINER_CORNER_RADIUS",{enumerable:!0,configurable:!0,writable:!0,value:10}),Object.defineProperty(t,"CONTAINER_THICKNESS",{enumerable:!0,configurable:!0,writable:!0,value:5}),Object.defineProperty(t,"CONTAINER_COLOR",{enumerable:!0,configurable:!0,writable:!0,value:"rgb(168, 98, 68)"}),Object.defineProperty(t,"CONTAINER_BACKGROUND",{enumerable:!0,configurable:!0,writable:!0,value:"rgb(255, 199, 130)"}),Object.defineProperty(t,"CONTAINER_OFFSET_Y",{enumerable:!0,configurable:!0,writable:!0,value:-200}),Object.defineProperty(t,"TEXT_PADDING",{enumerable:!0,configurable:!0,writable:!0,value:8}),Object.defineProperty(t,"TEXT_BLOCK_HORIZONTAL_PADDING",{enumerable:!0,configurable:!0,writable:!0,value:2}),Object.defineProperty(t,"TEXT_DEFAULT_FONT_SIZE",{enumerable:!0,configurable:!0,writable:!0,value:24}),Object.defineProperty(t,"TEXT_LINE_SPACING",{enumerable:!0,configurable:!0,writable:!0,value:8}),Object.defineProperty(t,"TEXT_EXTRA_CONTAINER_MARGIN",{enumerable:!0,configurable:!0,writable:!0,value:20}),Object.defineProperty(t,"TEXT_SPEED",{enumerable:!0,configurable:!0,writable:!0,value:20}),Object.defineProperty(t,"TRIANGLE_IMAGE_PATH",{enumerable:!0,configurable:!0,writable:!0,value:"ui/triangle.png"}),Object.defineProperty(t,"TRIANGLE_SIZE",{enumerable:!0,configurable:!0,writable:!0,value:"24px"}),Object.defineProperty(t,"TRIANGLE_BLINK_INTERVAL",{enumerable:!0,configurable:!0,writable:!0,value:300}),Object.defineProperty(t,"_container",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(t,"_verticalStack",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(t,"_triangle",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(t,"_layoutManager",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(t,"_textAnimator",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),t.initContainer(),t.initStack(),t.initTriangle(),t._layoutManager=new F(function(){var e=document.createElement("canvas");return e.getContext("2d")}(),t.TEXT_DEFAULT_FONT_SIZE,t.TEXT_BLOCK_HORIZONTAL_PADDING),t._textAnimator=new D,U.onAnyConversationStart.add((function(e){var n;t._container.isVisible=!0,(null===(n=e.conversationProvider)||void 0===n?void 0:n.mesh)&&(t._container.linkWithMesh(e.conversationProvider.mesh),t._container.linkOffsetY=t.CONTAINER_OFFSET_Y)})),U.onAnyConversationEnd.add((function(){t._stopBlink(),t._container.isVisible=!1})),U.onAnyDialogueStart.add((function(e){return t.showText(e.text,t.TEXT_SPEED)})),t}return(0,c.C6)(t,e),Object.defineProperty(t.prototype,"controlNode",{get:function(){return this._container},enumerable:!1,configurable:!0}),Object.defineProperty(t,"isTextFullyDisplayed",{get:function(){return this._isTextFullyDisplayed},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"initContainer",{enumerable:!1,configurable:!0,writable:!0,value:function(){this._container=new E.tN,this._container.width="".concat(100*this.CONTAINER_WIDTH,"%"),this._container.cornerRadius=this.CONTAINER_CORNER_RADIUS,this._container.thickness=this.CONTAINER_THICKNESS,this._container.color=this.CONTAINER_COLOR,this._container.background=this.CONTAINER_BACKGROUND,this._container.verticalAlignment=E.Ec.VERTICAL_ALIGNMENT_BOTTOM,this._container.horizontalAlignment=E.Ec.HORIZONTAL_ALIGNMENT_CENTER,this._container.isVisible=!1,this._container.paddingLeft="".concat(this.TEXT_PADDING,"px"),this._container.paddingRight="".concat(this.TEXT_PADDING,"px")}}),Object.defineProperty(t.prototype,"initStack",{enumerable:!1,configurable:!0,writable:!0,value:function(){this._verticalStack=new E.Pc,this._verticalStack.isVertical=!0,this._verticalStack.width="100%",this._verticalStack.paddingBottom="5px",this._container.addControl(this._verticalStack)}}),Object.defineProperty(t.prototype,"initTriangle",{enumerable:!1,configurable:!0,writable:!0,value:function(){this._triangle=new E._V("nextTriangle",this.TRIANGLE_IMAGE_PATH),this._triangle.width=this.TRIANGLE_SIZE,this._triangle.height=this.TRIANGLE_SIZE,this._triangle.verticalAlignment=E.Ec.VERTICAL_ALIGNMENT_BOTTOM,this._triangle.horizontalAlignment=E.Ec.HORIZONTAL_ALIGNMENT_RIGHT,this._triangle.isVisible=!1,this._container.addControl(this._triangle)}}),Object.defineProperty(t.prototype,"showText",{enumerable:!1,configurable:!0,writable:!0,value:function(e,n){return(0,c.sH)(this,void 0,void 0,(function(){var r,i,a,o,l,s,u,b,d,f,h,p,m,g,v=this;return(0,c.YH)(this,(function(c){switch(c.label){case 0:return t._isTextFullyDisplayed=!1,this._stopBlink(),this._textAnimator.resetAdvance(),this._verticalStack.clearControls(),r=U.onAdvanceDialogueRequested.add((function(){v._textAnimator.requestAdvance()})),i=document.querySelector("canvas").clientWidth,a=i*this.CONTAINER_WIDTH,o=a-2*this.TEXT_PADDING-2*this.TEXT_BLOCK_HORIZONTAL_PADDING,l=this._layoutManager.layout(e,o),s=l.lines,u=l.segments,b=Math.max.apply(Math,u.map((function(e){return e.style.size||v.TEXT_DEFAULT_FONT_SIZE}))),d=1.2*b+this.TEXT_LINE_SPACING,f=this._layoutManager.createTextBlocks(s,d,this.TEXT_BLOCK_HORIZONTAL_PADDING,this.TEXT_DEFAULT_FONT_SIZE),h=f.linesPanels,p=f.blocks,h.forEach((function(e){v._verticalStack.addControl(e)})),m=s.length*d,g=m+2*this.TEXT_PADDING+this.TEXT_EXTRA_CONTAINER_MARGIN,this._container.height="".concat(g,"px"),[4,this._textAnimator.animateBlocks(p,n)];case 1:return c.sent(),this._textAnimator.advanceRequested&&p.forEach((function(e){return e.tb.text=e.full})),t._isTextFullyDisplayed=!0,U.onAdvanceDialogueRequested.remove(r),[4,this._startBlink()];case 2:return c.sent(),[2]}}))}))}}),Object.defineProperty(t.prototype,"_startBlink",{enumerable:!1,configurable:!0,writable:!0,value:function(){return(0,c.sH)(this,void 0,void 0,(function(){return(0,c.YH)(this,(function(e){switch(e.label){case 0:if(!t._isTextFullyDisplayed)return[2];this._triangle.isVisible=!0,e.label=1;case 1:return t.isTextFullyDisplayed?(this._triangle.alpha=1,[4,x.sleep(this.TRIANGLE_BLINK_INTERVAL)]):[3,4];case 2:return e.sent(),this._triangle.alpha=0,[4,x.sleep(this.TRIANGLE_BLINK_INTERVAL)];case 3:return e.sent(),[3,1];case 4:return[2]}}))}))}}),Object.defineProperty(t.prototype,"_stopBlink",{enumerable:!1,configurable:!0,writable:!0,value:function(){this._triangle.isVisible=!1}}),Object.defineProperty(t,"_isTextFullyDisplayed",{enumerable:!0,configurable:!0,writable:!0,value:!1}),t}(I),q=function(e){function t(t){var n=e.call(this,"Space","_")||this;return Object.defineProperty(n,"_conversation",{enumerable:!0,configurable:!0,writable:!0,value:t}),n}return(0,c.C6)(t,e),Object.defineProperty(t.prototype,"executeInteraction",{enumerable:!1,configurable:!0,writable:!0,value:function(){H.isTextFullyDisplayed?this._conversation.next():U.onAdvanceDialogueRequested.notifyObservers()}}),Object.defineProperty(t.prototype,"mesh",{get:function(){var e;return null===(e=this._conversation.conversationProvider)||void 0===e?void 0:e.mesh},enumerable:!1,configurable:!0}),t}(M),U=function(){function e(){Object.defineProperty(this,"_onEnding",{enumerable:!0,configurable:!0,writable:!0,value:function(){}}),Object.defineProperty(this,"_conversationProvider",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_hasBeenRead",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"onDialogueStart",{enumerable:!0,configurable:!0,writable:!0,value:new d.cPK}),Object.defineProperty(this,"onConversationStart",{enumerable:!0,configurable:!0,writable:!0,value:new d.cPK}),Object.defineProperty(this,"onConversationEnd",{enumerable:!0,configurable:!0,writable:!0,value:new d.cPK}),Object.defineProperty(this,"_nextInteraction",{enumerable:!0,configurable:!0,writable:!0,value:new q(this)}),Object.defineProperty(this,"_currentNode",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_rootNode",{enumerable:!0,configurable:!0,writable:!0,value:void 0})}return Object.defineProperty(e.prototype,"conversationProvider",{get:function(){return this._conversationProvider},set:function(e){this._conversationProvider=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"root",{get:function(){return this._rootNode},set:function(e){this._rootNode=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"onEnding",{get:function(){return this._onEnding},set:function(e){this._onEnding=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"enterNode",{enumerable:!1,configurable:!0,writable:!0,value:function(t){this._currentNode=t,this._currentNode.execute(),this.onDialogueStart.notifyObservers(t),e.onAnyDialogueStart.notifyObservers(t)}}),Object.defineProperty(e.prototype,"startConversation",{enumerable:!1,configurable:!0,writable:!0,value:function(){var t;this._currentNode=this.root,this.onConversationStart.notifyObservers(this),e.onAnyConversationStart.notifyObservers(this),this.enterNode(this._currentNode),this._nextInteraction.makeAvailable();var n=null===(t=this._conversationProvider)||void 0===t?void 0:t.cameraConfiguration;n&&(O.instance.cameraConfiguration=n)}}),Object.defineProperty(e.prototype,"next",{enumerable:!1,configurable:!0,writable:!0,value:function(){var e,t=null===(e=this._currentNode)||void 0===e?void 0:e.nextNode;t?this.enterNode(t):this.endConversation()}}),Object.defineProperty(e.prototype,"endConversation",{enumerable:!1,configurable:!0,writable:!0,value:function(){this._currentNode=void 0,this._nextInteraction.makeUnavailable(),this.onConversationEnd.notifyObservers(this),e.onAnyConversationEnd.notifyObservers(this),O.instance.cameraConfiguration=z.playerCameraConfiguration,this._hasBeenRead||this._onEnding(),this._hasBeenRead=!0}}),Object.defineProperty(e.prototype,"isInProgress",{enumerable:!1,configurable:!0,writable:!0,value:function(){return!!this._currentNode}}),Object.defineProperty(e,"onAnyDialogueStart",{enumerable:!0,configurable:!0,writable:!0,value:new d.cPK}),Object.defineProperty(e,"onAnyConversationStart",{enumerable:!0,configurable:!0,writable:!0,value:new d.cPK}),Object.defineProperty(e,"onAnyConversationEnd",{enumerable:!0,configurable:!0,writable:!0,value:new d.cPK}),Object.defineProperty(e,"onAdvanceDialogueRequested",{enumerable:!0,configurable:!0,writable:!0,value:new d.cPK}),e}(),z=function(){function e(){e._instance=this,e.initializeCameraParameter(),e.registerKeyboardInputs(),e.registerMouseMovementInputs(),U.onAnyConversationStart.add((function(){return e.disableMovement()})),U.onAnyConversationEnd.add((function(){return e.enableMovement()}))}return Object.defineProperty(e,"instance",{get:function(){return this._instance},enumerable:!1,configurable:!0}),Object.defineProperty(e,"onCameraRotationObservable",{get:function(){return this._onCameraRotationObservable},enumerable:!1,configurable:!0}),Object.defineProperty(e,"onPlayerPressedAKey",{get:function(){return this._onPlayerPressedAKey},enumerable:!1,configurable:!0}),Object.defineProperty(e,"playerCameraConfiguration",{get:function(){return this._playerCameraConfiguration},enumerable:!1,configurable:!0}),Object.defineProperty(e,"isMoveForwardPressed",{enumerable:!1,configurable:!0,writable:!0,value:function(){return this._isForwardPressed&&this._isMovementEnabled}}),Object.defineProperty(e,"isMoveBackwardPressed",{enumerable:!1,configurable:!0,writable:!0,value:function(){return this._isBackwardPressed&&this._isMovementEnabled}}),Object.defineProperty(e,"isTurnLeftPressed",{enumerable:!1,configurable:!0,writable:!0,value:function(){return this._isLeftPressed&&this._isMovementEnabled}}),Object.defineProperty(e,"isTurnRightPressed",{enumerable:!1,configurable:!0,writable:!0,value:function(){return this._isRightPressed&&this._isMovementEnabled}}),Object.defineProperty(e,"registerKeyboardInputs",{enumerable:!1,configurable:!0,writable:!0,value:function(){var e=this,t=Ie.scene;t.onKeyboardObservable.add((function(t){if(Ie.isGameFocused){var n=t.type===d.TBB.KEYDOWN;"KeyW"===t.event.code?e._isForwardPressed=n:"KeyS"===t.event.code?e._isBackwardPressed=n:"KeyA"===t.event.code?e._isLeftPressed=n:"KeyD"===t.event.code&&(e._isRightPressed=n),e.onPlayerPressedAKey.notifyObservers(t)}}))}}),Object.defineProperty(e,"registerMouseMovementInputs",{enumerable:!1,configurable:!0,writable:!0,value:function(){var e=this,t=Ie.scene;t.onPointerObservable.add((function(t){if(Ie.isGameFocused){var n=t.event,r=n.movementX/window.screen.width,i=n.movementY/window.screen.height;e._onCameraRotationObservable.notifyObservers({movementX:r,movementY:i}),e.updateCameraParameter(r,i)}}))}}),Object.defineProperty(e,"enableMovement",{enumerable:!1,configurable:!0,writable:!0,value:function(){this._isMovementEnabled=!0}}),Object.defineProperty(e,"disableMovement",{enumerable:!1,configurable:!0,writable:!0,value:function(){this._isMovementEnabled=!1}}),Object.defineProperty(e,"initializeCameraParameter",{enumerable:!1,configurable:!0,writable:!0,value:function(){var e=this;G.instance.meshCreationPromise.then((function(t){e._playerCameraConfiguration.target=t,e._playerCameraConfiguration.distanceFromTarget=25,e._playerCameraConfiguration.currentLowerBetaLimit=d.uMQ.FromDegrees(30).radians(),e._playerCameraConfiguration.currentUpperBetaLimit=d.uMQ.FromDegrees(85).radians(),e._playerCameraConfiguration.wantedAlpha=d.uMQ.FromDegrees(-90).radians(),e._playerCameraConfiguration.wantedBeta=d.uMQ.FromDegrees(45).radians(),O.instance.cameraConfiguration=e._playerCameraConfiguration}))}}),Object.defineProperty(e,"updateCameraParameter",{enumerable:!1,configurable:!0,writable:!0,value:function(e,t){this._playerCameraConfiguration.wantedAlpha=d.X5X.LerpAngle(this._playerCameraConfiguration.wantedBeta,this._playerCameraConfiguration.wantedAlpha-e*this._horizontalCameraSensitivity,1),this._playerCameraConfiguration.wantedBeta=d.X5X.LerpAngle(this._playerCameraConfiguration.wantedBeta,this._playerCameraConfiguration.wantedBeta-t*this._verticalCameraSensitivity,1)}}),Object.defineProperty(e,"isCurrentCamera",{enumerable:!1,configurable:!0,writable:!0,value:function(){return O.instance.cameraConfiguration==this._playerCameraConfiguration}}),Object.defineProperty(e,"_onCameraRotationObservable",{enumerable:!0,configurable:!0,writable:!0,value:new d.cPK}),Object.defineProperty(e,"_onPlayerPressedAKey",{enumerable:!0,configurable:!0,writable:!0,value:new d.cPK}),Object.defineProperty(e,"_playerCameraConfiguration",{enumerable:!0,configurable:!0,writable:!0,value:new j}),Object.defineProperty(e,"_horizontalCameraSensitivity",{enumerable:!0,configurable:!0,writable:!0,value:5}),Object.defineProperty(e,"_verticalCameraSensitivity",{enumerable:!0,configurable:!0,writable:!0,value:5}),Object.defineProperty(e,"_isMovementEnabled",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(e,"_isForwardPressed",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(e,"_isBackwardPressed",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(e,"_isLeftPressed",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(e,"_isRightPressed",{enumerable:!0,configurable:!0,writable:!0,value:!1}),e}(),Z=function(){function e(){var e=this;Object.defineProperty(this,"_nodeMaterialPromise",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_nodeMaterial",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this._nodeMaterialPromise=d.MBv.ParseFromFileAsync("ToonShader","shaders/PBRToonMaterial.json",Ie.scene).then((function(t){e._nodeMaterial=t,e._nodeMaterial.maxSimultaneousLights=6,e.saturationMultiplier=1.5,e._nodeMaterial.build()}))}return Object.defineProperty(e.prototype,"assignMaterial",{enumerable:!1,configurable:!0,writable:!0,value:function(e){return(0,c.sH)(this,void 0,void 0,(function(){var t=this;return(0,c.YH)(this,(function(n){switch(n.label){case 0:return[4,this._nodeMaterialPromise.then((function(){e.material=t._nodeMaterial}))];case 1:return n.sent(),[2]}}))}))}}),Object.defineProperty(e.prototype,"saturationMultiplier",{set:function(e){var t=this;this._nodeMaterialPromise.then((function(){t._nodeMaterial.getBlockByName("SaturationMultiplier").value=e}))},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"numberOfSteps",{set:function(e){var t=this;this._nodeMaterialPromise.then((function(){t._nodeMaterial.getBlockByName("NumberOfSteps").value=e}))},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"luminanceEasingFactor",{set:function(e){var t=this;this._nodeMaterialPromise.then((function(){t._nodeMaterial.getBlockByName("LuminanceEasingFactor").value=e}))},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"indexOfRefraction",{set:function(e){var t=this;this._nodeMaterialPromise.then((function(){t._nodeMaterial.getBlockByName("IoR").value=e}))},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"albedoColor",{set:function(e){var t=this;this._nodeMaterialPromise.then((function(){t._nodeMaterial.getBlockByName("AlbedoColor").value=e}))},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"albedoTexture",{set:function(e){var t=this;this._nodeMaterialPromise.then((function(){t._nodeMaterial.getBlockByName("AlbedoTexture").texture=e}))},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"opacity",{set:function(e){var t=this;this._nodeMaterialPromise.then((function(){t._nodeMaterial.getBlockByName("OpacityFactor").value=e}))},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"metallic",{set:function(e){var t=this;this._nodeMaterialPromise.then((function(){t._nodeMaterial.getBlockByName("MetallicFactor").value=e}))},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"metallicTexture",{set:function(e){var t=this;this._nodeMaterialPromise.then((function(){t._nodeMaterial.getBlockByName("MetallicTexture").texture=e}))},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"roughness",{set:function(e){var t=this;this._nodeMaterialPromise.then((function(){t._nodeMaterial.getBlockByName("RoughnessFactor").value=e}))},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"roughnessTexture",{set:function(e){var t=this;this._nodeMaterialPromise.then((function(){t._nodeMaterial.getBlockByName("RoughnessTexture").texture=e}))},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"emission",{set:function(e){var t=this;this._nodeMaterialPromise.then((function(){t._nodeMaterial.getBlockByName("EmissiveFactor").value=e}))},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"emissionColor",{set:function(e){var t=this;this._nodeMaterialPromise.then((function(){t._nodeMaterial.getBlockByName("EmissiveColor").value=e}))},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"emissionTexture",{set:function(e){var t=this;this._nodeMaterialPromise.then((function(){t._nodeMaterial.getBlockByName("EmissiveTexture").texture=e}))},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"transparencyMode",{set:function(e){var t=this;this._nodeMaterialPromise.then((function(){t._nodeMaterial.transparencyMode=e}))},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"configureFromPBRMaterial",{enumerable:!1,configurable:!0,writable:!0,value:function(e){var t=this;this.albedoColor=e.albedoColor;var n=e.albedoTexture;null!==n&&(this.albedoTexture=n),this.emission=e.emissiveIntensity;var r=e.emissiveTexture;null!==r&&(this.emissionTexture=r),this.emissionColor=e.emissiveColor;var i=e.metallic;null!==i&&(this.metallic=i);var a=e.metallicTexture;null!==a&&(this.metallicTexture=a);var o=e.roughness;null!==o&&(this.roughness=o),this.transparencyMode=e.transparencyMode,this.indexOfRefraction=e.indexOfRefraction,this._nodeMaterialPromise.then((function(){t._nodeMaterial.backFaceCulling=e.backFaceCulling,t._nodeMaterial.needDepthPrePass=e.needDepthPrePass,t._nodeMaterial.cullBackFaces=e.cullBackFaces,t._nodeMaterial.alpha=e.alpha,t._nodeMaterial.alphaMode=e.alphaMode,t._nodeMaterial.disableDepthWrite=e.disableDepthWrite,t._nodeMaterial.disableColorWrite=e.disableColorWrite,t._nodeMaterial.forceDepthWrite=e.forceDepthWrite,t._nodeMaterial.depthFunction=e.depthFunction}))}}),e}(),V=function(){function e(){var t=this;Object.defineProperty(this,"_owner",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_grapplerLength",{enumerable:!0,configurable:!0,writable:!0,value:1.5}),Object.defineProperty(this,"_currentGrappledObject",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_localOffsetWithSubmarine",{enumerable:!0,configurable:!0,writable:!0,value:new d.Pq0(0,0,-5)}),Object.defineProperty(this,"_pullingForce",{enumerable:!0,configurable:!0,writable:!0,value:5}),e._instance=this,Ie.scene.onBeforeRenderObservable.add((function(){t.updateGrappledObject()}))}return Object.defineProperty(e,"instance",{get:function(){return this._instance},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"grappleObject",{enumerable:!1,configurable:!0,writable:!0,value:function(e){this._currentGrappledObject||(this._currentGrappledObject=e)}}),Object.defineProperty(e.prototype,"letGoOfObject",{enumerable:!1,configurable:!0,writable:!0,value:function(){this._currentGrappledObject&&(this._currentGrappledObject=void 0)}}),Object.defineProperty(e.prototype,"grappledObject",{get:function(){return this._currentGrappledObject},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"hasAnObjectGrappled",{get:function(){return void 0!==this._currentGrappledObject},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"grapplerLength",{get:function(){return this._grapplerLength},set:function(e){this._grapplerLength=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"owner",{get:function(){return this._owner},set:function(e){this._owner=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"offset",{get:function(){return this._localOffsetWithSubmarine},set:function(e){this._localOffsetWithSubmarine=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"updateGrappledObject",{enumerable:!1,configurable:!0,writable:!0,value:function(){if(void 0!==this._currentGrappledObject){var e=this._owner;if(e){var t=e.getObjectCenterWorld().add(this._localOffsetWithSubmarine.rotateByQuaternionToRef(e.transformNode.absoluteRotationQuaternion,d.Pq0.Zero())),n=this._currentGrappledObject.physicsBody.getObjectCenterWorld(),r=n.subtract(t),i=r.length();if(i>this._grapplerLength){var a=r.normalizeToNew().scale(-1);this._currentGrappledObject.physicsBody.applyForce(a.scale(this._pullingForce*(i-this._grapplerLength+1)),n)}}}}}),e}(),G=function(){function e(){var t=this;Object.defineProperty(this,"_physicsAggregate",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_mesh",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_movementForce",{enumerable:!0,configurable:!0,writable:!0,value:25e5}),Object.defineProperty(this,"_rotationForce",{enumerable:!0,configurable:!0,writable:!0,value:3e5}),Object.defineProperty(this,"_grappler",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"meshCreationPromise",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_spotLight",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_waveParticleSystem",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_waveEmitter",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),e._instance=this,this._grappler=new V,this.meshCreationPromise=this.createMesh(Ie.scene),this.meshCreationPromise.then((function(e){var n;t.createWaterParticles(),t._grappler.owner=null!==(n=e.physicsBody)&&void 0!==n?n:void 0,t._spotLight=t.createSpotlight(),t.addVolumetricLight();var r=1024;Ie.scene.onBeforeRenderObservable.add((function(){if(t._physicsAggregate){var e=t._physicsAggregate.body,n=e.transformNode.position.clone();(n.x>r||n.x<-r||n.z>r||n.z<-r)&&(e.setLinearVelocity(e.getLinearVelocity().negate()),e.transformNode.position.copyFrom(n))}}))})),Ie.scene.onBeforeRenderObservable.add((function(){t.update()}));var n=new Set;Ie.scene.onKeyboardObservable.add((function(e){var r=e.event.key;"k"===r&&(e.type===d.TBB.KEYDOWN?n.has(r)||(n.add(r),k.instance.playSFX("submarine_horn",{loop:!0},t.mesh)):e.type===d.TBB.KEYUP&&(n.delete(r),k.instance.stopSFX("submarine_horn")))})),Ie.scene.onKeyboardObservable.add((function(e){var t=e.event.key;"z"!==t&&"s"!==t||(e.type===d.TBB.KEYDOWN?n.has(t)||(n.add(t),k.instance.playSFX("submarine",{loop:!0})):e.type===d.TBB.KEYUP&&(n.delete(t),k.instance.stopSFX("submarine")))})),Ie.scene.onKeyboardObservable.add((function(e){var n,r,i=e.type===d.TBB.KEYDOWN;"l"===e.event.key&&i&&(null===(n=t._spotLight)||void 0===n||n.setEnabled(!(null===(r=t._spotLight)||void 0===r?void 0:r.isEnabled())))}))}return Object.defineProperty(e.prototype,"mesh",{get:function(){return this._mesh},enumerable:!1,configurable:!0}),Object.defineProperty(e,"instance",{get:function(){return this._instance},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"templeBall",{get:function(){return this._grappler.grappledObject},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"grabBall",{enumerable:!1,configurable:!0,writable:!0,value:function(e){this._grappler.grappleObject(e)}}),Object.defineProperty(e.prototype,"letGoOfBall",{enumerable:!1,configurable:!0,writable:!0,value:function(){this._grappler.letGoOfObject()}}),Object.defineProperty(e.prototype,"createMesh",{enumerable:!1,configurable:!0,writable:!0,value:function(e){return(0,c.sH)(this,void 0,void 0,(function(){var t,n,r,i,a,o,l,s;return(0,c.YH)(this,(function(u){switch(u.label){case 0:return[4,d.cng.ImportMeshAsync("","models/objects/","submarine.glb",e)];case 1:t=u.sent(),n=t.meshes[0],r=n.getChildMeshes(),i=function(e){var t,n;return(0,c.YH)(this,(function(r){switch(r.label){case 0:return t=e.material,t?(n=new Z,[4,n.assignMaterial(e).then((function(){n.configureFromPBRMaterial(t)}))]):[3,2];case 1:r.sent(),r.label=2;case 2:return[2]}}))},a=0,o=t.meshes,u.label=2;case 2:return a<o.length?(l=o[a],[5,i(l)]):[3,5];case 3:u.sent(),u.label=4;case 4:return a++,[3,2];case 5:return s=d.eaF.MergeMeshes(r,!0,void 0,void 0,void 0,!0),s&&(this._mesh=s,this._physicsAggregate=new d.Lfv(this._mesh,d.DKo.BOX,{mass:1,friction:0,restitution:0,mesh:s},Ie.scene),this._physicsAggregate.body.setMotionType(d.AHY.DYNAMIC),this._physicsAggregate.body.setMassProperties({inertia:new d.Pq0(0,1,0),centerOfMass:this._mesh.absolutePosition}),this._physicsAggregate.body.setLinearDamping(1),this._physicsAggregate.body.setAngularDamping(1),this._physicsAggregate.body.getCollisionObservable(),this._mesh.name="submarine",this._mesh.position=new d.Pq0(0,0,0)),this.mesh.receiveShadows=!0,[2,this._mesh]}}))}))}}),Object.defineProperty(e.prototype,"createWaterParticles",{enumerable:!1,configurable:!0,writable:!0,value:function(){var e=Ie.scene;this._waveEmitter=new d.VR0("waveEmitter",e),this._waveEmitter.parent=this._mesh,this._waveEmitter.position=new d.Pq0(0,0,-2.5);var t=new d.okU("waves",1e3,e);t.particleTexture=new d.gPd("textures/flare.png",e);var n=d.PeD.CreateSphere("waveEmitterMesh",{diameter:.1},e);n.parent=this._mesh,n.position=new d.Pq0(0,-.1,-2.5),n.isVisible=!1,t.emitter=n,t.minEmitBox=new d.Pq0(-.5,0,0),t.maxEmitBox=new d.Pq0(.5,0,0),t.color1=new d.ov8(1,1,1,1),t.color2=new d.ov8(1,1,1,.5),t.colorDead=new d.ov8(1,1,1,0),t.minSize=.5,t.maxSize=.7,t.minLifeTime=.6,t.maxLifeTime=.7,t.emitRate=5,t.blendMode=d.okU.BLENDMODE_ADD,t.minEmitPower=.5,t.maxEmitPower=1,t.updateSpeed=.02,t.direction1=new d.Pq0(0,1,-.5),t.direction2=new d.Pq0(0,1.2,-1),this._waveParticleSystem=t}}),Object.defineProperty(e.prototype,"createSpotlight",{enumerable:!1,configurable:!0,writable:!0,value:function(){var e=this,t=new d.nCl("spotLight",new d.Pq0(0,0,0),new d.Pq0(0,0,1),Math.PI/3,2,Ie.scene);return t.diffuse=new d.v9j(1,1,1),t.specular=new d.v9j(1,1,1),t.intensity=5e3,t.parent=this._mesh,t.setEnabled(!1),this._spotLight=t,Ie.scene.onKeyboardObservable.add((function(t){var n,r,i=t.type===d.TBB.KEYDOWN;if("l"===t.event.key&&i){var a=!(null===(n=e._spotLight)||void 0===n?void 0:n.isEnabled());null===(r=e._spotLight)||void 0===r||r.setEnabled(a)}})),t}}),Object.defineProperty(e.prototype,"addVolumetricLight",{enumerable:!1,configurable:!0,writable:!0,value:function(){var e=Ie.scene.activeCamera,t=d.PeD.CreateSphere("lightEmitter",{diameter:.8},Ie.scene),n=new d.gRT("vls",1,e,t);t.position=new d.Pq0(0,0,2.3),t.parent=this._mesh;var r=new d.FUi("lightMat",Ie.scene);r.emissiveTexture=new d.gPd("textures/lensflare/lens5.png",Ie.scene),r.diffuseColor=new d.v9j(0,0,0),r.specularColor=new d.v9j(0,0,0),r.emissiveColor=new d.v9j(1,1,1),r.alpha=.8,t.material=r,n.mesh=t,n.exposure=1,n.decay=.96815,n.weight=.4,n.density=.99,t.setEnabled(!1),Ie.scene.onKeyboardObservable.add((function(e){var n=e.type===d.TBB.KEYDOWN;"l"===e.event.key&&n&&t.setEnabled(!t.isEnabled())}))}}),Object.defineProperty(e.prototype,"update",{enumerable:!1,configurable:!0,writable:!0,value:function(){this.updateRotationSpeed(),this.updateMovementSpeed(),this.updateWaveParticles()}}),Object.defineProperty(e.prototype,"updateMovementSpeed",{enumerable:!1,configurable:!0,writable:!0,value:function(){if(this._physicsAggregate){var e=this._physicsAggregate.body,t=0;this.isForwardPressed()&&(t+=1),this.isBackwardPressed()&&(t-=1),0!==t&&e.applyForce(this._mesh.forward.scale(t*this._movementForce),e.getObjectCenterWorld())}}}),Object.defineProperty(e.prototype,"updateRotationSpeed",{enumerable:!1,configurable:!0,writable:!0,value:function(){if(this._physicsAggregate){var e=this._physicsAggregate.body,t=0;this.isRightPressed()&&(t+=1),this.isLeftPressed()&&(t-=1),0!=t&&e.applyForce(this._mesh.right.scale(t*this._rotationForce),e.getObjectCenterWorld().add(this._mesh.forward))}}}),Object.defineProperty(e.prototype,"updateWaveParticles",{enumerable:!1,configurable:!0,writable:!0,value:function(){if(this._physicsAggregate&&this._waveParticleSystem){var e=this._physicsAggregate.body.getLinearVelocity(),t=e.length();t>.6?this._waveParticleSystem.isStarted()||this._waveParticleSystem.start():this._waveParticleSystem.isStarted()&&this._waveParticleSystem.stop()}}}),Object.defineProperty(e.prototype,"isForwardPressed",{enumerable:!1,configurable:!0,writable:!0,value:function(){return z.isMoveForwardPressed()}}),Object.defineProperty(e.prototype,"isBackwardPressed",{enumerable:!1,configurable:!0,writable:!0,value:function(){return z.isMoveBackwardPressed()}}),Object.defineProperty(e.prototype,"isRightPressed",{enumerable:!1,configurable:!0,writable:!0,value:function(){return z.isTurnRightPressed()}}),Object.defineProperty(e.prototype,"isLeftPressed",{enumerable:!1,configurable:!0,writable:!0,value:function(){return z.isTurnLeftPressed()}}),e}(),K=function(){function e(){Object.defineProperty(this,"_name",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_detectionZone",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_discovered",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"_disabled",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"_mesh",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_physicsAggregate",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_conversationProviders",{enumerable:!0,configurable:!0,writable:!0,value:[]})}return Object.defineProperty(e.prototype,"name",{get:function(){return this._name},set:function(e){this._name=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"discovered",{get:function(){return this._discovered},set:function(e){this._discovered=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"detectionZone",{get:function(){return this._detectionZone},set:function(t){var n=this;this._detectionZone=t,this.detectionZone.onMeshEnter.add((function(){k.instance.playSFX("zone",{loop:!1,autoplay:!0}),e.onAnyKeyZoneEntered.notifyObservers(n),n.discovered=!0})),this.detectionZone.onMeshExit.add((function(){e.onAnyKeyZoneExited.notifyObservers(n)}))},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"disabled",{get:function(){return this._disabled},set:function(e){this._disabled=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"mesh",{get:function(){return this._mesh},set:function(e){var t=this;this._mesh=e,this._detectionZone.zone.parent=this._mesh,Me.submarine.meshCreationPromise.then((function(e){t.detectionZone.addMeshToDetect(e)}))},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"physicsAggregate",{get:function(){return this._physicsAggregate},set:function(e){this._physicsAggregate=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"conversationProviders",{get:function(){return this._conversationProviders},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"addConversationProvider",{enumerable:!1,configurable:!0,writable:!0,value:function(e){this._conversationProviders.push(e)}}),Object.defineProperty(e,"onAnyKeyZoneEntered",{enumerable:!0,configurable:!0,writable:!0,value:new d.cPK}),Object.defineProperty(e,"onAnyKeyZoneExited",{enumerable:!0,configurable:!0,writable:!0,value:new d.cPK}),e}(),X=function(){function e(e,t){var n=this;Object.defineProperty(this,"_zone",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"onMeshEnter",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"onMeshExit",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_meshToDetect",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this._zone=e,this._zone.visibility=t?.5:0,this._meshToDetect=new Map,this.onMeshEnter=new d.cPK,this.onMeshExit=new d.cPK,Ie.scene.onBeforeRenderObservable.add((function(){return n.checkAll()}))}return Object.defineProperty(e.prototype,"zone",{get:function(){return this._zone},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"addMeshToDetect",{enumerable:!1,configurable:!0,writable:!0,value:function(e){this._meshToDetect.set(e,!1),this.checkAll()}}),Object.defineProperty(e.prototype,"isInZone",{enumerable:!1,configurable:!0,writable:!0,value:function(e){return this._zone.intersectsMesh(e,!0)}}),Object.defineProperty(e.prototype,"checkDetection",{enumerable:!1,configurable:!0,writable:!0,value:function(e){var t=this._zone.intersectsMesh(e,!0);return t!==this._meshToDetect.get(e)&&(t?this.onMeshEnter.notifyObservers(e):this.onMeshExit.notifyObservers(e),this._meshToDetect.set(e,t)),t}}),Object.defineProperty(e.prototype,"checkAll",{enumerable:!1,configurable:!0,writable:!0,value:function(){var e=this;this._meshToDetect.forEach((function(t,n){e.checkDetection(n)}))}}),e}(),Y=function(e){function t(t,n){var r=this,i=d.PeD.CreateSphere("",t);return r=e.call(this,i,!1)||this,r}return(0,c.C6)(t,e),t}(X),Q=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return(0,c.C6)(t,e),t}(T),W=function(e){function t(t){var n=e.call(this,"KeyE","E")||this;return Object.defineProperty(n,"_conversation",{enumerable:!0,configurable:!0,writable:!0,value:t}),n}return(0,c.C6)(t,e),Object.defineProperty(t.prototype,"description",{get:function(){return"Parler"},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"executeInteraction",{enumerable:!1,configurable:!0,writable:!0,value:function(){this._conversation.startConversation()}}),Object.defineProperty(t.prototype,"mesh",{get:function(){var e;return null===(e=this._conversation.conversationProvider)||void 0===e?void 0:e.mesh},enumerable:!1,configurable:!0}),t}(Q),J=function(){function e(){Object.defineProperty(this,"_name",{enumerable:!0,configurable:!0,writable:!0,value:"undefined"}),Object.defineProperty(this,"_mesh",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_conversation",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_startConversationInteraction",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_playerDetectionZone",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_cameraConfiguration",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_transformNode",{enumerable:!0,configurable:!0,writable:!0,value:new d.VR0("npcTransform")})}return Object.defineProperty(e.prototype,"name",{get:function(){return this._name},set:function(e){this._name=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"mesh",{get:function(){return this._mesh},set:function(e){this._mesh=e,this._mesh&&(this._mesh.parent=this._transformNode)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"cameraConfiguration",{get:function(){return this._cameraConfiguration},set:function(e){this._cameraConfiguration=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"transformNode",{get:function(){return this._transformNode},set:function(e){this._transformNode=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"detectionZone",{get:function(){return this._playerDetectionZone},set:function(e){this._playerDetectionZone=e,this._playerDetectionZone&&(this._playerDetectionZone.zone.parent=this._transformNode,this.setSignals())},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"conversation",{get:function(){return this._conversation},set:function(e){var t,n=this;void 0!==e?(this._startConversationInteraction=new W(e),this._conversation=e,this._conversation.conversationProvider=this,null===(t=this._conversation)||void 0===t||t.onConversationEnd.add((function(){var e,t;(null===(e=n._playerDetectionZone)||void 0===e?void 0:e.isInZone(Me.submarine.mesh))&&(null===(t=n._startConversationInteraction)||void 0===t||t.makeAvailable())}))):(this._startConversationInteraction=void 0,this._conversation&&(this._conversation.conversationProvider=void 0),this._conversation=void 0)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"setSignals",{enumerable:!1,configurable:!0,writable:!0,value:function(){var e=this;this._playerDetectionZone&&(this._playerDetectionZone.onMeshEnter.add((function(){var t;e._startConversationInteraction&&!(null===(t=e._conversation)||void 0===t?void 0:t.isInProgress())&&e._startConversationInteraction.makeAvailable()})),this._playerDetectionZone.onMeshExit.add((function(){e._startConversationInteraction&&e._startConversationInteraction.makeUnavailable()})),Me.submarine.meshCreationPromise.then((function(t){e._playerDetectionZone&&e._playerDetectionZone.addMeshToDetect(t)})))}}),e}(),$=function(e){function t(t,n){var r=this,i=d.PeD.CreateCylinder("",t);return r=e.call(this,i,!1)||this,r}return(0,c.C6)(t,e),t}(X),ee=function(){function e(){Object.defineProperty(this,"_text",{enumerable:!0,configurable:!0,writable:!0,value:""}),Object.defineProperty(this,"_nextNode",{enumerable:!0,configurable:!0,writable:!0,value:void 0})}return Object.defineProperty(e.prototype,"text",{get:function(){return this._text},set:function(e){this._text=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"nextNode",{get:function(){return this._nextNode},set:function(e){this._nextNode=e},enumerable:!1,configurable:!0}),e}(),te=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return(0,c.C6)(t,e),Object.defineProperty(t.prototype,"execute",{enumerable:!1,configurable:!0,writable:!0,value:function(){}}),t}(ee),ne=function(){function e(){Object.defineProperty(this,"root",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"current",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_onEnding",{enumerable:!0,configurable:!0,writable:!0,value:void 0})}return Object.defineProperty(e.prototype,"say",{enumerable:!1,configurable:!0,writable:!0,value:function(e){var t=new te;return t.text=e,this.root?this.current&&(this.current.nextNode=t):this.root=t,this.current=t,this}}),Object.defineProperty(e.prototype,"then",{enumerable:!1,configurable:!0,writable:!0,value:function(e){return this.say(e)}}),Object.defineProperty(e.prototype,"build",{enumerable:!1,configurable:!0,writable:!0,value:function(){var e=new U;return this._onEnding&&(e.onEnding=this._onEnding),this.root&&(e.root=this.root),e}}),Object.defineProperty(e.prototype,"setOnEnding",{enumerable:!1,configurable:!0,writable:!0,value:function(e){return this._onEnding=e,this}}),e}(),re=function(e){function t(){var n=e.call(this)||this;return Object.defineProperty(n,"_panel",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),t._instance=n,n._panel=new E.Pc,n._panel.horizontalAlignment=E.Ec.HORIZONTAL_ALIGNMENT_RIGHT,n._panel.verticalAlignment=E.Ec.VERTICAL_ALIGNMENT_TOP,n._panel.width="25%",n._panel.height="100%",n._panel.paddingRight="10px",n._panel.paddingTop="20px",n._panel.isVertical=!0,n._panel.spacing=25,n}return(0,c.C6)(t,e),Object.defineProperty(t.prototype,"controlNode",{get:function(){return this._panel},enumerable:!1,configurable:!0}),Object.defineProperty(t,"instance",{get:function(){return this._instance},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"refresh",{enumerable:!1,configurable:!0,writable:!0,value:function(){var e=this;this._panel.clearControls();var t=we.instance.getAllActiveQuests();0!==t.length?t.forEach((function(t,n){var r=new E.Pc;r.isVertical=!0,r.width="100%",r.alpha=0;var i=new E.VJ;i.text="⛋ ".concat(t.name),i.color="white",i.fontSize=20,i.fontWeight="bold",i.textHorizontalAlignment=E.Ec.HORIZONTAL_ALIGNMENT_LEFT,i.height="40px";var a=new E.VJ;a.text=t.steps[t.currentStepIndex].description,a.color="#FFFFFF",a.fontSize=17,a.textHorizontalAlignment=E.Ec.HORIZONTAL_ALIGNMENT_CENTER,a.height="40px",a.textWrapping=!0,a.paddingLeft="16px",r.addControl(i),r.addControl(a),r.addControl(e.createSeparator()),e._panel.addControl(r);var o=new d.X55("fadeInQuest","alpha",60,d.X55.ANIMATIONTYPE_FLOAT,d.X55.ANIMATIONLOOPMODE_CONSTANT);o.setKeys([{frame:0,value:0},{frame:20,value:1}]),r.animations=[o],setTimeout((function(){Ie.scene.beginAnimation(r,0,20,!1)}),150*n)})):this._panel.addControl(this.createSeparator())}}),Object.defineProperty(t.prototype,"createSeparator",{enumerable:!1,configurable:!0,writable:!0,value:function(){var e=new E.tN;return e.height="5px",e.width="100%",e.background="white",e.thickness=0,e.paddingTop="4px",e}}),t}(I),ie=function(){function e(e,t,n,r){Object.defineProperty(this,"_id",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_name",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_state",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_currentStepIndex",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_steps",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this._id=e,this._name=t,this._state=n,this._currentStepIndex=r,this._steps=[]}return Object.defineProperty(e.prototype,"id",{get:function(){return this._id},set:function(e){this._id=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"name",{get:function(){return this._name},set:function(e){this._name=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"state",{get:function(){return this._state},set:function(e){this._state=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"currentStepIndex",{get:function(){return this._currentStepIndex},set:function(e){this._currentStepIndex=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"steps",{get:function(){return this._steps},set:function(e){this._steps=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"startQuest",{enumerable:!1,configurable:!0,writable:!0,value:function(){this._state="active",this.playQuestSound(),re.instance.refresh()}}),Object.defineProperty(e.prototype,"stopQuest",{enumerable:!1,configurable:!0,writable:!0,value:function(){this._state="completed",re.instance.refresh()}}),Object.defineProperty(e.prototype,"nextStep",{enumerable:!1,configurable:!0,writable:!0,value:function(){this._currentStepIndex!==this._steps.length-1&&(this._currentStepIndex++,this.playQuestSound()),re.instance.refresh()}}),Object.defineProperty(e.prototype,"updateCurrentStepStatus",{enumerable:!1,configurable:!0,writable:!0,value:function(){this._steps[this._currentStepIndex].validate()}}),Object.defineProperty(e.prototype,"playQuestSound",{enumerable:!1,configurable:!0,writable:!0,value:function(){k.instance.playSFX("quest",{loop:!1,autoplay:!0})}}),e}(),ae=function(){function e(e){Object.defineProperty(this,"description",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"condition",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.description=e,this.condition=!1}return Object.defineProperty(e.prototype,"validate",{enumerable:!1,configurable:!0,writable:!0,value:function(){this.condition=!0}}),e}(),oe=function(e){function t(t){var n=e.call(this,"KeyF","F")||this;return Object.defineProperty(n,"_socle",{enumerable:!0,configurable:!0,writable:!0,value:t}),n}return(0,c.C6)(t,e),Object.defineProperty(t.prototype,"description",{get:function(){return"Retirer"},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"executeInteraction",{enumerable:!1,configurable:!0,writable:!0,value:function(){var e=this._socle.currentBall;e&&!G.instance.templeBall&&(this._socle.letGoOfBall(),G.instance.grabBall(e),console.log("REMOVING THE BALL !!!"))}}),Object.defineProperty(t.prototype,"mesh",{get:function(){return this._socle.mesh},enumerable:!1,configurable:!0}),t}(Q),le=function(e){function t(t){var n=e.call(this,"KeyF","F")||this;return Object.defineProperty(n,"_socle",{enumerable:!0,configurable:!0,writable:!0,value:t}),n}return(0,c.C6)(t,e),Object.defineProperty(t.prototype,"description",{get:function(){return"Poser"},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"executeInteraction",{enumerable:!1,configurable:!0,writable:!0,value:function(){var e=G.instance.templeBall;e&&(console.log("PLACING THE BALL !!!",e),this._socle.placeBall(e),G.instance.letGoOfBall())}}),Object.defineProperty(t.prototype,"mesh",{get:function(){return this._socle.mesh},enumerable:!1,configurable:!0}),t}(Q),se=n(25135),ue=function(){function e(e,t){var n=this;Object.defineProperty(this,"_transformNode",{enumerable:!0,configurable:!0,writable:!0,value:new d.VR0("socle")}),Object.defineProperty(this,"_ballTransformNode",{enumerable:!0,configurable:!0,writable:!0,value:new d.VR0("ballPosition")}),Object.defineProperty(this,"_mesh",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_material",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_socleDetectionZone",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_validColor",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_currentBall",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_lockConstraint",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_placeTempleBallInteraction",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_removeTempleBallInteraction",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"meshImportedPromise",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this._material=new se.G("socleMat"),this._material.diffuseColor=new d.v9j(.3,.3,.3),this._transformNode.parent=e,this._transformNode.position=t,this._ballTransformNode.parent=this._transformNode,this._ballTransformNode.position=d.Pq0.Up().scale(5),this._placeTempleBallInteraction=new le(this),this._removeTempleBallInteraction=new oe(this),this._socleDetectionZone=new Y({diameter:8},!1),G.instance.meshCreationPromise.then((function(e){var t;null===(t=n._socleDetectionZone)||void 0===t||t.addMeshToDetect(e)})),this._socleDetectionZone.onMeshEnter.add((function(){n.makeInteractionAvailable()})),this._socleDetectionZone.onMeshExit.add((function(){n.makeInteractionUnavailable()})),this.meshImportedPromise=(0,d.TkY)("models/objects/socle.glb",Ie.scene).then((function(e){n._mesh=e.meshes[1],n._mesh.parent=n._transformNode,n._mesh.material=n._material;var t=new d.aZl(n._mesh,d.AHY.STATIC,!1,Ie.scene),r=new d.JNI({type:d.DKo.MESH,parameters:{mesh:n._mesh}},Ie.scene);t.shape=r,n._socleDetectionZone.zone.parent=n._mesh}))}return Object.defineProperty(e.prototype,"currentBall",{get:function(){return this._currentBall},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"mesh",{get:function(){return this._mesh},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"placeBall",{enumerable:!1,configurable:!0,writable:!0,value:function(e){var t;this._currentBall=e,this._lockConstraint=new d.lCF(d.Pq0.Zero(),d.Pq0.Up().scale(4),d.Pq0.Up(),d.Pq0.Down(),Ie.scene),null===(t=this._mesh.physicsBody)||void 0===t||t.addConstraint(e.physicsBody,this._lockConstraint),this._currentBall.socle=this,this._material.diffuseColor=new d.v9j(5,5,5),k.instance&&k.instance.playSFX("socle")}}),Object.defineProperty(e.prototype,"letGoOfBall",{enumerable:!1,configurable:!0,writable:!0,value:function(){var e;this._currentBall&&(this._currentBall=void 0,null===(e=this._lockConstraint)||void 0===e||e.dispose(),this._material.diffuseColor=new d.v9j(.3,.3,.3),k.instance&&k.instance.playSFX("socle"))}}),Object.defineProperty(e.prototype,"validColor",{get:function(){return this._validColor},set:function(e){this._validColor=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"transformNode",{get:function(){return this._transformNode},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"makeInteractionAvailable",{enumerable:!1,configurable:!0,writable:!0,value:function(){this._placeTempleBallInteraction.makeUnavailable(),this._removeTempleBallInteraction.makeUnavailable(),this._currentBall&&!G.instance.templeBall?this._removeTempleBallInteraction.makeAvailable():!this._currentBall&&G.instance.templeBall&&this._placeTempleBallInteraction.makeAvailable()}}),Object.defineProperty(e.prototype,"makeInteractionUnavailable",{enumerable:!1,configurable:!0,writable:!0,value:function(){this._placeTempleBallInteraction.makeUnavailable(),this._removeTempleBallInteraction.makeUnavailable()}}),e}(),ce=function(e){function t(t){var n=e.call(this,"KeyF","F")||this;return Object.defineProperty(n,"_grabbableObject",{enumerable:!0,configurable:!0,writable:!0,value:t}),n}return(0,c.C6)(t,e),Object.defineProperty(t.prototype,"grabbableObject",{get:function(){return this._grabbableObject},set:function(e){this._grabbableObject=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"description",{get:function(){return"Attraper"},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"executeInteraction",{enumerable:!1,configurable:!0,writable:!0,value:function(){V.instance.grappleObject(this._grabbableObject),this.makeUnavailable()}}),Object.defineProperty(t.prototype,"mesh",{get:function(){return this._grabbableObject.mesh},enumerable:!1,configurable:!0}),t}(Q),be=function(){function e(t,n){var r=this;Object.defineProperty(this,"color",{enumerable:!0,configurable:!0,writable:!0,value:n}),Object.defineProperty(this,"_detectionZone",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_grappleInteraction",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_mesh",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_physicsBody",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_physicsShape",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_socle",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"onPlacedOnSocle",{enumerable:!0,configurable:!0,writable:!0,value:new d.cPK}),_e.registerBall(this),this.onPlacedOnSocle.add((function(t){return e.onAnyBallPlacedOnAnySocle.notifyObservers({ball:r,socle:t})})),this._mesh=d.PeD.CreateSphere("templeBall",{diameter:2}),this._mesh.position=t,this._physicsShape=new d.JNI({type:d.DKo.SPHERE,parameters:{radius:1}},Ie.scene);var i=new se.G("templeBallMaterial");i.diffuseColor=n,this._mesh.material=i,this._physicsBody=new d.aZl(this._mesh,d.AHY.DYNAMIC,!1,Ie.scene),this._physicsBody.shape=this._physicsShape,this._physicsBody.setLinearDamping(1),this._physicsBody.setMassProperties({mass:.5}),this._grappleInteraction=new ce(this),this._detectionZone=new Y({diameter:4},!1),this._detectionZone.zone.parent=this._mesh,G.instance.meshCreationPromise.then((function(e){r._detectionZone.addMeshToDetect(e)})),this._detectionZone.onMeshEnter.add((function(){V.instance.hasAnObjectGrappled||r._socle||r._grappleInteraction.makeAvailable()})),this._detectionZone.onMeshExit.add((function(){r._grappleInteraction.makeUnavailable()}))}return Object.defineProperty(e.prototype,"mesh",{get:function(){return this._mesh},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"physicsBody",{get:function(){return this._physicsBody},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"socle",{get:function(){return this._socle},set:function(e){this._socle=e,e&&this.onPlacedOnSocle.notifyObservers(e)},enumerable:!1,configurable:!0}),Object.defineProperty(e,"onAnyBallPlacedOnAnySocle",{enumerable:!0,configurable:!0,writable:!0,value:new d.cPK}),e}(),de=function(e){function t(){var t=e.call(this)||this;return Object.defineProperty(t,"_container",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),t._container=new E.tN,t._container.width="300px",t._container.height="200px",t._container.thickness=0,t._container.scaleY=.5,t._container.scaleX=.5,C.instance.onInteractionAvailable.add((function(e){e instanceof Q&&t.show(e)})),C.instance.onInteractionUnavailable.add((function(e){e instanceof Q&&t.hide()})),t}return(0,c.C6)(t,e),Object.defineProperty(t.prototype,"controlNode",{get:function(){return this._container},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"show",{enumerable:!1,configurable:!0,writable:!0,value:function(e){var t;this._container.isVisible=!0;var n=new E.tN;n.width="180px",n.height="60px",n.cornerRadius=60,n.color="rgb(168, 98, 68)",n.thickness=4,n.background="rgb(255, 199, 130)",this._container.addControl(n);var r=new E.VJ;r.fontSize=30,r.text="".concat(e.description),n.addControl(r);var i=new E.tN;i.width="80px",i.height="70px",i.cornerRadius=60,i.color="rgb(168, 98, 68)",i.thickness=4,i.background="rgb(255, 255, 255)",i.horizontalAlignment=E.Ec.HORIZONTAL_ALIGNMENT_RIGHT,i.verticalAlignment=E.Ec.VERTICAL_ALIGNMENT_BOTTOM,this._container.addControl(i);var a=new E.VJ;a.fontSize=45,a.text="".concat(e.simplifiedCode),a.fontWeight="bold",a.paddingTop="6px",i.addControl(a),this._container.linkWithMesh(null!==(t=e.mesh)&&void 0!==t?t:null),this._container.linkOffsetY="-50px"}}),Object.defineProperty(t.prototype,"hide",{enumerable:!1,configurable:!0,writable:!0,value:function(){this._container.isVisible=!1,this._container.linkWithMesh(null)}}),t}(I),fe=function(e){function t(){var t=e.call(this)||this;return Object.defineProperty(t,"_container",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(t,"_textBlock",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),t._textBlock=new E.VJ,t._textBlock.color="white",t._textBlock.textWrapping=!0,t._textBlock.textHorizontalAlignment=E.Ec.HORIZONTAL_ALIGNMENT_CENTER,t._textBlock.textVerticalAlignment=E.Ec.VERTICAL_ALIGNMENT_CENTER,t._container=new E.tN,t._container.width="25%",t._container.height="80px",t._container.cornerRadius=12,t._container.color="white",t._container.thickness=2,t._container.background="rgba(0, 0, 0, 0.6)",t._container.alpha=0,t._container.addControl(t._textBlock),t._container.zIndex=1,K.onAnyKeyZoneEntered.add((function(e){return t.show(e)})),t}return(0,c.C6)(t,e),Object.defineProperty(t.prototype,"controlNode",{get:function(){return this._container},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"show",{enumerable:!1,configurable:!0,writable:!0,value:function(e){var t=this;this._textBlock.text=e.name,e.discovered?(this._container.horizontalAlignment=E.Ec.HORIZONTAL_ALIGNMENT_LEFT,this._container.verticalAlignment=E.Ec.VERTICAL_ALIGNMENT_BOTTOM,this._container.left="20px",this._container.top="-20px",this._textBlock.fontSize="28px",this._textBlock.fontStyle="normal"):(this._container.horizontalAlignment=E.Ec.HORIZONTAL_ALIGNMENT_CENTER,this._container.verticalAlignment=E.Ec.VERTICAL_ALIGNMENT_BOTTOM,this._container.paddingBottom="30px",this._textBlock.fontSize="36px",this._textBlock.fontStyle="bold"),this.fadeTo(1,300),setTimeout((function(){t.fadeTo(0,500)}),3e3)}}),Object.defineProperty(t.prototype,"fadeTo",{enumerable:!1,configurable:!0,writable:!0,value:function(e,t){var n=this,r=this._container.alpha,i=performance.now(),a=function(o){var l=o-i,s=Math.min(l/t,1);n._container.alpha=r+(e-r)*s,s<1&&requestAnimationFrame(a)};requestAnimationFrame(a)}}),t}(I),he=function(e){function t(t){var n=e.call(this)||this;Object.defineProperty(n,"_mainMenu",{enumerable:!0,configurable:!0,writable:!0,value:t}),Object.defineProperty(n,"_panel",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),n._panel=new E.Pc,n._panel.zIndex=2,n._panel.width="600px",n._panel.horizontalAlignment=E.Ec.HORIZONTAL_ALIGNMENT_LEFT,n._panel.verticalAlignment=E.Ec.VERTICAL_ALIGNMENT_CENTER,n._panel.spacing=15,n._panel.paddingLeft="60px",n.createSliderWithLabel("Volume SFX",k.instance.SFXVolume,(function(e){k.instance.SFXVolume=e})),n.createSliderWithLabel("Volume Musique",k.instance.MUSICVolume,(function(e){k.instance.MUSICVolume=e})),n.createSliderWithLabel("Volume UI",k.instance.UIVolume,(function(e){k.instance.UIVolume=e}));var r=me.createButton("Retour",(function(){n.hide()}));return r.width="300px",r.height="40px",r.color="white",r.background="rgba(255, 255, 255, 0.05)",n._panel.addControl(r),n._panel.isVisible=!1,Ie.scene.onKeyboardObservable.add((function(e){var t=e.type===d.TBB.KEYDOWN;"Escape"===e.event.key&&t&&n.controlNode.isVisible&&n.hide()})),n}return(0,c.C6)(t,e),Object.defineProperty(t.prototype,"controlNode",{get:function(){return this._panel},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"createSliderWithLabel",{enumerable:!1,configurable:!0,writable:!0,value:function(e,t,n){var r=new E.Pc;r.isVertical=!1,r.height="40px",r.paddingBottom="10px",r.horizontalAlignment=E.Ec.HORIZONTAL_ALIGNMENT_CENTER,r.verticalAlignment=E.Ec.VERTICAL_ALIGNMENT_CENTER;var i=new E.VJ;i.text=e,i.color="white",i.width="120px",i.fontSize=14,i.fontStyle="bold",i.textHorizontalAlignment=E.Ec.HORIZONTAL_ALIGNMENT_LEFT,i.paddingRight="10px";var a=new E.Ap;a.minimum=0,a.maximum=1,a.value=t,a.width="150px",a.height="14px",a.color="#FFF",a.background="#333",a.thumbWidth="18px",a.thumbColor="#AAA",a.borderColor="#888";var o=new E.VJ;o.text=Math.round(100*t).toString()+" %",o.width="50px",o.color="white",o.fontSize=14,o.textHorizontalAlignment=E.Ec.HORIZONTAL_ALIGNMENT_RIGHT,o.paddingLeft="10px",a.onValueChangedObservable.add((function(e){o.text=Math.round(100*e).toString()+" %",n(e)})),r.addControl(i),r.addControl(a),r.addControl(o),this._panel.addControl(r)}}),Object.defineProperty(t.prototype,"show",{enumerable:!1,configurable:!0,writable:!0,value:function(){this._panel.isVisible=!0}}),Object.defineProperty(t.prototype,"hide",{enumerable:!1,configurable:!0,writable:!0,value:function(){this._panel.isVisible=!1,this._mainMenu.show()}}),t}(I),pe=function(e){function t(t){var n=e.call(this)||this;return Object.defineProperty(n,"_imageControl",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),n._imageControl=new E._V("imageUI",t),n._imageControl.width=1,n._imageControl.height=1,n._imageControl.stretch=E._V.STRETCH_UNIFORM,n}return(0,c.C6)(t,e),Object.defineProperty(t.prototype,"controlNode",{get:function(){return this._imageControl},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"fadeIn",{enumerable:!1,configurable:!0,writable:!0,value:function(e){var t=this.controlNode;t.alpha=0;var n=performance.now(),r=Ie.scene.onBeforeRenderObservable.add((function(){var i=performance.now()-n,a=Math.min(i/e,1);t.alpha=a,a>=1&&Ie.scene.onBeforeRenderObservable.remove(r)}))}}),Object.defineProperty(t.prototype,"fadeOut",{enumerable:!1,configurable:!0,writable:!0,value:function(e){var t=this.controlNode;t.alpha=1;var n=performance.now(),r=Ie.scene.onBeforeRenderObservable.add((function(){var i=performance.now()-n,a=Math.min(i/e,1);t.alpha=1-a,a>=1&&Ie.scene.onBeforeRenderObservable.remove(r)}))}}),t}(I),me=function(e){function t(){var n=e.call(this)||this;Object.defineProperty(n,"_panel",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(n,"_optionMenuUI",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(n,"_canvas",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(n,"_howToPlay",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),n._howToPlay=new pe("ui/how-to-play.png"),n._howToPlay.controlNode.isVisible=!1,n._optionMenuUI=new he(n),n._panel=new E.Pc,n._panel.zIndex=2,n._panel.width="300px",n._panel.horizontalAlignment=E.Ec.HORIZONTAL_ALIGNMENT_LEFT,n._panel.verticalAlignment=E.Ec.VERTICAL_ALIGNMENT_CENTER,n._panel.paddingLeft="60px",n._panel.spacing=20;var r=t.createButton("Jouer",(function(){return n.onPlayPressed()})),i=t.createButton("Options",(function(){return n.onOptionsPressed()})),a=t.createButton("How to Play",(function(){return n.showHowToPlay()}));t.createButton("Quitter",(function(){return n.onQuitPressed()}));return n._panel.addControl(r),n._panel.addControl(i),n._panel.addControl(a),n.show(),Ie.scene.onKeyboardObservable.add((function(e){var t=e.type===d.TBB.KEYDOWN;"Escape"===e.event.key&&t&&!n.optionsMenuUI.controlNode.isVisible&&n._canvas&&!n._panel.isVisible&&n.show(),"Escape"===e.event.key&&t&&n._howToPlay.controlNode.isVisible&&n._canvas&&(n.hideHowToPlay(),n.show())})),n}return(0,c.C6)(t,e),Object.defineProperty(t.prototype,"canvas",{set:function(e){this._canvas=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"controlNode",{get:function(){return this._panel},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"optionsMenuUI",{get:function(){return this._optionMenuUI},enumerable:!1,configurable:!0}),Object.defineProperty(t,"createButton",{enumerable:!1,configurable:!0,writable:!0,value:function(e,t){var n=E.$n.CreateSimpleButton(e.toLowerCase(),e);return n.width="100%",n.height="60px",n.color="white",n.background="rgba(255, 255, 255, 0.05)",n.fontSize="28px",n.fontStyle="bold",n.textBlock.textHorizontalAlignment=E.Ec.HORIZONTAL_ALIGNMENT_LEFT,n.textBlock.paddingLeft="20px",n.cornerRadius=10,n.thickness=1,n.paddingBottom="10px",n.onPointerEnterObservable.add((function(){n.background="rgba(255, 255, 255, 0.2)"})),n.onPointerOutObservable.add((function(){n.background="rgba(255, 255, 255, 0.05)"})),n.onPointerUpObservable.add(t),n.onPointerUpObservable.add((function(){k.instance&&(k.instance.stopUI("click"),k.instance.playUI("click",{autoplay:!0,loop:!1}))})),n}}),Object.defineProperty(t.prototype,"show",{enumerable:!1,configurable:!0,writable:!0,value:function(){this._panel.isVisible=!0}}),Object.defineProperty(t.prototype,"hide",{enumerable:!1,configurable:!0,writable:!0,value:function(){this._panel.isVisible=!1}}),Object.defineProperty(t.prototype,"onPlayPressed",{enumerable:!1,configurable:!0,writable:!0,value:function(){this._canvas&&(this._canvas.requestPointerLock(),this.hide())}}),Object.defineProperty(t.prototype,"onOptionsPressed",{enumerable:!1,configurable:!0,writable:!0,value:function(){this._optionMenuUI.show(),this.hide()}}),Object.defineProperty(t.prototype,"onQuitPressed",{enumerable:!1,configurable:!0,writable:!0,value:function(){console.log("Quitter !")}}),Object.defineProperty(t.prototype,"showHowToPlay",{enumerable:!1,configurable:!0,writable:!0,value:function(){this.hide(),this._howToPlay.controlNode.isVisible=!0,ve.instance.ui.addControl(this._howToPlay.controlNode)}}),Object.defineProperty(t.prototype,"hideHowToPlay",{enumerable:!1,configurable:!0,writable:!0,value:function(){this._howToPlay.controlNode.isVisible=!1,ve.instance.ui.removeControl(this._howToPlay.controlNode)}}),t}(I),ge=function(e){function t(){var t=e.call(this)||this;return Object.defineProperty(t,"_container",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(t,"_childControls",{enumerable:!0,configurable:!0,writable:!0,value:[]}),t._container=new E.mc,t._container.isVisible=!0,K.onAnyKeyZoneEntered.add(t.createUIs.bind(t)),K.onAnyKeyZoneExited.add(t.destroyUIs.bind(t)),U.onAnyConversationStart.add(t.hideUIs.bind(t)),U.onAnyConversationEnd.add(t.showUIs.bind(t)),C.instance.onInteractionAvailable.add((function(e){(e instanceof W||e instanceof M)&&t.hideUIs()})),C.instance.onInteractionUnavailable.add((function(e){(e instanceof W||e instanceof M)&&t.showUIs()})),t}return(0,c.C6)(t,e),Object.defineProperty(t.prototype,"controlNode",{get:function(){return this._container},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"createUIs",{enumerable:!1,configurable:!0,writable:!0,value:function(e){for(var t=e.conversationProviders,n=0;n<t.length;n++){var r=t[n];console.log(r);var i=new E.tN;i.width="180px",i.height="60px",i.cornerRadius=60,i.color="rgb(168, 98, 68)",i.thickness=4,i.background="rgb(255, 199, 130)";var a=new E.VJ;a.fontSize=30,a.text="● ● ●",i.addControl(a),ve.instance.ui.addControl(i),this._childControls.push(i);var o=r.mesh;o&&(i.linkWithMesh(o),i.linkOffsetY="-50px")}}}),Object.defineProperty(t.prototype,"destroyUIs",{enumerable:!1,configurable:!0,writable:!0,value:function(){this._childControls.forEach((function(e){return e.dispose()})),this._childControls=[]}}),Object.defineProperty(t.prototype,"showUIs",{enumerable:!1,configurable:!0,writable:!0,value:function(){this._childControls.forEach((function(e){return e.isVisible=!0}))}}),Object.defineProperty(t.prototype,"hideUIs",{enumerable:!1,configurable:!0,writable:!0,value:function(){this._childControls.forEach((function(e){return e.isVisible=!1}))}}),t}(I),ve=function(){function e(t){Object.defineProperty(this,"_canvas",{enumerable:!0,configurable:!0,writable:!0,value:t}),Object.defineProperty(this,"_ui",{enumerable:!0,configurable:!0,writable:!0,value:E.vs.CreateFullscreenUI("_ui",void 0,Ie.scene)}),Object.defineProperty(this,"_worldInteractionUI",{enumerable:!0,configurable:!0,writable:!0,value:new de}),Object.defineProperty(this,"_dialogueInteractionUI",{enumerable:!0,configurable:!0,writable:!0,value:new H}),Object.defineProperty(this,"_showConversationProviderUI",{enumerable:!0,configurable:!0,writable:!0,value:new ge}),Object.defineProperty(this,"_islandsUI",{enumerable:!0,configurable:!0,writable:!0,value:new fe}),Object.defineProperty(this,"_mainMenuUI",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_optionsMenuUI",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_questUI",{enumerable:!0,configurable:!0,writable:!0,value:new re}),Object.defineProperty(this,"_journalUI",{enumerable:!0,configurable:!0,writable:!0,value:new Oe}),Object.defineProperty(this,"_slideAnimationUI",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),e._instance=this,this._ui.addControl(this._worldInteractionUI.controlNode),this._ui.addControl(this._showConversationProviderUI.controlNode),this._ui.addControl(this._dialogueInteractionUI.controlNode),this._ui.addControl(this._islandsUI.controlNode),this._mainMenuUI=new me,this._optionsMenuUI=this._mainMenuUI.optionsMenuUI,this._ui.addControl(this._optionsMenuUI.controlNode),this._ui.addControl(this._mainMenuUI.controlNode),this._mainMenuUI.canvas=t,this._ui.addControl(this._questUI.controlNode),this._ui.addControl(this._journalUI.controlNode),this._slideAnimationUI=new ye}return Object.defineProperty(e,"instance",{get:function(){return this._instance},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"ui",{get:function(){return this._ui},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"showMainMenu",{enumerable:!1,configurable:!0,writable:!0,value:function(){this._mainMenuUI&&this._mainMenuUI.show()}}),e}(),ye=function(){function e(){Object.defineProperty(this,"ui",{enumerable:!0,configurable:!0,writable:!0,value:ve.instance.ui}),Object.defineProperty(this,"_slides",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"currentIndex",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"slidePanel",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"spaceLabel",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),e._instance=this,this.setSlides(),this.slidePanel=new E.tN("slidePanel"),this.slidePanel.width="100%",this.slidePanel.height="100%",this.slidePanel.isVisible=!0,this.slidePanel.alpha=0,this.ui.addControl(this.slidePanel),this.spaceLabel=new E.VJ,this.spaceLabel.text="Space",this.spaceLabel.color="black",this.spaceLabel.fontSize=32,this.spaceLabel.textHorizontalAlignment=E.VJ.HORIZONTAL_ALIGNMENT_RIGHT,this.spaceLabel.textVerticalAlignment=E.VJ.VERTICAL_ALIGNMENT_BOTTOM,this.spaceLabel.paddingRight="40px",this.spaceLabel.paddingBottom="20px",this.spaceLabel.zIndex=1,this.animateBlinkingText(this.spaceLabel,2e3),this.slidePanel.addControl(this.spaceLabel)}return Object.defineProperty(e,"instance",{get:function(){return this._instance},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"animateBlinkingText",{enumerable:!1,configurable:!0,writable:!0,value:function(e,t){void 0===t&&(t=1e3);var n=null,r=function(i){n||(n=i);var a=i-n,o=a%t/t;e.alpha=.65+.35*Math.sin(2*o*Math.PI),requestAnimationFrame(r)};requestAnimationFrame(r)}}),Object.defineProperty(e.prototype,"startSlideshow",{enumerable:!1,configurable:!0,writable:!0,value:function(){return(0,c.sH)(this,void 0,Promise,(function(){var e,t=this;return(0,c.YH)(this,(function(n){switch(n.label){case 0:return 0===this._slides.length?[2]:(this.currentIndex=0,[4,this.fadeInPanel(500)]);case 1:return n.sent(),this.showSlide(this.currentIndex),e=function(e){return(0,c.sH)(t,void 0,void 0,(function(){return(0,c.YH)(this,(function(t){return"Space"===e.code&&(this.currentIndex++,this.currentIndex<this._slides.length&&this.showSlide(this.currentIndex)),[2]}))}))},window.addEventListener("keydown",e),[2]}}))}))}}),Object.defineProperty(e.prototype,"showSlide",{enumerable:!1,configurable:!0,writable:!0,value:function(e){0!=e&&this._slides[e-1].fadeOut(500);var t=this._slides[e];switch(this.slidePanel.addControl(t.controlNode),this._slides[e].fadeIn(500),e){case 0:k.instance.playSFX("snoring",{autoplay:!0,loop:!0});break;case 1:k.instance.stopSFX("snoring"),k.instance.playSFX("earthquake",{autoplay:!0,loop:!0});break;case 3:k.instance.stopSFX("earthquake"),k.instance.playSFX("whale",{autoplay:!0,loop:!1});break;case 4:k.instance.playSFX("plock");break;case 5:k.instance.playSFX("stars",{autoplay:!0,loop:!1}),k.instance.playSFX("snoring",{autoplay:!0,loop:!1});break;case 6:k.instance.stopSFX("snoring")}}}),Object.defineProperty(e.prototype,"fadeInPanel",{enumerable:!1,configurable:!0,writable:!0,value:function(e){var t=this;return new Promise((function(n){t.slidePanel.alpha=0;var r=Ie.scene,i=performance.now(),a=r.onBeforeRenderObservable.add((function(){var o=performance.now()-i,l=Math.min(o/e,1);t.slidePanel.alpha=l,l>=1&&(r.onBeforeRenderObservable.remove(a),n())}))}))}}),Object.defineProperty(e.prototype,"setSlides",{enumerable:!1,configurable:!0,writable:!0,value:function(){this._slides=[new pe("ui/slides/slide1.png"),new pe("ui/slides/slide2.png"),new pe("ui/slides/slide3.png"),new pe("ui/slides/slide4.png"),new pe("ui/slides/slide5.png"),new pe("ui/slides/slide6.png"),new pe("ui/slides/slide7.png")]}}),e}(),_e=function(){function e(t,n){var r=this;Object.defineProperty(this,"_upperRightSocle",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_middleRightSocle",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_lowerRightSocle",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_lowerMiddleSocle",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_lowerLeftSocle",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_middleLeftSocle",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_upperLeftSocle",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_upperMiddleSocle",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_centerSocle",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_transformNode",{enumerable:!0,configurable:!0,writable:!0,value:new d.VR0("templePuzzle")}),Object.defineProperty(this,"_cameraConfiguration",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_detectionZone",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),e._instance=this,this._transformNode.parent=t,this._transformNode.rotation=d.Pq0.Zero(),this._transformNode.position=n,this._detectionZone=new Y({diameter:70},!1),this._detectionZone.zone.parent=this._transformNode,this._cameraConfiguration=new j,this._cameraConfiguration.target=this._transformNode,this._cameraConfiguration.wantedBeta=d.uMQ.FromDegrees(0).radians(),this._cameraConfiguration.wantedAlpha=d.uMQ.FromDegrees(-90).radians(),this._cameraConfiguration.distanceFromTarget=100,this._detectionZone.onMeshEnter.add((function(){O.instance.cameraConfiguration=r._cameraConfiguration})),this._detectionZone.onMeshExit.add((function(){O.instance.cameraConfiguration=z.playerCameraConfiguration})),G.instance.meshCreationPromise.then((function(e){r._detectionZone.addMeshToDetect(e)})),this._upperRightSocle=this.createSocle(new d.Pq0(-1,0,-1).scale(20)),this._middleRightSocle=this.createSocle(new d.Pq0(-1,0,0).scale(20),d.v9j.Purple()),this._lowerRightSocle=this.createSocle(new d.Pq0(-1,0,1).scale(20),d.v9j.Blue()),this._lowerMiddleSocle=this.createSocle(new d.Pq0(0,0,1).scale(20),d.v9j.Green()),this._lowerLeftSocle=this.createSocle(new d.Pq0(1,0,1).scale(20),d.v9j.Red()),this._middleLeftSocle=this.createSocle(new d.Pq0(1,0,0).scale(20)),this._upperLeftSocle=this.createSocle(new d.Pq0(1,0,-1).scale(20),d.v9j.Gray()),this._upperMiddleSocle=this.createSocle(new d.Pq0(0,0,-1).scale(20),d.v9j.Yellow()),this._centerSocle=this.createSocle(d.Pq0.Zero()),this._lowerLeftSocle.meshImportedPromise.then((function(){new be(r._lowerLeftSocle.transformNode.absolutePosition.add(d.Pq0.Forward().scale(-10)).add(d.Pq0.Up().scale(50)),d.v9j.Yellow())})),this._lowerRightSocle.meshImportedPromise.then((function(){new be(r._lowerRightSocle.transformNode.absolutePosition.add(d.Pq0.Forward().scale(-10)).add(d.Pq0.Up().scale(50)),d.v9j.Gray())}))}return Object.defineProperty(e,"instance",{get:function(){return this._instance},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"transformNode",{get:function(){return this._transformNode},enumerable:!1,configurable:!0}),Object.defineProperty(e,"registerBall",{enumerable:!1,configurable:!0,writable:!0,value:function(e){var t=this;this._ball.push(e),e.onPlacedOnSocle.add((function(){t._instance.onBallPlacedOnSocle()}))}}),Object.defineProperty(e.prototype,"createSocle",{enumerable:!1,configurable:!0,writable:!0,value:function(e,t){var n=new ue(this._transformNode,e);return n.validColor=t,n}}),Object.defineProperty(e.prototype,"onBallPlacedOnSocle",{enumerable:!1,configurable:!0,writable:!0,value:function(){this.isAllBallPlacedOnASocle()&&(this.checkConfiguration()?(e.onPuzzleResolved.notifyObservers(),ye.instance.startSlideshow()):e.onPuzzleRejected.notifyObservers())}}),Object.defineProperty(e.prototype,"isAllBallPlacedOnASocle",{enumerable:!1,configurable:!0,writable:!0,value:function(){var t=0;return e._ball.forEach((function(e){e.socle&&t++})),6==t}}),Object.defineProperty(e.prototype,"checkConfiguration",{enumerable:!1,configurable:!0,writable:!0,value:function(){for(var t=0;t<e._ball.length;t++){var n=e._ball[t],r=n.socle;if(!r)return console.log("Some ball are not placed"),!1;var i=r.validColor;if(void 0===i||!n.color.equals(i))return!1}return!0}}),Object.defineProperty(e,"onPuzzleResolved",{enumerable:!0,configurable:!0,writable:!0,value:new d.cPK}),Object.defineProperty(e,"onPuzzleRejected",{enumerable:!0,configurable:!0,writable:!0,value:new d.cPK}),Object.defineProperty(e,"_ball",{enumerable:!0,configurable:!0,writable:!0,value:new Array}),e}(),Pe=function(){function e(){}return Object.defineProperty(e,"createAll",{enumerable:!1,configurable:!0,writable:!0,value:function(){var t=[];return t.push(e.createTalkToPedro()),t.push(e.createTempleQuest()),t}}),Object.defineProperty(e,"createTalkToPedro",{enumerable:!1,configurable:!0,writable:!0,value:function(){var e=new ie("dreamland","Le monde des rêves","active",0),t=[];return t.push(new ae("Parlez à l'habitant de l'ile du Dophin")),t.push(new ae("Ouvrir le journal en appuyant sur la touche J")),t.push(new ae("Aller voir le temple")),t.push(new ae("Parler aux différents habitants de chaque île")),e.steps=t,_e.onPuzzleResolved.add((function(){e.stopQuest()})),e}}),Object.defineProperty(e,"createTempleQuest",{enumerable:!1,configurable:!0,writable:!0,value:function(){var e=new ie("temple_quest","Le Temple","inactive",0),t=[];return t.push(new ae("A l'aide du journal, \n Résoudre l'énigme du temple")),e.steps=t,_e.onPuzzleResolved.add((function(){e.state="completed"})),e}}),e}(),we=function(){function e(){var t,n=this;Object.defineProperty(this,"quests",{enumerable:!0,configurable:!0,writable:!0,value:[]}),this.quests=Pe.createAll(),e._instance=this,Ie.scene.onBeforeRenderObservable.add((function(){n.quests.forEach((function(e){e.steps[e.currentStepIndex].condition&&"active"===e.state&&e.nextStep()}))})),null===(t=this.getQuest("dreamland"))||void 0===t||t.startQuest()}return Object.defineProperty(e,"instance",{get:function(){return this._instance},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"getQuest",{enumerable:!1,configurable:!0,writable:!0,value:function(e){return this.quests.find((function(t){return t.id===e}))}}),Object.defineProperty(e.prototype,"getAllActiveQuests",{enumerable:!1,configurable:!0,writable:!0,value:function(){var e=[];return this.quests.forEach((function(t){"active"===t.state&&e.push(t)})),e}}),e}(),Oe=function(e){function t(){var n=e.call(this)||this;Object.defineProperty(n,"_panel",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(n,"_container",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(n,"_journalEntry",{enumerable:!0,configurable:!0,writable:!0,value:new Map}),Object.defineProperty(n,"hasBeenOpened",{enumerable:!0,configurable:!0,writable:!0,value:!1}),n._panel=new E.Pc,n._panel.width="60%",n._panel.height="90%",n._panel.horizontalAlignment=E.Ec.HORIZONTAL_ALIGNMENT_CENTER,n._panel.verticalAlignment=E.Ec.VERTICAL_ALIGNMENT_CENTER,n._panel.isVisible=!1;var r=new E.tN;return r.background="rgba(0, 0, 0, 0.6)",r.thickness=0,r.cornerRadius=10,r.height="100%",r.width="100%",r.verticalAlignment=E.Ec.VERTICAL_ALIGNMENT_TOP,n._container=new E.Pc,n._container.isVertical=!0,n._container.width="100%",n._container.spacing=20,n._container.verticalAlignment=E.Ec.VERTICAL_ALIGNMENT_TOP,r.addControl(n._container),n._panel.addControl(r),Ie.scene.onKeyboardObservable.add((function(e){var t=e.type===d.TBB.KEYDOWN;"j"===e.event.key&&t&&(n._panel.isVisible?n.hide():n.show())})),t._instance=n,n}return(0,c.C6)(t,e),Object.defineProperty(t,"instance",{get:function(){return this._instance},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"controlNode",{get:function(){return this._panel},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"refresh",{enumerable:!1,configurable:!0,writable:!0,value:function(){var e=this;we.instance&&(this._container.clearControls(),this._journalEntry.forEach((function(t,n){var r=new E.Pc;r.isVertical=!0,r.width="80%",r.paddingTop="10px",r.paddingBottom="10px",r.horizontalAlignment=E.Ec.HORIZONTAL_ALIGNMENT_CENTER;var i=new E.VJ;i.text="⛋ ".concat(n.name),i.color="white",i.fontSize=20,i.fontWeight="bold",i.resizeToFit=!0,i.textHorizontalAlignment=E.Ec.HORIZONTAL_ALIGNMENT_LEFT,r.addControl(i),t.forEach((function(e){var t=new E.VJ;t.text="▣ ".concat(e),t.color="#FFFFFF",t.fontSize=17,t.textWrapping=!0,t.resizeToFit=!0,t.textHorizontalAlignment=E.Ec.HORIZONTAL_ALIGNMENT_LEFT,r.addControl(t)})),r.addControl(e.createSeparator()),e._container.addControl(r)})))}}),Object.defineProperty(t.prototype,"createSeparator",{enumerable:!1,configurable:!0,writable:!0,value:function(){var e=new E.tN;return e.height="2px",e.width="100%",e.background="#888888",e.thickness=0,e.paddingTop="6px",e}}),Object.defineProperty(t.prototype,"show",{enumerable:!1,configurable:!0,writable:!0,value:function(){var e;this.refresh(),this._panel.isVisible=!0,this.hasBeenOpened||null===(e=we.instance.getQuest("dreamland"))||void 0===e||e.updateCurrentStepStatus(),k.instance&&(k.instance.stopSFX("click"),k.instance.playSFX("click",{autoplay:!0})),this.hasBeenOpened=!0}}),Object.defineProperty(t.prototype,"hide",{enumerable:!1,configurable:!0,writable:!0,value:function(){this._panel.isVisible=!1,k.instance&&(k.instance.stopSFX("click"),k.instance.playSFX("click",{autoplay:!0}))}}),Object.defineProperty(t.prototype,"addEntryToQuest",{enumerable:!1,configurable:!0,writable:!0,value:function(e,t){if(e){this._journalEntry.has(e)||this._journalEntry.set(e,[]);var n=this._journalEntry.get(e);n.includes(t)||n.push(t),this.refresh()}}}),t}(I),je=function(){function e(){}return Object.defineProperty(e,"createPedro",{enumerable:!1,configurable:!0,writable:!0,value:function(){return(0,c.sH)(this,void 0,Promise,(function(){var e;return(0,c.YH)(this,(function(t){return e=new J,e.name="Pedro",x.loadMesh("models/characters/pedro.glb").then((function(t){e.mesh=t.meshes[0],t.meshes.forEach((function(e){var t=e.material;if(t){var n=new Z;n.assignMaterial(e).then((function(){n.configureFromPBRMaterial(t)}))}}))})),e.detectionZone=new $({height:8,diameterTop:100,diameterBottom:100},!0),e.detectionZone.zone.position.set(0,-11,0),e.conversation=(new ne).say("[g]OH CA VA PAS DE ME REVEILLER COMME CA ! MAIS QUI ES TU !! [/g]").then("Ca fais bien longtemps que j'ai pas vu quelqu'un comme toi ici ! Je me présente, je suis Pedro. Je pêche ici depuis bel lurette mon n'veu.").then("Ici, eh beh ici je sais pas trop comment te le décrire. C'est assez [i]vide[/i] et ça mord pas trop au bout de ma canne... ").then("Mais ! Y'a un [c=blue]p'tit endroit au nord d'ici [/c] un peu particulier.").then("[c=blue] Y'avait deux boules et plein de poteaux [/c], j'ai pas tout compris et j'étais fatigué Ducoup j'suis parti..").then("Normalement tu devrais l'apercevoir d'ici ! Fais attention ! ").then("Aussi ! [g]Information capital !!! [/g] Si tu as un journal dans ton sous-marin [g]tu peux prendre des notes[/g] sur tout ce que tu vas découvrir pour ne pas oublier d'information").then("Hésite pas à aller voir [g][c=blue]les habitants des autres îles[/c][/g], ils devraient pouvoir t'aider !").then("Bon aller moi je retourne pêcher (et dormir au passage... ça fais bieeeen ..... loongt................zzZZZzzzzzZZzzzzzzzz)").setOnEnding((function(){var e;Oe.instance.addEntryToQuest(we.instance.getQuest("dreamland"),"Pedro s'est endormie"),Oe.instance.addEntryToQuest(we.instance.getQuest("dreamland"),"Il y aurait un endroit interessant au nord de l'ile des dauphins"),Oe.instance.addEntryToQuest(we.instance.getQuest("dreamland"),"Deux boules ? seraient déjà présentes"),Oe.instance.addEntryToQuest(we.instance.getQuest("dreamland"),"Vu le manque de place, je vais pouvoir en prendre qu'une seule à la fois.."),null===(e=we.instance.getQuest("dreamland"))||void 0===e||e.updateCurrentStepStatus()})).build(),e.cameraConfiguration=new j,e.cameraConfiguration.target=e.transformNode,e.cameraConfiguration.distanceFromTarget=10,e.cameraConfiguration.offset=d.Pq0.Up().scale(2),e.cameraConfiguration.wantedAlpha=d.uMQ.FromDegrees(-90).radians(),[2,e]}))}))}}),Object.defineProperty(e,"createFox",{enumerable:!1,configurable:!0,writable:!0,value:function(){return(0,c.sH)(this,void 0,Promise,(function(){var e;return(0,c.YH)(this,(function(t){return e=new J,e.name="Crimson",x.loadMesh("models/characters/fox.glb").then((function(t){e.mesh=t.meshes[0],t.meshes.forEach((function(e){var t=e.material;if(t){var n=new Z;n.assignMaterial(e).then((function(){n.configureFromPBRMaterial(t)}))}}))})),e.detectionZone=new $({height:8,diameterTop:45,diameterBottom:45},!0),e.conversation=(new ne).say("Je sais pas si tu vois la même chose que moi [i](peut-être que c'est un mirage).[/i] Y'a une [g]piste de bowling là-bas[/g] où y'a les quilles qui sortent de l'eau.").then("Y'a une sorte de boule de bowling qui était sur l'île. J'ai essayé de jouer avec des quilles en glace mais ça a pas trop marché.").then("Parmi les quilles j'ai mis une bouteille que j'ai trouvée dans le coin et bizarrement, quand j'ai fait un STRIKE ! Y'a une note qui est sortie.").then("Y'avait marqué ça : [c=blue]« Redina, la plus forte, restait en retrait afin de couvrir leurs arrières »[/c]").then("Bizarre l'ambiance... J'en ai marre de jouer au bowling donc [g]j'te donne la boule[/g] ! Mais prends-en soin !").then("Allez, je vais jouer à la pétanque moi...").setOnEnding((function(){Oe.instance.addEntryToQuest(we.instance.getQuest("dreamland"),"D'après Crimson : Redina, la plus forte, restait en retrait afin de couvrir leurs arrières")})).build(),e.cameraConfiguration=new j,e.cameraConfiguration.target=e.transformNode,e.cameraConfiguration.distanceFromTarget=10,e.cameraConfiguration.wantedAlpha=d.uMQ.FromDegrees(-90).radians(),[2,e]}))}))}}),Object.defineProperty(e,"createGirl",{enumerable:!1,configurable:!0,writable:!0,value:function(){return(0,c.sH)(this,void 0,Promise,(function(){var e;return(0,c.YH)(this,(function(t){return e=new J,e.name="Rosa",x.loadMesh("models/characters/phare_girl.glb").then((function(t){e.mesh=t.meshes[0],t.meshes.forEach((function(e){var t=e.material;if(t){var n=new Z;n.assignMaterial(e).then((function(){n.configureFromPBRMaterial(t)}))}}))})),e.detectionZone=new $({height:8,diameterTop:45,diameterBottom:45},!0),e.conversation=(new ne).say("Si je suis la trajectoire de cette étoile, alors je peux peut-être réussir à démontrer que e = m6 !").then("Oh salut toi ! T'as un sacré sous-marin ! [i]J'adore[/i] les sous-marins tu tombes à pic !").then("Pour la peine, je vais te présenter les conclusions de mon expérience, prépare toi à en prendre plein la vue !").then("J'ai trouvé [c=blue]une boule de couleurs avec deux parchemins[/c]. Commençons par les FAITS !").then("Fait numéro 1 : la boule est [g]d'une couleur spécifique[/g]... Hmmmm...... Ok soit.").then("Fait numéro 2 : les textes parlent de...je ne sais pas trop quoi à vrai dire. Mais ! J'ai l'impression que [g]les couleurs sont importantes ![/g]").then("Fait numéro 3 : les deux parchemins racontes la chose suivante : \n [c=blue] - Greina, la plus sage, veillait sur ses soeurs sans faillire à sa tâche[/c] \n [c=blue] - Bluella, la plus téméraire, ouvrait la marche, portant un chapeau violet[/c] ").then("Maintenant, passons à la THEORIE !").then("Théorie numéro 1 : une boule de couleur a une position unique. Mais où ??? AHHH Je ne comprends pas....").then("Théorie numéro 2 : Si la théorie 1 est correcte, alors la solution du puzzle doit dépendre de ses boules et [g]EST UNIQUE[/g].").then("Et voilà c'est un peu tout ce que j'ai, je suis dans une sacrée impasse. Je vais sûrement rater le prix Nobel cette année...").then("Allez j'te laisse la boule, je suis passé à autre chose ! Tu me diras une prochaine fois si ça t'a été utile !").then("À la revoyure !").setOnEnding((function(){Oe.instance.addEntryToQuest(we.instance.getQuest("dreamland"),"Rosa a trouvée ces deux phrases :\n Bluella, la plus téméraire, ouvrait la marche, portant un chapeau violet\n Greina, la plus sage, veillait sur ses soeurs sans faillire à sa tâche")})).build(),e.cameraConfiguration=new j,e.cameraConfiguration.target=e.transformNode,e.cameraConfiguration.distanceFromTarget=40,e.cameraConfiguration.wantedAlpha=d.uMQ.FromDegrees(-120).radians(),e.cameraConfiguration.wantedBeta=d.uMQ.FromDegrees(50).radians(),[2,e]}))}))}}),Object.defineProperty(e,"createScribe",{enumerable:!1,configurable:!0,writable:!0,value:function(){return(0,c.sH)(this,void 0,Promise,(function(){var e;return(0,c.YH)(this,(function(t){return e=new J,e.name="Marcel",x.loadMesh("models/characters/scribe.glb").then((function(t){e.mesh=t.meshes[0],t.meshes.forEach((function(e){var t=e.material;if(t){var n=new Z;n.assignMaterial(e).then((function(){n.configureFromPBRMaterial(t)}))}}))})),e.detectionZone=new $({height:8,diameterTop:45,diameterBottom:45},!0),e.conversation=(new ne).say("Que penses-tu de mon prochain poème jeune étranger ?").then("[g]Ballade d’un Génie Naufragé[/g]").then("[i]Je suis ce grand Marcel, qu’aucun vent ne dérange\n, Poète illustre et fier, perdu sur cet étrange \n Territoire obscur, bordé par l’inconnu, \n Où des piliers sans fin soutiennent l’absolu.[/i]").then("[i]Je ne sais point comment j’ai pu atterrir ici,\n Mais l’endroit me salue d’un silence exquis.\n Tantôt le ciel s’emplit de choses voltigeantes, \n Tantôt le vide plane, en formes déchirantes.[/i]").then("[i]Sur le rivage nu, comme un don du destin, \n J’aperçus une orbe, d’un éclat si divin \n Que mon esprit, troublé par tant de magnificence,\n Faillit se noyer dans sa propre éloquence.[/i]").then("[i]Juste à côté dormait, message dans bouteille,\n Un parchemin d’échos, d’une main non pareille. \n Il était écrit, sans honte ni limite : \n [/i] [c=blue]« Pendant que le soleil était au zénith, Un nuage grisâtre s’approchait depuis l’ouest ».[/c] Ah ! Que cette phrase est d’un raffinement leste !").then("[i]Moi seul, Marcel, pouvais en saisir l’essence, \n Car mon verbe est plus fort que toute connaissance. [/i]").then("[i]Je retourne à présent vers la fontaine noire,\n Dont l’encre tachera les vers de ma mémoire.[/i]").then("Voila ! J'espère que ce ne fut pas un peu trop long. \n Maintenant file je dois me concentrer !").setOnEnding((function(){Oe.instance.addEntryToQuest(we.instance.getQuest("dreamland"),"Marcel nous indique dans son poeme interminable : \n Pendant que le soleil était au zénith, Un nuage grisâtre s’approchait depuis l’ouest")})).build(),e.cameraConfiguration=new j,e.cameraConfiguration.target=e.transformNode,e.cameraConfiguration.distanceFromTarget=10,e.cameraConfiguration.wantedAlpha=d.uMQ.FromDegrees(150).radians(),[2,e]}))}))}}),Object.defineProperty(e,"createRabbit",{enumerable:!1,configurable:!0,writable:!0,value:function(){return(0,c.sH)(this,void 0,Promise,(function(){var e;return(0,c.YH)(this,(function(t){return e=new J,e.name="Matthew",x.loadMesh("models/characters/lapin.glb").then((function(t){e.mesh=t.meshes[0],t.meshes.forEach((function(e){var t=e.material;if(t){var n=new Z;n.assignMaterial(e).then((function(){n.configureFromPBRMaterial(t)}))}}))})),e.detectionZone=new $({height:8,diameterTop:45,diameterBottom:45},!0),e.detectionZone.zone.position.set(0,-2,0),e.conversation=(new ne).say("[i][c=blue]Trois sœurs, Redina, Greina, Bluella, voyant le nuage s'approcher, se dirigeaient à l'opposée....[/i][/c]").then("Hmmmm... Qu'est-ce que ça peut vouloir dire....").then("[g][c=red]AAAAAAAAAAAAAAAAAAAAHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHH[/c][/g]").then("TU M'AS FAIS PEUR !!!!").then("TIENS PREND ÇA ! ET PARS LOIN D'ICI SANS REVENIR !!!!!!!!!!!!!!!!").setOnEnding((function(){Oe.instance.addEntryToQuest(we.instance.getQuest("dreamland"),"Marcel nous indique dans son poeme interminable : \n  - Trois sœurs, Redina, Greina, Bluella, voyant le nuage s'approcher, se dirigeaient à l'opposée...")})).build(),e.cameraConfiguration=new j,e.cameraConfiguration.target=e.transformNode,e.cameraConfiguration.distanceFromTarget=10,e.cameraConfiguration.wantedAlpha=d.uMQ.FromDegrees(-90).radians(),[2,e]}))}))}}),e}(),Ce=function(){function e(){Object.defineProperty(this,"_steleInteractionZone",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_conversation",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_startConversationInteraction",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_cameraConfiguration",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.steleInteractionZone=new Y({diameter:20},!0),this._cameraConfiguration=new j,this._cameraConfiguration.target=this._steleInteractionZone.zone,this._cameraConfiguration.distanceFromTarget=20,this._cameraConfiguration.wantedAlpha=d.uMQ.FromDegrees(-90).radians();var e=new ne;e.say("La ligne du haut regarde les cieux").then("La ligne du milieu respire l’air").then("La ligne du bas touche la terre").setOnEnding((function(){var e=we.instance.getQuest("temple_quest");e&&e.startQuest(),e=we.instance.getQuest("dreamland"),e&&e.updateCurrentStepStatus(),Oe.instance.addEntryToQuest(we.instance.getQuest("temple_quest"),"La stèle nous a donnés des informations sur les rangés : `\n - La ligne du haut regarde les cieux \n - La ligne du milieu respire l’air \n - La ligne du bas touche la terre")})),this.conversation=e.build(),this.conversation.conversationProvider=this}return Object.defineProperty(e.prototype,"steleInteractionZone",{get:function(){return this._steleInteractionZone},set:function(e){var t=this;this._steleInteractionZone=e,this._steleInteractionZone&&(this._steleInteractionZone.onMeshEnter.add((function(){t._startConversationInteraction&&t._startConversationInteraction.makeAvailable()})),this._steleInteractionZone.onMeshExit.add((function(){t._startConversationInteraction&&t._startConversationInteraction.makeUnavailable()})),G.instance.meshCreationPromise.then((function(e){var n;null===(n=t._steleInteractionZone)||void 0===n||n.addMeshToDetect(e)})))},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"conversation",{get:function(){return this._conversation},set:function(e){this._conversation=e,this._conversation&&(this._startConversationInteraction=new W(this._conversation))},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"mesh",{get:function(){return this._steleInteractionZone.zone},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"name",{get:function(){return"Stele"},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"cameraConfiguration",{get:function(){return this._cameraConfiguration},enumerable:!1,configurable:!0}),e}(),Te=function(){function e(){}return Object.defineProperty(e,"createDolphinIsland",{enumerable:!1,configurable:!0,writable:!0,value:function(){return(0,c.sH)(this,void 0,Promise,(function(){var e,t,n,r,i,a,o,l,s,u,b,f;return(0,c.YH)(this,(function(h){switch(h.label){case 0:return e=new d.VR0("island transform"),t=new K,t.name="Dolphin island",t.detectionZone=new Y({diameter:200},!0),[4,x.loadMesh("models/scenes/dolphinIsland.glb")];case 1:n=h.sent(),r=n.meshes[0],r.position=d.Pq0.Zero(),r.parent=e,i=r.getChildMeshes(),a=function(e){var t,n;return(0,c.YH)(this,(function(r){switch(r.label){case 0:return t=e.material,t?(n=new Z,[4,n.assignMaterial(e).then((function(){n.configureFromPBRMaterial(t)}))]):[3,2];case 1:r.sent(),r.label=2;case 2:return[2]}}))},o=0,l=n.meshes,h.label=2;case 2:return o<l.length?(s=l[o],[5,a(s)]):[3,5];case 3:h.sent(),h.label=4;case 4:return o++,[3,2];case 5:return u=d.eaF.MergeMeshes(i,!0,void 0,void 0,void 0,!0),u&&(u.parent=e,t.mesh=u,e.position=this._dolphinPosition,b=new d.aZl(u,d.AHY.STATIC,!1,Ie.scene),f=new d.JNI({type:d.DKo.MESH,parameters:{mesh:u}},Ie.scene),b.shape=f,b.disablePreStep=!1,Ie.scene.onBeforeRenderObservable.addOnce((function(){return b.disablePreStep=!0})),je.createPedro().then((function(n){n.transformNode.position=new d.Pq0(-30,15,-14),n.transformNode.parent=e,t.addConversationProvider(n)}))),[2,t]}}))}))}}),Object.defineProperty(e,"createTemple",{enumerable:!1,configurable:!0,writable:!0,value:function(){return(0,c.sH)(this,void 0,void 0,(function(){var e,t,n,r,i,a,o,l,s,u,b,f,h,p;return(0,c.YH)(this,(function(m){switch(m.label){case 0:return e=new d.VR0("temple transform"),t=new K,t.name="Temple",t.detectionZone=new Y({diameter:260},!0),[4,x.loadMesh("models/scenes/temple.glb")];case 1:n=m.sent(),r=n.meshes[0],r.position=d.Pq0.Zero(),r.parent=e,i=r.getChildMeshes(),a=function(e){var t,n;return(0,c.YH)(this,(function(r){switch(r.label){case 0:return t=e.material,t?(n=new Z,[4,n.assignMaterial(e).then((function(){n.configureFromPBRMaterial(t)}))]):[3,2];case 1:r.sent(),n.emissionColor=d.v9j.FromHexString("#4bf49f"),r.label=2;case 2:return[2]}}))},o=0,l=n.meshes,m.label=2;case 2:return o<l.length?(s=l[o],[5,a(s)]):[3,5];case 3:m.sent(),m.label=4;case 4:return o++,[3,2];case 5:return u=d.eaF.MergeMeshes(i,!0,void 0,void 0,void 0,!0),u&&(u.parent=e,t.mesh=u,e.position=this._templePosition,e.rotate(d.Pq0.Up(),d.uMQ.FromDegrees(180).radians(),d.$xS.WORLD),b=new d.aZl(u,d.AHY.STATIC,!1,Ie.scene),f=new d.JNI({type:d.DKo.MESH,parameters:{mesh:u}},Ie.scene),b.shape=f,b.disablePreStep=!1,Ie.scene.onBeforeRenderObservable.addOnce((function(){return b.disablePreStep=!0}))),h=new Ce,p=h.steleInteractionZone,p.zone.parent=e,p.zone.position=new d.Pq0(0,0,50),t.addConversationProvider(h),new _e(e,new d.Pq0(0,0,0)),[2]}}))}))}}),Object.defineProperty(e,"createStaticPhysicsAggregate",{enumerable:!1,configurable:!0,writable:!0,value:function(e,t){var n=new d.Lfv(e,t,{mass:0},Ie.scene);return n}}),Object.defineProperty(e,"createBanquise",{enumerable:!1,configurable:!0,writable:!0,value:function(){return(0,c.sH)(this,void 0,void 0,(function(){var e,t,n,r,i,a,o,l,s,u,b,f,h,p;return(0,c.YH)(this,(function(c){switch(c.label){case 0:return e=new d.VR0("banquise transform"),t=new K,t.name="Fractisberg",t.detectionZone=new Y({diameter:200},!0),[4,x.loadMesh("models/scenes/banquise.glb")];case 1:for(n=c.sent(),r=n.meshes[0],r.position=d.Pq0.Zero(),r.parent=e,i=r.getChildMeshes(),a=0,o=n.meshes;a<o.length;a++)l=o[a],s=l.material,u=l.material,s?(b=new se.G("banquiseMat"),b.needDepthPrePass=!0,b.diffuseColor=s.albedoColor,s.albedoTexture&&(b.diffuseTexture=s.albedoTexture),l.material=b,b.cullBackFaces=!1):u&&(b=new se.G("banquiseMat"),b.needDepthPrePass=!0,b.diffuseColor=u.diffuseColor,u.diffuseTexture&&(b.diffuseTexture=u.diffuseTexture),l.material=b,b.cullBackFaces=!1);return f=d.eaF.MergeMeshes(i,!0,void 0,void 0,void 0,!0),f&&(f.parent=e,t.mesh=f,e.position=this._banquisePosition,e.rotate(d.Pq0.Up(),d.uMQ.FromDegrees(-90).radians(),d.$xS.WORLD),h=new d.aZl(f,d.AHY.STATIC,!1,Ie.scene),p=new d.JNI({type:d.DKo.MESH,parameters:{mesh:f}},Ie.scene),h.shape=p,h.disablePreStep=!1,Ie.scene.onBeforeRenderObservable.addOnce((function(){return h.disablePreStep=!0})),je.createFox().then((function(n){var r;n.transformNode.position=new d.Pq0(-8,1.4,0),n.transformNode.parent=e;var i=new be(n.transformNode.absolutePosition.add(new d.Pq0(0,20,0)),d.v9j.Green()),a=null===(r=n.conversation)||void 0===r?void 0:r.onConversationEnd.add((function(){var e;G.instance.templeBall||(G.instance.grabBall(i),null===(e=n.conversation)||void 0===e||e.onConversationEnd.remove(null!==a&&void 0!==a?a:null))}));t.addConversationProvider(n)}))),[2]}}))}))}}),Object.defineProperty(e,"createArchipel",{enumerable:!1,configurable:!0,writable:!0,value:function(){return(0,c.sH)(this,void 0,void 0,(function(){var e,t,n,r,i,a,o,l,s,u,b,f,h,p;return(0,c.YH)(this,(function(c){switch(c.label){case 0:return e=new d.VR0("archipel transform"),t=new K,t.name="L'Archipel Carotte",t.detectionZone=new Y({diameter:200},!0),[4,x.loadMesh("models/scenes/archipel.glb")];case 1:for(n=c.sent(),r=n.meshes[0],r.position=d.Pq0.Zero(),r.parent=e,i=r.getChildMeshes(),a=0,o=n.meshes;a<o.length;a++)l=o[a],s=l.material,u=l.material,s?(b=new se.G("archipelMat"),b.needDepthPrePass=!0,b.diffuseColor=s.albedoColor,s.albedoTexture&&(b.diffuseTexture=s.albedoTexture),l.material=b):u&&(b=new se.G("archipelMat"),b.needDepthPrePass=!0,b.diffuseColor=u.diffuseColor,u.diffuseTexture&&(b.diffuseTexture=u.diffuseTexture),l.material=b);return f=d.eaF.MergeMeshes(i,!0,void 0,void 0,void 0,!0),f&&(f.parent=e,t.mesh=f,e.position=this._archipelPosition,e.rotate(d.Pq0.Up(),d.uMQ.FromDegrees(-90).radians(),d.$xS.WORLD),h=new d.aZl(f,d.AHY.STATIC,!1,Ie.scene),p=new d.JNI({type:d.DKo.MESH,parameters:{mesh:f}},Ie.scene),h.shape=p,h.disablePreStep=!1,Ie.scene.onBeforeRenderObservable.addOnce((function(){return h.disablePreStep=!0})),je.createRabbit().then((function(n){var r;n.transformNode.position=new d.Pq0(-.8,5.2,-.7),n.transformNode.parent=e;var i=new be(n.transformNode.absolutePosition.add(new d.Pq0(0,20,0)),d.v9j.Red()),a=null===(r=n.conversation)||void 0===r?void 0:r.onConversationEnd.add((function(){var e;G.instance.templeBall||(G.instance.grabBall(i),null===(e=n.conversation)||void 0===e||e.onConversationEnd.remove(null!==a&&void 0!==a?a:null))}));t.addConversationProvider(n)}))),[2]}}))}))}}),Object.defineProperty(e,"createPoulpe",{enumerable:!1,configurable:!0,writable:!0,value:function(){return(0,c.sH)(this,void 0,void 0,(function(){var e,t,n,r,i,a,o,l,s,u,b,f,h,p;return(0,c.YH)(this,(function(c){switch(c.label){case 0:return e=new d.VR0("poulpe transform"),t=new K,t.name="Le Poulpensant",t.detectionZone=new Y({diameter:200},!0),[4,x.loadMesh("models/scenes/poulpe.glb")];case 1:for(n=c.sent(),r=n.meshes[0],r.position=d.Pq0.Zero(),r.parent=e,i=r.getChildMeshes(),a=0,o=n.meshes;a<o.length;a++)l=o[a],s=l.material,u=l.material,s?(b=new se.G("poulpeMat"),b.needDepthPrePass=!0,b.diffuseColor=s.albedoColor,s.albedoTexture&&(b.diffuseTexture=s.albedoTexture),l.material=b):u&&(b=new se.G("poulpeMat"),b.needDepthPrePass=!0,b.diffuseColor=u.diffuseColor,u.diffuseTexture&&(b.diffuseTexture=u.diffuseTexture),l.material=b);return f=d.eaF.MergeMeshes(i,!0,void 0,void 0,void 0,!0),f&&(f.parent=e,t.mesh=f,e.position=this._poulpePosition,h=new d.aZl(f,d.AHY.STATIC,!1,Ie.scene),p=new d.JNI({type:d.DKo.MESH,parameters:{mesh:f}},Ie.scene),h.shape=p,h.disablePreStep=!1,Ie.scene.onBeforeRenderObservable.addOnce((function(){return h.disablePreStep=!0})),je.createScribe().then((function(n){var r;n.transformNode.position=new d.Pq0(-1.57,.8,5.8),n.transformNode.parent=e;var i=new be(n.transformNode.absolutePosition.add(new d.Pq0(0,20,0)),d.v9j.Purple()),a=null===(r=n.conversation)||void 0===r?void 0:r.onConversationEnd.add((function(){var e;G.instance.templeBall||(G.instance.grabBall(i),null===(e=n.conversation)||void 0===e||e.onConversationEnd.remove(null!==a&&void 0!==a?a:null))}));t.addConversationProvider(n)}))),[2]}}))}))}}),Object.defineProperty(e,"createPhare",{enumerable:!1,configurable:!0,writable:!0,value:function(){return(0,c.sH)(this,void 0,void 0,(function(){var e,t,n,r,i,a,o,l,s,u,b,f,h,p;return(0,c.YH)(this,(function(c){switch(c.label){case 0:return e=new d.VR0("phare transform"),t=new K,t.name="Le Phare Flashouille",t.detectionZone=new Y({diameter:200},!0),[4,x.loadMesh("models/scenes/phare.glb")];case 1:for(n=c.sent(),r=n.meshes[0],r.position=d.Pq0.Zero(),r.parent=e,i=r.getChildMeshes(),a=0,o=n.meshes;a<o.length;a++)l=o[a],s=l.material,u=l.material,s?(b=new se.G("phareMat"),b.needDepthPrePass=!0,b.diffuseColor=s.albedoColor,s.albedoTexture&&(b.diffuseTexture=s.albedoTexture),l.material=b):u&&(b=new se.G("phareMat"),b.needDepthPrePass=!0,b.diffuseColor=u.diffuseColor,u.diffuseTexture&&(b.diffuseTexture=u.diffuseTexture),l.material=b);return f=d.eaF.MergeMeshes(i,!0,void 0,void 0,void 0,!0),f&&(f.parent=e,t.mesh=f,e.position=this._pharePosition,h=new d.aZl(f,d.AHY.STATIC,!1,Ie.scene),p=new d.JNI({type:d.DKo.MESH,parameters:{mesh:f}},Ie.scene),h.shape=p,h.disablePreStep=!1,Ie.scene.onBeforeRenderObservable.addOnce((function(){return h.disablePreStep=!0})),je.createGirl().then((function(n){var r;n.transformNode.position=new d.Pq0(1.2,1.26,-16.9),n.transformNode.parent=e;var i=new be(n.transformNode.absolutePosition.add(new d.Pq0(-30,20,-30)),d.v9j.Blue()),a=null===(r=n.conversation)||void 0===r?void 0:r.onConversationEnd.add((function(){var e;G.instance.templeBall||(G.instance.grabBall(i),null===(e=n.conversation)||void 0===e||e.onConversationEnd.remove(null!==a&&void 0!==a?a:null))}));t.addConversationProvider(n)}))),[2]}}))}))}}),Object.defineProperty(e,"_dolphinPosition",{enumerable:!0,configurable:!0,writable:!0,value:new d.Pq0(0,0,160)}),Object.defineProperty(e,"_templePosition",{enumerable:!0,configurable:!0,writable:!0,value:new d.Pq0(0,0,500)}),Object.defineProperty(e,"_banquisePosition",{enumerable:!0,configurable:!0,writable:!0,value:new d.Pq0(-200,0,680)}),Object.defineProperty(e,"_archipelPosition",{enumerable:!0,configurable:!0,writable:!0,value:new d.Pq0(200,0,680)}),Object.defineProperty(e,"_pharePosition",{enumerable:!0,configurable:!0,writable:!0,value:new d.Pq0(-250,0,420)}),Object.defineProperty(e,"_poulpePosition",{enumerable:!0,configurable:!0,writable:!0,value:new d.Pq0(250,0,420)}),e}(),Me=function(){function e(){Object.defineProperty(this,"_sky",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_sea",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_submarine",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),e._instance=this,this._sea=new P,this._submarine=new G,this._sky=new y;var t=new d.VA("",Ie.scene);t.intensity=.3}return Object.defineProperty(e.prototype,"submarine",{get:function(){return this._submarine},enumerable:!1,configurable:!0}),Object.defineProperty(e,"submarine",{get:function(){return this.instance.submarine},enumerable:!1,configurable:!0}),Object.defineProperty(e,"instance",{get:function(){return this._instance},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"init",{enumerable:!1,configurable:!0,writable:!0,value:function(){return(0,c.sH)(this,void 0,Promise,(function(){return(0,c.YH)(this,(function(e){switch(e.label){case 0:return[4,Promise.all([Te.createDolphinIsland(),Te.createTemple(),Te.createBanquise(),Te.createPhare(),Te.createPoulpe(),Te.createArchipel()])];case 1:return e.sent(),[2]}}))}))}}),e}(),Ie=function(){function e(t,n){var r=this;Object.defineProperty(this,"_canvas",{enumerable:!0,configurable:!0,writable:!0,value:t}),Object.defineProperty(this,"_havok",{enumerable:!0,configurable:!0,writable:!0,value:n}),Object.defineProperty(this,"_scene",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_engine",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_world",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_player",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_isGameFocused",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"_camera",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_interactionManager",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_uiManager",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_soundManager",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_questManager",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),e._instance=this,this._engine=new d.N$8(this._canvas),this._scene=new d.Z58(this._engine),this._scene.enablePhysics(new d.Pq0(0,-9.81,0),n),this._interactionManager=new C,this._camera=new O,this._world=new Me,document.addEventListener("pointerlockchange",(function(){r.updateFocusState(document.pointerLockElement===t)})),this._engine.runRenderLoop((function(){r._scene.render()})),window.addEventListener("resize",(function(){return r._engine.resize()}))}return Object.defineProperty(e,"canvas",{get:function(){return this._instance._canvas},enumerable:!1,configurable:!0}),Object.defineProperty(e,"engine",{get:function(){return e._instance._engine},enumerable:!1,configurable:!0}),Object.defineProperty(e,"scene",{get:function(){return e._instance._scene},enumerable:!1,configurable:!0}),Object.defineProperty(e,"uiManager",{get:function(){return e._instance._uiManager},enumerable:!1,configurable:!0}),Object.defineProperty(e,"isGameFocused",{get:function(){return e._instance._isGameFocused},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"init",{enumerable:!1,configurable:!0,writable:!0,value:function(){return(0,c.sH)(this,void 0,Promise,(function(){return(0,c.YH)(this,(function(e){switch(e.label){case 0:return[4,this._world.init()];case 1:return e.sent(),this._player=new z,this._soundManager=new k,this._uiManager=new ve(this._canvas),this._questManager=new we,[2]}}))}))}}),Object.defineProperty(e.prototype,"updateFocusState",{enumerable:!1,configurable:!0,writable:!0,value:function(t){t!=this._isGameFocused&&(this._isGameFocused=t,e.onGameFocusChange.notifyObservers(this._isGameFocused),this._isGameFocused||e.uiManager.showMainMenu())}}),Object.defineProperty(e,"onGameFocusChange",{enumerable:!0,configurable:!0,writable:!0,value:new d.cPK}),e}(),Ee=n(61823),xe=(0,i.pM)({name:"YellowSubmarine",setup:function(){var e=(0,b.KR)(!0),t=(0,b.KR)(!1),n="Chargement...".split(""),r=function(){return"/YellowSubmarine/logo.png"};return{isLoading:e,isFadingOut:t,loadingText:n,getLogoSrc:r}},mounted:function(){return(0,c.sH)(this,void 0,void 0,(function(){var e,t,n,r,i=this;return(0,c.YH)(this,(function(a){switch(a.label){case 0:return e=document.getElementById("mainCanvas"),d.Mjc.ShadersRepository="/YellowSubmarine/shaders/",d.N$8.ShadersRepository="/YellowSubmarine/shaders/",[4,(0,Ee.A)()];case 1:return t=a.sent(),n=new d.P3(!0,t),r=new Ie(e,n),[4,r.init()];case 2:return a.sent(),setTimeout((function(){i.isFadingOut=!0,setTimeout((function(){i.isLoading=!1}),1e3)}),500),[2]}}))}))}}),Ae=n(66262);const Ne=(0,Ae.A)(xe,[["render",u],["__scopeId","data-v-121896b8"]]);var Se=Ne,Be=(0,i.pM)({name:"App",components:{YellowSubmarine:Se}});const Le=(0,Ae.A)(Be,[["render",a]]);var Re=Le;(0,r.Ef)(Re).mount("#app")}},t={};function n(r){var i=t[r];if(void 0!==i)return i.exports;var a=t[r]={exports:{}};return e[r](a,a.exports,n),a.exports}n.m=e,function(){var e=[];n.O=function(t,r,i,a){if(!r){var o=1/0;for(c=0;c<e.length;c++){r=e[c][0],i=e[c][1],a=e[c][2];for(var l=!0,s=0;s<r.length;s++)(!1&a||o>=a)&&Object.keys(n.O).every((function(e){return n.O[e](r[s])}))?r.splice(s--,1):(l=!1,a<o&&(o=a));if(l){e.splice(c--,1);var u=i();void 0!==u&&(t=u)}}return t}a=a||0;for(var c=e.length;c>0&&e[c-1][2]>a;c--)e[c]=e[c-1];e[c]=[r,i,a]}}(),function(){n.d=function(e,t){for(var r in t)n.o(t,r)&&!n.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})}}(),function(){n.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}()}(),function(){n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)}}(),function(){n.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}}(),function(){n.p="/YellowSubmarine/"}(),function(){n.b=document.baseURI||self.location.href;var e={524:0};n.O.j=function(t){return 0===e[t]};var t=function(t,r){var i,a,o=r[0],l=r[1],s=r[2],u=0;if(o.some((function(t){return 0!==e[t]}))){for(i in l)n.o(l,i)&&(n.m[i]=l[i]);if(s)var c=s(n)}for(t&&t(r);u<o.length;u++)a=o[u],n.o(e,a)&&e[a]&&e[a][0](),e[a]=0;return n.O(c)},r=self["webpackChunkyellow_submarine"]=self["webpackChunkyellow_submarine"]||[];r.forEach(t.bind(null,0)),r.push=t.bind(null,r.push.bind(r))}();var r=n.O(void 0,[504],(function(){return n(99774)}));r=n.O(r)})();
//# sourceMappingURL=app.7faf6013.js.map