{"version":3,"file":"js/app.bd67c322.js","mappings":"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","sources":["webpack://yellow_submarine/./src/App.vue?c4b5","webpack://yellow_submarine/./src/App.vue","webpack://yellow_submarine/./src/components/YellowSubmarine.vue?3caf","webpack://yellow_submarine/./src/components/YellowSubmarine.vue","webpack://yellow_submarine/./src/YellowSubmarine/sky system/CelestialBody.ts","webpack://yellow_submarine/./src/YellowSubmarine/sky system/HemisphericCelestialBody.ts","webpack://yellow_submarine/./src/YellowSubmarine/sky system/Sun.ts","webpack://yellow_submarine/./src/YellowSubmarine/sky system/Moon.ts","webpack://yellow_submarine/./src/YellowSubmarine/sky system/SkyBox.ts","webpack://yellow_submarine/./src/YellowSubmarine/sky system/DayNightCycle.ts","webpack://yellow_submarine/./src/YellowSubmarine/sky system/Sky.ts","webpack://yellow_submarine/./src/YellowSubmarine/shader material/ReflectiveToonWaterMaterial.ts","webpack://yellow_submarine/./src/YellowSubmarine/Sea.ts","webpack://yellow_submarine/./src/YellowSubmarine/camera system/ConfigurableCamera.ts","webpack://yellow_submarine/./src/YellowSubmarine/camera system/CameraConfiguration.ts","webpack://yellow_submarine/./src/YellowSubmarine/interaction system/InteractionManager.ts","webpack://yellow_submarine/./src/YellowSubmarine/interaction system/interactions/AbstractInteraction.ts","webpack://yellow_submarine/./src/YellowSubmarine/interaction system/interactions/DialogueInteraction.ts","webpack://yellow_submarine/./src/YellowSubmarine/ui system/UI.ts","webpack://yellow_submarine/./src/YellowSubmarine/Utils.ts","webpack://yellow_submarine/./src/YellowSubmarine/ui system/BBCode/BBTag.ts","webpack://yellow_submarine/./src/YellowSubmarine/ui system/BBCode/Tags/ItalicTag.ts","webpack://yellow_submarine/./src/YellowSubmarine/ui system/BBCode/Tags/BoldTag.ts","webpack://yellow_submarine/./src/YellowSubmarine/ui system/BBCode/Tags/ColorTag.ts","webpack://yellow_submarine/./src/YellowSubmarine/ui system/BBCode/Tags/SizeTag.ts","webpack://yellow_submarine/./src/YellowSubmarine/ui system/BBCode/BBParser.ts","webpack://yellow_submarine/./src/YellowSubmarine/ui system/TextLayoutManager.ts","webpack://yellow_submarine/./src/YellowSubmarine/ui system/TextAnimator.ts","webpack://yellow_submarine/./src/YellowSubmarine/interaction system/ui/DialogueInteractionUI.ts","webpack://yellow_submarine/./src/YellowSubmarine/dialogue system/interactions/NextDialogueInteraction.ts","webpack://yellow_submarine/./src/YellowSubmarine/dialogue system/Conversation.ts","webpack://yellow_submarine/./src/YellowSubmarine/Player.ts","webpack://yellow_submarine/./src/YellowSubmarine/shader material/CartoonShaderMaterial.ts","webpack://yellow_submarine/./src/YellowSubmarine/grappling system/Grappler.ts","webpack://yellow_submarine/./src/YellowSubmarine/sound system/SoundManager.ts","webpack://yellow_submarine/./src/YellowSubmarine/Submarine.ts","webpack://yellow_submarine/./src/YellowSubmarine/keyzone system/KeyZone.ts","webpack://yellow_submarine/./src/YellowSubmarine/detection system/MeshDetectionZone.ts","webpack://yellow_submarine/./src/YellowSubmarine/detection system/SphericalDetectionZone.ts","webpack://yellow_submarine/./src/YellowSubmarine/interaction system/interactions/WorldInteraction.ts","webpack://yellow_submarine/./src/YellowSubmarine/dialogue system/interactions/StartConversationInteraction.ts","webpack://yellow_submarine/./src/YellowSubmarine/npcs/NPC.ts","webpack://yellow_submarine/./src/YellowSubmarine/detection system/CylindricalDetectionZone.ts","webpack://yellow_submarine/./src/YellowSubmarine/dialogue system/nodes/AbstractDialogueNode.ts","webpack://yellow_submarine/./src/YellowSubmarine/dialogue system/nodes/SimpleDialogueNode.ts","webpack://yellow_submarine/./src/YellowSubmarine/dialogue system/ConversationBuilder.ts","webpack://yellow_submarine/./src/YellowSubmarine/quest system/Quest.ts","webpack://yellow_submarine/./src/YellowSubmarine/quest system/QuestStep.ts","webpack://yellow_submarine/./src/YellowSubmarine/temple/interaction/RemoveTempleBallInteraction.ts","webpack://yellow_submarine/./src/YellowSubmarine/temple/interaction/PlaceTempleBallInteraction.ts","webpack://yellow_submarine/./src/YellowSubmarine/temple/Socle.ts","webpack://yellow_submarine/./src/YellowSubmarine/grappling system/interaction/GrappleInteraction.ts","webpack://yellow_submarine/./src/YellowSubmarine/temple/TempleBall.ts","webpack://yellow_submarine/./src/YellowSubmarine/temple/TemplePuzzle.ts","webpack://yellow_submarine/./src/YellowSubmarine/quest system/QuestFactory.ts","webpack://yellow_submarine/./src/YellowSubmarine/quest system/QuestManager.ts","webpack://yellow_submarine/./src/YellowSubmarine/quest system/ui/JournalUI.ts","webpack://yellow_submarine/./src/YellowSubmarine/npcs/NPCFactory.ts","webpack://yellow_submarine/./src/YellowSubmarine/temple/Stele.ts","webpack://yellow_submarine/./src/YellowSubmarine/keyzone system/KeyZoneFactory.ts","webpack://yellow_submarine/./src/YellowSubmarine/World.ts","webpack://yellow_submarine/./src/YellowSubmarine/interaction system/ui/WorldInteractionUI.ts","webpack://yellow_submarine/./src/YellowSubmarine/interaction system/ui/IslandsUI.ts","webpack://yellow_submarine/./src/YellowSubmarine/ui system/OptionsMenuUI.ts","webpack://yellow_submarine/./src/YellowSubmarine/ui system/MainMenuUI.ts","webpack://yellow_submarine/./src/YellowSubmarine/quest system/ui/QuestUI.ts","webpack://yellow_submarine/./src/YellowSubmarine/ui system/UIManager.ts","webpack://yellow_submarine/./src/YellowSubmarine/Game.ts","webpack://yellow_submarine/./src/components/YellowSubmarine.vue?d24b","webpack://yellow_submarine/./src/App.vue?7ccd","webpack://yellow_submarine/./src/main.ts","webpack://yellow_submarine/webpack/bootstrap","webpack://yellow_submarine/webpack/runtime/chunk loaded","webpack://yellow_submarine/webpack/runtime/define property getters","webpack://yellow_submarine/webpack/runtime/global","webpack://yellow_submarine/webpack/runtime/hasOwnProperty shorthand","webpack://yellow_submarine/webpack/runtime/make namespace object","webpack://yellow_submarine/webpack/runtime/publicPath","webpack://yellow_submarine/webpack/runtime/jsonp chunk loading","webpack://yellow_submarine/webpack/startup"],"sourcesContent":["import { resolveComponent as _resolveComponent, openBlock as _openBlock, createBlock as _createBlock } from \"vue\"\n\nexport function render(_ctx: any,_cache: any,$props: any,$setup: any,$data: any,$options: any) {\n  const _component_YellowSubmarine = _resolveComponent(\"YellowSubmarine\")!\n\n  return (_openBlock(), _createBlock(_component_YellowSubmarine))\n}","<template>\n  <YellowSubmarine/>\n</template>\n\n<script lang=\"ts\">\nimport { defineComponent } from 'vue';\nimport YellowSubmarine from './components/YellowSubmarine.vue';\n\nexport default defineComponent({\n  name: 'App',\n  components: {\n    YellowSubmarine\n  }\n});\n</script>\n\n<style>\nhtml, body, #app {\n  margin: 0;\n  padding: 0;\n  height: 100%;\n  width: 100%;\n  overflow: hidden;\n}\n</style>\n","import { createElementVNode as _createElementVNode, openBlock as _openBlock, createElementBlock as _createElementBlock } from \"vue\"\n\nexport function render(_ctx: any,_cache: any,$props: any,$setup: any,$data: any,$options: any) {\n  return (_openBlock(), _createElementBlock(\"div\", null, _cache[0] || (_cache[0] = [\n    _createElementVNode(\"canvas\", { id: \"mainCanvas\" }, null, -1)\n  ])))\n}","<template>\r\n  <div>\r\n    <canvas id=\"mainCanvas\"></canvas>\r\n</div>\r\n</template>\r\n\r\n<script lang=\"ts\">\r\nimport { defineComponent } from 'vue';\r\nimport {Game} from \"@/YellowSubmarine/Game\";\r\nimport {Engine, HavokPlugin} from \"@babylonjs/core\";\r\nimport HavokPhysics from \"@babylonjs/havok\";\r\nimport {Debug} from \"@babylonjs/core/Legacy/legacy\";\r\n\r\nexport default defineComponent({\r\n  name: 'YellowSubmarine',\r\n  props: {\r\n    msg: String,\r\n  },\r\n  async mounted() {\r\n      const canvas = document.getElementById(\"mainCanvas\") as HTMLCanvasElement;\r\n      Engine.ShadersRepository = \"../shaders/\";\r\n      await HavokPhysics().then((havok) => {\r\n        const havokPlugin = new HavokPlugin(true, havok);\r\n        const game = new Game(canvas, havokPlugin);\r\n\r\n/*        setTimeout(() => {\r\n          const physicsViewer = new Debug.PhysicsViewer();\r\n          for (const mesh of Game.scene.meshes) {\r\n            if (mesh.physicsBody) {\r\n              physicsViewer.showBody(mesh.physicsBody);\r\n            }\r\n          }\r\n        }, 3000);*/\r\n\r\n      })\r\n\r\n\r\n\r\n\r\n  },\r\n});\r\n</script>\r\n\r\n<!-- Add \"scoped\" attribute to limit CSS to this component only -->\r\n\r\n<style scoped>\r\ncanvas {\r\n  position: absolute;\r\n  top: 0;\r\n  left: 0;\r\n  width: 100vw;\r\n  height: 100vh;\r\n  display: block;\r\n}\r\n</style>\r\n\r\n","import {\r\n    Color3,\r\n    DirectionalLight,\r\n    GlowLayer,\r\n    Mesh,\r\n    MeshBuilder,\r\n    Scene,\r\n    StandardMaterial,\r\n    Vector3\r\n} from \"@babylonjs/core\";\r\nimport {Game} from \"@/YellowSubmarine/Game\";\r\n\r\nexport abstract class CelestialBody {\r\n\r\n    protected _bodyMesh : Mesh\r\n    protected _haloMesh : Mesh\r\n    private _light : DirectionalLight\r\n\r\n    // Physics Characteristic\r\n    public get _defaultPosition(): Vector3{\r\n        return new Vector3(1000, 200, -1000);\r\n    }\r\n\r\n    public get _diameter(): number {\r\n        return 40;\r\n    }\r\n\r\n    // Light Characteristic\r\n    public get _intensity(): number {\r\n        return 1.0;\r\n    }\r\n    public get _diffuse(): Color3 {\r\n        return new Color3(1.0, 1.0, 1.0);\r\n    }\r\n    public get _specular(): Color3 {\r\n        return new Color3(1.0, 1.0, 1.0);\r\n    }\r\n    public get _emissiveColor(): Color3 {\r\n        return new Color3(1.0, 1.0, 1.0);\r\n    }\r\n\r\n    constructor(){\r\n        this._bodyMesh = this.createBody(Game.scene);\r\n        this._haloMesh = this.createHalo(Game.scene);\r\n        this._light = this.createLight(Game.scene);\r\n        this.configMaterials(Game.scene);\r\n    }\r\n\r\n    private createBody(scene: Scene) : Mesh{\r\n        const body = MeshBuilder.CreateSphere(\"celestialBody\", {\r\n            diameter: this._diameter,\r\n            segments: 32\r\n        }, scene);\r\n        body.infiniteDistance = true;\r\n        body.isPickable = false;\r\n        body.position = this._defaultPosition;\r\n        return body;\r\n    }\r\n\r\n    private createHalo(scene: Scene) : Mesh{\r\n        const halo = MeshBuilder.CreateSphere(\"halo\", {\r\n            diameter: this._diameter * 1.05,\r\n            segments: 32\r\n        }, scene);\r\n        halo.infiniteDistance = true;\r\n        halo.isPickable = false;\r\n        halo.position = this._defaultPosition;\r\n        return halo;\r\n    }\r\n\r\n    private createLight(scene: Scene) : DirectionalLight{\r\n        let direction = new Vector3(0, 0, 0);\r\n        if (scene.activeCamera) {\r\n            direction = this._bodyMesh.position.subtract(scene.activeCamera.position).normalize();\r\n        }\r\n        const light = new DirectionalLight(\"sunLight\", direction.negate(), scene);\r\n        light.intensity = this._intensity;\r\n        light.shadowEnabled = true;\r\n        light.parent = this._bodyMesh;\r\n        light.diffuse = this._diffuse;\r\n        light.specular = this._specular;\r\n        const glowLayer = new GlowLayer(\"\", scene);\r\n        glowLayer.intensity = 0.3;\r\n        return light;\r\n    }\r\n\r\n    protected configMaterials(scene: Scene){\r\n        const bodyMaterial = new StandardMaterial(\"bodyMat\", scene);\r\n        bodyMaterial.emissiveColor = this._emissiveColor;\r\n        bodyMaterial.diffuseColor = this._diffuse;\r\n        bodyMaterial.specularColor = this._specular;\r\n        this._bodyMesh.material = bodyMaterial;\r\n\r\n        const haloMaterial = new StandardMaterial(\"haloMat\", scene);\r\n        haloMaterial.emissiveColor = this._emissiveColor;\r\n        haloMaterial.diffuseColor = this._diffuse;\r\n        haloMaterial.specularColor = this._specular;\r\n        haloMaterial.alpha = 0.5;\r\n        this._haloMesh.material = haloMaterial;\r\n    }\r\n\r\n    public get bodyMesh(): Mesh {\r\n        return this._bodyMesh;\r\n    }\r\n\r\n    public get haloMesh(): Mesh {\r\n        return this._haloMesh;\r\n    }\r\n\r\n    public get light(): DirectionalLight {\r\n        return this._light;\r\n    }\r\n\r\n    public get position(): Vector3 {\r\n        return this.bodyMesh.position;\r\n    }\r\n\r\n    public set position(position: Vector3){\r\n        this._bodyMesh.position = position;\r\n        this._haloMesh.position = position;\r\n        this.light.position = position;\r\n    }\r\n}","import {CelestialBody} from \"@/YellowSubmarine/sky system/CelestialBody\";\r\nimport {Color3, HemisphericLight, Scene, ShadowGenerator, Vector3} from \"@babylonjs/core\";\r\nimport {Game} from \"@/YellowSubmarine/Game\";\r\n\r\nexport abstract class HemisphericCelestialBody extends CelestialBody{\r\n\r\n    private _hemiLight : HemisphericLight\r\n    private shadowGenerator: ShadowGenerator;\r\n\r\n    public get hemiLight(){\r\n        return this._hemiLight;\r\n    }\r\n\r\n    public get hemiLightIntensity(){\r\n        return this._hemiLight.intensity;\r\n    }\r\n\r\n    public get _emissiveColor(): Color3 {\r\n        return new Color3(1.0, 1.0, 1.0);\r\n    }\r\n\r\n    public getPosition(){\r\n        return this._bodyMesh.position;\r\n    }\r\n\r\n    public get _direction(): Vector3{\r\n        if(Game.scene.activeCamera){\r\n            this.light.direction = this._bodyMesh.absolutePosition.subtract(Vector3.Zero()).normalize();\r\n            this._hemiLight.direction = this._bodyMesh.position.subtract(Game.scene.activeCamera.position).normalize();\r\n        }\r\n        return this.light.direction;\r\n    }\r\n\r\n    constructor() {\r\n        super();\r\n        this._hemiLight = this.createHemiLight(Game.scene);\r\n        this.configMaterials(Game.scene);\r\n        this._hemiLight.direction = Vector3.Up();\r\n        this._hemiLight.isEnabled(false);\r\n        this.shadowGenerator = new ShadowGenerator(1024, this.light);\r\n        this.shadowGenerator.useBlurExponentialShadowMap = true;\r\n        this.shadowGenerator.blurKernel = 16;\r\n        this.light.shadowEnabled = true;\r\n        Game.scene.onBeforeRenderObservable.add(() => {\r\n            if (Game.scene.activeCamera) {\r\n                const dir = this._bodyMesh.absolutePosition.subtract(Vector3.Zero()).normalize();\r\n                this.light.direction = dir.negate();\r\n            }\r\n        });\r\n    }\r\n\r\n    private createHemiLight(scene: Scene) : HemisphericLight{\r\n        const light = new HemisphericLight(\"hemisphericLight\", Vector3.Up(), scene);\r\n        light.intensity = 2;\r\n        light.diffuse = this._diffuse;\r\n        light.shadowEnabled = false;\r\n        light.parent = this._bodyMesh;\r\n        return light;\r\n    }\r\n\r\n}","import {\r\n    Color3,\r\n    Vector3\r\n} from \"@babylonjs/core\";\r\nimport {HemisphericCelestialBody} from \"@/YellowSubmarine/sky system/HemisphericCelestialBody\";\r\n\r\nexport class Sun extends HemisphericCelestialBody {\r\n\r\n    // Physics Characteristic\r\n    public override get _defaultPosition(): Vector3{\r\n        return new Vector3(1000, 200, -1000);\r\n    }\r\n    public override get _diameter(): number {\r\n        return 40;\r\n    }\r\n\r\n    // Light Characteristic\r\n    public override get _intensity(): number {\r\n        return 5;\r\n    }\r\n    public override get hemiLightIntensity(){\r\n        return 2;\r\n    }\r\n    public override get _diffuse(): Color3 {\r\n        return new Color3(1.0, 1.0, 1.0);\r\n    }\r\n    public override get _specular(): Color3 {\r\n        return new Color3(1.0, 1.0, 1.0);\r\n    }\r\n    public override get _emissiveColor(): Color3 {\r\n        return new Color3(1.0, 1.0, 1.0);\r\n    }\r\n\r\n    constructor() {\r\n        super();\r\n    }\r\n}","import {\r\n    Color3,\r\n    Vector3\r\n} from \"@babylonjs/core\";\r\nimport {HemisphericCelestialBody} from \"@/YellowSubmarine/sky system/HemisphericCelestialBody\";\r\n\r\nexport class Moon extends HemisphericCelestialBody {\r\n\r\n    // Physics Characteristic\r\n    public override get _defaultPosition(): Vector3{\r\n        return new Vector3(1000, 200, 1000);\r\n    }\r\n    public override get _diameter(): number {\r\n        return 40;\r\n    }\r\n\r\n    // Light Characteristic\r\n    public override get _intensity(): number {\r\n        return 2;\r\n    }\r\n    public override get hemiLightIntensity(){\r\n        return 1;\r\n    }\r\n    public override get _diffuse(): Color3 {\r\n        return new Color3(1.0, 1.0, 1.0);\r\n    }\r\n    public override get _specular(): Color3 {\r\n        return new Color3(1.0, 1.0, 1.0);\r\n    }\r\n    public override get _emissiveColor(): Color3 {\r\n        return new Color3(1.0, 1.0, 1.0);\r\n    }\r\n\r\n    constructor() {\r\n        super();\r\n    }\r\n}\r\n","import {\r\n    Color3, CubeTexture, Effect,\r\n    Mesh,\r\n    MeshBuilder,\r\n    ShaderMaterial, Texture\r\n} from \"@babylonjs/core\";\r\nimport {Game} from \"@/YellowSubmarine/Game\";\r\nimport {Sky} from \"@/YellowSubmarine/sky system/Sky\";\r\n\r\n\r\nexport class SkyBox {\r\n\r\n    private static _instance: SkyBox;\r\n    private _daySkyboxTexture: CubeTexture;\r\n    private _nightSkyboxTexture: CubeTexture;\r\n    private _shaderMaterial: ShaderMaterial;\r\n\r\n    public static get instance(): SkyBox {\r\n        return this._instance;\r\n    }\r\n\r\n    public get mesh(): Mesh {\r\n        return this._mesh;\r\n    }\r\n\r\n    private _mesh: Mesh;\r\n\r\n    constructor() {\r\n        Effect.ShadersRepository = \"/YellowSubmarine/shaders/\";\r\n        SkyBox._instance = this;\r\n        this._mesh = MeshBuilder.CreateBox(\"skyBox\", { size: 10000 }, Game.scene);\r\n        this._mesh.infiniteDistance = true;\r\n        this._mesh.isPickable = false;\r\n\r\n        this._shaderMaterial = new ShaderMaterial(\"skyboxMaterial\", Game.scene, {\r\n            vertex: \"skyboxShader\",\r\n            fragment: \"skyboxShader\",\r\n        },{\r\n            attributes: [\"position\", \"uv\"],\r\n            uniforms: [\"worldViewProjection\", \"timeOfTheDay\"],\r\n            samplers: [\"daySkyboxTexture\", \"nightSkyboxTexture\"],\r\n        })\r\n\r\n        Game.scene.onBeforeRenderObservable.add(() => {\r\n            this._shaderMaterial.setFloat(\"timeOfTheDay\", Sky.instance.dayNightCycle.timeOfTheDay);\r\n        })\r\n\r\n        this._daySkyboxTexture = CubeTexture.CreateFromImages([\r\n            \"textures/skybox/alternate day/px.png\",\r\n            \"textures/skybox/alternate day/pz.png\",\r\n            \"textures/skybox/alternate day/py.png\",\r\n            \"textures/skybox/alternate day/nx.png\",\r\n            \"textures/skybox/alternate day/nz.png\",\r\n            \"textures/skybox/alternate day/ny.png\"\r\n        ], Game.scene);\r\n        this._daySkyboxTexture.coordinatesMode = Texture.SKYBOX_MODE;\r\n        this._nightSkyboxTexture = CubeTexture.CreateFromImages([\r\n            \"textures/skybox/alternate night/px.png\",\r\n            \"textures/skybox/alternate night/pz.png\",\r\n            \"textures/skybox/alternate night/py.png\",\r\n            \"textures/skybox/alternate night/nx.png\",\r\n            \"textures/skybox/alternate night/nz.png\",\r\n            \"textures/skybox/alternate night/ny.png\"\r\n        ], Game.scene);\r\n        this._nightSkyboxTexture.coordinatesMode = Texture.SKYBOX_MODE;\r\n\r\n        this._shaderMaterial.setTexture(\"daySkyboxTexture\", this._daySkyboxTexture);\r\n        this._shaderMaterial.setTexture(\"nightSkyboxTexture\", this._nightSkyboxTexture);\r\n        this._shaderMaterial.backFaceCulling = false;\r\n\r\n        this._mesh.material = this._shaderMaterial;\r\n\r\n\r\n/*\r\n        const material = new ShaderMaterial(\"skyShader\", Game.scene, {\r\n            vertex: \"sky\",\r\n            fragment: \"sky\",\r\n        }, {\r\n            attributes: [\"position\"],\r\n            uniforms: [\r\n                \"worldViewProjection\", \"timeOfDay\",\r\n                \"dayTop\", \"dayBottom\",\r\n                \"sunsetTop\", \"sunsetBottom\",\r\n                \"dayTop\", \"nightBottom\",\r\n                \"dawnTop\", \"dawnBottom\"\r\n            ],\r\n        });\r\n\r\n        material.backFaceCulling = false;\r\n        this._mesh.material = material;\r\n\r\n        this.initColors(material);\r\n\r\n        Game.scene.onBeforeRenderObservable.add(() => {\r\n            const secondsInCycle = 30;\r\n            const time = performance.now() / 1000;\r\n            const timeOfDay = (time % secondsInCycle) / secondsInCycle;\r\n            material.setFloat(\"timeOfDay\", timeOfDay);\r\n        });\r\n*/\r\n    }\r\n\r\n    private initColors(material: ShaderMaterial): void {\r\n        material.setColor3(\"dayTop\", new Color3(0.3, 0.78, 0.98));       // #3580d9\r\n        material.setColor3(\"dayBottom\", new Color3(1.0, 0.94, 0.80)); // bleu trs clair avec un ton chaud\r\n\r\n        material.setColor3(\"sunsetTop\", new Color3(1.0, 0.69, 0.4));     // #ffb066 (anciennement #fff2ce)\r\n        material.setColor3(\"sunsetBottom\", new Color3(0.58, 0.55, 0.82)); // #938cd2\r\n\r\n        material.setColor3(\"dawnTop\", new Color3(0.65, 0.80, 1.0));      // Bleu clair doux #a6ccff\r\n        material.setColor3(\"dawnBottom\", new Color3(1.0, 0.69, 0.4));    // Orange doux #ffb066\r\n\r\n        material.setColor3(\"nightTop\", new Color3(0.043, 0.106, 0.212));    // #3a4a6b\r\n        material.setColor3(\"nightBottom\", new Color3(0.23, 0.29, 0.42)); // #0b1b36\r\n\r\n\r\n    }\r\n\r\n\r\n\r\n}","import {Moon} from \"@/YellowSubmarine/sky system/Moon\";\r\nimport {Sky} from \"@/YellowSubmarine/sky system/Sky\";\r\nimport {Sun} from \"@/YellowSubmarine/sky system/Sun\";\r\nimport {Color3, Vector3} from \"@babylonjs/core\";\r\nimport {Game} from \"@/YellowSubmarine/Game\";\r\n\r\nexport class DayNightCycle {\r\n    \r\n    private _sun : Sun;\r\n    private _moon : Moon;\r\n    private _time = 0;\r\n\r\n    constructor(sky : Sky) {\r\n        this._sun = sky.sun;\r\n        this._moon = sky.moon;\r\n\r\n        Game.scene.onBeforeRenderObservable.add(() => {\r\n            this._time += Game.engine.getDeltaTime() * 0.00001;\r\n            if (this._time > 1) this._time -= 1;\r\n\r\n            this.updateBody(this._time);\r\n            this.updateLight();\r\n            this.updateMoonLight();\r\n        });\r\n    }\r\n\r\n    public get timeOfTheDay(): number{\r\n        return this._time;\r\n    }\r\n\r\n\r\n    private updateBody(time: number): void {\r\n        const sunAngle = time * 2.0 * Math.PI;\r\n        const moonAngle = (time * 2.0 * Math.PI) / 1.5 + Math.PI;\r\n\r\n        const sunRadius = this._sun._defaultPosition.length();\r\n        const moonRadius = this._moon._defaultPosition.length();\r\n\r\n        const inclination = Math.PI / 6;\r\n\r\n        const sunX = sunRadius * Math.cos(sunAngle);\r\n        const sunY = sunRadius * Math.sin(sunAngle) * Math.sin(inclination);\r\n        const sunZ = sunRadius * Math.sin(sunAngle) * Math.cos(inclination);\r\n\r\n        const moonInclination = Math.PI / 8;\r\n        const moonX = moonRadius * Math.cos(moonAngle);\r\n        const moonY = moonRadius * Math.sin(moonAngle) * Math.sin(moonInclination);\r\n        const moonZ = moonRadius * Math.sin(moonAngle) * Math.cos(moonInclination);\r\n\r\n        this._sun.position = new Vector3(sunX, sunY, sunZ);\r\n        this._moon.position = new Vector3(moonX, moonY, moonZ);\r\n    }\r\n\r\n    private updateLight(){\r\n        const sunPos = this._sun.position;\r\n        const sunRadius = this._sun._defaultPosition.length();\r\n        const sunHeight = sunPos.y;\r\n\r\n        const normalized = Math.max(0, Math.min(sunHeight / sunRadius, 1));\r\n        const smooth = Math.pow(normalized, 1.5);\r\n\r\n        this._sun.light.intensity = smooth * this._sun._intensity;\r\n\r\n        if (normalized <= 0.01) {\r\n            this._sun.light.setEnabled(false);\r\n        } else {\r\n            this._sun.light.setEnabled(true);\r\n        }\r\n\r\n        if (smooth > 0 && smooth < 0.3) {\r\n            const sunsetColor = Color3.FromHexString(\"#ff884d\");\r\n            this._sun.light.diffuse = Color3.Lerp(sunsetColor, Color3.White(), smooth / 0.3);\r\n        } else {\r\n            this._sun.light.diffuse = Color3.White();\r\n        }\r\n\r\n        const hemi = this._sun.hemiLight;\r\n        if (hemi) {\r\n            const dayColor = Color3.FromHexString(\"#b6e8ff\");\r\n            const nightColor = Color3.FromHexString(\"#1a1a2e\");\r\n            hemi.diffuse = Color3.Lerp(nightColor, dayColor, smooth);\r\n        }\r\n        Game.scene.ambientColor = new Color3(1, 0, 0);\r\n    }\r\n\r\n    private updateMoonLight(): void {\r\n        const moonPos = this._moon.position;\r\n        const moonRadius = this._moon._defaultPosition.length();\r\n        const moonHeight = moonPos.y;\r\n\r\n        const normalized = Math.max(0, Math.min(moonHeight / moonRadius, 1));\r\n        const smooth = Math.pow(normalized, 1.5);\r\n\r\n        if (this._moon.light) {\r\n            this._moon.light.intensity = smooth * this._moon._intensity;\r\n\r\n            if (normalized <= 0.01) {\r\n                this._moon.light.setEnabled(false);\r\n            } else {\r\n                this._moon.light.setEnabled(true);\r\n            }\r\n        }\r\n\r\n        const hemi = this._moon.hemiLight;\r\n        if (hemi) {\r\n            const nightColor = Color3.FromHexString(\"#818de3\");\r\n            const deepNightColor = Color3.FromHexString(\"#1a1a2e\");\r\n            hemi.diffuse = Color3.Lerp(deepNightColor, nightColor, smooth);\r\n            hemi.intensity = 0.1 + smooth * 0.3;\r\n        }\r\n\r\n    }\r\n}","import {Sun} from \"@/YellowSubmarine/sky system/Sun\";\r\nimport {Moon} from \"@/YellowSubmarine/sky system/Moon\";\r\nimport {SkyBox} from \"@/YellowSubmarine/sky system/SkyBox\";\r\nimport {DayNightCycle} from \"@/YellowSubmarine/sky system/DayNightCycle\";\r\n\r\nexport class Sky{\r\n    private static _instance: Sky;\r\n\r\n    private _sun : Sun;\r\n    private _moon : Moon;\r\n    private _skybox : SkyBox;\r\n    private _dayNightCycle: DayNightCycle;\r\n\r\n    public static get instance(): Sky{\r\n        return this._instance;\r\n    }\r\n\r\n    constructor() {\r\n        Sky._instance = this;\r\n        this._sun = new Sun();\r\n        this._moon = new Moon();\r\n        this._skybox = new SkyBox();\r\n        this._dayNightCycle = new DayNightCycle(this);\r\n    }\r\n\r\n    public get sun(): Sun {\r\n        return this._sun;\r\n    }\r\n\r\n    public set sun(value: Sun) {\r\n        this._sun = value;\r\n    }\r\n\r\n    public static get sun(){\r\n        return this._instance._sun;\r\n    }\r\n\r\n    public get skybox(): SkyBox {\r\n        return this._skybox;\r\n    }\r\n\r\n    public set skybox(value: SkyBox) {\r\n        this._skybox = value;\r\n    }\r\n\r\n    public get moon(): Moon {\r\n        return this._moon;\r\n    }\r\n\r\n    public set moon(value: Moon) {\r\n        this._moon = value;\r\n    }\r\n\r\n    public get dayNightCycle(): DayNightCycle {\r\n        return this._dayNightCycle;\r\n    }\r\n\r\n}","import {\r\n    AbstractMesh, DepthRenderer, Effect, GeometryBufferRenderer, Material, MirrorTexture,\r\n    MultiRenderTarget, Nullable, Plane, RenderTargetTexture, Scene,\r\n    ShaderMaterial, Texture, Vector2, Vector3, Vector4\r\n} from \"@babylonjs/core\";\r\nimport {Game} from \"@/YellowSubmarine/Game\";\r\nimport {Sky} from \"@/YellowSubmarine/sky system/Sky\";\r\n\r\nexport class ReflectiveToonWaterMaterial {\r\n\r\n    private static _instance: ReflectiveToonWaterMaterial;\r\n\r\n    protected _scene: Scene;\r\n    protected _material: ShaderMaterial;\r\n    private _depthRenderer: DepthRenderer;\r\n    private _depthMap: RenderTargetTexture;\r\n    private _geometryBufferRenderer: Nullable<GeometryBufferRenderer>;\r\n    private _gBuffer: Nullable<MultiRenderTarget> = null;\r\n    private _renderListPredicate: (mesh: AbstractMesh) => boolean;\r\n\r\n    protected constructor() {\r\n        Effect.ShadersRepository = \"/YellowSubmarine/shaders/\";\r\n        ReflectiveToonWaterMaterial._instance = this;\r\n        this._scene = Game.scene;\r\n        const camera = this._scene.activeCamera;\r\n\r\n        this._material = new ShaderMaterial(\"toonWaterMaterial\", this._scene,{\r\n            vertex: this.shaderMaterialName, fragment: this.shaderMaterialName,\r\n        },{\r\n            attributes: [\"position\", \"normal\", \"uv\"],\r\n            uniforms: [\"world\",\"view\",\"projection\",\"depthShallowColor\", \"depthDeepColor\", \"depthMaximumDistance\",\r\n                \"surfaceNoiseST\", \"surfaceNoiseCutoff\", \"foamMaxDistance\", \"foamMinDistance\", \"surfaceNoiseScroll\", \"time\", \"surfaceDistortionST\",\r\n                \"surfaceDistortionAmount\", \"screensize\", \"timeOfTheDay\"],\r\n            samplers: [\"linearDepthTexture\", \"surfaceNoiseTexture\",\"surfaceDistortionTexture\",\"reflectionTexture\"],\r\n            needAlphaTesting: true,\r\n        });\r\n\r\n\r\n        this._depthRenderer = this._scene.enableDepthRenderer(undefined, false, undefined, undefined, true);\r\n        this._depthMap = this._depthRenderer.getDepthMap();\r\n        this._renderListPredicate = (m) => m.material !== this._material;\r\n        this._depthMap.renderListPredicate = this._renderListPredicate;\r\n\r\n        this._material.setVector4(\"depthShallowColor\", new Vector4(0.325, 0.807, 0.971, 0.725));\r\n        this._material.setVector4(\"depthDeepColor\", new Vector4(0.086, 0.407, 1, 0.749));\r\n        this._material.setFloat(\"depthMaximumDistance\", 10.0);\r\n        this._material.setTexture(\"linearDepthTexture\", this._depthMap);\r\n        this._material.setVector4(\"surfaceNoiseST\", new Vector4(1, 4, 0, 0));\r\n        this._material.setTexture(\"surfaceNoiseTexture\", new Texture(\"textures/PerlinNoise.png\"));\r\n        this._material.setFloat(\"surfaceNoiseCutoff\", 0.85);\r\n        this._material.setFloat(\"foamMaxDistance\", 0.6);\r\n        this._material.setFloat(\"foamMinDistance\", 0.04);\r\n        this._material.setVector2(\"surfaceNoiseScroll\", new Vector2(0.03, 0.03));\r\n        this._material.setVector4(\"surfaceDistortionST\", new Vector4(1,1,0,0));\r\n        this._material.setFloat(\"surfaceDistortionAmount\", 0.27);\r\n        this._material.setTexture(\"surfaceDistortionTexture\", new Texture(\"textures/WaterDistortion.png\"));\r\n        Game.scene.onBeforeRenderObservable.add(() => {\r\n            this._material.setFloat(\"timeOfTheDay\", Sky.instance.dayNightCycle.timeOfTheDay);\r\n        })\r\n        this._material.setVector2(\"screensize\", new Vector2(window.innerWidth, window.innerHeight));\r\n        window.addEventListener(\"resize\", () => this._material.setVector2(\"screensize\", new Vector2(window.innerWidth, window.innerHeight)) );\r\n        const mirrorTexture = new MirrorTexture(\"mirrorTexture\", 1024, Game.scene);\r\n        mirrorTexture.mirrorPlane = Plane.FromPositionAndNormal(Vector3.Zero(), Vector3.Down());\r\n        mirrorTexture.renderListPredicate = (m) => true;\r\n        this._material.setTexture(\"reflectionTexture\", mirrorTexture);\r\n        Game.scene.customRenderTargets.push(mirrorTexture);\r\n        // this._material.disableDepthWrite = false;\r\n\r\n        this._geometryBufferRenderer = this._scene.enableGeometryBufferRenderer();\r\n        if(this._geometryBufferRenderer != null) {\r\n            this._geometryBufferRenderer.enableNormal;\r\n            this._gBuffer = this._geometryBufferRenderer.getGBuffer();\r\n            this._gBuffer.renderListPredicate = this._renderListPredicate\r\n            const cameraNormalTexture = this._gBuffer.textures[GeometryBufferRenderer.NORMAL_TEXTURE_TYPE];\r\n            this._material.setTexture(\"cameraNormalTexture\", cameraNormalTexture);\r\n        }\r\n\r\n        let time = 0;\r\n        Game.scene.onBeforeRenderObservable.add(() => {\r\n            time += (Game.engine.getDeltaTime()/1000) * 0.01;\r\n            this._material.setFloat(\"time\", time);\r\n        })\r\n\r\n        /*this._material = new ShaderMaterial(\"mirror\", Game.scene, {\r\n            vertex: \"mirror\", fragment: \"mirror\"\r\n        },{\r\n            attributes: [\"position\", \"normal\", \"uv\"],\r\n            uniforms: [\"worldViewProjection\", \"screensize\"],\r\n            samplers: [\"mirrorSampler\"]\r\n        })\r\n\r\n        const mirrorTexture = new MirrorTexture(\"mirrorTex\",512, Game.scene);\r\n        mirrorTexture.mirrorPlane = Plane.FromPositionAndNormal(Vector3.Zero(), Vector3.Down());\r\n        mirrorTexture.renderListPredicate = (m) => m.material !== this._material;\r\n        this._material.setTexture(\"mirrorSampler\", mirrorTexture);\r\n        const canvas = Game.canvas;\r\n        this._material.setVector2(\"screensize\", new Vector2(canvas.width, canvas.height));\r\n        canvas.addEventListener(\"resize\", () => this._material.setVector2(\"screensize\", new Vector2(canvas.width, canvas.height)) );\r\n        Game.scene.customRenderTargets.push(mirrorTexture);*/\r\n\r\n    }\r\n\r\n    public static get instance(){\r\n        if(this._instance == null){\r\n            this._instance = new this();\r\n        }\r\n        return this._instance;\r\n    }\r\n\r\n    public static get material(){\r\n        return this.instance._material;\r\n    }\r\n\r\n    protected get shaderMaterialName(){ return \"toonWaterAndReflections\"; }\r\n\r\n}","import {\r\n    Mesh,\r\n    MeshBuilder,\r\n    PhysicsBody,\r\n    PhysicsMotionType,\r\n    PhysicsShape,\r\n    PhysicsShapeType,\r\n    Vector3,\r\n} from \"@babylonjs/core\";\r\nimport {Game} from \"@/YellowSubmarine/Game\";\r\nimport {ReflectiveToonWaterMaterial} from \"@/YellowSubmarine/shader material/ReflectiveToonWaterMaterial\";\r\n\r\nexport class Sea {\r\n\r\n        private static _instance: Sea;\r\n        private _seaMesh: Mesh;\r\n        private _invisiblePlane: Mesh;\r\n        private _invisiblePlaneBody: PhysicsBody;\r\n        private _invisiblePlaneShape: PhysicsShape;\r\n\r\n        constructor() {\r\n            Sea._instance = this;\r\n            this._seaMesh = MeshBuilder.CreateGround(\r\n                \"waterPlane\",\r\n                {\r\n                    width: 2048,\r\n                    height: 2048,\r\n                    subdivisions: 128,\r\n                },\r\n                Game.scene\r\n            );\r\n            this._invisiblePlane = MeshBuilder.CreateGround(\r\n                \"collisionPlane\",\r\n                {\r\n                    width: 2048,\r\n                    height: 2048,\r\n                    subdivisions: 128,\r\n                },\r\n                Game.scene\r\n            );\r\n            this._invisiblePlane.position = new Vector3(0,-2,0);\r\n            this._invisiblePlaneBody = new PhysicsBody(this._invisiblePlane, PhysicsMotionType.STATIC, false, Game.scene);\r\n            this._invisiblePlaneShape = new PhysicsShape({\r\n                type: PhysicsShapeType.BOX,\r\n                parameters: {\r\n                    mesh: this._invisiblePlane,\r\n                    extents: new Vector3(2048,2,2048),\r\n                }\r\n            }, Game.scene);\r\n            this._invisiblePlaneBody.shape = this._invisiblePlaneShape;\r\n            this._invisiblePlaneBody.setMassProperties({\r\n                mass: 0,\r\n            });\r\n            this._seaMesh.material = ReflectiveToonWaterMaterial.material;\r\n\r\n        }\r\n\r\n\r\n}","import {\r\n    Angle,\r\n    ArcRotateCamera,\r\n    Scalar,\r\n    Vector3\r\n} from \"@babylonjs/core\";\r\nimport {Game} from \"@/YellowSubmarine/Game\";\r\nimport {CameraConfiguration} from \"@/YellowSubmarine/camera system/CameraConfiguration\";\r\nimport {Lerp} from \"@babylonjs/core/Maths/math.scalar.functions\";\r\n\r\nexport class ConfigurableCamera {\r\n    private static _instance: ConfigurableCamera;\r\n\r\n    public static get instance(): ConfigurableCamera {\r\n        return this._instance;\r\n    }\r\n\r\n    private _cameraConfiguration?: CameraConfiguration;\r\n    private _arcRotateCamera: ArcRotateCamera;\r\n    private _positionLerpFactor = 2.0;\r\n    private _rotationLerpFactor = 2.0;\r\n\r\n    constructor() {\r\n        ConfigurableCamera._instance = this;\r\n        this._arcRotateCamera = new ArcRotateCamera(\"customCamera\", 0, 0, 0, Vector3.Zero(), Game.scene);\r\n        Game.scene.onBeforeRenderObservable.add( () => {\r\n            const deltaTimeInSeconds = Game.engine.getDeltaTime() / 1000;\r\n            this.update(deltaTimeInSeconds);\r\n        } );\r\n    }\r\n\r\n    public set cameraConfiguration(cameraParameter: CameraConfiguration | undefined) {\r\n        const oldCameraParameter = this._cameraConfiguration;\r\n        this._cameraConfiguration = cameraParameter;\r\n        if(!oldCameraParameter){\r\n            this.jumpToTarget();\r\n        }\r\n    }\r\n\r\n    public get cameraConfiguration(): CameraConfiguration | undefined {\r\n        return this._cameraConfiguration;\r\n    }\r\n\r\n    private update(deltaTimeInSec: number) {\r\n        this.updatePosition(deltaTimeInSec);\r\n        this.updateRotation(deltaTimeInSec);\r\n    }\r\n\r\n    private jumpToTarget(){\r\n        if(this._cameraConfiguration){\r\n            this._arcRotateCamera.target = this._cameraConfiguration.targetPosition;\r\n            this._arcRotateCamera.alpha = this._cameraConfiguration.wantedAlpha;\r\n            this._arcRotateCamera.beta = this._cameraConfiguration.wantedBeta;\r\n            this._arcRotateCamera.radius = this._cameraConfiguration.distanceFromTarget;\r\n        }\r\n    }\r\n\r\n    private updatePosition(deltaTimeInSec: number) {\r\n        if(this._cameraConfiguration) {\r\n            const target = this._cameraConfiguration.target;\r\n            if(target){\r\n                this._arcRotateCamera.target = Vector3.Lerp(this._arcRotateCamera.target, this._cameraConfiguration.targetPosition, deltaTimeInSec * this._positionLerpFactor);\r\n            }\r\n            this._arcRotateCamera.radius = Lerp(this._arcRotateCamera.radius, this._cameraConfiguration.distanceFromTarget, deltaTimeInSec * this._positionLerpFactor);\r\n            this._arcRotateCamera.lowerRadiusLimit = this._arcRotateCamera.radius;\r\n            this._arcRotateCamera.upperRadiusLimit = this._arcRotateCamera.radius;\r\n        }\r\n    }\r\n\r\n    private updateRotation(deltaTimeInSec: number) {\r\n        if(this._cameraConfiguration) {\r\n            const wantedAlpha = this._cameraConfiguration.wantedAlpha;\r\n            const wantedBeta = this._cameraConfiguration.wantedBeta;\r\n            this._arcRotateCamera.alpha =  Angle.FromDegrees( Scalar.LerpAngle(Angle.FromRadians(this._arcRotateCamera.alpha).degrees(), Angle.FromRadians(wantedAlpha).degrees(), deltaTimeInSec * this._rotationLerpFactor) ).radians();\r\n            this._arcRotateCamera.beta =  Angle.FromDegrees( Scalar.LerpAngle(Angle.FromRadians(this._arcRotateCamera.beta).degrees(), Angle.FromRadians(wantedBeta).degrees(), deltaTimeInSec * this._rotationLerpFactor) ).radians();\r\n        }\r\n    }\r\n\r\n}","import {Angle, Quaternion, TransformNode, Vector3} from \"@babylonjs/core\";\r\n\r\nexport class CameraConfiguration {\r\n\r\n    private _offset: Vector3 = Vector3.Zero();\r\n    private _wantedAlpha = 0;\r\n    private _wantedBeta = Angle.FromDegrees(80).radians();\r\n    private _distanceFromTarget = 10;\r\n    private _target?: TransformNode\r\n    private _currentLowerBetaLimit? : number;\r\n    private _currentUpperBetaLimit? : number;\r\n\r\n    public get targetPosition(): Vector3{\r\n        return ( this._target?.absolutePosition ?? Vector3.Zero() ).add( this._offset.rotateByQuaternionToRef(this._target?.absoluteRotationQuaternion ?? Quaternion.Identity(), Vector3.Zero() ) );\r\n    }\r\n\r\n    public get offset(): Vector3 {\r\n        return this._offset;\r\n    }\r\n\r\n    public set offset(offset: Vector3) {\r\n        this._offset = offset;\r\n    }\r\n\r\n    public get wantedAlpha(): number {\r\n        return this._wantedAlpha;\r\n    }\r\n\r\n    public set wantedAlpha(alpha: number) {\r\n        this._wantedAlpha = alpha;\r\n    }\r\n\r\n    public get wantedBeta(): number {\r\n        return this._wantedBeta;\r\n    }\r\n\r\n    public set wantedBeta(beta: number) {\r\n        this._wantedBeta = beta;\r\n        if(this._currentLowerBetaLimit){\r\n            this._wantedBeta = Math.max(this._wantedBeta, this._currentLowerBetaLimit);\r\n        }\r\n        if(this._currentUpperBetaLimit){\r\n            this._wantedBeta = Math.min(this._wantedBeta, this._currentUpperBetaLimit);\r\n        }\r\n    }\r\n\r\n    public get distanceFromTarget(): number {\r\n        return this._distanceFromTarget;\r\n    }\r\n\r\n    public set distanceFromTarget(distanceFromTarget: number) {\r\n        this._distanceFromTarget = distanceFromTarget;\r\n    }\r\n\r\n    public get target(): TransformNode | undefined {\r\n        return this._target;\r\n    }\r\n\r\n    public set target(target: TransformNode | undefined) {\r\n        this._target = target;\r\n    }\r\n\r\n    public get currentUpperBetaLimit(): number | undefined {\r\n        return this._currentUpperBetaLimit;\r\n    }\r\n\r\n    public set currentUpperBetaLimit(value: number | undefined) {\r\n        this._currentUpperBetaLimit = value;\r\n    }\r\n\r\n    public get currentLowerBetaLimit(): number | undefined {\r\n        return this._currentLowerBetaLimit;\r\n    }\r\n\r\n    public set currentLowerBetaLimit(value: number | undefined) {\r\n        this._currentLowerBetaLimit = value;\r\n    }\r\n\r\n}\r\n","import {AbstractInteraction} from \"@/YellowSubmarine/interaction system/interactions/AbstractInteraction\";\r\nimport {KeyboardEventTypes, Observable} from \"@babylonjs/core\";\r\nimport {Player} from \"@/YellowSubmarine/Player\";\r\n\r\nexport class InteractionManager{\r\n\r\n    private static _instance: InteractionManager;\r\n\r\n    public static get instance(): InteractionManager {\r\n        return this._instance;\r\n    }\r\n\r\n    // private _interactionArray: Array<AbstractInteraction> = new Array<AbstractInteraction>();\r\n    private _currentInteraction?: AbstractInteraction;\r\n\r\n    public onInteractionAvailable: Observable<AbstractInteraction>;\r\n    public onInteractionUnavailable: Observable<AbstractInteraction>;\r\n\r\n    constructor() {\r\n        InteractionManager._instance = this;\r\n        this.onInteractionAvailable = new Observable<AbstractInteraction>();\r\n        this.onInteractionUnavailable = new Observable<AbstractInteraction>();\r\n        Player.onPlayerPressedAKey.add( (eventData) => {\r\n\r\n            if(\r\n                eventData.type === KeyboardEventTypes.KEYDOWN &&\r\n                this._currentInteraction &&\r\n                eventData.event.code === this._currentInteraction.code\r\n            ) {\r\n                this.executeInteraction();\r\n            }\r\n        } )\r\n    }\r\n\r\n    public makeInteractionAvailable(interaction: AbstractInteraction){\r\n        if(this._currentInteraction) {\r\n            this.makeInteractionUnavailable(this._currentInteraction);\r\n        }\r\n        this._currentInteraction = interaction;\r\n        this.onInteractionAvailable.notifyObservers(interaction);\r\n    }\r\n\r\n    public makeInteractionUnavailable(interaction: AbstractInteraction){\r\n        this._currentInteraction = undefined;\r\n        this.onInteractionUnavailable.notifyObservers(interaction);\r\n    }\r\n\r\n    public executeInteraction(){\r\n        const interaction = this._currentInteraction;\r\n        if(interaction){\r\n            interaction.executeInteraction();\r\n        }\r\n    }\r\n\r\n}","import {InteractionManager} from \"@/YellowSubmarine/interaction system/InteractionManager\";\r\n\r\nexport abstract class AbstractInteraction {\r\n\r\n    protected _code:string;\r\n    protected  _simplifiedCode: string;\r\n\r\n    public get code(): string {\r\n        return this._code;\r\n    }\r\n\r\n    public get simplifiedCode(): string {\r\n        return this._simplifiedCode;\r\n    }\r\n\r\n    protected constructor(code: string, simplifiedCode: string) {\r\n        this._code = code;\r\n        this._simplifiedCode = simplifiedCode;\r\n    }\r\n\r\n    public makeAvailable(){\r\n        InteractionManager.instance.makeInteractionAvailable(this);\r\n    }\r\n\r\n    public makeUnavailable(){\r\n        InteractionManager.instance.makeInteractionUnavailable(this);\r\n    }\r\n\r\n    public abstract executeInteraction(): void;\r\n\r\n}","import {AbstractInteraction} from \"@/YellowSubmarine/interaction system/interactions/AbstractInteraction\";\r\nimport {AbstractMesh} from \"@babylonjs/core\";\r\n\r\nexport abstract class DialogueInteraction extends AbstractInteraction{\r\n    public abstract get mesh():AbstractMesh | undefined;\r\n}","import {Control} from \"@babylonjs/gui\";\r\n\r\nexport abstract class UI{\r\n\r\n    public abstract get controlNode(): Control;\r\n}","import {ImportMeshAsync, ImportMeshOptions, Scene} from \"@babylonjs/core\";\r\nimport {Game} from \"@/YellowSubmarine/Game\";\r\n\r\nexport class Utils {\r\n\r\n    public static loadMesh(path: string, scene?: Scene,  options?: ImportMeshOptions | undefined) {\r\n        return ImportMeshAsync(path, scene??Game.scene, options);\r\n    }\r\n\r\n    public static sleep(ms: number) {\r\n        return new Promise(resolve => setTimeout(resolve, ms));\r\n    }\r\n\r\n}","import {BBStyle} from \"@/YellowSubmarine/ui system/BBCode/BBStyle\";\r\n\r\nexport abstract class BBTag {\r\n\r\n    constructor(public param?: string){}\r\n\r\n    public abstract onOpen(style: BBStyle): BBStyle;\r\n\r\n    public onClose(style: BBStyle): BBStyle{\r\n        return style;\r\n    }\r\n\r\n}","import {BBTag} from \"@/YellowSubmarine/ui system/BBCode/BBTag\";\r\nimport {BBStyle} from \"@/YellowSubmarine/ui system/BBCode/BBStyle\";\r\n\r\nexport class ItalicTag extends BBTag {\r\n    onOpen(style: BBStyle): BBStyle {\r\n        return {...style, italic: true};\r\n    }\r\n}","import {BBTag} from \"@/YellowSubmarine/ui system/BBCode/BBTag\";\r\nimport {BBStyle} from \"@/YellowSubmarine/ui system/BBCode/BBStyle\";\r\n\r\nexport class BoldTag extends BBTag {\r\n    onOpen(style: BBStyle): BBStyle {\r\n        return {...style, bold: true};\r\n    }\r\n\r\n}","import {BBTag} from \"@/YellowSubmarine/ui system/BBCode/BBTag\";\r\nimport {BBStyle} from \"@/YellowSubmarine/ui system/BBCode/BBStyle\";\r\n\r\nexport class ColorTag extends BBTag {\r\n    onOpen(style: BBStyle): BBStyle {\r\n        return {...style, color: this.param || style.color};\r\n    }\r\n\r\n}","import {BBTag} from \"@/YellowSubmarine/ui system/BBCode/BBTag\";\r\nimport {BBStyle} from \"@/YellowSubmarine/ui system/BBCode/BBStyle\";\r\n\r\nexport class SizeTag extends BBTag {\r\n\r\n    onOpen(style: BBStyle): BBStyle {\r\n        const newStyle = {...style};\r\n        const parsedSize = parseInt(this.param || \"\");\r\n\r\n        if(!isNaN(parsedSize)){\r\n            newStyle.size = parsedSize;\r\n        }\r\n        return newStyle;\r\n    }\r\n\r\n}","import {BBStyle} from \"@/YellowSubmarine/ui system/BBCode/BBStyle\";\r\nimport {BBTag} from \"@/YellowSubmarine/ui system/BBCode/BBTag\";\r\nimport {ItalicTag} from \"@/YellowSubmarine/ui system/BBCode/Tags/ItalicTag\";\r\nimport {BoldTag} from \"@/YellowSubmarine/ui system/BBCode/Tags/BoldTag\";\r\nimport {ColorTag} from \"@/YellowSubmarine/ui system/BBCode/Tags/ColorTag\";\r\nimport {SizeTag} from \"@/YellowSubmarine/ui system/BBCode/Tags/SizeTag\";\r\n\r\ninterface Segment { text: string; style: BBStyle; }\r\n\r\nexport class BBParser {\r\n\r\n    private _registry = new Map<string, new (param?: string) => BBTag>();\r\n\r\n    constructor() {\r\n        this.initRegistry();\r\n    }\r\n\r\n    private initRegistry(): void{\r\n        this._registry.set(\"i\", ItalicTag);\r\n        this._registry.set(\"g\", BoldTag);\r\n        this._registry.set(\"c\", ColorTag);\r\n        this._registry.set(\"s\", SizeTag);\r\n    }\r\n\r\n    public parseBBCode(input: string): Segment[] {\r\n        const segments: Segment[] = [];\r\n        const tagStack: BBTag[] = [];\r\n        const styleStack: BBStyle[] = [];\r\n\r\n        let cursor = 0;\r\n        let currentStyle: BBStyle = {};\r\n\r\n        const regex = /\\[\\/?([a-z]+)(?:=([^\\]]+))?\\]/ig;\r\n        let match: RegExpExecArray | null;\r\n\r\n        while ((match = regex.exec(input))) {\r\n            const [full, name, param] = match;\r\n            const isClosing = full.startsWith(\"[/\");\r\n            const idx = match.index;\r\n\r\n            // 1) Texte avant le tag\r\n            if (idx > cursor) {\r\n                segments.push({ text: input.slice(cursor, idx), style: { ...currentStyle } });\r\n            }\r\n            cursor = idx + full.length;\r\n\r\n            if (!isClosing) {\r\n                const TagClass = this._registry.get(name);\r\n                if (TagClass) {\r\n                    const tagInstance = new TagClass(param);\r\n                    tagStack.push(tagInstance);\r\n                    styleStack.push({ ...currentStyle }); // snapshot du style\r\n                    currentStyle = tagInstance.onOpen(currentStyle);\r\n                }\r\n            } else {\r\n                const last = tagStack.pop();\r\n                const previousStyle = styleStack.pop();\r\n                if (last && previousStyle) {\r\n                    currentStyle = previousStyle; // restore snapshot\r\n                }\r\n            }\r\n        }\r\n\r\n        if (cursor < input.length) {\r\n            segments.push({ text: input.slice(cursor), style: { ...currentStyle } });\r\n        }\r\n\r\n        return segments;\r\n    }\r\n\r\n\r\n}","import { BBParser } from \"@/YellowSubmarine/ui system/BBCode/BBParser\";\r\nimport { BBStyle } from \"@/YellowSubmarine/ui system/BBCode/BBStyle\";\r\nimport { Control, TextBlock, StackPanel } from \"@babylonjs/gui\";\r\n\r\nexport interface StyledSegment {\r\n    text: string;\r\n    style: BBStyle;\r\n}\r\n\r\nexport interface StyledTextBlock {\r\n    tb: TextBlock;\r\n    full: string;\r\n}\r\n\r\nexport class TextLayoutManager {\r\n    private parser: BBParser;\r\n    private ctx: CanvasRenderingContext2D;\r\n    private defaultFontSize: number;\r\n    private horizontalPadding: number;\r\n\r\n    constructor(\r\n        ctx: CanvasRenderingContext2D,\r\n        defaultFontSize = 24,\r\n        horizontalPadding = 4\r\n    ) {\r\n        this.parser = new BBParser();\r\n        this.ctx = ctx;\r\n        this.defaultFontSize = defaultFontSize;\r\n        this.horizontalPadding = horizontalPadding;\r\n    }\r\n\r\n    public layout(text: string, maxWidth: number): { lines: StyledSegment[][]; segments: StyledSegment[] } {\r\n        const segments = this.parser.parseBBCode(text).map(s => ({\r\n            text: s.text,\r\n            style: s.style\r\n        }));\r\n\r\n        const lines = this.splitLines(segments, maxWidth);\r\n\r\n        return { lines, segments };\r\n    }\r\n\r\n    private getTextWidth(text: string, fontSize: number): number {\r\n        this.ctx.font = `${fontSize}px sans-serif`;\r\n        return this.ctx.measureText(text).width;\r\n    }\r\n\r\n    private splitLines(segments: StyledSegment[], maxWidth: number): StyledSegment[][] {\r\n        const lines: StyledSegment[][] = [];\r\n        let currentLine: StyledSegment[] = [];\r\n        let currentWidth = 0;\r\n\r\n        for (const segment of segments) {\r\n            const fontSize = segment.style.size || this.defaultFontSize;\r\n            const segWidth = this.getTextWidth(segment.text, fontSize) + this.horizontalPadding * 2;\r\n\r\n            if (currentWidth + segWidth <= maxWidth) {\r\n                currentLine.push(segment);\r\n                currentWidth += segWidth;\r\n            } else {\r\n                const parts = segment.text.split(/(\\s+)/);\r\n\r\n                for (const part of parts) {\r\n                    if (part === '' || (part.trim() === '' && currentLine.length === 0)) continue;\r\n\r\n                    const partWidth = this.getTextWidth(part, fontSize) + this.horizontalPadding * 2;\r\n\r\n                    if (currentWidth + partWidth > maxWidth && currentLine.length) {\r\n                        lines.push(currentLine);\r\n                        currentLine = [];\r\n                        currentWidth = 0;\r\n                        if (part.trim() === '') continue;\r\n                    }\r\n\r\n                    currentLine.push({ text: part, style: segment.style });\r\n                    currentWidth += partWidth;\r\n                }\r\n            }\r\n        }\r\n\r\n        if (currentLine.length) lines.push(currentLine);\r\n        return lines;\r\n    }\r\n\r\n    /**\r\n     * Cre les StackPanels (lignes) et TextBlocks (segments) formats.\r\n     * Renvoie un tableau d'objets pour animer le texte.\r\n     */\r\n    public createTextBlocks(\r\n        lines: StyledSegment[][],\r\n        lineHeight: number,\r\n        textBlockHorizontalPadding: number,\r\n        defaultFontSize: number\r\n    ): { linesPanels: StackPanel[]; blocks: StyledTextBlock[] } {\r\n        const blocks: StyledTextBlock[] = [];\r\n        const linesPanels: StackPanel[] = [];\r\n\r\n        lines.forEach(lineSegments => {\r\n            const row = new StackPanel();\r\n            row.isVertical = false;\r\n            row.height = `${lineHeight}px`;\r\n            row.horizontalAlignment = Control.HORIZONTAL_ALIGNMENT_CENTER;\r\n            row.verticalAlignment = Control.VERTICAL_ALIGNMENT_BOTTOM;\r\n\r\n            lineSegments.forEach(segment => {\r\n                const tb = new TextBlock();\r\n                tb.text = \"\";\r\n                this.applyStyle(tb, segment.style, textBlockHorizontalPadding, defaultFontSize);\r\n                tb.textWrapping = false;\r\n                tb.resizeToFit = true;\r\n                tb.verticalAlignment = Control.VERTICAL_ALIGNMENT_BOTTOM;\r\n\r\n                row.addControl(tb);\r\n                blocks.push({ tb, full: segment.text });\r\n            });\r\n\r\n            linesPanels.push(row);\r\n        });\r\n\r\n        return { linesPanels, blocks };\r\n    }\r\n\r\n    private applyStyle(tb: TextBlock, style: BBStyle, padding: number, defaultFontSize: number) {\r\n        tb.fontWeight = style.bold ? \"bold\" : \"normal\";\r\n        tb.fontStyle = style.italic ? \"italic\" : \"normal\";\r\n        tb.color = style.color || \"black\";\r\n        tb.fontSize = style.size || defaultFontSize;\r\n        tb.paddingLeft = `${padding}px`;\r\n        tb.paddingRight = `${padding}px`;\r\n    }\r\n}\r\n","import { Utils } from \"@/YellowSubmarine/Utils\";\r\nimport {StyledTextBlock} from \"@/YellowSubmarine/ui system/TextLayoutManager\";\r\n\r\nexport class TextAnimator {\r\n    private _advanceRequested = false;\r\n\r\n    public get advanceRequested() {\r\n        return this._advanceRequested;\r\n    }\r\n\r\n\r\n    public requestAdvance() {\r\n        this._advanceRequested = true;\r\n    }\r\n\r\n    public resetAdvance() {\r\n        this._advanceRequested = false;\r\n    }\r\n\r\n    public async animateBlocks(blocks: StyledTextBlock[], speed: number) {\r\n        let skipped = false;\r\n        for (const { tb, full } of blocks) {\r\n            for (let i = 1; i <= full.length; i++) {\r\n                tb.text = full.slice(0, i);\r\n                if (this._advanceRequested) {\r\n                    skipped = true;\r\n                    break;\r\n                }\r\n                await Utils.sleep(speed);\r\n            }\r\n            if (skipped) break;\r\n        }\r\n    }\r\n}\r\n","import { UI } from \"@/YellowSubmarine/ui system/UI\";\r\nimport { Control, Rectangle, Image, StackPanel } from \"@babylonjs/gui\";\r\nimport { Conversation } from \"@/YellowSubmarine/dialogue system/Conversation\";\r\nimport { Utils } from \"@/YellowSubmarine/Utils\";\r\nimport { TextLayoutManager } from \"@/YellowSubmarine/ui system/TextLayoutManager\";\r\nimport {TextAnimator} from \"@/YellowSubmarine/ui system/TextAnimator\";\r\n\r\nexport class DialogueInteractionUI extends UI {\r\n\r\n    private readonly CONTAINER_WIDTH = 0.4;\r\n    private readonly CONTAINER_CORNER_RADIUS = 10;\r\n    private readonly CONTAINER_THICKNESS = 5;\r\n    private readonly CONTAINER_COLOR = \"rgb(168, 98, 68)\";\r\n    private readonly CONTAINER_BACKGROUND = \"rgb(255, 199, 130)\";\r\n    private readonly CONTAINER_OFFSET_Y = -200;\r\n\r\n    private readonly TEXT_PADDING = 8;\r\n    private readonly TEXT_BLOCK_HORIZONTAL_PADDING = 2;\r\n    private readonly TEXT_DEFAULT_FONT_SIZE = 24;\r\n    private readonly TEXT_LINE_SPACING = 8;\r\n    private readonly TEXT_EXTRA_CONTAINER_MARGIN = 20;\r\n    private readonly TEXT_SPEED = 20;\r\n\r\n    private readonly TRIANGLE_IMAGE_PATH = \"ui/triangle.png\";\r\n    private readonly TRIANGLE_SIZE = \"24px\";\r\n    private readonly TRIANGLE_BLINK_INTERVAL = 300;\r\n\r\n    private _container!: Rectangle;\r\n    private _verticalStack!: StackPanel;\r\n    private _triangle!: Image;\r\n\r\n    private static _isTextFullyDisplayed = false;\r\n\r\n\r\n    private _layoutManager: TextLayoutManager;\r\n    private _textAnimator: TextAnimator;\r\n\r\n    public get controlNode(): Control {\r\n        return this._container;\r\n    }\r\n\r\n    public static get isTextFullyDisplayed(): boolean {\r\n        return this._isTextFullyDisplayed;\r\n    }\r\n\r\n    constructor() {\r\n        super();\r\n\r\n        this.initContainer();\r\n        this.initStack();\r\n        this.initTriangle();\r\n\r\n        this._layoutManager = new TextLayoutManager(\r\n            (() => {\r\n                const canvas = document.createElement(\"canvas\");\r\n                return canvas.getContext(\"2d\")!;\r\n            })(),\r\n            this.TEXT_DEFAULT_FONT_SIZE,\r\n            this.TEXT_BLOCK_HORIZONTAL_PADDING\r\n        );\r\n\r\n        this._textAnimator = new TextAnimator();\r\n\r\n        Conversation.onAnyConversationStart.add((conv) => {\r\n            this._container.isVisible = true;\r\n            if (conv.conversationProvider?.mesh) {\r\n                this._container.linkWithMesh(conv.conversationProvider.mesh);\r\n                this._container.linkOffsetY = this.CONTAINER_OFFSET_Y;\r\n            }\r\n        });\r\n\r\n        Conversation.onAnyConversationEnd.add(() => {\r\n            this._stopBlink();\r\n            this._container.isVisible = false;\r\n        });\r\n\r\n        Conversation.onAnyDialogueStart.add((dialog) =>\r\n            this.showText(dialog.text, this.TEXT_SPEED)\r\n        );\r\n    }\r\n\r\n    private initContainer() {\r\n        this._container = new Rectangle();\r\n        this._container.width = `${this.CONTAINER_WIDTH * 100}%`;\r\n        this._container.cornerRadius = this.CONTAINER_CORNER_RADIUS;\r\n        this._container.thickness = this.CONTAINER_THICKNESS;\r\n        this._container.color = this.CONTAINER_COLOR;\r\n        this._container.background = this.CONTAINER_BACKGROUND;\r\n        this._container.verticalAlignment = Control.VERTICAL_ALIGNMENT_BOTTOM;\r\n        this._container.horizontalAlignment = Control.HORIZONTAL_ALIGNMENT_CENTER;\r\n        this._container.isVisible = false;\r\n        this._container.paddingLeft = `${this.TEXT_PADDING}px`;\r\n        this._container.paddingRight = `${this.TEXT_PADDING}px`;\r\n    }\r\n\r\n    private initStack() {\r\n        this._verticalStack = new StackPanel();\r\n        this._verticalStack.isVertical = true;\r\n        this._verticalStack.width = \"100%\";\r\n        this._verticalStack.paddingBottom = \"5px\";\r\n        this._container.addControl(this._verticalStack);\r\n    }\r\n\r\n    private initTriangle() {\r\n        this._triangle = new Image(\"nextTriangle\", this.TRIANGLE_IMAGE_PATH);\r\n        this._triangle.width = this.TRIANGLE_SIZE;\r\n        this._triangle.height = this.TRIANGLE_SIZE;\r\n        this._triangle.verticalAlignment = Control.VERTICAL_ALIGNMENT_BOTTOM;\r\n        this._triangle.horizontalAlignment = Control.HORIZONTAL_ALIGNMENT_RIGHT;\r\n        this._triangle.isVisible = false;\r\n        this._container.addControl(this._triangle);\r\n    }\r\n\r\n    private async showText(text: string, speed: number) {\r\n        DialogueInteractionUI._isTextFullyDisplayed = false;\r\n        this._stopBlink();\r\n        this._textAnimator.resetAdvance();\r\n        this._verticalStack.clearControls();\r\n\r\n        const advanceObserver = Conversation.onAdvanceDialogueRequested.add(() => {\r\n            this._textAnimator.requestAdvance();\r\n        });\r\n\r\n        const canvasWidth = document.querySelector(\"canvas\")!.clientWidth;\r\n        const containerPixelWidth = canvasWidth * this.CONTAINER_WIDTH;\r\n        const maxWidth =\r\n            containerPixelWidth -\r\n            this.TEXT_PADDING * 2 -\r\n            this.TEXT_BLOCK_HORIZONTAL_PADDING * 2;\r\n\r\n        const { lines, segments } = this._layoutManager.layout(text, maxWidth);\r\n\r\n        const maxFontSize = Math.max(\r\n            ...segments.map((s) => s.style.size || this.TEXT_DEFAULT_FONT_SIZE)\r\n        );\r\n        const lineHeight = maxFontSize * 1.2 + this.TEXT_LINE_SPACING;\r\n\r\n        const { linesPanels, blocks } = this._layoutManager.createTextBlocks(\r\n            lines,\r\n            lineHeight,\r\n            this.TEXT_BLOCK_HORIZONTAL_PADDING,\r\n            this.TEXT_DEFAULT_FONT_SIZE\r\n        );\r\n\r\n        linesPanels.forEach(linePanel => {\r\n            this._verticalStack.addControl(linePanel);\r\n        });\r\n\r\n        const contentHeight = lines.length * lineHeight;\r\n        const totalHeight =\r\n            contentHeight + this.TEXT_PADDING * 2 + this.TEXT_EXTRA_CONTAINER_MARGIN;\r\n        this._container.height = `${totalHeight}px`;\r\n\r\n        await this._textAnimator.animateBlocks(blocks, speed);\r\n\r\n        if (this._textAnimator.advanceRequested) {\r\n            blocks.forEach((b) => (b.tb.text = b.full));\r\n        }\r\n\r\n        DialogueInteractionUI._isTextFullyDisplayed = true;\r\n        Conversation.onAdvanceDialogueRequested.remove(advanceObserver);\r\n        await this._startBlink();\r\n    }\r\n\r\n    private async _startBlink() {\r\n        if(!DialogueInteractionUI._isTextFullyDisplayed) return;\r\n        this._triangle.isVisible = true;\r\n\r\n        while (DialogueInteractionUI.isTextFullyDisplayed) {\r\n            this._triangle.alpha = 1;\r\n            await Utils.sleep(this.TRIANGLE_BLINK_INTERVAL);\r\n            this._triangle.alpha = 0;\r\n            await Utils.sleep(this.TRIANGLE_BLINK_INTERVAL);\r\n        }\r\n\r\n\r\n    }\r\n\r\n    private _stopBlink() {\r\n        this._triangle.isVisible = false;\r\n    }\r\n}\r\n","import {Conversation} from \"@/YellowSubmarine/dialogue system/Conversation\";\r\nimport {DialogueInteraction} from \"@/YellowSubmarine/interaction system/interactions/DialogueInteraction\";\r\nimport {AbstractMesh} from \"@babylonjs/core\";\r\nimport {DialogueInteractionUI} from \"@/YellowSubmarine/interaction system/ui/DialogueInteractionUI\";\r\n\r\nexport class NextDialogueInteraction extends DialogueInteraction{\r\n\r\n    constructor(private _conversation:Conversation) {\r\n        super(\"Space\", \"_\");\r\n    }\r\n\r\n    executeInteraction(): void {\r\n        if(!DialogueInteractionUI.isTextFullyDisplayed){\r\n            Conversation.onAdvanceDialogueRequested.notifyObservers();\r\n            return;\r\n        }\r\n        this._conversation.next();\r\n    }\r\n\r\n    get mesh(): AbstractMesh | undefined {\r\n        return this._conversation.conversationProvider?.mesh;\r\n    }\r\n\r\n}","import {Observable} from \"@babylonjs/core\";\r\nimport {AbstractDialogueNode} from \"@/YellowSubmarine/dialogue system/nodes/AbstractDialogueNode\";\r\nimport {NextDialogueInteraction} from \"@/YellowSubmarine/dialogue system/interactions/NextDialogueInteraction\";\r\nimport {ConfigurableCamera} from \"@/YellowSubmarine/camera system/ConfigurableCamera\";\r\nimport {Player} from \"@/YellowSubmarine/Player\";\r\nimport {IConversationProvider} from \"@/YellowSubmarine/dialogue system/IConversationProvider\";\r\n\r\n\r\nexport class Conversation {\r\n\r\n    private _onEnding = (): void => {return};\r\n\r\n    private _conversationProvider?: IConversationProvider;\r\n\r\n    public static onAnyDialogueStart:Observable<AbstractDialogueNode> = new Observable();\r\n    public static onAnyConversationStart: Observable<Conversation> = new Observable();\r\n    public static onAnyConversationEnd: Observable<Conversation> = new Observable();\r\n    public static onAdvanceDialogueRequested: Observable<void> = new Observable();\r\n\r\n    public onDialogueStart: Observable<AbstractDialogueNode> = new Observable();\r\n    public onConversationStart: Observable<Conversation> = new Observable();\r\n    public onConversationEnd: Observable<Conversation> = new Observable();\r\n\r\n    private _nextInteraction: NextDialogueInteraction = new NextDialogueInteraction(this);\r\n    private _currentNode: AbstractDialogueNode | undefined = undefined;\r\n    private _rootNode: AbstractDialogueNode | undefined = undefined;\r\n\r\n    public get conversationProvider(): IConversationProvider | undefined{\r\n        return this._conversationProvider;\r\n    }\r\n\r\n    public set conversationProvider(conversationProvider: IConversationProvider | undefined) {\r\n        this._conversationProvider = conversationProvider;\r\n    }\r\n\r\n    public get root(){\r\n        return this._rootNode;\r\n    }\r\n    public set root(value: AbstractDialogueNode | undefined){\r\n        this._rootNode = value;\r\n    }\r\n\r\n    public get onEnding(): () => void {\r\n        return this._onEnding;\r\n    }\r\n\r\n    public set onEnding(value: () => void) {\r\n        this._onEnding = value;\r\n    }\r\n\r\n    private enterNode(node: AbstractDialogueNode){\r\n        this._currentNode = node;\r\n        this._currentNode.execute();\r\n        this.onDialogueStart.notifyObservers(node);\r\n        Conversation.onAnyDialogueStart.notifyObservers(node);\r\n    }\r\n\r\n    public startConversation(): void {\r\n        this._currentNode = this.root;\r\n        this.onConversationStart.notifyObservers(this);\r\n        Conversation.onAnyConversationStart.notifyObservers(this);\r\n        this.enterNode(<AbstractDialogueNode>this._currentNode);\r\n        this._nextInteraction.makeAvailable();\r\n        const cameraConfiguration = this._conversationProvider?.cameraConfiguration\r\n        if(cameraConfiguration) {\r\n            ConfigurableCamera.instance.cameraConfiguration = cameraConfiguration;\r\n        }\r\n    }\r\n\r\n    public next(): void {\r\n        const nextNode = this._currentNode?.nextNode;\r\n        if (nextNode) {\r\n            this.enterNode(nextNode);\r\n        } else {\r\n            this.endConversation();\r\n        }\r\n    }\r\n\r\n    private endConversation() {\r\n        this._currentNode = undefined;\r\n        this._nextInteraction.makeUnavailable();\r\n        this.onConversationEnd.notifyObservers(this);\r\n        Conversation.onAnyConversationEnd.notifyObservers(this);\r\n        ConfigurableCamera.instance.cameraConfiguration = Player.playerCameraConfiguration;\r\n        this._onEnding();\r\n    }\r\n\r\n    public isInProgress(): boolean {\r\n        return !!this._currentNode;\r\n    }\r\n}","import {Game} from \"@/YellowSubmarine/Game\";\r\nimport {Angle, KeyboardEventTypes, KeyboardInfo, Observable, Scalar} from \"@babylonjs/core\";\r\nimport {ConfigurableCamera} from \"@/YellowSubmarine/camera system/ConfigurableCamera\";\r\nimport {CameraConfiguration} from \"@/YellowSubmarine/camera system/CameraConfiguration\";\r\nimport {Submarine} from \"@/YellowSubmarine/Submarine\";\r\nimport {Conversation} from \"@/YellowSubmarine/dialogue system/Conversation\";\r\n\r\ntype CameraRotationInfo = {movementX: number, movementY: number};\r\n\r\nexport class Player {\r\n\r\n\r\n    private static _instance: Player;\r\n    private static _onCameraRotationObservable: Observable<CameraRotationInfo> = new Observable();\r\n    private static _onPlayerPressedAKey: Observable<KeyboardInfo> = new Observable();\r\n    private static _playerCameraConfiguration: CameraConfiguration = new CameraConfiguration();\r\n    private static _horizontalCameraSensitivity = 5;\r\n    private static _verticalCameraSensitivity = 5;\r\n    private static _isMovementEnabled = true;\r\n\r\n\r\n    public static get instance() {\r\n        return this._instance;\r\n    }\r\n\r\n    public static get onCameraRotationObservable(){\r\n        return this._onCameraRotationObservable;\r\n    }\r\n\r\n    public static get onPlayerPressedAKey(): Observable<KeyboardInfo> {\r\n        return this._onPlayerPressedAKey;\r\n    }\r\n\r\n    public static get playerCameraConfiguration(): CameraConfiguration {\r\n        return this._playerCameraConfiguration;\r\n    }\r\n\r\n    private static _isForwardPressed = false;\r\n    private static _isBackwardPressed = false;\r\n    private static _isLeftPressed = false;\r\n    private static _isRightPressed = false;\r\n\r\n    constructor() {\r\n        Player._instance = this;\r\n        Player.initializeCameraParameter();\r\n        Player.registerKeyboardInputs();\r\n        Player.registerMouseMovementInputs();\r\n        Conversation.onAnyConversationStart.add(() => Player.disableMovement());\r\n        Conversation.onAnyConversationEnd.add(() => Player.enableMovement());\r\n    }\r\n\r\n    public static isMoveForwardPressed(): boolean {\r\n        return this._isForwardPressed && this._isMovementEnabled;\r\n    }\r\n\r\n    public static isMoveBackwardPressed(): boolean {\r\n        return this._isBackwardPressed && this._isMovementEnabled;\r\n    }\r\n\r\n    public static isTurnLeftPressed(): boolean {\r\n        return this._isLeftPressed && this._isMovementEnabled;\r\n    }\r\n\r\n    public static isTurnRightPressed(): boolean {\r\n        return this._isRightPressed && this._isMovementEnabled;\r\n    }\r\n\r\n    private static registerKeyboardInputs(){\r\n        const scene = Game.scene;\r\n        scene.onKeyboardObservable.add( (eventData) => {\r\n            if(Game.isGameFocused){\r\n                const state = eventData.type === KeyboardEventTypes.KEYDOWN;\r\n                if(eventData.event.code === \"KeyW\"){\r\n                    this._isForwardPressed = state;\r\n                }\r\n                else if(eventData.event.code === \"KeyS\"){\r\n                    this._isBackwardPressed = state;\r\n                }\r\n                else if(eventData.event.code === \"KeyA\"){\r\n                    this._isLeftPressed = state;\r\n                }\r\n                else if(eventData.event.code === \"KeyD\"){\r\n                    this._isRightPressed = state;\r\n                }\r\n                this.onPlayerPressedAKey.notifyObservers(eventData);\r\n\r\n            }\r\n        } );\r\n    }\r\n\r\n    private static registerMouseMovementInputs() {\r\n        const scene = Game.scene;\r\n        scene.onPointerObservable.add((pointerInfo) => {\r\n            if(Game.isGameFocused){\r\n                const event = pointerInfo.event as PointerEvent;\r\n                const movementX = event.movementX/window.screen.width;\r\n                const movementY = event.movementY/window.screen.height;\r\n                this._onCameraRotationObservable.notifyObservers({movementX, movementY});\r\n                this.updateCameraParameter(movementX, movementY);\r\n            }\r\n        })\r\n    }\r\n\r\n    public static enableMovement(){\r\n        this._isMovementEnabled = true;\r\n    }\r\n\r\n    public static disableMovement(){\r\n        this._isMovementEnabled = false;\r\n    }\r\n\r\n    private static initializeCameraParameter() {\r\n        Submarine.instance.meshCreationPromise.then((mesh) => {\r\n            this._playerCameraConfiguration.target = mesh;\r\n            this._playerCameraConfiguration.distanceFromTarget = 25;\r\n            this._playerCameraConfiguration.currentLowerBetaLimit = Angle.FromDegrees(30).radians();\r\n            this._playerCameraConfiguration.currentUpperBetaLimit = Angle.FromDegrees(85).radians();\r\n            this._playerCameraConfiguration.wantedAlpha = Angle.FromDegrees(-90).radians();\r\n            this._playerCameraConfiguration.wantedBeta = Angle.FromDegrees(45).radians();\r\n            ConfigurableCamera.instance.cameraConfiguration = this._playerCameraConfiguration;\r\n        })\r\n    }\r\n\r\n    private static updateCameraParameter(movementX: number, movementY: number) {\r\n        this._playerCameraConfiguration.wantedAlpha = Scalar.LerpAngle(this._playerCameraConfiguration.wantedBeta, this._playerCameraConfiguration.wantedAlpha - movementX * this._horizontalCameraSensitivity, 1);\r\n        this._playerCameraConfiguration.wantedBeta = Scalar.LerpAngle(this._playerCameraConfiguration.wantedBeta, this._playerCameraConfiguration.wantedBeta - movementY * this._verticalCameraSensitivity, 1);\r\n\r\n    }\r\n\r\n    private static isCurrentCamera(){\r\n        return ConfigurableCamera.instance.cameraConfiguration == this._playerCameraConfiguration;\r\n    }\r\n}","import {\r\n    AbstractMesh,\r\n    Color3,\r\n    InputBlock,\r\n    NodeMaterial,\r\n    Nullable,\r\n    PBRMaterial,\r\n    Texture,\r\n    TextureBlock,\r\n} from \"@babylonjs/core\";\r\nimport {Game} from \"@/YellowSubmarine/Game\";\r\n\r\nexport class CartoonShaderMaterial {\r\n\r\n    private _nodeMaterialPromise;\r\n    private _nodeMaterial!: NodeMaterial;\r\n\r\n    public async assignMaterial(mesh: AbstractMesh){\r\n        await this._nodeMaterialPromise.then(() => {\r\n            mesh.material = this._nodeMaterial;\r\n        })\r\n\r\n    }\r\n\r\n    public constructor() {\r\n        this._nodeMaterialPromise = NodeMaterial.ParseFromFileAsync(\"ToonShader\", \"shaders/PBRToonMaterial.json\", Game.scene).then((nodeMaterial) => {\r\n            this._nodeMaterial = nodeMaterial;\r\n            this._nodeMaterial.maxSimultaneousLights = 6;\r\n            this.saturationMultiplier = 1.5;\r\n            this._nodeMaterial.build();\r\n        })\r\n    }\r\n\r\n    public set saturationMultiplier(saturationMultiplier: number) {\r\n        this._nodeMaterialPromise.then(() => {\r\n            (this._nodeMaterial.getBlockByName(\"SaturationMultiplier\") as InputBlock).value = saturationMultiplier;\r\n        })\r\n    }\r\n\r\n    public set numberOfSteps(numberOfSteps: number) {\r\n        this._nodeMaterialPromise.then(() => {\r\n            (this._nodeMaterial.getBlockByName(\"NumberOfSteps\") as InputBlock).value = numberOfSteps;\r\n        })\r\n    }\r\n\r\n    public set luminanceEasingFactor(luminanceEasingFactor: number) {\r\n        this._nodeMaterialPromise.then(() => {\r\n            (this._nodeMaterial.getBlockByName(\"LuminanceEasingFactor\") as InputBlock).value = luminanceEasingFactor;\r\n        })\r\n    }\r\n\r\n    public set indexOfRefraction(indexOfRefraction: number) {\r\n        this._nodeMaterialPromise.then(() => {\r\n            (this._nodeMaterial.getBlockByName(\"IoR\") as InputBlock).value = indexOfRefraction;\r\n        })\r\n    }\r\n\r\n    public set albedoColor(albedoColor: Color3){\r\n        this._nodeMaterialPromise.then(() => {\r\n            (this._nodeMaterial.getBlockByName(\"AlbedoColor\") as InputBlock).value = albedoColor;\r\n        })\r\n    }\r\n\r\n    public set albedoTexture(albedoTexture: Texture){\r\n        this._nodeMaterialPromise.then(() => {\r\n            (this._nodeMaterial.getBlockByName(\"AlbedoTexture\") as TextureBlock).texture = albedoTexture;\r\n        })\r\n    }\r\n\r\n    public set opacity(opacity: number){\r\n        this._nodeMaterialPromise.then(() => {\r\n            (this._nodeMaterial.getBlockByName(\"OpacityFactor\") as InputBlock).value = opacity;\r\n        })\r\n    }\r\n\r\n    public set metallic(metallic: number){\r\n        this._nodeMaterialPromise.then(() => {\r\n            (this._nodeMaterial.getBlockByName(\"MetallicFactor\") as InputBlock).value = metallic;\r\n        })\r\n    }\r\n\r\n    public set metallicTexture(metallicTexture: Texture){\r\n        this._nodeMaterialPromise.then(() => {\r\n            (this._nodeMaterial.getBlockByName(\"MetallicTexture\") as TextureBlock).texture = metallicTexture;\r\n        })\r\n    }\r\n\r\n    public set roughness(roughness: number){\r\n        this._nodeMaterialPromise.then(() => {\r\n            (this._nodeMaterial.getBlockByName(\"RoughnessFactor\") as InputBlock).value = roughness;\r\n        })\r\n    }\r\n\r\n    public set roughnessTexture(roughnessTexture: Texture){\r\n        this._nodeMaterialPromise.then(() => {\r\n            (this._nodeMaterial.getBlockByName(\"RoughnessTexture\") as TextureBlock).texture = roughnessTexture;\r\n        })\r\n    }\r\n\r\n    public set emission(emission: number){\r\n        this._nodeMaterialPromise.then(() => {\r\n            (this._nodeMaterial.getBlockByName(\"EmissiveFactor\") as InputBlock).value = emission;\r\n        })\r\n    }\r\n\r\n    public set emissionColor(emissionColor: Color3){\r\n        this._nodeMaterialPromise.then(() => {\r\n            (this._nodeMaterial.getBlockByName(\"EmissiveColor\") as InputBlock).value = emissionColor;\r\n        })\r\n    }\r\n\r\n    public set emissionTexture(emissionTexture: Texture){\r\n        this._nodeMaterialPromise.then(() => {\r\n            (this._nodeMaterial.getBlockByName(\"EmissiveTexture\") as TextureBlock).texture = emissionTexture;\r\n        })\r\n    }\r\n\r\n    public set transparencyMode(transparencyMode: Nullable<number>){\r\n        this._nodeMaterialPromise.then(() => {\r\n            this._nodeMaterial.transparencyMode = transparencyMode;\r\n        })\r\n    }\r\n\r\n    public configureFromPBRMaterial(pbrMaterial: PBRMaterial){\r\n        this.albedoColor = pbrMaterial.albedoColor;\r\n        const albedoTexture = pbrMaterial.albedoTexture;\r\n        if(albedoTexture !== null){\r\n            this.albedoTexture = albedoTexture as Texture;\r\n        }\r\n\r\n        this.emission = pbrMaterial.emissiveIntensity;\r\n        const emissionTexture = pbrMaterial.emissiveTexture;\r\n        if(emissionTexture !== null){\r\n            this.emissionTexture = emissionTexture as Texture;\r\n        }\r\n        this.emissionColor = pbrMaterial.emissiveColor;\r\n\r\n        const metallic = pbrMaterial.metallic;\r\n        if(metallic !== null){\r\n            this.metallic = metallic;\r\n        }\r\n        const metallicTexture = pbrMaterial.metallicTexture;\r\n        if(metallicTexture !== null){\r\n            this.metallicTexture = metallicTexture as Texture;\r\n        }\r\n\r\n        const roughness = pbrMaterial.roughness;\r\n        if(roughness !== null){\r\n            this.roughness = roughness;\r\n        }\r\n\r\n        this.transparencyMode = pbrMaterial.transparencyMode;\r\n        this.indexOfRefraction = pbrMaterial.indexOfRefraction;\r\n\r\n        this._nodeMaterialPromise.then(() => {\r\n            this._nodeMaterial.backFaceCulling = pbrMaterial.backFaceCulling;\r\n            this._nodeMaterial.needDepthPrePass = pbrMaterial.needDepthPrePass;\r\n            this._nodeMaterial.cullBackFaces = pbrMaterial.cullBackFaces;\r\n            this._nodeMaterial.alpha = pbrMaterial.alpha;\r\n            this._nodeMaterial.alphaMode = pbrMaterial.alphaMode;\r\n            this._nodeMaterial.disableDepthWrite = pbrMaterial.disableDepthWrite;\r\n            this._nodeMaterial.disableColorWrite = pbrMaterial.disableColorWrite;\r\n            this._nodeMaterial.forceDepthWrite = pbrMaterial.forceDepthWrite;\r\n            this._nodeMaterial.depthFunction = pbrMaterial.depthFunction;\r\n        })\r\n\r\n\r\n    }\r\n\r\n}","import {DistanceConstraint, Observable, PhysicsBody, PhysicsConstraint, TransformNode, Vector3} from \"@babylonjs/core\";\r\nimport {Game} from \"@/YellowSubmarine/Game\";\r\nimport {TempleBall} from \"@/YellowSubmarine/temple/TempleBall\";\r\n\r\nexport class Grappler {\r\n\r\n    private static _instance: Grappler;\r\n\r\n    private _owner?: PhysicsBody;\r\n    private _grapplerLength = 1.5;\r\n    private _currentGrappledObject?: TempleBall;\r\n    private _localOffsetWithSubmarine: Vector3 = new Vector3(0, 0, -5);\r\n    private _pullingForce = 5;\r\n\r\n    public static get instance(): Grappler {\r\n        return this._instance;\r\n    }\r\n\r\n    constructor() {\r\n        Grappler._instance = this;\r\n        Game.scene.onBeforeRenderObservable.add(() => {\r\n            this.updateGrappledObject();\r\n        })\r\n    }\r\n\r\n    public grappleObject(object: TempleBall) {\r\n        if(this._currentGrappledObject) return;\r\n\r\n        this._currentGrappledObject = object;\r\n\r\n    }\r\n\r\n    public letGoOfObject() {\r\n        if(!this._currentGrappledObject) return;\r\n\r\n        this._currentGrappledObject = undefined;\r\n    }\r\n\r\n    public get grappledObject(): TempleBall | undefined {\r\n        return this._currentGrappledObject;\r\n    }\r\n\r\n    public get hasAnObjectGrappled(): boolean {\r\n        return this._currentGrappledObject !== undefined;\r\n    }\r\n\r\n    public get grapplerLength(): number {\r\n        return this._grapplerLength;\r\n    }\r\n\r\n    public set grapplerLength(length: number) {\r\n        this._grapplerLength = length;\r\n    }\r\n\r\n    public get owner(): PhysicsBody | undefined {\r\n        return this._owner;\r\n    }\r\n\r\n    public set owner(submarine: PhysicsBody | undefined) {\r\n        this._owner = submarine;\r\n    }\r\n\r\n    public get offset(): Vector3 {\r\n        return this._localOffsetWithSubmarine;\r\n    }\r\n\r\n    public set offset(offset: Vector3) {\r\n        this._localOffsetWithSubmarine = offset;\r\n    }\r\n\r\n    // -------------------------------------------------------------------------------------------------------------- //\r\n\r\n    private updateGrappledObject(){\r\n        if(this._currentGrappledObject !== undefined){\r\n            const parent = this._owner;\r\n            if(parent){\r\n                const positionWithOffset = parent.getObjectCenterWorld().add(this._localOffsetWithSubmarine.rotateByQuaternionToRef(parent.transformNode.absoluteRotationQuaternion, Vector3.Zero()));\r\n\r\n                const grappledObjectPosition = this._currentGrappledObject.physicsBody.getObjectCenterWorld();\r\n                const fromGrapplerToObject = grappledObjectPosition.subtract(positionWithOffset);\r\n                const distance = fromGrapplerToObject.length();\r\n                if(distance > this._grapplerLength){\r\n                    const pullingDirection = fromGrapplerToObject.normalizeToNew().scale(-1);\r\n                    this._currentGrappledObject.physicsBody.applyForce(pullingDirection.scale(this._pullingForce * (1 + (distance - this._grapplerLength)) ), grappledObjectPosition);\r\n                }\r\n\r\n            }\r\n\r\n        }\r\n    }\r\n\r\n}","import {\r\n    AbstractMesh,\r\n    CreateAudioEngineAsync,\r\n    CreateSoundAsync, ISoundOptions, SoundState,\r\n    StaticSound\r\n} from \"@babylonjs/core\";\r\nimport {Game} from \"@/YellowSubmarine/Game\";\r\nexport class SoundManager {\r\n\r\n    public static instance: SoundManager;\r\n    private _audioEngine;\r\n    private _SFXsounds = new Map<string, StaticSound>();\r\n    private _UIsounds = new Map<string, StaticSound>();\r\n    private _MUSICsounds = new Map<string, StaticSound>();\r\n\r\n    private _SFXVolume : number;\r\n    private _UIVolume : number;\r\n    private _MUSICVolume : number;\r\n\r\n\r\n    constructor() {\r\n        SoundManager.instance = this;\r\n        this._SFXVolume = 0.8;\r\n        this._UIVolume = 1;\r\n        this._MUSICVolume = 0;\r\n        Game.scene.headphone = true;\r\n        this._audioEngine = CreateAudioEngineAsync();\r\n        this._audioEngine.then((engine) => {\r\n            engine.unlockAsync();\r\n            Game.scene.onBeforeRenderObservable.add(() => {\r\n                if(Game.scene.activeCamera !== null) {\r\n                    engine.listener.position = Game.scene.activeCamera?.position;\r\n                }\r\n            });\r\n        });\r\n        Game.scene.onReadyObservable.add(() => {\r\n            this.playSFX(\"wind\", {\r\n                loop: true,\r\n                autoplay: true,\r\n            });\r\n        })\r\n        Game.scene.onReadyObservable.add(() => {\r\n            this.playMUSIC(\"ambiant\", {\r\n                loop: true,\r\n                autoplay: true,\r\n            });\r\n        })\r\n    }\r\n\r\n    private async load(name: string, url: string, options?: Partial<ISoundOptions>) {\r\n        return CreateSoundAsync(name, `${url}/${name}.wav`, options);\r\n    }\r\n\r\n    protected async play(name: string, url: string, map: Map<string, StaticSound>, volume: number, options?: Partial<ISoundOptions>, mesh?: AbstractMesh) {\r\n        const sound = map.get(name);\r\n        if(sound) {\r\n            if(sound.state !== SoundState.Started) {\r\n                this.fadeIn(sound, volume, 100);\r\n                sound.play();\r\n            }\r\n        }\r\n        else{\r\n            const sound = await this.load(name, url, options);\r\n            map.set(name, sound)\r\n            if (options?.spatialSound && mesh) {\r\n                sound.spatial.attach(mesh);\r\n                sound.spatial.maxDistance = options.maxDistance ?? 100;\r\n                sound.spatial.distanceModel = \"linear\";\r\n                console.log(sound.spatial);\r\n            }\r\n            this.fadeIn(sound, volume, 1000);\r\n            sound.play();\r\n        }\r\n    }\r\n\r\n    public async playSFX(name: string, options?: Partial<ISoundOptions>, mesh?: AbstractMesh) {\r\n        await this.play(name, \"sounds/sfx\", this._SFXsounds, this.SFXVolume, options, mesh);\r\n    }\r\n\r\n    public async playUI(name: string, options?: Partial<ISoundOptions>, mesh?: AbstractMesh) {\r\n        await this.play(name, \"sounds/ui\", this._UIsounds, this.UIVolume, options, mesh);\r\n    }\r\n\r\n    public async playMUSIC(name: string, options?: Partial<ISoundOptions>, mesh?: AbstractMesh) {\r\n        await this.play(name, \"sounds/music\", this._MUSICsounds, this.MUSICVolume, options, mesh);\r\n    }\r\n\r\n    private fadeIn(sound: StaticSound, targetVolume: number, duration: number) {\r\n        sound.volume = 0;\r\n        const stepTime = 20;\r\n        const steps = duration / stepTime;\r\n        let currentStep = 0;\r\n\r\n        const interval = setInterval(() => {\r\n            currentStep++;\r\n            const volume = targetVolume * (currentStep / steps);\r\n            sound.volume = Math.min(volume, targetVolume);\r\n            if (currentStep >= steps) clearInterval(interval);\r\n        }, stepTime);\r\n    }\r\n\r\n    private fadeOutAndStop(sound: StaticSound, duration: number) {\r\n        const stepTime = 20;\r\n        const steps = duration / stepTime;\r\n        let currentStep = 0;\r\n        const initialVolume = sound.volume;\r\n\r\n        const interval = setInterval(() => {\r\n            currentStep++;\r\n            const volume = initialVolume * (1 - currentStep / steps);\r\n            sound.volume = Math.max(volume, 0);\r\n            if (currentStep >= steps) {\r\n                clearInterval(interval);\r\n                sound.stop();\r\n            }\r\n        }, stepTime);\r\n    }\r\n\r\n    public stopSFX(name: string) {\r\n        const sound = this._SFXsounds.get(name);\r\n        if (sound) this.fadeOutAndStop(sound, 100);\r\n    }\r\n\r\n    public stopUI(name: string) {\r\n        const sound = this._UIsounds.get(name);\r\n        if (sound) this.fadeOutAndStop(sound, 100);\r\n    }\r\n\r\n    public stopMUSIC(name: string) {\r\n        const sound = this._MUSICsounds.get(name);\r\n        if (sound) this.fadeOutAndStop(sound, 100);\r\n    }\r\n\r\n    public stopAll(map : Map<string, StaticSound>) {\r\n        map.forEach(sound => {sound.stop()});\r\n    }\r\n\r\n    public get SFXVolume(): number {\r\n        return this._SFXVolume;\r\n    }\r\n\r\n    public set SFXVolume(value: number) {\r\n        this._SFXVolume = value;\r\n        this._SFXsounds.forEach((sound) => {\r\n            sound.volume = this._SFXVolume;\r\n        })\r\n    }\r\n\r\n    public get UIVolume(): number {\r\n        return this._UIVolume;\r\n    }\r\n\r\n    public set UIVolume(value: number) {\r\n        this._UIVolume = value;\r\n        this._UIsounds.forEach((sound) => {\r\n            sound.volume = this._UIVolume;\r\n        })\r\n    }\r\n\r\n    public get MUSICVolume(): number {\r\n        return this._MUSICVolume;\r\n    }\r\n\r\n    public set MUSICVolume(value: number) {\r\n        this._MUSICVolume = value;\r\n        this._MUSICsounds.forEach((sound) => {\r\n            sound.volume = this._MUSICVolume;\r\n        })\r\n    }\r\n}","import {\r\n    AbstractMesh, Color3, KeyboardEventTypes,\r\n    Mesh, MeshBuilder, PBRMaterial, PhysicsAggregate, PhysicsMotionType, PhysicsShapeType,\r\n    Scene,\r\n    SceneLoader, SpotLight, StandardMaterial, Texture,\r\n    Vector3, VolumetricLightScatteringPostProcess,\r\n} from \"@babylonjs/core\";\r\nimport {Game} from \"@/YellowSubmarine/Game\";\r\nimport \"@babylonjs/loaders/glTF\"\r\nimport {Player} from \"@/YellowSubmarine/Player\";\r\nimport {CartoonShaderMaterial} from \"@/YellowSubmarine/shader material/CartoonShaderMaterial\";\r\nimport {Grappler} from \"@/YellowSubmarine/grappling system/Grappler\";\r\nimport {TempleBall} from \"@/YellowSubmarine/temple/TempleBall\";\r\nimport {SoundManager} from \"@/YellowSubmarine/sound system/SoundManager\";\r\n\r\nexport class Submarine {\r\n    private _physicsAggregate?: PhysicsAggregate;\r\n\r\n    public get mesh(): AbstractMesh{\r\n        return this._mesh;\r\n    }\r\n\r\n    public static get instance(): Submarine {\r\n        return this._instance;\r\n    }\r\n\r\n    private static _instance: Submarine;\r\n    private _mesh!: AbstractMesh;\r\n\r\n    private _movementForce = 3000000;\r\n\r\n    private _rotationForce = 500000;\r\n    private _grappler: Grappler;\r\n\r\n    public meshCreationPromise: Promise<AbstractMesh>;\r\n\r\n    private _spotLight?: SpotLight;\r\n\r\n    constructor() {\r\n        Submarine._instance = this;\r\n        this._grappler = new Grappler();\r\n        this.meshCreationPromise = this.createMesh(Game.scene);\r\n        this.meshCreationPromise.then((mesh) => {\r\n            this._grappler.owner = mesh.physicsBody ?? undefined;\r\n            this._spotLight = this.createSpotlight();\r\n            this.addVolumetricLight();\r\n\r\n\r\n            const mapLimit = 1024;\r\n            Game.scene.onBeforeRenderObservable.add(() => {\r\n                if (!this._physicsAggregate) return;\r\n\r\n                const body = this._physicsAggregate.body;\r\n                const pos = body.transformNode.position.clone();\r\n\r\n                if (pos.x > mapLimit || pos.x < -mapLimit || pos.z > mapLimit || pos.z < -mapLimit) {\r\n                    body.setLinearVelocity(body.getLinearVelocity().negate());\r\n                    body.transformNode.position.copyFrom(pos);\r\n                }\r\n            });\r\n        });\r\n        Game.scene.onBeforeRenderObservable.add(() => {\r\n            this.update(/*Game.engine.getDeltaTime() / 1000*/);\r\n\r\n        });\r\n\r\n        const keysDown = new Set<string>();\r\n        Game.scene.onKeyboardObservable.add((eventData) => {\r\n            const key = eventData.event.key;\r\n            if (key === \"k\") {\r\n                if (eventData.type === KeyboardEventTypes.KEYDOWN) {\r\n                    if (!keysDown.has(key)) {\r\n                        keysDown.add(key);\r\n                        SoundManager.instance.playSFX(\"submarine_horn\", {\r\n                            loop : true\r\n                        }, this.mesh);\r\n                    }\r\n                } else if (eventData.type === KeyboardEventTypes.KEYUP) {\r\n                    keysDown.delete(key);\r\n                    SoundManager.instance.stopSFX(\"submarine_horn\");\r\n                }\r\n            }\r\n        });\r\n\r\n        Game.scene.onKeyboardObservable.add((eventData) => {\r\n            const key = eventData.event.key;\r\n            if(key === \"z\" || key === \"s\"){\r\n                if (eventData.type === KeyboardEventTypes.KEYDOWN) {\r\n                    if (!keysDown.has(key)) {\r\n                        keysDown.add(key);\r\n                        SoundManager.instance.playSFX(\"submarine\", {\r\n                            loop : true\r\n                        });\r\n                    }\r\n                } else if (eventData.type === KeyboardEventTypes.KEYUP) {\r\n                    keysDown.delete(key);\r\n                    SoundManager.instance.stopSFX(\"submarine\");\r\n                }\r\n            }\r\n        });\r\n\r\n        Game.scene.onKeyboardObservable.add( (eventData) => {\r\n            const state = eventData.type === KeyboardEventTypes.KEYDOWN;\r\n            if(eventData.event.key === \"l\" && state){\r\n                this._spotLight?.setEnabled(!this._spotLight?.isEnabled())\r\n            }\r\n        });\r\n    }\r\n\r\n    public get templeBall(): TempleBall | undefined {\r\n        return this._grappler.grappledObject;\r\n    }\r\n\r\n    public grabBall(ball: TempleBall): void {\r\n        this._grappler.grappleObject(ball);\r\n    }\r\n\r\n    public letGoOfBall(){\r\n        this._grappler.letGoOfObject();\r\n    }\r\n\r\n    private async createMesh(scene: Scene) {\r\n        const result = await SceneLoader.ImportMeshAsync(\"\", \"models/objects/\", \"submarine.glb\", scene);\r\n        const rootMesh = result.meshes[0] as Mesh;\r\n        const childMeshes = rootMesh.getChildMeshes<Mesh>();\r\n        for (const mesh of result.meshes) {\r\n            const mat = mesh.material as PBRMaterial;\r\n            if(mat){\r\n                const toonMat = new CartoonShaderMaterial();\r\n                await toonMat.assignMaterial(mesh).then(() => {\r\n                    toonMat.configureFromPBRMaterial(mat);\r\n                });\r\n            }\r\n        }\r\n        const mergedMesh = Mesh.MergeMeshes(childMeshes,true, undefined, undefined, undefined, true);\r\n        if(mergedMesh){\r\n            this._mesh = mergedMesh;\r\n            this._physicsAggregate = new PhysicsAggregate(this._mesh, PhysicsShapeType.BOX,{\r\n                mass: 1,\r\n                friction: 0,\r\n                restitution: 0,\r\n                mesh: mergedMesh,\r\n            }, Game.scene);\r\n            this._physicsAggregate.body.setMotionType(PhysicsMotionType.DYNAMIC);\r\n            this._physicsAggregate.body.setMassProperties({\r\n                inertia: new Vector3(0, 1, 0),\r\n                centerOfMass: this._mesh.absolutePosition,\r\n            });\r\n            this._physicsAggregate.body.setLinearDamping(1);\r\n            this._physicsAggregate.body.setAngularDamping(1);\r\n            this._physicsAggregate.body.getCollisionObservable();\r\n\r\n            this._mesh.name = \"submarine\";\r\n            this._mesh.position = new Vector3(0, 0, 0);\r\n        }\r\n        this.mesh.receiveShadows = true;\r\n        return this._mesh;\r\n    }\r\n\r\n\r\n    private createSpotlight() {\r\n        const spotLight = new SpotLight(\"spotLight\",\r\n            new Vector3(0, 0, 0),\r\n            new Vector3(0, 0, 1),\r\n            Math.PI / 3,\r\n            2,\r\n            Game.scene\r\n        );\r\n        spotLight.diffuse = new Color3(1, 1, 1);\r\n        spotLight.specular = new Color3(1, 1, 1);\r\n        spotLight.intensity = 5000;\r\n        spotLight.parent = this._mesh;\r\n        spotLight.setEnabled(false);\r\n\r\n        this._spotLight = spotLight;\r\n        Game.scene.onKeyboardObservable.add((eventData) => {\r\n            const state = eventData.type === KeyboardEventTypes.KEYDOWN;\r\n            if (eventData.event.key === \"l\" && state) {\r\n                const enabled = !this._spotLight?.isEnabled();\r\n                this._spotLight?.setEnabled(enabled);\r\n            }\r\n        });\r\n\r\n        return spotLight;\r\n    }\r\n\r\n    private addVolumetricLight() {\r\n        const camera = Game.scene.activeCamera!;\r\n\r\n        const lightEmitter = MeshBuilder.CreateSphere(\"lightEmitter\", {diameter: 0.8}, Game.scene);\r\n        const vl = new VolumetricLightScatteringPostProcess(\"vls\", 1.0, camera, lightEmitter);\r\n        lightEmitter.position = new Vector3(0, 0, 2.3);\r\n        lightEmitter.parent = this._mesh;\r\n\r\n        const mat = new StandardMaterial(\"lightMat\", Game.scene);\r\n        mat.emissiveTexture = new Texture(\"textures/lensflare/lens5.png\", Game.scene);\r\n        mat.diffuseColor = new Color3(0, 0, 0);\r\n        mat.specularColor = new Color3(0, 0, 0);\r\n        mat.emissiveColor = new Color3(1, 1, 1);\r\n        mat.alpha = 0.8;\r\n        lightEmitter.material = mat;\r\n\r\n        vl.mesh = lightEmitter;\r\n\r\n        vl.exposure = 1;\r\n        vl.decay = 0.96815;\r\n        vl.weight = 0.4;\r\n        vl.density = 0.99;\r\n\r\n        lightEmitter.setEnabled(false);\r\n\r\n        Game.scene.onKeyboardObservable.add((eventData) => {\r\n            const state = eventData.type === KeyboardEventTypes.KEYDOWN;\r\n            if (eventData.event.key === \"l\" && state) {\r\n                lightEmitter.setEnabled(!lightEmitter.isEnabled());\r\n            }\r\n        });\r\n    }\r\n\r\n    private update() {\r\n        this.updateRotationSpeed();\r\n        this.updateMovementSpeed();\r\n    }\r\n\r\n    private updateMovementSpeed() {\r\n            if (!this._physicsAggregate) return;\r\n\r\n            const body = this._physicsAggregate.body;\r\n\r\n            let direction = 0;\r\n            if (this.isForwardPressed()) direction += 1;\r\n            if (this.isBackwardPressed()) direction -= 1;\r\n\r\n            if (direction === 0) return;\r\n\r\n            body.applyForce(this._mesh.forward.scale(direction * this._movementForce), body.getObjectCenterWorld() );\r\n\r\n        }\r\n\r\n    private updateRotationSpeed() {\r\n            if (!this._physicsAggregate) return;\r\n\r\n            const body = this._physicsAggregate.body;\r\n\r\n            let direction = 0;\r\n            if (this.isRightPressed()) direction += 1;\r\n            if (this.isLeftPressed()) direction -= 1;\r\n\r\n            if(direction == 0) return;\r\n\r\n            body.applyForce(this._mesh.right.scale(direction * this._rotationForce), body.getObjectCenterWorld().add(this._mesh.forward));\r\n\r\n        }\r\n\r\n\r\n    private isForwardPressed() {\r\n        return Player.isMoveForwardPressed();\r\n    }\r\n\r\n    private isBackwardPressed() {\r\n        return Player.isMoveBackwardPressed();\r\n    }\r\n\r\n    private isRightPressed() {\r\n        return Player.isTurnRightPressed();\r\n    }\r\n\r\n    private isLeftPressed() {\r\n        return Player.isTurnLeftPressed();\r\n    }\r\n\r\n\r\n}","import {MeshDetectionZone} from \"@/YellowSubmarine/detection system/MeshDetectionZone\";\r\nimport {AbstractMesh, Observable, PhysicsAggregate} from \"@babylonjs/core\";\r\nimport {World} from \"@/YellowSubmarine/World\";\r\n\r\nexport class KeyZone {\r\n\r\n    private  _name!: string;\r\n    private _detectionZone!: MeshDetectionZone;\r\n    private  _discovered = false;\r\n    private  _disabled = false;\r\n    private _mesh!:AbstractMesh;\r\n    private _physicsAggregate?: PhysicsAggregate;\r\n\r\n    public static onAnyKeyZoneEntered: Observable<KeyZone> = new Observable();\r\n\r\n\r\n    public set name(value: string) {\r\n        this._name = value;\r\n    }\r\n    public get name(): string {\r\n        return this._name;\r\n    }\r\n\r\n\r\n    public set discovered(value: boolean) {\r\n        this._discovered = value;\r\n    }\r\n    public get discovered(): boolean {\r\n        return this._discovered;\r\n    }\r\n\r\n\r\n    public set detectionZone(value: MeshDetectionZone) {\r\n        this._detectionZone = value;\r\n        this.detectionZone.onMeshEnter.add( () => {\r\n            KeyZone.onAnyKeyZoneEntered.notifyObservers(this);\r\n            this.discovered = true;\r\n        });\r\n    }\r\n    public get detectionZone(): MeshDetectionZone {\r\n        return this._detectionZone;\r\n    }\r\n\r\n\r\n    public set disabled(value: boolean) {\r\n        this._disabled = value;\r\n    }\r\n    public get disabled():boolean {\r\n        return this._disabled;\r\n    }\r\n\r\n    public set mesh(value: AbstractMesh) {\r\n        this._mesh = value;\r\n        this._detectionZone.zone.parent = this._mesh;\r\n        World.submarine.meshCreationPromise.then((mesh: AbstractMesh) => {\r\n            this.detectionZone.addMeshToDetect(mesh);\r\n        });\r\n    }\r\n    public get mesh() {\r\n        return this._mesh;\r\n    }\r\n\r\n    public get physicsAggregate(): PhysicsAggregate | undefined {\r\n        return this._physicsAggregate;\r\n    }\r\n\r\n    public set physicsAggregate(physicsAggregate: PhysicsAggregate | undefined){\r\n        this._physicsAggregate = physicsAggregate;\r\n    }\r\n\r\n}","import {AbstractMesh, Observable} from \"@babylonjs/core\";\r\nimport {Game} from \"@/YellowSubmarine/Game\";\r\n\r\nexport class MeshDetectionZone {\r\n\r\n    private _zone : AbstractMesh\r\n    public onMeshEnter : Observable<AbstractMesh>;\r\n    public onMeshExit : Observable<AbstractMesh>;\r\n    private _meshToDetect : Map<AbstractMesh, boolean>;\r\n\r\n    public get zone(): AbstractMesh {\r\n        return this._zone;\r\n    }\r\n\r\n    constructor(zone : AbstractMesh, debug ?: boolean) {\r\n        this._zone = zone;\r\n        this._zone.visibility = debug ? 0.5 : 0;\r\n        this._meshToDetect = new Map<AbstractMesh, boolean>();\r\n        this.onMeshEnter = new Observable<AbstractMesh>();\r\n        this.onMeshExit = new Observable<AbstractMesh>();\r\n        Game.scene.onBeforeRenderObservable.add(() => this.checkAll());\r\n    }\r\n\r\n    public addMeshToDetect(mesh : AbstractMesh) : void {\r\n        this._meshToDetect.set(mesh, false);\r\n        this.checkAll();\r\n    }\r\n\r\n    public isInZone(mesh: AbstractMesh): boolean {\r\n        return this._zone.intersectsMesh(mesh, true);\r\n    }\r\n\r\n    private checkDetection(mesh : AbstractMesh) : boolean {\r\n        const state = this._zone.intersectsMesh(mesh, true);\r\n        if (state !== this._meshToDetect.get(mesh)) {\r\n            if(state) this.onMeshEnter.notifyObservers(mesh);\r\n            else this.onMeshExit.notifyObservers(mesh);\r\n            this._meshToDetect.set(mesh, state);\r\n        }\r\n        return state;\r\n    }\r\n\r\n    private checkAll(){\r\n        this._meshToDetect.forEach((state, mesh) => {this.checkDetection(mesh)})\r\n    }\r\n\r\n}","import {MeshDetectionZone} from \"@/YellowSubmarine/detection system/MeshDetectionZone\";\r\nimport {MeshBuilder, Vector4} from \"@babylonjs/core\";\r\n\r\nexport class SphericalDetectionZone extends MeshDetectionZone {\r\n\r\n    constructor(options ?: {segments?: number, diameter?: number,\r\n        diameterX?: number, diameterY?: number, diameterZ?: number, arc?: number,\r\n        slice?: number, sideOrientation?: number, frontUVs?: Vector4,\r\n        backUVs?: Vector4, updatable?: boolean}, debug ?: boolean) {\r\n\r\n        const mesh = MeshBuilder.CreateSphere(\"\", options);\r\n        super(mesh, debug);\r\n    }\r\n}","import {AbstractInteraction} from \"@/YellowSubmarine/interaction system/interactions/AbstractInteraction\";\r\nimport {AbstractMesh} from \"@babylonjs/core\";\r\n\r\nexport abstract class WorldInteraction extends AbstractInteraction{\r\n\r\n    public abstract get description(): string\r\n\r\n    public abstract get mesh():AbstractMesh | undefined;\r\n\r\n}","import {Conversation} from \"@/YellowSubmarine/dialogue system/Conversation\";\r\nimport {WorldInteraction} from \"@/YellowSubmarine/interaction system/interactions/WorldInteraction\";\r\nimport {AbstractMesh} from \"@babylonjs/core\";\r\n\r\nexport class StartConversationInteraction extends WorldInteraction{\r\n\r\n    public get description(): string {\r\n        return `Talk`;\r\n    }\r\n\r\n    constructor(private _conversation: Conversation) {\r\n        super(\"KeyE\", \"E\");\r\n    }\r\n\r\n    executeInteraction(): void {\r\n        this._conversation.startConversation();\r\n    }\r\n\r\n    get mesh(): AbstractMesh | undefined {\r\n        return this._conversation.conversationProvider?.mesh;\r\n    }\r\n\r\n}","import {AbstractMesh, TransformNode} from \"@babylonjs/core\";\r\nimport {Conversation} from \"@/YellowSubmarine/dialogue system/Conversation\";\r\nimport {MeshDetectionZone} from \"@/YellowSubmarine/detection system/MeshDetectionZone\";\r\nimport {\r\n    StartConversationInteraction\r\n} from \"@/YellowSubmarine/dialogue system/interactions/StartConversationInteraction\";\r\nimport {World} from \"@/YellowSubmarine/World\";\r\nimport {CameraConfiguration} from \"@/YellowSubmarine/camera system/CameraConfiguration\";\r\nimport {IConversationProvider} from \"@/YellowSubmarine/dialogue system/IConversationProvider\";\r\n\r\nexport class NPC implements IConversationProvider {\r\n\r\n    private _name = \"undefined\";\r\n    private _mesh?: AbstractMesh;\r\n    private _conversation?: Conversation;\r\n    private _startConversationInteraction?: StartConversationInteraction;\r\n    private _playerDetectionZone?: MeshDetectionZone;\r\n    private _cameraConfiguration?: CameraConfiguration;\r\n\r\n    private _transformNode: TransformNode = new TransformNode(\"npcTransform\");\r\n\r\n    public get name(): string {\r\n        return this._name;\r\n    }\r\n    public set name(value: string) {\r\n        this._name = value;\r\n    }\r\n\r\n    public set mesh(value: AbstractMesh | undefined) {\r\n        this._mesh = value;\r\n        if(this._mesh) {\r\n            this._mesh.parent = this._transformNode;\r\n        }\r\n    }\r\n    public get mesh(): AbstractMesh | undefined {\r\n        return this._mesh;\r\n    }\r\n\r\n\r\n    public get cameraConfiguration(): CameraConfiguration | undefined{\r\n        return this._cameraConfiguration;\r\n    }\r\n    public set cameraConfiguration(value: CameraConfiguration | undefined) {\r\n        this._cameraConfiguration = value;\r\n    }\r\n\r\n    public set transformNode(value: TransformNode) {\r\n        this._transformNode = value;\r\n    }\r\n\r\n    public get transformNode(): TransformNode {\r\n        return this._transformNode;\r\n    }\r\n\r\n\r\n    public set detectionZone(value: MeshDetectionZone | undefined ) {\r\n        this._playerDetectionZone = value;\r\n        if(this._playerDetectionZone) {\r\n            this._playerDetectionZone.zone.parent = this._transformNode;\r\n            this.setSignals();\r\n        }\r\n    }\r\n    public get detectionZone(): MeshDetectionZone | undefined {\r\n        return this._playerDetectionZone;\r\n    }\r\n\r\n    public get conversation(): Conversation | undefined {\r\n        return this._conversation;\r\n    }\r\n\r\n    public set conversation(conversation: Conversation | undefined) {\r\n        if(conversation !== undefined) {\r\n            this._startConversationInteraction = new StartConversationInteraction(conversation);\r\n            this._conversation = conversation;\r\n            this._conversation.conversationProvider = this;\r\n\r\n            this._conversation?.onConversationEnd.add( () =>  {\r\n                if(this._playerDetectionZone?.isInZone(World.submarine.mesh)){\r\n                    this._startConversationInteraction?.makeAvailable();\r\n                }\r\n            });\r\n\r\n        }\r\n        else{\r\n            this._startConversationInteraction = undefined;\r\n            if(this._conversation){\r\n                this._conversation.conversationProvider = undefined;\r\n            }\r\n            this._conversation = undefined;\r\n        }\r\n    }\r\n\r\n    private setSignals(): void {\r\n        if(this._playerDetectionZone){\r\n            this._playerDetectionZone.onMeshEnter.add( () => {\r\n                if(this._startConversationInteraction && !this._conversation?.isInProgress()){\r\n                    this._startConversationInteraction.makeAvailable();\r\n                }\r\n            } );\r\n\r\n            this._playerDetectionZone.onMeshExit.add( () => {\r\n                if(this._startConversationInteraction){\r\n                    this._startConversationInteraction.makeUnavailable();\r\n                }\r\n            } );\r\n\r\n            World.submarine.meshCreationPromise.then((mesh: AbstractMesh) => {\r\n                if(this._playerDetectionZone){\r\n                    this._playerDetectionZone.addMeshToDetect(mesh);\r\n                }\r\n            });\r\n\r\n        }\r\n    }\r\n}","import {MeshDetectionZone} from \"@/YellowSubmarine/detection system/MeshDetectionZone\";\r\nimport {Color4, MeshBuilder, Vector4} from \"@babylonjs/core\";\r\n\r\nexport class CylindricalDetectionZone extends MeshDetectionZone {\r\n\r\n    constructor(options ?: {height?: number, diameterTop?: number, diameterBottom?: number, diameter?: number,\r\n        tessellation?: number, subdivisions?: number, arc?: number,\r\n        faceColors?: Color4[], faceUV?: Vector4[], updatable?: boolean,\r\n        hasRings?: boolean, enclose?: boolean, cap?: number, sideOrientation?: number,\r\n        frontUVs?: Vector4, backUVs?: Vector4}, debug ?: boolean) {\r\n\r\n        const mesh = MeshBuilder.CreateCylinder(\"\", options);\r\n        super(mesh, debug);\r\n    }\r\n}","export abstract class AbstractDialogueNode {\r\n\r\n    private _text = \"\";\r\n    private _nextNode: AbstractDialogueNode | undefined = undefined;\r\n\r\n    public get text() : string {\r\n        return this._text;\r\n    }\r\n\r\n    public set text(text: string) {\r\n        this._text = text;\r\n    }\r\n\r\n    public set nextNode(value: AbstractDialogueNode | undefined) {\r\n        this._nextNode = value;\r\n    }\r\n\r\n    public get nextNode(): AbstractDialogueNode | undefined {\r\n        return this._nextNode;\r\n    }\r\n\r\n    public abstract execute(): void;\r\n\r\n}","import {AbstractDialogueNode} from \"@/YellowSubmarine/dialogue system/nodes/AbstractDialogueNode\";\r\n\r\nexport class SimpleDialogueNode extends AbstractDialogueNode{\r\n\r\n    execute(): void {return;}\r\n\r\n}","import {Conversation} from \"@/YellowSubmarine/dialogue system/Conversation\";\r\nimport {SimpleDialogueNode} from \"@/YellowSubmarine/dialogue system/nodes/SimpleDialogueNode\";\r\n\r\nexport class ConversationBuilder {\r\n    private root?: SimpleDialogueNode;\r\n    private current?: SimpleDialogueNode;\r\n    private _onEnding?: () => void;\r\n\r\n    public say(text: string): ConversationBuilder {\r\n        const node = new SimpleDialogueNode();\r\n        node.text = text;\r\n\r\n        if (!this.root) {\r\n            this.root = node;\r\n        } else if (this.current) {\r\n            this.current.nextNode = node;\r\n        }\r\n\r\n        this.current = node;\r\n        return this;\r\n    }\r\n\r\n    public then(text: string): ConversationBuilder {\r\n        return this.say(text);\r\n    }\r\n\r\n    public build(): Conversation {\r\n        const conversation = new Conversation();\r\n        if(this._onEnding) conversation.onEnding = this._onEnding;\r\n        if (this.root) {\r\n            conversation.root = this.root;\r\n        }\r\n        return conversation;\r\n    }\r\n\r\n    public setOnEnding(value: () => void): ConversationBuilder {\r\n        this._onEnding = value;\r\n        return this;\r\n    }\r\n}\r\n","import {QuestStep} from \"@/YellowSubmarine/quest system/QuestStep\";\r\n\r\nexport type QuestState = 'inactive' | 'active' | 'completed';\r\n\r\nexport class Quest{\r\n\r\n    private _id: string;\r\n    private _name: string;\r\n    private _state: QuestState;\r\n    private _currentStepIndex: number;\r\n    private _steps: QuestStep[];\r\n\r\n    public get id(): string {\r\n        return this._id;\r\n    }\r\n\r\n    public set id(value: string) {\r\n        this._id = value;\r\n    }\r\n\r\n    public get name(): string {\r\n        return this._name;\r\n    }\r\n\r\n    public set name(value: string) {\r\n        this._name = value;\r\n    }\r\n\r\n    public get state(): QuestState {\r\n        return this._state;\r\n    }\r\n\r\n    public set state(value: QuestState) {\r\n        this._state = value;\r\n    }\r\n\r\n    public get currentStepIndex(): number {\r\n        return this._currentStepIndex;\r\n    }\r\n\r\n    public set currentStepIndex(value: number) {\r\n        this._currentStepIndex = value;\r\n    }\r\n\r\n    public get steps(): QuestStep[] {\r\n        return this._steps;\r\n    }\r\n\r\n    public set steps(value: QuestStep[]) {\r\n        this._steps = value;\r\n    }\r\n\r\n    constructor(id: string, name: string, state: QuestState, currentStepIndex: number) {\r\n        this._id = id;\r\n        this._name = name;\r\n        this._state = state;\r\n        this._currentStepIndex = currentStepIndex;\r\n        this._steps = []\r\n    }\r\n\r\n    public startQuest() {\r\n        this._state = \"active\";\r\n        console.log(`Qute \"${this._name}\" commence`);\r\n    }\r\n\r\n    public stopQuest() {\r\n        this._state = \"completed\";\r\n        console.log(`Qute \"${this._name}\" fini`);\r\n    }\r\n\r\n    public nextStep() {\r\n        if(this._currentStepIndex === this._steps.length - 1){\r\n            this.stopQuest();\r\n        }\r\n        else {\r\n            this._currentStepIndex++;\r\n            console.log(`Qute \"${this._name}\" passe  l'tape suivante`)\r\n        }\r\n    }\r\n\r\n    public updateCurrentStepStatus() {\r\n        this._steps[this._currentStepIndex].validate();\r\n    }\r\n}\r\n","export class QuestStep {\r\n\r\n    public description: string;\r\n    public condition: boolean;\r\n\r\n    constructor(description: string) {\r\n        this.description = description;\r\n        this.condition = false;\r\n    }\r\n\r\n    public validate(){\r\n        this.condition = true;\r\n    }\r\n}","import {WorldInteraction} from \"@/YellowSubmarine/interaction system/interactions/WorldInteraction\";\r\nimport {Socle} from \"@/YellowSubmarine/temple/Socle\";\r\nimport {AbstractMesh} from \"@babylonjs/core\";\r\nimport {Submarine} from \"@/YellowSubmarine/Submarine\";\r\n\r\nexport class RemoveTempleBallInteraction extends WorldInteraction{\r\n\r\n    public constructor(private _socle: Socle) {\r\n        super(\"KeyF\", \"F\");\r\n    }\r\n\r\n    public get description(): string {\r\n        return \"Remove\";\r\n    }\r\n\r\n    executeInteraction(): void {\r\n        const templeBall = this._socle.currentBall;\r\n        if(templeBall && !Submarine.instance.templeBall){\r\n            this._socle.letGoOfBall();\r\n            Submarine.instance.grabBall(templeBall);\r\n            console.log(\"REMOVING THE BALL !!!\")\r\n        }\r\n    }\r\n\r\n    public get mesh(): AbstractMesh | undefined {\r\n        return this._socle.mesh;\r\n    }\r\n\r\n\r\n\r\n}","import {WorldInteraction} from \"@/YellowSubmarine/interaction system/interactions/WorldInteraction\";\r\nimport {Socle} from \"@/YellowSubmarine/temple/Socle\";\r\nimport {AbstractMesh} from \"@babylonjs/core\";\r\nimport {Submarine} from \"@/YellowSubmarine/Submarine\";\r\n\r\nexport class PlaceTempleBallInteraction extends WorldInteraction{\r\n\r\n    public constructor(private _socle: Socle) {\r\n        super(\"KeyF\", \"F\");\r\n    }\r\n\r\n    public get description(): string {\r\n        return \"Place\";\r\n    }\r\n\r\n    executeInteraction(): void {\r\n        const templeBall = Submarine.instance.templeBall;\r\n        if(templeBall) {\r\n            console.log(\"PLACING THE BALL !!!\", templeBall);\r\n            this._socle.placeBall(templeBall);\r\n            Submarine.instance.letGoOfBall();\r\n        }\r\n    }\r\n\r\n    public get mesh(): AbstractMesh | undefined {\r\n        return this._socle.mesh;\r\n    }\r\n\r\n}","import {\r\n    AbstractMesh,\r\n    Color3,\r\n    ImportMeshAsync, ISceneLoaderAsyncResult, LockConstraint,\r\n    Mesh,\r\n    PhysicsBody,\r\n    PhysicsMotionType,\r\n    PhysicsShape,\r\n    PhysicsShapeType, TransformNode, Vector3\r\n} from \"@babylonjs/core\";\r\nimport {MeshDetectionZone} from \"@/YellowSubmarine/detection system/MeshDetectionZone\";\r\nimport {Game} from \"@/YellowSubmarine/Game\";\r\nimport {SphericalDetectionZone} from \"@/YellowSubmarine/detection system/SphericalDetectionZone\";\r\nimport {Submarine} from \"@/YellowSubmarine/Submarine\";\r\nimport {TempleBall} from \"@/YellowSubmarine/temple/TempleBall\";\r\nimport {RemoveTempleBallInteraction} from \"@/YellowSubmarine/temple/interaction/RemoveTempleBallInteraction\";\r\nimport {PlaceTempleBallInteraction} from \"@/YellowSubmarine/temple/interaction/PlaceTempleBallInteraction\";\r\nimport {CellMaterial} from \"@babylonjs/materials\";\r\n\r\nexport class Socle{\r\n    public get currentBall(): TempleBall | undefined{\r\n        return this._currentBall;\r\n    }\r\n    public get mesh(): AbstractMesh {\r\n        return this._mesh;\r\n    }\r\n\r\n    private _transformNode: TransformNode = new TransformNode(\"socle\");\r\n    private _ballTransformNode: TransformNode = new TransformNode(\"ballPosition\");\r\n    private _mesh!: AbstractMesh;\r\n    private _material: CellMaterial;\r\n    private _socleDetectionZone: MeshDetectionZone;\r\n    private _validColor?: Color3;\r\n    private _currentBall?: TempleBall;\r\n    private _lockConstraint?: LockConstraint;\r\n    private _placeTempleBallInteraction: PlaceTempleBallInteraction;\r\n    private _removeTempleBallInteraction: RemoveTempleBallInteraction;\r\n\r\n    public readonly meshImportedPromise: Promise<void | ISceneLoaderAsyncResult>;\r\n\r\n    public constructor(parent: TransformNode, position: Vector3) {\r\n\r\n        this._material = new CellMaterial(\"socleMat\");\r\n        this._material.diffuseColor = new Color3(0.3,0.3,0.3);\r\n        this._transformNode.parent = parent;\r\n        this._transformNode.position = position;\r\n        this._ballTransformNode.parent = this._transformNode;\r\n        this._ballTransformNode.position = Vector3.Up().scale(5);\r\n        this._placeTempleBallInteraction = new PlaceTempleBallInteraction(this);\r\n        this._removeTempleBallInteraction = new RemoveTempleBallInteraction(this);\r\n\r\n\r\n        this._socleDetectionZone = new SphericalDetectionZone({\r\n            diameter: 8,\r\n        }, false);\r\n\r\n        Submarine.instance.meshCreationPromise.then((mesh) => {\r\n            this._socleDetectionZone?.addMeshToDetect(mesh);\r\n        });\r\n\r\n        this._socleDetectionZone.onMeshEnter.add(() => {\r\n            this.makeInteractionAvailable();\r\n        });\r\n\r\n        this._socleDetectionZone.onMeshExit.add(() => {\r\n            this.makeInteractionUnavailable();\r\n        });\r\n\r\n        this.meshImportedPromise = ImportMeshAsync(\"models/objects/socle.glb\", Game.scene).then((result) => {\r\n            this._mesh = result.meshes[1];\r\n            this._mesh.parent = this._transformNode;\r\n            this._mesh.material = this._material;\r\n            const physicsBody = new PhysicsBody(this._mesh, PhysicsMotionType.STATIC, false, Game.scene);\r\n            const physicsShape = new PhysicsShape({\r\n                type: PhysicsShapeType.MESH,\r\n                parameters:{\r\n                    mesh: this._mesh as Mesh\r\n                },\r\n            }, Game.scene);\r\n            physicsBody.shape = physicsShape;\r\n\r\n            this._socleDetectionZone.zone.parent = this._mesh;\r\n        });\r\n\r\n    }\r\n\r\n    public placeBall(ball: TempleBall) {\r\n        this._currentBall = ball;\r\n        this._lockConstraint = new LockConstraint(Vector3.Zero(), Vector3.Up().scale(4), Vector3.Up(), Vector3.Down(), Game.scene);\r\n        this._mesh.physicsBody?.addConstraint(ball.physicsBody, this._lockConstraint);\r\n        this._currentBall.socle = this;\r\n        this._material.diffuseColor = new Color3(5,5,5);\r\n    }\r\n\r\n    public letGoOfBall(){\r\n        if(this._currentBall){\r\n            this._currentBall = undefined;\r\n            this._lockConstraint?.dispose();\r\n            this._material.diffuseColor = new Color3(0.3,0.3,0.3);\r\n        }\r\n    }\r\n\r\n    public get validColor(): Color3 | undefined {\r\n        return this._validColor;\r\n    }\r\n\r\n    public set validColor(value: Color3 | undefined) {\r\n        this._validColor = value;\r\n    }\r\n\r\n    public get transformNode(): TransformNode {\r\n        return this._transformNode;\r\n    }\r\n\r\n    private makeInteractionAvailable(){\r\n        this._placeTempleBallInteraction.makeUnavailable();\r\n        this._removeTempleBallInteraction.makeUnavailable();\r\n        if(this._currentBall && !Submarine.instance.templeBall){\r\n            this._removeTempleBallInteraction.makeAvailable();\r\n        }\r\n        else if(!this._currentBall && Submarine.instance.templeBall){\r\n            this._placeTempleBallInteraction.makeAvailable();\r\n        }\r\n    }\r\n\r\n    private makeInteractionUnavailable(){\r\n        this._placeTempleBallInteraction.makeUnavailable();\r\n        this._removeTempleBallInteraction.makeUnavailable();\r\n    }\r\n\r\n}","import {WorldInteraction} from \"@/YellowSubmarine/interaction system/interactions/WorldInteraction\";\r\nimport {TempleBall} from \"@/YellowSubmarine/temple/TempleBall\";\r\nimport {AbstractMesh} from \"@babylonjs/core\";\r\nimport {Grappler} from \"@/YellowSubmarine/grappling system/Grappler\";\r\n\r\nexport class GrappleInteraction extends WorldInteraction{\r\n\r\n    public constructor(private _grabbableObject: TempleBall) {\r\n        super(\"KeyF\", \"F\");\r\n    }\r\n\r\n    public get grabbableObject(): TempleBall {\r\n        return this._grabbableObject;\r\n    }\r\n\r\n    public set grabbableObject(value: TempleBall) {\r\n        this._grabbableObject = value;\r\n    }\r\n\r\n    public get description(): string {\r\n        return \"Grapple\";\r\n    }\r\n\r\n    public executeInteraction(): void {\r\n        Grappler.instance.grappleObject(this._grabbableObject);\r\n        this.makeUnavailable();\r\n    }\r\n\r\n    public get mesh(): AbstractMesh | undefined {\r\n        return this._grabbableObject.mesh;\r\n    }\r\n\r\n\r\n}","import {SphericalDetectionZone} from \"@/YellowSubmarine/detection system/SphericalDetectionZone\";\r\nimport {GrappleInteraction} from \"@/YellowSubmarine/grappling system/interaction/GrappleInteraction\";\r\nimport {\r\n    AbstractMesh, Color3,\r\n    MeshBuilder, Observable,\r\n    PhysicsBody,\r\n    PhysicsMotionType,\r\n    PhysicsShape,\r\n    PhysicsShapeType, Vector3\r\n} from \"@babylonjs/core\";\r\nimport {Submarine} from \"@/YellowSubmarine/Submarine\";\r\nimport {Game} from \"@/YellowSubmarine/Game\";\r\nimport {Grappler} from \"@/YellowSubmarine/grappling system/Grappler\";\r\nimport {Socle} from \"@/YellowSubmarine/temple/Socle\";\r\nimport {CellMaterial} from \"@babylonjs/materials\";\r\nimport {TemplePuzzle} from \"@/YellowSubmarine/temple/TemplePuzzle\";\r\n\r\nexport class TempleBall {\r\n    private _detectionZone: SphericalDetectionZone;\r\n    private _grappleInteraction: GrappleInteraction;\r\n    private _mesh: AbstractMesh;\r\n    private _physicsBody: PhysicsBody;\r\n    private _physicsShape: PhysicsShape;\r\n    private _socle?: Socle;\r\n\r\n    public static onAnyBallPlacedOnAnySocle = new Observable<{ball: TempleBall, socle: Socle}>();\r\n    public onPlacedOnSocle = new Observable<Socle>();\r\n\r\n    public get mesh(): AbstractMesh {\r\n        return this._mesh;\r\n    }\r\n\r\n    public get physicsBody(): PhysicsBody {\r\n        return this._physicsBody;\r\n    }\r\n\r\n    public get socle(): Socle | undefined {\r\n        return this._socle;\r\n    }\r\n\r\n    public set socle(socle: Socle | undefined) {\r\n        this._socle = socle;\r\n        if(socle){\r\n            this.onPlacedOnSocle.notifyObservers(socle);\r\n        }\r\n    }\r\n\r\n    public constructor(position: Vector3, public readonly color: Color3) {\r\n        TemplePuzzle.registerBall(this);\r\n        this.onPlacedOnSocle.add((s) => TempleBall.onAnyBallPlacedOnAnySocle.notifyObservers({ball: this, socle: s}));\r\n        this._mesh = MeshBuilder.CreateSphere(\"templeBall\", {\r\n            diameter: 2,\r\n        });\r\n        this._mesh.position = position;\r\n        this._physicsShape = new PhysicsShape({\r\n            type: PhysicsShapeType.SPHERE,\r\n            parameters: {\r\n                radius: 1,\r\n            }\r\n        }, Game.scene);\r\n        const cellMaterial = new CellMaterial(\"templeBallMaterial\");\r\n        cellMaterial.diffuseColor = color;\r\n        this._mesh.material = cellMaterial;\r\n        this._physicsBody = new PhysicsBody(this._mesh, PhysicsMotionType.DYNAMIC, false, Game.scene);\r\n        this._physicsBody.shape = this._physicsShape;\r\n        this._physicsBody.setLinearDamping(1);\r\n        this._physicsBody.setMassProperties({\r\n            mass: 0.5,\r\n        });\r\n\r\n        this._grappleInteraction = new GrappleInteraction(this);\r\n        this._detectionZone = new SphericalDetectionZone({\r\n            diameter: 4,\r\n        },false);\r\n        this._detectionZone.zone.parent = this._mesh;\r\n        Submarine.instance.meshCreationPromise.then((mesh) => {\r\n           this._detectionZone.addMeshToDetect(mesh);\r\n        });\r\n        this._detectionZone.onMeshEnter.add(() => {\r\n            if(Grappler.instance.hasAnObjectGrappled || this._socle) return\r\n\r\n            this._grappleInteraction.makeAvailable();\r\n        })\r\n        this._detectionZone.onMeshExit.add(() => {\r\n            this._grappleInteraction.makeUnavailable();\r\n        })\r\n    }\r\n\r\n\r\n\r\n\r\n}","import {Angle, Color3, Observable, TransformNode, Vector3} from \"@babylonjs/core\";\r\nimport {Socle} from \"@/YellowSubmarine/temple/Socle\";\r\nimport {TempleBall} from \"@/YellowSubmarine/temple/TempleBall\";\r\nimport {CameraConfiguration} from \"@/YellowSubmarine/camera system/CameraConfiguration\";\r\nimport {MeshDetectionZone} from \"@/YellowSubmarine/detection system/MeshDetectionZone\";\r\nimport {SphericalDetectionZone} from \"@/YellowSubmarine/detection system/SphericalDetectionZone\";\r\nimport {ConfigurableCamera} from \"@/YellowSubmarine/camera system/ConfigurableCamera\";\r\nimport {Submarine} from \"@/YellowSubmarine/Submarine\";\r\nimport {Player} from \"@/YellowSubmarine/Player\";\r\n\r\nexport class TemplePuzzle {\r\n    private _upperRightSocle: Socle;\r\n    private _middleRightSocle: Socle;\r\n    private _lowerRightSocle: Socle;\r\n    private _lowerMiddleSocle: Socle;\r\n    private _lowerLeftSocle: Socle;\r\n    private _middleLeftSocle: Socle;\r\n    private _upperLeftSocle: Socle;\r\n    private _upperMiddleSocle: Socle;\r\n    private _centerSocle: Socle;\r\n\r\n    public static get instance(): TemplePuzzle{\r\n        return this._instance;\r\n    }\r\n\r\n    public get transformNode(): TransformNode {\r\n        return this._transformNode;\r\n    }\r\n\r\n    public static onPuzzleResolved = new Observable<void>();\r\n    public static onPuzzleRejected = new Observable<void>();\r\n\r\n    private static _instance: TemplePuzzle;\r\n\r\n    private static _ball: TempleBall[] = new Array<TempleBall>();\r\n\r\n    public static registerBall(ball: TempleBall): void {\r\n        this._ball.push(ball);\r\n        ball.onPlacedOnSocle.add(() => {\r\n            this._instance.onBallPlacedOnSocle();\r\n        });\r\n    }\r\n\r\n    private _transformNode: TransformNode = new TransformNode(\"templePuzzle\");\r\n    private _cameraConfiguration: CameraConfiguration;\r\n    private _detectionZone: MeshDetectionZone;\r\n\r\n    public constructor(parent: TransformNode, position: Vector3) {\r\n        TemplePuzzle._instance = this;\r\n        this._transformNode.parent = parent;\r\n        this._transformNode.rotation = Vector3.Zero();\r\n        this._transformNode.position = position;\r\n        this._detectionZone = new SphericalDetectionZone({\r\n            diameter: 70,\r\n        }, false);\r\n        this._detectionZone.zone.parent = this._transformNode;\r\n        this._cameraConfiguration = new CameraConfiguration();\r\n        this._cameraConfiguration.target = this._transformNode;\r\n        this._cameraConfiguration.wantedBeta = Angle.FromDegrees(0).radians();\r\n        this._cameraConfiguration.wantedAlpha = Angle.FromDegrees(-90).radians();\r\n        this._cameraConfiguration.distanceFromTarget = 100;\r\n        this._detectionZone.onMeshEnter.add(() => {\r\n            ConfigurableCamera.instance.cameraConfiguration = this._cameraConfiguration;\r\n        });\r\n        this._detectionZone.onMeshExit.add(() => {\r\n            ConfigurableCamera.instance.cameraConfiguration = Player.playerCameraConfiguration;\r\n        })\r\n        Submarine.instance.meshCreationPromise.then((mesh) => {\r\n            this._detectionZone.addMeshToDetect(mesh);\r\n        })\r\n        this._upperRightSocle = this.createSocle(new Vector3(-1,0,-1).scale(20));\r\n        this._middleRightSocle = this.createSocle(new Vector3(-1,0,0).scale(20), Color3.Purple());\r\n        this._lowerRightSocle = this.createSocle(new Vector3(-1,0,1).scale(20), Color3.Blue());\r\n        this._lowerMiddleSocle = this.createSocle(new Vector3(0,0,1).scale(20), Color3.Green());\r\n        this._lowerLeftSocle = this.createSocle(new Vector3(1,0,1).scale(20), Color3.Red());\r\n        this._middleLeftSocle = this.createSocle(new Vector3(1,0,0).scale(20));\r\n        this._upperLeftSocle = this.createSocle(new Vector3(1,0,-1).scale(20), Color3.Gray());\r\n        this._upperMiddleSocle = this.createSocle(new Vector3(0,0,-1).scale(20), Color3.Yellow());\r\n        this._centerSocle = this.createSocle(Vector3.Zero());\r\n\r\n        // TODO: Test only, remove after\r\n        const grayBall = new TempleBall(new Vector3(40,0,20), Color3.Gray());\r\n        const yellowBall = new TempleBall(new Vector3(50,0,20), Color3.Yellow());\r\n\r\n        this._lowerLeftSocle.meshImportedPromise.then(() => {\r\n            this._lowerLeftSocle.placeBall(yellowBall);\r\n        });\r\n        this._lowerRightSocle.meshImportedPromise.then(() => {\r\n            this._lowerRightSocle.placeBall(grayBall);\r\n        })\r\n\r\n    }\r\n\r\n    private createSocle(position: Vector3, validColor?: Color3){\r\n        const socle = new Socle(this._transformNode, position);\r\n        socle.validColor = validColor;\r\n        return socle;\r\n    }\r\n\r\n    private onBallPlacedOnSocle(){\r\n        if(this.isAllBallPlacedOnASocle()){\r\n            if(this.checkConfiguration()){\r\n                TemplePuzzle.onPuzzleResolved.notifyObservers();\r\n            }\r\n            else{\r\n                TemplePuzzle.onPuzzleRejected.notifyObservers();\r\n            }\r\n\r\n        }\r\n    }\r\n\r\n    private isAllBallPlacedOnASocle(){\r\n        let numberOfPlaced = 0;\r\n        TemplePuzzle._ball.forEach( (ball) => {\r\n            if(ball.socle){\r\n                numberOfPlaced++;\r\n            }\r\n        });\r\n        return numberOfPlaced == 6;\r\n    }\r\n\r\n    private checkConfiguration() {\r\n        for(let i = 0; i < TemplePuzzle._ball.length; i++) {\r\n            const ball = TemplePuzzle._ball[i];\r\n            const socle = ball.socle;\r\n            if (socle) {\r\n                const socleValidColor = socle.validColor;\r\n                if (socleValidColor === undefined || !ball.color.equals(socleValidColor) ) {\r\n                    return false;\r\n                }\r\n            } else {\r\n                console.log(\"Some ball are not placed\");\r\n                return false;\r\n            }\r\n        }\r\n        return true;\r\n    }\r\n\r\n}","import {Quest} from \"@/YellowSubmarine/quest system/Quest\";\r\nimport {QuestStep} from \"@/YellowSubmarine/quest system/QuestStep\";\r\nimport {TemplePuzzle} from \"@/YellowSubmarine/temple/TemplePuzzle\";\r\n\r\nexport class QuestFactory {\r\n\r\n    public static createAll(){\r\n        const quests: Quest[] = [];\r\n        quests.push(QuestFactory.createTalkToPedro());\r\n        quests.push(QuestFactory.createTempleQuest());\r\n        return quests;\r\n    }\r\n\r\n    private static createTalkToPedro(): Quest{\r\n        const quest = new Quest(\"dreamland\", \"Le monde des rves\", \"active\", 0);\r\n        const steps: QuestStep[] = [];\r\n        steps.push(new QuestStep(\"Parlez  l'habitant de l'ile du Dophin\"));\r\n        steps.push(new QuestStep(\"Aller voir le temple\"));\r\n        steps.push(new QuestStep(\"Parler aux diffrents habitants de chaque le\"));\r\n        quest.steps = steps;\r\n        TemplePuzzle.onPuzzleResolved.add(() => {\r\n            quest.state = \"completed\";\r\n        });\r\n        return quest;\r\n    }\r\n\r\n    private static createTempleQuest(): Quest{\r\n        const quest = new Quest(\"temple_quest\", \"Le Temple\", \"inactive\", 0);\r\n        const steps: QuestStep[] = [];\r\n        steps.push(new QuestStep(\"Rsoudre l'nigme du temple\"));\r\n        quest.steps = steps;\r\n        TemplePuzzle.onPuzzleResolved.add(() => {\r\n            quest.state = \"completed\";\r\n        });\r\n        return quest;\r\n    }\r\n}","import {Quest} from \"@/YellowSubmarine/quest system/Quest\";\r\nimport {Game} from \"@/YellowSubmarine/Game\";\r\nimport {QuestFactory} from \"@/YellowSubmarine/quest system/QuestFactory\";\r\n\r\nexport class QuestManager {\r\n\r\n    private quests: Quest[] = [];\r\n\r\n    private static _instance: QuestManager;\r\n\r\n    public static get instance(): QuestManager {\r\n        return this._instance;\r\n    }\r\n\r\n    constructor() {\r\n        this.quests = QuestFactory.createAll();\r\n        QuestManager._instance = this;\r\n        Game.scene.onBeforeRenderObservable.add(() => {\r\n            this.quests.forEach(quest => {\r\n                if(quest.steps[quest.currentStepIndex].condition && quest.state === \"active\") {\r\n                    quest.nextStep();\r\n                }\r\n            })\r\n        });\r\n    }\r\n\r\n    public getQuest(id: string): Quest | undefined {\r\n        return this.quests.find(quest => quest.id === id);\r\n    }\r\n\r\n    public getAllActiveQuests(): Quest[] {\r\n        const quests: Quest[] = [];\r\n        this.quests.forEach(quest => {\r\n            if(quest.state === \"active\") {\r\n                quests.push(quest);\r\n            }\r\n        });\r\n        return quests;\r\n    }\r\n}","import { UI } from \"@/YellowSubmarine/ui system/UI\";\r\nimport {Control, StackPanel, TextBlock, Rectangle, Grid} from \"@babylonjs/gui\";\r\nimport { Quest } from \"@/YellowSubmarine/quest system/Quest\";\r\nimport { Game } from \"@/YellowSubmarine/Game\";\r\nimport { QuestManager } from \"@/YellowSubmarine/quest system/QuestManager\";\r\nimport { KeyboardEventTypes } from \"@babylonjs/core\";\r\n\r\nexport class JournalUI extends UI {\r\n    private _panel: StackPanel;\r\n    private _journalEntry: Map<Quest, Array<string>> = new Map();\r\n    private static _instance: JournalUI;\r\n\r\n    public static get instance(): JournalUI {\r\n        return this._instance;\r\n    }\r\n\r\n    get controlNode(): Control {\r\n        return this._panel;\r\n    }\r\n\r\n    constructor() {\r\n        super();\r\n\r\n        this._panel = new StackPanel();\r\n        this._panel.width = \"60%\";\r\n        this._panel.height = \"90%\";\r\n        this._panel.horizontalAlignment = Control.HORIZONTAL_ALIGNMENT_CENTER;\r\n        this._panel.verticalAlignment = Control.VERTICAL_ALIGNMENT_CENTER;\r\n        this._panel.spacing = 20;\r\n        this._panel.isVisible = false;\r\n\r\n        Game.scene.onKeyboardObservable.add((eventData) => {\r\n            const state = eventData.type === KeyboardEventTypes.KEYDOWN;\r\n            if (eventData.event.key === \"j\" && state) {\r\n                this._panel.isVisible ? this.hide() : this.show();\r\n            }\r\n        });\r\n\r\n        JournalUI._instance = this;\r\n    }\r\n\r\n    private refresh() {\r\n        if (QuestManager.instance) {\r\n            this._panel.clearControls();\r\n\r\n            this._journalEntry.forEach((lines, quest) => {\r\n                const container = new Rectangle();\r\n                container.background = \"rgba(0, 0, 0, 0.4)\";\r\n                container.thickness = 0;\r\n                container.cornerRadius = 10;\r\n                container.height = \"100%\";\r\n                container.paddingBottom = \"5px\";\r\n                container.width = \"100%\";\r\n                container.paddingLeft = \"10px\";\r\n                container.paddingRight = \"10px\";\r\n                container.verticalAlignment = Control.VERTICAL_ALIGNMENT_TOP;\r\n\r\n                const questGrid = new Grid();\r\n                questGrid.height = \"100%\";\r\n                questGrid.addColumnDefinition(0.4);\r\n                questGrid.addColumnDefinition(0.6);\r\n                questGrid.horizontalAlignment = Control.HORIZONTAL_ALIGNMENT_RIGHT;\r\n                questGrid.verticalAlignment = Control.VERTICAL_ALIGNMENT_CENTER;\r\n                questGrid.paddingBottom = \"5px\";\r\n                questGrid.width = \"100%\";\r\n\r\n                const titleText = new TextBlock();\r\n                titleText.text = \"\\n\" + ` ${quest.name}`;\r\n                titleText.color = \"white\";\r\n                titleText.fontSize = 20;\r\n                titleText.fontWeight = \"bold\";\r\n                titleText.paddingLeft = \"10px\";\r\n                titleText.paddingRight = \"10px\";\r\n                titleText.paddingTop = \"10px\"\r\n                titleText.paddingBottom = \"10px\";\r\n                titleText.textHorizontalAlignment = Control.HORIZONTAL_ALIGNMENT_LEFT;\r\n                titleText.textVerticalAlignment = Control.VERTICAL_ALIGNMENT_TOP;\r\n\r\n                const stepText = new TextBlock();\r\n                lines.forEach((line) => {\r\n                    stepText.text += \"\\n\" + line + \"\\n\";\r\n                })\r\n                stepText.color = \"lightgray\";\r\n                stepText.fontSize = 20;\r\n                stepText.textHorizontalAlignment = Control.HORIZONTAL_ALIGNMENT_LEFT;\r\n                stepText.textVerticalAlignment = Control.VERTICAL_ALIGNMENT_TOP;\r\n                stepText.textWrapping = true;\r\n                stepText.paddingLeft = \"10px\";\r\n                stepText.paddingRight = \"10px\";\r\n                stepText.paddingTop = \"10px\";\r\n                stepText.paddingBottom = \"10px\";\r\n                questGrid.addControl(titleText, 0, 0); // ligne 0, colonne 0\r\n                questGrid.addControl(stepText, 0, 1);\r\n                container.addControl(questGrid);\r\n                this._panel.addControl(container);\r\n            });\r\n        }\r\n    }\r\n\r\n    public show() {\r\n        this._panel.isVisible = true;\r\n    }\r\n\r\n    public hide() {\r\n        this._panel.isVisible = false;\r\n    }\r\n\r\n    public addEntryToQuest(quest: Quest | undefined, entry: string) {\r\n        if (quest) {\r\n            if (!this._journalEntry.has(quest)) {\r\n                this._journalEntry.set(quest, []);\r\n            }\r\n            if(!this._journalEntry.get(quest)?.includes(entry)) this._journalEntry.get(quest)?.push(entry);\r\n        }\r\n        this.refresh();\r\n    }\r\n}\r\n","import {NPC} from \"@/YellowSubmarine/npcs/NPC\";\r\nimport {Utils} from \"@/YellowSubmarine/Utils\";\r\nimport {CylindricalDetectionZone} from \"@/YellowSubmarine/detection system/CylindricalDetectionZone\";\r\nimport {CameraConfiguration} from \"@/YellowSubmarine/camera system/CameraConfiguration\";\r\nimport {Angle, PBRMaterial, Vector3} from \"@babylonjs/core\";\r\nimport {CartoonShaderMaterial} from \"@/YellowSubmarine/shader material/CartoonShaderMaterial\";\r\nimport {SoundManager} from \"@/YellowSubmarine/sound system/SoundManager\";\r\nimport {ConversationBuilder} from \"@/YellowSubmarine/dialogue system/ConversationBuilder\";\r\nimport {JournalUI} from \"@/YellowSubmarine/quest system/ui/JournalUI\";\r\nimport {QuestManager} from \"@/YellowSubmarine/quest system/QuestManager\";\r\n\r\nexport class NPCFactory {\r\n\r\n    public static async createPedro(): Promise<NPC>{\r\n        const pedro = new NPC();\r\n        pedro.name = \"Pedro\";\r\n        Utils.loadMesh(\"models/characters/pedro.glb\").then((result) => {\r\n            pedro.mesh = result.meshes[0];\r\n            result.meshes.forEach((mesh) => {\r\n                const mat = mesh.material as PBRMaterial;\r\n                if(mat){\r\n                    const toonMat = new CartoonShaderMaterial();\r\n                    toonMat.assignMaterial(mesh).then(() => {\r\n                        toonMat.configureFromPBRMaterial(mat);\r\n                    });\r\n                }\r\n            })\r\n        });\r\n        pedro.detectionZone = new CylindricalDetectionZone( {\r\n            height: 8,\r\n            diameterTop: 45,\r\n            diameterBottom: 45,\r\n        }, true);\r\n\r\n        pedro.detectionZone.zone.position.set(0, -11, 0);\r\n\r\n        pedro.conversation = new ConversationBuilder()\r\n            .say(\"OH CA VA PAS DE ME REVEILLER COMME CA ! MAIS QUI ES TU !!!!!\")\r\n            .then(\"Ca fais bien longtemps que j'ai pas vu quelqu'un comme toi ici ! Je me prsente, je suis Pedro. Je pche ici depuis bel lurette mon n'veu.\")\r\n            .then(\"Ici, eh beh ici je sais pas trop comment te le dcrire. C'est assez vide et a mord pas trop au bout de ma canne... \")\r\n            .then(\"Mais ! Y'a un p'tit endroit au nord d'ici un peu particulier.\")\r\n            .then(\"Y'avait deux boules et plein de poteaux, j'ai pas tout compris et j'tais fatigu Ducoup j'suis parti..\")\r\n            .then(\"Normalement tu devrais l'apercevoir d'ici ! Fais attention ! \")\r\n            .then(\"Hsite pas  aller voir les habitants des autres, ils devraient pouvoir t'aider !\")\r\n            .then(\"Bon aller moi je retourne pcher (et dormir au passage... a fais bieeeen ..... loongt....................... zzZZZzzzzzZZzzzzzzzz)\")\r\n            .setOnEnding(() => {\r\n                JournalUI.instance.addEntryToQuest(QuestManager.instance.getQuest(\"dreamland\"), \"Pedro s'est endormie\");\r\n                QuestManager.instance.getQuest(\"dreamland\")?.updateCurrentStepStatus();\r\n            })\r\n            .build();\r\n\r\n        pedro.cameraConfiguration = new CameraConfiguration();\r\n        pedro.cameraConfiguration.target = pedro.transformNode;\r\n        pedro.cameraConfiguration.distanceFromTarget = 10;\r\n        pedro.cameraConfiguration.offset = Vector3.Up().scale(2);\r\n        pedro.cameraConfiguration.wantedAlpha = Angle.FromDegrees(-90).radians();\r\n\r\n        return pedro;\r\n    }\r\n\r\n    public static async createFox(): Promise<NPC>{\r\n        const fox = new NPC();\r\n        fox.name = \"Crimson\";\r\n        Utils.loadMesh(\"models/characters/fox.glb\").then((result) => {\r\n            fox.mesh = result.meshes[0];\r\n            result.meshes.forEach((mesh) => {\r\n                const mat = mesh.material as PBRMaterial;\r\n                if(mat){\r\n                    const toonMat = new CartoonShaderMaterial();\r\n                    toonMat.assignMaterial(mesh).then(() => {\r\n                        toonMat.configureFromPBRMaterial(mat);\r\n                    });\r\n                }\r\n            })\r\n        });\r\n        fox.detectionZone = new CylindricalDetectionZone( {\r\n            height: 8,\r\n            diameterTop: 45,\r\n            diameterBottom: 45,\r\n        }, true);\r\n\r\n        fox.conversation = new ConversationBuilder()\r\n            .say(\"Je sais pas si tu vois la mme chose que moi (peut-tre que c'est un mirage). Y'a une piste de bowling l-bas o y'a les quilles qui sortent de l'eau.\")\r\n            .then(\"Y'a une sorte de boule de bowling qui tait sur l'le. J'ai essay de jouer avec des quilles en glace mais a a pas trop march.\")\r\n            .then(\"Parmi les quilles j'ai mis une bouteille que j'ai trouve dans le coin et bizarrement, quand j'ai fait un STRIKE ! Y'a une note qui est sortie.\")\r\n            .then(\"Y'avait marqu a :  Redina, la plus forte, restait en retrait afin de couvrir leurs arrires \")\r\n            .then(\"Bizarre l'ambiance... J'en ai marre de jouer au bowling donc j'te donne la boule ! Mais prends-en soin !\")\r\n            .then(\"Allez, je vais jouer  la ptanque moi...\")\r\n            .setOnEnding(() => {\r\n                JournalUI.instance.addEntryToQuest(QuestManager.instance.getQuest(\"dreamland\"), \"D'aprs Crimson : Redina, la plus forte, restait en retrait afin de couvrir leurs arrires\");\r\n            })\r\n            .build();\r\n\r\n        fox.cameraConfiguration = new CameraConfiguration();\r\n        fox.cameraConfiguration.target = fox.transformNode;\r\n        fox.cameraConfiguration.distanceFromTarget = 10;\r\n        fox.cameraConfiguration.wantedAlpha = Angle.FromDegrees(-90).radians();\r\n\r\n        return fox;\r\n    }\r\n\r\n    public static async createGirl(): Promise<NPC>{\r\n        const scientific = new NPC();\r\n        scientific.name = \"Rosa\";\r\n        Utils.loadMesh(\"models/characters/phare_girl.glb\").then((result) => {\r\n            scientific.mesh = result.meshes[0];\r\n            result.meshes.forEach((mesh) => {\r\n                const mat = mesh.material as PBRMaterial;\r\n                if(mat){\r\n                    const toonMat = new CartoonShaderMaterial();\r\n                    toonMat.assignMaterial(mesh).then(() => {\r\n                        toonMat.configureFromPBRMaterial(mat);\r\n                    });\r\n                }\r\n            })\r\n        });\r\n        scientific.detectionZone = new CylindricalDetectionZone( {\r\n            height: 8,\r\n            diameterTop: 45,\r\n            diameterBottom: 45,\r\n        }, true);\r\n\r\n\r\n        scientific.conversation = new ConversationBuilder()\r\n            .say(\"Si je suis la trajectoire de cette toile, alors je peux peut-tre russir  dmontrer que e = m6 !\")\r\n            .then(\"Oh salut toi ! T'as un sacr sous-marin ! J'adore les sous-marins tu tombes  pic !\")\r\n            .then(\"Pour la peine, je vais te prsenter les conclusions de mon exprience AHAH prpare toi  en prendre plein la vue !\")\r\n            .then(\"J'ai trouv une boule de couleurs avec deux parchemins. Commenons par les FAITS !\")\r\n            .then(\"Fait numro 1 : la boule est d'une couleur spcifique... Hmmmm...... Ok soit.\")\r\n            .then(\"Fait numro 2 : les textes parlent de je ne sais pas trop quoi  vrai dire. Mais ! J'ai l'impression que les couleurs sont importantes !\")\r\n            .then(\"Fait numro 3 : les deux parchemins racontes la chose suivante : \\n\" +\r\n                \" - Greina, la plus sage, veillait sur ses soeurs sans faillire  sa tche \\n\" +\r\n                \" - Bluella, la plus tmraire, ouvrait la marche, portant un chapeau violet \")\r\n            .then(\"Maintenant, passons  la THEORIE !\")\r\n            .then(\"Thorie numro 1 : une boule de couleur a une position unique. Mais o ??? AHHH Je ne comprends pas....\")\r\n            .then(\"Thorie numro 2 : il existe d'autres boules de couleur car mes deux indices parlent de couleurs diffrentes de celle de ma boule !\")\r\n            .then(\"Et voil c'est un peu tout ce que j'ai, je suis dans une sacre impasse. Je vais srement rater le prix Nobel cette anne.....\")\r\n            .then(\"Allez j'te laisse la boule, je suis pass  autre chose ! Tu me diras une prochaine fois si a t'a t utile !\")\r\n            .then(\" la revoyure !\")\r\n            .setOnEnding(() => {\r\n                JournalUI.instance.addEntryToQuest(QuestManager.instance.getQuest(\"dreamland\"), (\"Rosa a trouve ces deux phrases :\" +\r\n                    \"\\n - Bluella, la plus tmraire, ouvrait la marche, portant un chapeau violet\" +\r\n                    \"\\n - Greina, la plus sage, veillait sur ses soeurs sans faillire  sa tche\"));\r\n            })\r\n            .build();\r\n\r\n\r\n\r\n        scientific.cameraConfiguration = new CameraConfiguration();\r\n        scientific.cameraConfiguration.target = scientific.transformNode;\r\n        scientific.cameraConfiguration.distanceFromTarget = 40;\r\n        scientific.cameraConfiguration.wantedAlpha = Angle.FromDegrees(-120).radians();\r\n        scientific.cameraConfiguration.wantedBeta = Angle.FromDegrees(50).radians();\r\n\r\n        return scientific;\r\n    }\r\n\r\n    public static async createScribe(): Promise<NPC>{\r\n        const scribe = new NPC();\r\n        scribe.name = \"Marcel\";\r\n        Utils.loadMesh(\"models/characters/scribe.glb\").then((result) => {\r\n            scribe.mesh = result.meshes[0];\r\n            result.meshes.forEach((mesh) => {\r\n                const mat = mesh.material as PBRMaterial;\r\n                if(mat){\r\n                    const toonMat = new CartoonShaderMaterial();\r\n                    toonMat.assignMaterial(mesh).then(() => {\r\n                        toonMat.configureFromPBRMaterial(mat);\r\n                    });\r\n                }\r\n            })\r\n        });\r\n        scribe.detectionZone = new CylindricalDetectionZone( {\r\n            height: 8,\r\n            diameterTop: 45,\r\n            diameterBottom: 45,\r\n        }, true);\r\n\r\n        scribe.conversation = new ConversationBuilder()\r\n            .say(\"Que penses-tu de mon prochain pome jeune tranger ?\")\r\n            .then(\"[g]Ballade dun Gnie Naufrag[/g]\")\r\n            .then(\"[i]Je suis ce grand Marcel, quaucun vent ne drange, Pote illustre et fier, perdu sur cet trange Territoire obscur, bord par linconnu, O des piliers sans fin soutiennent labsolu.[/i]\")\r\n            .then(\"[i]Je ne sais point comment jai pu atterrir ici, Mais lendroit me salue dun silence exquis. Tantt le ciel semplit de choses voltigeantes, Tantt le vide plane, en formes dchirantes.[/i]\")\r\n            .then(\"[i]Sur le rivage nu, comme un don du destin, Japerus une orbe, dun clat si divin Que mon esprit, troubl par tant de magnificence, Faillit se noyer dans sa propre loquence.[/i]\")\r\n            .then(\"[i]Juste  ct dormait, message dans bouteille, Un parchemin dchos, dune main non pareille. Il tait crit, sans honte ni limite : [/i] [c=blue] Pendant que le soleil tait au znith, Un nuage gristre sapprochait depuis louest . Ah ! Que cette phrase est dun raffinement leste ![/c]\")\r\n            .then(\"[i]Moi seul, Marcel, pouvais en saisir lessence, Car mon verbe est plus fort que toute connaissance.[/i]\")\r\n            .then(\"[i]Je retourne  prsent vers la fontaine noire, Dont lencre tachera les vers de ma mmoire.[/i]\")\r\n            .then(\"Voila ! J'espre que ce ne fut pas un peu trop long. Maintenant file je dois me concentrer !\")\r\n            .setOnEnding(() => {\r\n                JournalUI.instance.addEntryToQuest(QuestManager.instance.getQuest(\"dreamland\"), \"Marcel nous indique dans son poeme interminable : \\n \" +\r\n                    \" - Pendant que le soleil tait au znith, Un nuage gristre sapprochait depuis louest\")\r\n            })\r\n            .build();\r\n\r\n\r\n        scribe.cameraConfiguration = new CameraConfiguration();\r\n        scribe.cameraConfiguration.target = scribe.transformNode;\r\n        scribe.cameraConfiguration.distanceFromTarget = 10;\r\n        scribe.cameraConfiguration.wantedAlpha = Angle.FromDegrees(150).radians();\r\n\r\n        return scribe;\r\n    }\r\n\r\n    public static async createRabbit(): Promise<NPC>{\r\n        const rabbit = new NPC();\r\n        rabbit.name = \"Matthew\";\r\n\r\n        Utils.loadMesh(\"models/characters/lapin.glb\").then((result) => {\r\n            rabbit.mesh = result.meshes[0];\r\n\r\n            result.meshes.forEach((mesh) => {\r\n\r\n                const mat = mesh.material as PBRMaterial;\r\n                if(mat){\r\n                    const toonMat = new CartoonShaderMaterial();\r\n                    toonMat.assignMaterial(mesh).then(() => {\r\n                        toonMat.configureFromPBRMaterial(mat);\r\n                    });\r\n                }\r\n            })\r\n        });\r\n\r\n        rabbit.detectionZone = new CylindricalDetectionZone( {\r\n            height: 8,\r\n            diameterTop: 45,\r\n            diameterBottom: 45,\r\n        }, true);\r\n\r\n        rabbit.detectionZone.zone.position.set(0, -2, 0);\r\n\r\n        rabbit.conversation = new ConversationBuilder()\r\n            .say(\"[i][c=blue]Trois surs, Redina, Greina, Bluella, voyant le nuage s'approcher, se dirigeaient  l'oppose....[/i][/c]\")\r\n            .then(\"Hmmmm... Qu'est-ce que a peut vouloir dire....\")\r\n            .then(\"AAAAAAAAAAAAAAAAAAAAHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHH\")\r\n            .then(\"TU M'AS FAIS PEUR !!!!\")\r\n            .then(\"TIENS PREND A ! ET PARS LOIN D'ICI SANS REVENIR !!!!!!!!!!!!!!!!\")\r\n            .setOnEnding(() => {\r\n                JournalUI.instance.addEntryToQuest(QuestManager.instance.getQuest(\"dreamland\"), \"Marcel nous indique dans son poeme interminable : \\n \" +\r\n                    \" - Trois surs, Redina, Greina, Bluella, voyant le nuage s'approcher, se dirigeaient  l'oppose...\")\r\n            })\r\n            .build();\r\n\r\n\r\n\r\n        rabbit.cameraConfiguration = new CameraConfiguration();\r\n        rabbit.cameraConfiguration.target = rabbit.transformNode;\r\n        rabbit.cameraConfiguration.distanceFromTarget = 10;\r\n        rabbit.cameraConfiguration.wantedAlpha = Angle.FromDegrees(-90).radians();\r\n\r\n        return rabbit;\r\n    }\r\n}","import {MeshDetectionZone} from \"@/YellowSubmarine/detection system/MeshDetectionZone\";\r\nimport {Conversation} from \"@/YellowSubmarine/dialogue system/Conversation\";\r\nimport {\r\n    StartConversationInteraction\r\n} from \"@/YellowSubmarine/dialogue system/interactions/StartConversationInteraction\";\r\nimport {ConversationBuilder} from \"@/YellowSubmarine/dialogue system/ConversationBuilder\";\r\nimport {SphericalDetectionZone} from \"@/YellowSubmarine/detection system/SphericalDetectionZone\";\r\nimport {Submarine} from \"@/YellowSubmarine/Submarine\";\r\nimport {QuestManager} from \"@/YellowSubmarine/quest system/QuestManager\";\r\nimport {IConversationProvider} from \"@/YellowSubmarine/dialogue system/IConversationProvider\";\r\nimport {AbstractMesh, Angle} from \"@babylonjs/core\";\r\nimport {CameraConfiguration} from \"@/YellowSubmarine/camera system/CameraConfiguration\";\r\n\r\nexport class Stele implements IConversationProvider {\r\n    private _steleInteractionZone!: MeshDetectionZone;\r\n    private _conversation!: Conversation;\r\n    private _startConversationInteraction?: StartConversationInteraction\r\n    private _cameraConfiguration!: CameraConfiguration;\r\n\r\n    public constructor() {\r\n        this.steleInteractionZone = new SphericalDetectionZone({\r\n            diameter: 20\r\n        }, true);\r\n        this._cameraConfiguration = new CameraConfiguration();\r\n        this._cameraConfiguration.target = this._steleInteractionZone.zone;\r\n        this._cameraConfiguration.distanceFromTarget = 20;\r\n        this._cameraConfiguration.wantedAlpha = Angle.FromDegrees(-90).radians();\r\n\r\n        const conversationBuilder = new ConversationBuilder();\r\n        conversationBuilder.say(\"La ligne du haut regarde les cieux\")\r\n            .then(\"La ligne du milieu respire lair\")\r\n            .then(\"La ligne du bas touche la terre\")\r\n            .setOnEnding(() => {\r\n                let quest = QuestManager.instance.getQuest(\"temple_quest\");\r\n                if(quest) quest.state = \"active\";\r\n                quest = QuestManager.instance.getQuest(\"dreamland\");\r\n                if(quest) quest.updateCurrentStepStatus();\r\n            })\r\n        this.conversation = conversationBuilder.build();\r\n        this.conversation.conversationProvider = this;\r\n    }\r\n\r\n    public get steleInteractionZone(): MeshDetectionZone {\r\n        return this._steleInteractionZone;\r\n    }\r\n\r\n    private set steleInteractionZone(value: MeshDetectionZone) {\r\n        this._steleInteractionZone = value;\r\n        if(this._steleInteractionZone) {\r\n            this._steleInteractionZone.onMeshEnter.add(() => {\r\n                if (this._startConversationInteraction) {\r\n                    this._startConversationInteraction.makeAvailable();\r\n                }\r\n            })\r\n            this._steleInteractionZone.onMeshExit.add(() => {\r\n                if(this._startConversationInteraction) {\r\n                    this._startConversationInteraction.makeUnavailable();\r\n                }\r\n            })\r\n            Submarine.instance.meshCreationPromise.then((mesh) => {\r\n                this._steleInteractionZone?.addMeshToDetect(mesh);\r\n            })\r\n        }\r\n    }\r\n\r\n    public get conversation(): Conversation {\r\n        return this._conversation;\r\n    }\r\n\r\n    private set conversation(value: Conversation) {\r\n        this._conversation = value;\r\n        if(this._conversation) {\r\n            this._startConversationInteraction = new StartConversationInteraction(this._conversation);\r\n        }\r\n    }\r\n\r\n    get mesh(): AbstractMesh | undefined {\r\n        return this._steleInteractionZone.zone;\r\n    }\r\n\r\n    get name(): string {\r\n        return \"Stele\";\r\n    }\r\n\r\n    get cameraConfiguration(): CameraConfiguration | undefined {\r\n        return this._cameraConfiguration;\r\n    }\r\n\r\n\r\n\r\n\r\n\r\n}","import {KeyZone} from \"@/YellowSubmarine/keyzone system/KeyZone\";\r\nimport {SphericalDetectionZone} from \"@/YellowSubmarine/detection system/SphericalDetectionZone\";\r\nimport {\r\n    Angle,\r\n    Color3,\r\n    Mesh,\r\n    PBRMaterial,\r\n    PhysicsAggregate,\r\n    PhysicsBody,\r\n    PhysicsMotionType,\r\n    PhysicsShape,\r\n    PhysicsShapeType,\r\n    Space, StandardMaterial,\r\n    TransformNode,\r\n    Vector3\r\n} from \"@babylonjs/core\";\r\nimport {Utils} from \"@/YellowSubmarine/Utils\";\r\nimport {NPCFactory} from \"@/YellowSubmarine/npcs/NPCFactory\";\r\nimport {CartoonShaderMaterial} from \"@/YellowSubmarine/shader material/CartoonShaderMaterial\";\r\nimport {Game} from \"@/YellowSubmarine/Game\";\r\nimport {Stele} from \"@/YellowSubmarine/temple/Stele\";\r\nimport {TemplePuzzle} from \"@/YellowSubmarine/temple/TemplePuzzle\";\r\nimport {CellMaterial} from \"@babylonjs/materials\";\r\nimport {TempleBall} from \"@/YellowSubmarine/temple/TempleBall\";\r\nimport {Submarine} from \"@/YellowSubmarine/Submarine\";\r\n\r\nexport class KeyZoneFactory {\r\n\r\n    private static readonly _dolphinPosition: Vector3 = new Vector3(0,0,160);\r\n    private static readonly _templePosition: Vector3 = new Vector3(0, 0, 500);\r\n    private static readonly _banquisePosition: Vector3 = new Vector3(-200, 0, 680);\r\n    private static readonly _archipelPosition: Vector3 = new Vector3(200, 0, 680);\r\n    private static readonly _pharePosition: Vector3 = new Vector3(-250, 0, 420);\r\n    private static readonly _poulpePosition: Vector3 = new Vector3(250, 0, 420);\r\n\r\n    public static async createDolphinIsland(): Promise<KeyZone> {\r\n        const _transformIsland: TransformNode = new TransformNode(\"island transform\");\r\n        const island = new KeyZone();\r\n\r\n        island.name = \"Dolphin island\";\r\n        island.detectionZone = new SphericalDetectionZone({\r\n            diameter : 200\r\n        }, true);\r\n\r\n        const result = await Utils.loadMesh(\"models/scenes/dolphinIsland.glb\");\r\n        const rootMesh = result.meshes[0];\r\n        rootMesh.position = Vector3.Zero();\r\n        rootMesh.parent = _transformIsland;\r\n        const childMeshes = rootMesh.getChildMeshes<Mesh>();\r\n        for (const mesh of result.meshes) {\r\n            const mat = mesh.material as PBRMaterial;\r\n            if(mat){\r\n                const toonMat = new CartoonShaderMaterial();\r\n                await toonMat.assignMaterial(mesh).then(() => {\r\n                    toonMat.configureFromPBRMaterial(mat);\r\n                });\r\n            }\r\n        }\r\n        const mergedMesh = Mesh.MergeMeshes(childMeshes,true, undefined, undefined, undefined, true);\r\n        if(mergedMesh){\r\n            mergedMesh.parent = _transformIsland;\r\n            island.mesh = mergedMesh;\r\n            _transformIsland.position = this._dolphinPosition;\r\n\r\n            const physicsBody = new PhysicsBody(mergedMesh, PhysicsMotionType.STATIC, false, Game.scene);\r\n            const physicsShape = new PhysicsShape({\r\n                type: PhysicsShapeType.MESH,\r\n                parameters: {\r\n                    mesh: mergedMesh,\r\n                }\r\n            }, Game.scene);\r\n\r\n            physicsBody.shape = physicsShape;\r\n            physicsBody.disablePreStep = false;\r\n            Game.scene.onBeforeRenderObservable.addOnce(() => physicsBody.disablePreStep = true);\r\n\r\n\r\n            NPCFactory.createPedro().then( (pedro) => {\r\n                pedro.transformNode.position = new Vector3(-30, 15, -14);\r\n                pedro.transformNode.parent = _transformIsland;\r\n            });\r\n        }\r\n\r\n\r\n        /*island.physicsAggregate = new PhysicsAggregate(island.mesh, PhysicsShapeType.SPHERE, {\r\n            mass: 0,\r\n            radius: 30,\r\n        }, Game.scene);*/\r\n\r\n\r\n        return island;\r\n    }\r\n\r\n    public static async createTemple(){\r\n\r\n        const templeTransform: TransformNode = new TransformNode(\"temple transform\");\r\n        const temple = new KeyZone();\r\n\r\n        temple.name = \"Temple\";\r\n        temple.detectionZone = new SphericalDetectionZone({\r\n            diameter : 260,\r\n        }, true);\r\n\r\n        const result = await Utils.loadMesh(\"models/scenes/temple.glb\");\r\n        const rootMesh = result.meshes[0];\r\n        rootMesh.position = Vector3.Zero();\r\n        rootMesh.parent = templeTransform;\r\n        const childMeshes = rootMesh.getChildMeshes<Mesh>();\r\n        for (const mesh of result.meshes) {\r\n            const mat = mesh.material as PBRMaterial;\r\n            if(mat){\r\n                const toonMat = new CartoonShaderMaterial();\r\n                await toonMat.assignMaterial(mesh).then(() => {\r\n                    toonMat.configureFromPBRMaterial(mat);\r\n                });\r\n                toonMat.emissionColor = Color3.FromHexString(\"#4bf49f\")\r\n            }\r\n        }\r\n        const mergedMesh = Mesh.MergeMeshes(childMeshes,true, undefined, undefined, undefined, true);\r\n        if(mergedMesh){\r\n            mergedMesh.parent = templeTransform;\r\n            temple.mesh = mergedMesh;\r\n            templeTransform.position = this._templePosition;\r\n            templeTransform.rotate(Vector3.Up(), Angle.FromDegrees(180).radians(), Space.WORLD);\r\n\r\n            const physicsBody = new PhysicsBody(mergedMesh, PhysicsMotionType.STATIC, false, Game.scene);\r\n            const physicsShape = new PhysicsShape({\r\n                type: PhysicsShapeType.MESH,\r\n                parameters: {\r\n                    mesh: mergedMesh,\r\n                }\r\n            }, Game.scene);\r\n            physicsBody.shape = physicsShape;\r\n\r\n            physicsBody.disablePreStep = false;\r\n            Game.scene.onBeforeRenderObservable.addOnce(() => physicsBody.disablePreStep = true);\r\n        }\r\n\r\n\r\n\r\n\r\n        const stele = new Stele();\r\n        const steleInteractionZone = stele.steleInteractionZone;\r\n        steleInteractionZone.zone.parent = templeTransform;\r\n        steleInteractionZone.zone.position = new Vector3(0,0,50);\r\n\r\n        const templePuzzle = new TemplePuzzle(templeTransform, new Vector3(0,0,0));\r\n\r\n    }\r\n\r\n    private static createStaticPhysicsAggregate(\r\n        transformNode: TransformNode,\r\n        type: PhysicsShapeType | PhysicsShape,\r\n    ){\r\n        const aggregate = new PhysicsAggregate(transformNode, type, {\r\n            mass: 0,\r\n        }, Game.scene);\r\n\r\n        return aggregate;\r\n    }\r\n\r\n    public static async createBanquise(){\r\n        const banquiseTransform: TransformNode = new TransformNode(\"banquise transform\");\r\n        const banquise = new KeyZone();\r\n\r\n        banquise.name = \"Fractisberg\";\r\n        banquise.detectionZone = new SphericalDetectionZone({\r\n            diameter : 200,\r\n        }, true);\r\n\r\n        const result = await Utils.loadMesh(\"models/scenes/banquise.glb\");\r\n        const rootMesh = result.meshes[0];\r\n        rootMesh.position = Vector3.Zero();\r\n        rootMesh.parent = banquiseTransform;\r\n        const childMeshes = rootMesh.getChildMeshes<Mesh>();\r\n        for (const mesh of result.meshes) {\r\n            const pbrMaterial = mesh.material as PBRMaterial;\r\n            const standardMat = mesh.material as StandardMaterial;\r\n            if(pbrMaterial){\r\n                const cellMaterial = new CellMaterial(\"banquiseMat\");\r\n                cellMaterial.needDepthPrePass = true;\r\n                cellMaterial.diffuseColor = pbrMaterial.albedoColor;\r\n                if(pbrMaterial.albedoTexture){\r\n                    cellMaterial.diffuseTexture = pbrMaterial.albedoTexture;\r\n                }\r\n                mesh.material = cellMaterial;\r\n                cellMaterial.cullBackFaces = false;\r\n\r\n            }\r\n            else if(standardMat){\r\n                const cellMaterial = new CellMaterial(\"banquiseMat\");\r\n                cellMaterial.needDepthPrePass = true;\r\n                cellMaterial.diffuseColor = standardMat.diffuseColor;\r\n                if(standardMat.diffuseTexture){\r\n                    cellMaterial.diffuseTexture = standardMat.diffuseTexture;\r\n                }\r\n                mesh.material = cellMaterial;\r\n                cellMaterial.cullBackFaces = false;\r\n            }\r\n\r\n        }\r\n        const mergedMesh = Mesh.MergeMeshes(childMeshes,true, undefined, undefined, undefined, true);\r\n        if(mergedMesh){\r\n            mergedMesh.parent = banquiseTransform;\r\n            banquise.mesh = mergedMesh;\r\n            banquiseTransform.position = this._banquisePosition;\r\n            banquiseTransform.rotate(Vector3.Up(), Angle.FromDegrees(-90).radians(), Space.WORLD);\r\n\r\n            const physicsBody = new PhysicsBody(mergedMesh, PhysicsMotionType.STATIC, false, Game.scene);\r\n            const physicsShape = new PhysicsShape({\r\n                type: PhysicsShapeType.MESH,\r\n                parameters: {\r\n                    mesh: mergedMesh,\r\n                }\r\n            }, Game.scene);\r\n            physicsBody.shape = physicsShape;\r\n\r\n            physicsBody.disablePreStep = false;\r\n            Game.scene.onBeforeRenderObservable.addOnce(() => physicsBody.disablePreStep = true);\r\n\r\n            NPCFactory.createFox().then( (fox) => {\r\n                fox.transformNode.position = new Vector3(-8, 1.4, 0);\r\n                fox.transformNode.parent = banquiseTransform;\r\n                const ball = new TempleBall(fox.transformNode.absolutePosition.add(new Vector3(0,20,0)), Color3.Green());\r\n                const callBack = fox.conversation?.onConversationEnd.add(() => {\r\n                    if(!Submarine.instance.templeBall){\r\n                        Submarine.instance.grabBall(ball);\r\n                        fox.conversation?.onConversationEnd.remove(callBack ?? null);\r\n                    }\r\n                });\r\n            });\r\n        }\r\n\r\n\r\n    }\r\n\r\n    public static async createArchipel(){\r\n        const archipelTransform: TransformNode = new TransformNode(\"archipel transform\");\r\n        const archipel = new KeyZone();\r\n\r\n        archipel.name = \"L'Archipel Carotte\";\r\n        archipel.detectionZone = new SphericalDetectionZone({\r\n            diameter : 200,\r\n        }, true);\r\n\r\n        const result = await Utils.loadMesh(\"models/scenes/archipel.glb\");\r\n        const rootMesh = result.meshes[0];\r\n        rootMesh.position = Vector3.Zero();\r\n        rootMesh.parent = archipelTransform;\r\n        const childMeshes = rootMesh.getChildMeshes<Mesh>();\r\n        for (const mesh of result.meshes) {\r\n            const pbrMaterial = mesh.material as PBRMaterial;\r\n            const standardMat = mesh.material as StandardMaterial;\r\n            if(pbrMaterial){\r\n                const cellMaterial = new CellMaterial(\"archipelMat\");\r\n                cellMaterial.needDepthPrePass = true;\r\n                cellMaterial.diffuseColor = pbrMaterial.albedoColor;\r\n                if(pbrMaterial.albedoTexture){\r\n                    cellMaterial.diffuseTexture = pbrMaterial.albedoTexture;\r\n                }\r\n                mesh.material = cellMaterial;\r\n            }\r\n            else if(standardMat){\r\n                const cellMaterial = new CellMaterial(\"archipelMat\");\r\n                cellMaterial.needDepthPrePass = true;\r\n                cellMaterial.diffuseColor = standardMat.diffuseColor;\r\n                if(standardMat.diffuseTexture){\r\n                    cellMaterial.diffuseTexture = standardMat.diffuseTexture;\r\n                }\r\n                mesh.material = cellMaterial;\r\n            }\r\n        }\r\n        const mergedMesh = Mesh.MergeMeshes(childMeshes,true, undefined, undefined, undefined, true);\r\n        if(mergedMesh){\r\n            mergedMesh.parent = archipelTransform;\r\n            archipel.mesh = mergedMesh;\r\n            archipelTransform.position = this._archipelPosition;\r\n            archipelTransform.rotate(Vector3.Up(), Angle.FromDegrees(-90).radians(), Space.WORLD);\r\n\r\n            const physicsBody = new PhysicsBody(mergedMesh, PhysicsMotionType.STATIC, false, Game.scene);\r\n            const physicsShape = new PhysicsShape({\r\n                type: PhysicsShapeType.MESH,\r\n                parameters: {\r\n                    mesh: mergedMesh,\r\n                }\r\n            }, Game.scene);\r\n            physicsBody.shape = physicsShape;\r\n\r\n            physicsBody.disablePreStep = false;\r\n            Game.scene.onBeforeRenderObservable.addOnce(() => physicsBody.disablePreStep = true);\r\n\r\n            NPCFactory.createRabbit().then( (rabbit) => {\r\n                rabbit.transformNode.position = new Vector3(-0.8, 5.2, -0.7);\r\n                rabbit.transformNode.parent = archipelTransform;\r\n                const ball = new TempleBall(rabbit.transformNode.absolutePosition.add(new Vector3(0,20,0)), Color3.Red());\r\n                const callBack = rabbit.conversation?.onConversationEnd.add(() => {\r\n                    if(!Submarine.instance.templeBall){\r\n                        Submarine.instance.grabBall(ball);\r\n                        rabbit.conversation?.onConversationEnd.remove(callBack ?? null);\r\n                    }\r\n                });\r\n            });\r\n\r\n\r\n        }\r\n\r\n\r\n    }\r\n\r\n    public static async createPoulpe(){\r\n        const poulpeTransform: TransformNode = new TransformNode(\"poulpe transform\");\r\n        const poulpe = new KeyZone();\r\n\r\n        poulpe.name = \"Le Poulpensant\";\r\n        poulpe.detectionZone = new SphericalDetectionZone({\r\n            diameter : 200,\r\n        }, true);\r\n\r\n        const result = await Utils.loadMesh(\"models/scenes/poulpe.glb\");\r\n        const rootMesh = result.meshes[0];\r\n        rootMesh.position = Vector3.Zero();\r\n        rootMesh.parent = poulpeTransform;\r\n        const childMeshes = rootMesh.getChildMeshes<Mesh>();\r\n        for (const mesh of result.meshes) {\r\n            const pbrMaterial = mesh.material as PBRMaterial;\r\n            const standardMat = mesh.material as StandardMaterial;\r\n            if(pbrMaterial){\r\n                const cellMaterial = new CellMaterial(\"poulpeMat\");\r\n                cellMaterial.needDepthPrePass = true;\r\n                cellMaterial.diffuseColor = pbrMaterial.albedoColor;\r\n                if(pbrMaterial.albedoTexture){\r\n                    cellMaterial.diffuseTexture = pbrMaterial.albedoTexture;\r\n                }\r\n                mesh.material = cellMaterial;\r\n            }\r\n            else if(standardMat){\r\n                const cellMaterial = new CellMaterial(\"poulpeMat\");\r\n                cellMaterial.needDepthPrePass = true;\r\n                cellMaterial.diffuseColor = standardMat.diffuseColor;\r\n                if(standardMat.diffuseTexture){\r\n                    cellMaterial.diffuseTexture = standardMat.diffuseTexture;\r\n                }\r\n                mesh.material = cellMaterial;\r\n            }\r\n\r\n        }\r\n        const mergedMesh = Mesh.MergeMeshes(childMeshes,true, undefined, undefined, undefined, true);\r\n        if(mergedMesh){\r\n            mergedMesh.parent = poulpeTransform;\r\n            poulpe.mesh = mergedMesh;\r\n            poulpeTransform.position = this._poulpePosition;\r\n\r\n            const physicsBody = new PhysicsBody(mergedMesh, PhysicsMotionType.STATIC, false, Game.scene);\r\n            const physicsShape = new PhysicsShape({\r\n                type: PhysicsShapeType.MESH,\r\n                parameters: {\r\n                    mesh: mergedMesh,\r\n                }\r\n            }, Game.scene);\r\n            physicsBody.shape = physicsShape;\r\n\r\n            physicsBody.disablePreStep = false;\r\n            Game.scene.onBeforeRenderObservable.addOnce(() => physicsBody.disablePreStep = true);\r\n\r\n            NPCFactory.createScribe().then( (scribe) => {\r\n                scribe.transformNode.position = new Vector3(-1.57, 0.8, 5.8);\r\n                scribe.transformNode.parent = poulpeTransform;\r\n                const ball = new TempleBall(scribe.transformNode.absolutePosition.add(new Vector3(0,20,0)), Color3.Purple());\r\n                const callBack = scribe.conversation?.onConversationEnd.add(() => {\r\n                    if(!Submarine.instance.templeBall){\r\n                        Submarine.instance.grabBall(ball);\r\n                        scribe.conversation?.onConversationEnd.remove(callBack ?? null);\r\n                    }\r\n                });\r\n            });\r\n        }\r\n\r\n\r\n    }\r\n\r\n    public static async createPhare(){\r\n        const phareTransform: TransformNode = new TransformNode(\"phare transform\");\r\n        const phare = new KeyZone();\r\n\r\n        phare.name = \"Le Phare Flashouille\";\r\n        phare.detectionZone = new SphericalDetectionZone({\r\n            diameter : 200,\r\n        }, true);\r\n\r\n        const result = await Utils.loadMesh(\"models/scenes/phare.glb\");\r\n        const rootMesh = result.meshes[0];\r\n        rootMesh.position = Vector3.Zero();\r\n        rootMesh.parent = phareTransform;\r\n        const childMeshes = rootMesh.getChildMeshes<Mesh>();\r\n        for (const mesh of result.meshes) {\r\n            const pbrMaterial = mesh.material as PBRMaterial;\r\n            const standardMat = mesh.material as StandardMaterial;\r\n            if(pbrMaterial){\r\n                const cellMaterial = new CellMaterial(\"phareMat\");\r\n                cellMaterial.needDepthPrePass = true;\r\n                cellMaterial.diffuseColor = pbrMaterial.albedoColor;\r\n                if(pbrMaterial.albedoTexture){\r\n                    cellMaterial.diffuseTexture = pbrMaterial.albedoTexture;\r\n                }\r\n                mesh.material = cellMaterial;\r\n            }\r\n            else if(standardMat){\r\n                const cellMaterial = new CellMaterial(\"phareMat\");\r\n                cellMaterial.needDepthPrePass = true;\r\n                cellMaterial.diffuseColor = standardMat.diffuseColor;\r\n                if(standardMat.diffuseTexture){\r\n                    cellMaterial.diffuseTexture = standardMat.diffuseTexture;\r\n                }\r\n                mesh.material = cellMaterial;\r\n            }\r\n        }\r\n        const mergedMesh = Mesh.MergeMeshes(childMeshes,true, undefined, undefined, undefined, true);\r\n        if(mergedMesh){\r\n            mergedMesh.parent = phareTransform;\r\n            phare.mesh = mergedMesh;\r\n            phareTransform.position = this._pharePosition;\r\n            //phareTransform.rotate(Vector3.Up(), Angle.FromDegrees(180).radians(), Space.WORLD);\r\n\r\n            const physicsBody = new PhysicsBody(mergedMesh, PhysicsMotionType.STATIC, false, Game.scene);\r\n            const physicsShape = new PhysicsShape({\r\n                type: PhysicsShapeType.MESH,\r\n                parameters: {\r\n                    mesh: mergedMesh,\r\n                }\r\n            }, Game.scene);\r\n            physicsBody.shape = physicsShape;\r\n\r\n            physicsBody.disablePreStep = false;\r\n            Game.scene.onBeforeRenderObservable.addOnce(() => physicsBody.disablePreStep = true);\r\n\r\n            NPCFactory.createGirl().then( (girl) => {\r\n                girl.transformNode.position = new Vector3(1.2, 1.26, -16.90);\r\n                girl.transformNode.parent = phareTransform;\r\n                const ball = new TempleBall(girl.transformNode.absolutePosition.add(new Vector3(0,20,0)), Color3.Blue());\r\n                const callBack = girl.conversation?.onConversationEnd.add(() => {\r\n                    if(!Submarine.instance.templeBall){\r\n                        Submarine.instance.grabBall(ball);\r\n                        girl.conversation?.onConversationEnd.remove(callBack ?? null);\r\n                    }\r\n                });\r\n            });\r\n        }\r\n\r\n\r\n    }\r\n\r\n}","import {Sea} from \"@/YellowSubmarine/Sea\";\r\nimport {Submarine} from \"@/YellowSubmarine/Submarine\";\r\nimport {Sky} from \"@/YellowSubmarine/sky system/Sky\";\r\nimport {KeyZoneFactory} from \"@/YellowSubmarine/keyzone system/KeyZoneFactory\";\r\nexport class World {\r\n    private _sky: Sky;\r\n\r\n    public get submarine(): Submarine{\r\n        return this._submarine;\r\n    }\r\n\r\n    public static get submarine(): Submarine {\r\n        return this.instance.submarine;\r\n    }\r\n\r\n    private static get instance(): World {\r\n        return this._instance;\r\n    }\r\n\r\n    private static _instance: World;\r\n\r\n    private _sea: Sea;\r\n    private _submarine: Submarine;\r\n\r\n    constructor() {\r\n        World._instance = this;\r\n        this._sea = new Sea();\r\n        this._submarine = new Submarine();\r\n        this._sky = new Sky();\r\n        KeyZoneFactory.createDolphinIsland();\r\n        KeyZoneFactory.createTemple();\r\n        KeyZoneFactory.createBanquise();\r\n        KeyZoneFactory.createPhare();\r\n        KeyZoneFactory.createPoulpe();\r\n        KeyZoneFactory.createArchipel();\r\n\r\n    }\r\n\r\n}","import {WorldInteraction} from \"@/YellowSubmarine/interaction system/interactions/WorldInteraction\";\r\nimport {UI} from \"@/YellowSubmarine/ui system/UI\";\r\nimport {Control, Rectangle, TextBlock} from \"@babylonjs/gui\";\r\nimport {InteractionManager} from \"@/YellowSubmarine/interaction system/InteractionManager\";\r\n\r\nexport class WorldInteractionUI extends UI{\r\n\r\n    private _container: Rectangle;\r\n\r\n    constructor() {\r\n        super();\r\n        this._container = new Rectangle();\r\n        this._container.width = \"300px\";\r\n        this._container.height = \"200px\";\r\n        this._container.thickness = 0;\r\n        this._container.scaleY = 0.5;\r\n        this._container.scaleX = 0.5;\r\n\r\n        InteractionManager.instance.onInteractionAvailable.add((interaction) => {\r\n            if(interaction instanceof WorldInteraction) {\r\n                this.show(interaction);\r\n            }\r\n        });\r\n        InteractionManager.instance.onInteractionUnavailable.add((interaction) => {\r\n            if(interaction instanceof WorldInteraction) {\r\n                this.hide();\r\n            }\r\n        });\r\n    }\r\n\r\n    public get controlNode(): Control {\r\n        return this._container;\r\n    }\r\n\r\n    private show(interaction: WorldInteraction): void {\r\n        this._container.isVisible = true;\r\n\r\n        const rec1 = new Rectangle();\r\n        rec1.width = \"280px\";\r\n        rec1.height = \"100px\";\r\n        rec1.cornerRadius = 60;\r\n        rec1.color = \"rgb(168, 98, 68)\";\r\n        rec1.thickness = 4;\r\n        rec1.background = \"rgb(255, 199, 130)\";\r\n        this._container.addControl(rec1);\r\n\r\n        const label1 = new TextBlock();\r\n        label1.fontSize = 45;\r\n        label1.text = `${interaction.description}`;\r\n        rec1.addControl(label1);\r\n\r\n        // Deuxime rectangle avec son label\r\n        const rec2 = new Rectangle();\r\n        rec2.width = \"100px\";\r\n        rec2.height = \"85px\";\r\n        rec2.cornerRadius = 60;\r\n        rec2.color = \"rgb(168, 98, 68)\";\r\n        rec2.thickness = 4;\r\n        rec2.background = \"rgb(255, 255, 255)\";\r\n        rec2.horizontalAlignment = Control.HORIZONTAL_ALIGNMENT_RIGHT;\r\n        rec2.verticalAlignment = Control.VERTICAL_ALIGNMENT_BOTTOM;\r\n        this._container.addControl(rec2);\r\n\r\n        const label2 = new TextBlock();\r\n        label2.fontSize = 60;\r\n        label2.text = `${interaction.simplifiedCode}`;\r\n        label2.fontWeight = \"bold\";\r\n        label2.paddingTop = \"6px\";\r\n        rec2.addControl(label2);\r\n\r\n\r\n        this._container.linkWithMesh(interaction.mesh ?? null);\r\n        this._container.linkOffsetY = \"-140px\";\r\n\r\n    }\r\n\r\n    private hide() {\r\n        this._container.isVisible = false;\r\n        this._container.linkWithMesh(null);\r\n    }\r\n}","import {UI} from \"@/YellowSubmarine/ui system/UI\";\r\nimport {Control, TextBlock} from \"@babylonjs/gui\";\r\nimport {KeyZone} from \"@/YellowSubmarine/keyzone system/KeyZone\";\r\n\r\nexport class IslandsUI extends UI{\r\n\r\n    private _textBlock: TextBlock;\r\n\r\n    get controlNode(): Control {\r\n        return this._textBlock;\r\n    }\r\n\r\n    constructor() {\r\n        super();\r\n        this._textBlock = new TextBlock();\r\n        KeyZone.onAnyKeyZoneEntered.add((keyzone) => this.show(keyzone))\r\n    }\r\n\r\n    public show(keyzone: KeyZone) {\r\n\r\n        this._textBlock.isVisible = true;\r\n        this._textBlock.text = keyzone.name;\r\n\r\n        if(keyzone.discovered) {\r\n            this._textBlock.horizontalAlignment = Control.HORIZONTAL_ALIGNMENT_LEFT;\r\n            this._textBlock.verticalAlignment = Control.VERTICAL_ALIGNMENT_BOTTOM;\r\n            this._textBlock.paddingLeft = \"20px\";\r\n            this._textBlock.paddingBottom = \"20px\";\r\n            this._textBlock.color = \"white\";\r\n            this._textBlock.fontSize = \"24px\";\r\n            this._textBlock.textHorizontalAlignment = Control.HORIZONTAL_ALIGNMENT_LEFT;\r\n\r\n        } else {\r\n            this._textBlock.color = \"white\";\r\n            this._textBlock.fontSize = \"48px\";\r\n            this._textBlock.fontStyle = \"bold\";\r\n            this._textBlock.textHorizontalAlignment = Control.HORIZONTAL_ALIGNMENT_CENTER;\r\n            this._textBlock.textVerticalAlignment = Control.VERTICAL_ALIGNMENT_TOP;\r\n            this._textBlock.paddingTop = \"30px\";\r\n        }\r\n\r\n        setTimeout(() => {\r\n            this._textBlock.isVisible = false;\r\n        }, 3000);\r\n    }\r\n\r\n\r\n\r\n\r\n}","import { UI } from \"@/YellowSubmarine/ui system/UI\";\r\nimport { Button, Control, Slider, StackPanel, TextBlock, Rectangle, Grid } from \"@babylonjs/gui\";\r\nimport { MainMenuUI } from \"@/YellowSubmarine/ui system/MainMenuUI\";\r\nimport { Game } from \"@/YellowSubmarine/Game\";\r\nimport { KeyboardEventTypes } from \"@babylonjs/core\";\r\nimport { SoundManager } from \"@/YellowSubmarine/sound system/SoundManager\";\r\n\r\nexport class OptionsMenuUI extends UI {\r\n\r\n    private _panel: StackPanel;\r\n\r\n    get controlNode(): Control {\r\n        return this._panel;\r\n    }\r\n\r\n    constructor(private _mainMenu: MainMenuUI) {\r\n        super();\r\n        this._panel = new StackPanel();\r\n        this._panel.width = \"600px\";\r\n        this._panel.horizontalAlignment = Control.HORIZONTAL_ALIGNMENT_LEFT;\r\n        this._panel.verticalAlignment = Control.VERTICAL_ALIGNMENT_CENTER;\r\n        this._panel.spacing = 15;\r\n        this._panel.paddingLeft = \"60px\";\r\n        this.createSliderWithLabel(\"Volume SFX\", SoundManager.instance.SFXVolume, (value) => {\r\n            SoundManager.instance.SFXVolume = value;\r\n        });\r\n\r\n        this.createSliderWithLabel(\"Volume Musique\", SoundManager.instance.MUSICVolume, (value) => {\r\n            SoundManager.instance.MUSICVolume = value;\r\n        });\r\n\r\n        this.createSliderWithLabel(\"Volume UI\", SoundManager.instance.UIVolume, (value) => {\r\n            SoundManager.instance.UIVolume = value;\r\n        });\r\n\r\n        const backButton = MainMenuUI.createButton(\"Retour\", () => {\r\n            this.hide();\r\n        });\r\n        backButton.width = \"300px\";\r\n        backButton.height = \"40px\";\r\n        backButton.color = \"white\";\r\n        backButton.background = \"rgba(255, 255, 255, 0.05)\";\r\n        this._panel.addControl(backButton);\r\n\r\n        this._panel.isVisible = false;\r\n\r\n        Game.scene.onKeyboardObservable.add((eventData) => {\r\n            const state = eventData.type === KeyboardEventTypes.KEYDOWN;\r\n            if (eventData.event.key === \"Escape\" && state && this.controlNode.isVisible) {\r\n                this.hide();\r\n            }\r\n        });\r\n    }\r\n\r\n    private createSliderWithLabel(labelText: string, initialValue: number, onChange: (value: number) => void) {\r\n        const container = new StackPanel();\r\n        container.isVertical = false;\r\n        container.height = \"40px\";\r\n        container.paddingBottom = \"10px\";\r\n        container.horizontalAlignment = Control.HORIZONTAL_ALIGNMENT_CENTER;\r\n        container.verticalAlignment = Control.VERTICAL_ALIGNMENT_CENTER;\r\n\r\n        const label = new TextBlock();\r\n        label.text = labelText;\r\n        label.color = \"white\";\r\n        label.width = \"120px\";\r\n        label.fontSize = 14;\r\n        label.fontStyle = \"bold\";\r\n        label.textHorizontalAlignment = Control.HORIZONTAL_ALIGNMENT_LEFT;\r\n        label.paddingRight = \"10px\";\r\n\r\n        const slider = new Slider();\r\n        slider.minimum = 0;\r\n        slider.maximum = 1;\r\n        slider.value = initialValue;\r\n        slider.width = \"150px\";\r\n        slider.height = \"14px\";\r\n        slider.color = \"#FFF\";\r\n        slider.background = \"#333\";\r\n        slider.thumbWidth = \"18px\";\r\n        slider.thumbColor = \"#AAA\";\r\n        slider.borderColor = \"#888\";\r\n\r\n        const valueLabel = new TextBlock();\r\n        valueLabel.text = Math.round(initialValue * 100).toString() + \" %\";\r\n        valueLabel.width = \"50px\";\r\n        valueLabel.color = \"white\";\r\n        valueLabel.fontSize = 14;\r\n        valueLabel.textHorizontalAlignment = Control.HORIZONTAL_ALIGNMENT_RIGHT;\r\n        valueLabel.paddingLeft = \"10px\";\r\n\r\n        slider.onValueChangedObservable.add((value) => {\r\n            valueLabel.text = Math.round(value * 100).toString() + \" %\";\r\n            onChange(value);\r\n        });\r\n\r\n        container.addControl(label);\r\n        container.addControl(slider);\r\n        container.addControl(valueLabel);\r\n\r\n        this._panel.addControl(container);\r\n    }\r\n\r\n    public show() {\r\n        this._panel.isVisible = true;\r\n    }\r\n\r\n    public hide() {\r\n        this._panel.isVisible = false;\r\n        this._mainMenu.show();\r\n    }\r\n}","import {UI} from \"@/YellowSubmarine/ui system/UI\";\r\nimport {\r\n    Button,\r\n    Control,\r\n    StackPanel,\r\n    TextBlock\r\n} from \"@babylonjs/gui\";\r\nimport {Game} from \"@/YellowSubmarine/Game\";\r\nimport {KeyboardEventTypes} from \"@babylonjs/core\";\r\nimport {OptionsMenuUI} from \"@/YellowSubmarine/ui system/OptionsMenuUI\";\r\n\r\nexport class MainMenuUI extends UI {\r\n\r\n    private _panel: StackPanel;\r\n    private _optionMenuUI : OptionsMenuUI;\r\n    private _canvas?: HTMLCanvasElement;\r\n\r\n    public set canvas(canvas : HTMLCanvasElement) {\r\n        this._canvas = canvas;\r\n    }\r\n\r\n    public get controlNode(): Control {\r\n        return this._panel;\r\n    }\r\n\r\n    public get optionsMenuUI(): OptionsMenuUI {\r\n        return this._optionMenuUI;\r\n    }\r\n\r\n    constructor() {\r\n        super();\r\n        this._optionMenuUI = new OptionsMenuUI(this);\r\n        this._panel = new StackPanel();\r\n        this._panel.width = \"300px\";\r\n        this._panel.horizontalAlignment = Control.HORIZONTAL_ALIGNMENT_LEFT;\r\n        this._panel.verticalAlignment = Control.VERTICAL_ALIGNMENT_CENTER;\r\n        this._panel.paddingLeft = \"60px\";\r\n        this._panel.spacing = 20;\r\n\r\n        const playButton = MainMenuUI.createButton(\"Jouer\", () => this.onPlayPressed());\r\n        const optionsButton = MainMenuUI.createButton(\"Options\", () => this.onOptionsPressed());\r\n        const quitButton = MainMenuUI.createButton(\"Quitter\", () => this.onQuitPressed());\r\n\r\n        this._panel.addControl(playButton);\r\n        this._panel.addControl(optionsButton);\r\n        //this._panel.addControl(quitButton);\r\n\r\n        this.show();\r\n\r\n        Game.scene.onKeyboardObservable.add((eventData) => {\r\n            const state = eventData.type === KeyboardEventTypes.KEYDOWN;\r\n            if(eventData.event.key === \"Escape\" && state && !this.optionsMenuUI.controlNode.isVisible){\r\n                if(this._canvas)\r\n                    this._panel.isVisible ? this.onPlayPressed() : this.show();\r\n            }\r\n        });\r\n    }\r\n\r\n    public static createButton(text: string, callback: () => void): Button {\r\n        const button = Button.CreateSimpleButton(text.toLowerCase(), text);\r\n        button.width = \"100%\";\r\n        button.height = \"60px\";\r\n        button.color = \"white\";\r\n        button.background = \"rgba(255, 255, 255, 0.05)\";\r\n        button.fontSize = \"28px\";\r\n        button.fontStyle = \"bold\";\r\n        button.textBlock!.textHorizontalAlignment = Control.HORIZONTAL_ALIGNMENT_LEFT;\r\n        button.textBlock!.paddingLeft = \"20px\";\r\n        button.cornerRadius = 10;\r\n        button.thickness = 1;\r\n        button.paddingBottom = \"10px\";\r\n\r\n        button.onPointerEnterObservable.add(() => {\r\n            button.background = \"rgba(255, 255, 255, 0.2)\";\r\n        });\r\n        button.onPointerOutObservable.add(() => {\r\n            button.background = \"rgba(255, 255, 255, 0.05)\";\r\n        });\r\n\r\n        button.onPointerUpObservable.add(callback);\r\n        return button;\r\n    }\r\n\r\n    public show() {\r\n        this._panel.isVisible = true;\r\n    }\r\n\r\n    public hide() {\r\n        this._panel.isVisible = false;\r\n    }\r\n\r\n    private onPlayPressed() {\r\n        if(this._canvas) {\r\n            this._canvas.requestPointerLock();\r\n            this.hide();\r\n        }\r\n    }\r\n\r\n    private onOptionsPressed() {\r\n        this._optionMenuUI.show();\r\n        this.hide();\r\n    }\r\n\r\n    private onQuitPressed() {\r\n        console.log(\"Quitter !\");\r\n    }\r\n}","import { UI } from \"@/YellowSubmarine/ui system/UI\";\r\nimport { Control, Rectangle, StackPanel, TextBlock } from \"@babylonjs/gui\";\r\nimport { Game } from \"@/YellowSubmarine/Game\";\r\nimport { QuestManager } from \"@/YellowSubmarine/quest system/QuestManager\";\r\nimport { Quest } from \"@/YellowSubmarine/quest system/Quest\";\r\n\r\nexport class QuestUI extends UI {\r\n    private _panel: StackPanel;\r\n\r\n    get controlNode(): Control {\r\n        return this._panel;\r\n    }\r\n\r\n    constructor() {\r\n        super();\r\n\r\n        this._panel = new StackPanel();\r\n        this._panel.horizontalAlignment = Control.HORIZONTAL_ALIGNMENT_RIGHT;\r\n        this._panel.verticalAlignment = Control.VERTICAL_ALIGNMENT_TOP;\r\n        this._panel.width = \"25%\";\r\n        this._panel.height = \"100%\";\r\n        this._panel.paddingRight = \"10px\";\r\n        this._panel.paddingTop = \"20px\";\r\n        this._panel.isVertical = true;\r\n        this._panel.spacing = 10;\r\n\r\n        Game.scene.onBeforeRenderObservable.add(() => {\r\n            this.refresh();\r\n        });\r\n    }\r\n\r\n    private refresh() {\r\n        this._panel.clearControls();\r\n        const activeQuests = QuestManager.instance.getAllActiveQuests();\r\n\r\n        if (activeQuests.length === 0) {\r\n            // On affiche quand mme un sparateur vide\r\n            this._panel.addControl(this.createSeparator());\r\n            return;\r\n        }\r\n\r\n        activeQuests.forEach((quest: Quest) => {\r\n            const container = new StackPanel();\r\n            container.isVertical = true;\r\n            container.width = \"100%\";\r\n            //container.paddingTop = \"5px\";\r\n\r\n            // Titre\r\n            const titleText = new TextBlock();\r\n            titleText.text = ` ${quest.name}`;\r\n            titleText.color = \"white\";\r\n            titleText.fontSize = 20;\r\n            titleText.fontWeight = \"bold\";\r\n            titleText.textHorizontalAlignment = Control.HORIZONTAL_ALIGNMENT_LEFT;\r\n            titleText.height = \"28px\";\r\n            titleText.paddingBottom = \"6px\";\r\n\r\n            // Description avec un lger dcalage  droite\r\n            const stepText = new TextBlock();\r\n            stepText.text = quest.steps[quest.currentStepIndex].description;\r\n            stepText.color = \"#FFFFFF\";\r\n            stepText.fontSize = 17;\r\n            stepText.textHorizontalAlignment = Control.HORIZONTAL_ALIGNMENT_CENTER;\r\n            stepText.height = \"28px\";\r\n            stepText.textWrapping = true;\r\n            stepText.paddingLeft = \"16px\"; // Dcalage  droite\r\n            stepText.paddingBottom = \"10px\";\r\n\r\n            container.addControl(titleText);\r\n            container.addControl(stepText);\r\n            container.addControl(this.createSeparator());\r\n\r\n            this._panel.addControl(container);\r\n        });\r\n    }\r\n\r\n    private createSeparator(): Rectangle {\r\n        const separator = new Rectangle();\r\n        separator.height = \"5px\";\r\n        separator.width = \"100%\";\r\n        separator.background = \"white\";\r\n        separator.thickness = 0;\r\n        separator.paddingTop = \"4px\";\r\n        return separator;\r\n    }\r\n\r\n}\r\n","import {AdvancedDynamicTexture} from \"@babylonjs/gui\";\r\nimport {Game} from \"@/YellowSubmarine/Game\";\r\nimport {DialogueInteractionUI} from \"@/YellowSubmarine/interaction system/ui/DialogueInteractionUI\";\r\nimport {WorldInteractionUI} from \"@/YellowSubmarine/interaction system/ui/WorldInteractionUI\";\r\nimport {IslandsUI} from \"@/YellowSubmarine/interaction system/ui/IslandsUI\";\r\nimport {MainMenuUI} from \"@/YellowSubmarine/ui system/MainMenuUI\";\r\nimport {OptionsMenuUI} from \"@/YellowSubmarine/ui system/OptionsMenuUI\";\r\nimport {QuestUI} from \"@/YellowSubmarine/quest system/ui/QuestUI\";\r\nimport {JournalUI} from \"@/YellowSubmarine/quest system/ui/JournalUI\";\r\n\r\n\r\nexport class UIManager {\r\n\r\n    private _ui = AdvancedDynamicTexture.CreateFullscreenUI(\"_ui\", undefined, Game.scene);\r\n\r\n    private _worldInteractionUI: WorldInteractionUI = new WorldInteractionUI();\r\n    private _dialogueInteractionUI: DialogueInteractionUI = new DialogueInteractionUI();\r\n    private _islandsUI: IslandsUI = new IslandsUI();\r\n    private _mainMenuUI: MainMenuUI;\r\n    private _optionsMenuUI;\r\n    private _questUI: QuestUI = new QuestUI();\r\n    private _journalUI: JournalUI = new JournalUI();\r\n\r\n\r\n    constructor(private _canvas: HTMLCanvasElement) {\r\n        this._ui.addControl(this._worldInteractionUI.controlNode);\r\n        this._ui.addControl(this._dialogueInteractionUI.controlNode);\r\n        this._ui.addControl(this._islandsUI.controlNode);\r\n        this._mainMenuUI = new MainMenuUI();\r\n        this._optionsMenuUI = this._mainMenuUI.optionsMenuUI;\r\n        this._ui.addControl(this._optionsMenuUI.controlNode);\r\n        this._ui.addControl(this._mainMenuUI.controlNode);\r\n        this._mainMenuUI.canvas = _canvas;\r\n        this._ui.addControl(this._questUI.controlNode);\r\n        this._ui.addControl(this._journalUI.controlNode);\r\n    }\r\n\r\n    public showMainMenu(): void {\r\n        if(this._mainMenuUI)\r\n            this._mainMenuUI.show();\r\n    }\r\n}","import {World} from \"@/YellowSubmarine/World\";\r\nimport {Engine, HavokPlugin, Observable, Scene, Vector3} from \"@babylonjs/core\";\r\nimport {Player} from \"@/YellowSubmarine/Player\";\r\nimport {ConfigurableCamera} from \"@/YellowSubmarine/camera system/ConfigurableCamera\";\r\nimport {InteractionManager} from \"@/YellowSubmarine/interaction system/InteractionManager\";\r\nimport {UIManager} from \"@/YellowSubmarine/ui system/UIManager\";\r\nimport {SoundManager} from \"@/YellowSubmarine/sound system/SoundManager\";\r\nimport {QuestManager} from \"@/YellowSubmarine/quest system/QuestManager\";\r\n\r\nexport class Game{\r\n\r\n    private static _instance: Game;\r\n\r\n    public static onGameFocusChange: Observable<boolean> = new Observable<boolean>();\r\n\r\n    private _scene: Scene;\r\n    private _engine: Engine;\r\n    private _world: World;\r\n    private _player: Player;\r\n    private _isGameFocused = false;\r\n    private _camera: ConfigurableCamera;\r\n    private _interactionManager: InteractionManager;\r\n    private _uiManager: UIManager;\r\n    private _soundManager: SoundManager;\r\n    private _questManager: QuestManager;\r\n\r\n    public static get canvas(){\r\n        return this._instance._canvas;\r\n    }\r\n\r\n    public static get engine(): Engine {\r\n        return Game._instance._engine;\r\n    }\r\n\r\n    public static get scene(): Scene {\r\n        return Game._instance._scene;\r\n    }\r\n\r\n    public static get uiManager(): UIManager {\r\n        return Game._instance._uiManager;\r\n    }\r\n\r\n    public static get isGameFocused(): boolean {\r\n        return Game._instance._isGameFocused;\r\n    }\r\n\r\n    constructor(private _canvas: HTMLCanvasElement, private _havok: HavokPlugin) {\r\n        Game._instance = this;\r\n        this._engine = new Engine(this._canvas);\r\n        this._scene = new Scene(this._engine);\r\n        this._scene.enablePhysics(new Vector3(0,-9.81,0), _havok);\r\n        this._interactionManager = new InteractionManager();\r\n        this._camera = new ConfigurableCamera();\r\n        this._world = new World();\r\n        this._player = new Player();\r\n        this._soundManager = new SoundManager();\r\n        this._uiManager = new UIManager(_canvas);\r\n        this._questManager = new QuestManager();\r\n\r\n        document.addEventListener(\"pointerlockchange\", () => {\r\n            this.updateFocusState(document.pointerLockElement === _canvas);\r\n        });\r\n\r\n        this._engine.runRenderLoop(() => {\r\n            this._scene.render();\r\n        })\r\n        window.addEventListener(\"resize\", () => this._engine.resize());\r\n    }\r\n\r\n    private updateFocusState(state: boolean) {\r\n        if(state != this._isGameFocused){\r\n            this._isGameFocused = state;\r\n            Game.onGameFocusChange.notifyObservers(this._isGameFocused);\r\n            if (!this._isGameFocused) {\r\n                Game.uiManager.showMainMenu();\r\n            }\r\n        }\r\n    }\r\n\r\n\r\n\r\n}","import { render } from \"./YellowSubmarine.vue?vue&type=template&id=65f31b32&scoped=true&ts=true\"\nimport script from \"./YellowSubmarine.vue?vue&type=script&lang=ts\"\nexport * from \"./YellowSubmarine.vue?vue&type=script&lang=ts\"\n\nimport \"./YellowSubmarine.vue?vue&type=style&index=0&id=65f31b32&scoped=true&lang=css\"\n\nimport exportComponent from \"../../node_modules/vue-loader/dist/exportHelper.js\"\nconst __exports__ = /*#__PURE__*/exportComponent(script, [['render',render],['__scopeId',\"data-v-65f31b32\"]])\n\nexport default __exports__","import { render } from \"./App.vue?vue&type=template&id=091a8ae3&ts=true\"\nimport script from \"./App.vue?vue&type=script&lang=ts\"\nexport * from \"./App.vue?vue&type=script&lang=ts\"\n\nimport \"./App.vue?vue&type=style&index=0&id=091a8ae3&lang=css\"\n\nimport exportComponent from \"../node_modules/vue-loader/dist/exportHelper.js\"\nconst __exports__ = /*#__PURE__*/exportComponent(script, [['render',render]])\n\nexport default __exports__","import { createApp } from 'vue'\nimport App from './App.vue'\n\ncreateApp(App).mount('#app')\n","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId](module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n// expose the modules object (__webpack_modules__)\n__webpack_require__.m = __webpack_modules__;\n\n","var deferred = [];\n__webpack_require__.O = function(result, chunkIds, fn, priority) {\n\tif(chunkIds) {\n\t\tpriority = priority || 0;\n\t\tfor(var i = deferred.length; i > 0 && deferred[i - 1][2] > priority; i--) deferred[i] = deferred[i - 1];\n\t\tdeferred[i] = [chunkIds, fn, priority];\n\t\treturn;\n\t}\n\tvar notFulfilled = Infinity;\n\tfor (var i = 0; i < deferred.length; i++) {\n\t\tvar chunkIds = deferred[i][0];\n\t\tvar fn = deferred[i][1];\n\t\tvar priority = deferred[i][2];\n\t\tvar fulfilled = true;\n\t\tfor (var j = 0; j < chunkIds.length; j++) {\n\t\t\tif ((priority & 1 === 0 || notFulfilled >= priority) && Object.keys(__webpack_require__.O).every(function(key) { return __webpack_require__.O[key](chunkIds[j]); })) {\n\t\t\t\tchunkIds.splice(j--, 1);\n\t\t\t} else {\n\t\t\t\tfulfilled = false;\n\t\t\t\tif(priority < notFulfilled) notFulfilled = priority;\n\t\t\t}\n\t\t}\n\t\tif(fulfilled) {\n\t\t\tdeferred.splice(i--, 1)\n\t\t\tvar r = fn();\n\t\t\tif (r !== undefined) result = r;\n\t\t}\n\t}\n\treturn result;\n};","// define getter functions for harmony exports\n__webpack_require__.d = function(exports, definition) {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.g = (function() {\n\tif (typeof globalThis === 'object') return globalThis;\n\ttry {\n\t\treturn this || new Function('return this')();\n\t} catch (e) {\n\t\tif (typeof window === 'object') return window;\n\t}\n})();","__webpack_require__.o = function(obj, prop) { return Object.prototype.hasOwnProperty.call(obj, prop); }","// define __esModule on exports\n__webpack_require__.r = function(exports) {\n\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n\t}\n\tObject.defineProperty(exports, '__esModule', { value: true });\n};","__webpack_require__.p = \"/YellowSubmarine/\";","__webpack_require__.b = document.baseURI || self.location.href;\n\n// object to store loaded and loading chunks\n// undefined = chunk not loaded, null = chunk preloaded/prefetched\n// [resolve, reject, Promise] = chunk loading, 0 = chunk loaded\nvar installedChunks = {\n\t524: 0\n};\n\n// no chunk on demand loading\n\n// no prefetching\n\n// no preloaded\n\n// no HMR\n\n// no HMR manifest\n\n__webpack_require__.O.j = function(chunkId) { return installedChunks[chunkId] === 0; };\n\n// install a JSONP callback for chunk loading\nvar webpackJsonpCallback = function(parentChunkLoadingFunction, data) {\n\tvar chunkIds = data[0];\n\tvar moreModules = data[1];\n\tvar runtime = data[2];\n\t// add \"moreModules\" to the modules object,\n\t// then flag all \"chunkIds\" as loaded and fire callback\n\tvar moduleId, chunkId, i = 0;\n\tif(chunkIds.some(function(id) { return installedChunks[id] !== 0; })) {\n\t\tfor(moduleId in moreModules) {\n\t\t\tif(__webpack_require__.o(moreModules, moduleId)) {\n\t\t\t\t__webpack_require__.m[moduleId] = moreModules[moduleId];\n\t\t\t}\n\t\t}\n\t\tif(runtime) var result = runtime(__webpack_require__);\n\t}\n\tif(parentChunkLoadingFunction) parentChunkLoadingFunction(data);\n\tfor(;i < chunkIds.length; i++) {\n\t\tchunkId = chunkIds[i];\n\t\tif(__webpack_require__.o(installedChunks, chunkId) && installedChunks[chunkId]) {\n\t\t\tinstalledChunks[chunkId][0]();\n\t\t}\n\t\tinstalledChunks[chunkId] = 0;\n\t}\n\treturn __webpack_require__.O(result);\n}\n\nvar chunkLoadingGlobal = self[\"webpackChunkyellow_submarine\"] = self[\"webpackChunkyellow_submarine\"] || [];\nchunkLoadingGlobal.forEach(webpackJsonpCallback.bind(null, 0));\nchunkLoadingGlobal.push = webpackJsonpCallback.bind(null, chunkLoadingGlobal.push.bind(chunkLoadingGlobal));","// startup\n// Load entry module and return exports\n// This entry module depends on other loaded chunks and execution need to be delayed\nvar __webpack_exports__ = __webpack_require__.O(undefined, [504], function() { return __webpack_require__(26811); })\n__webpack_exports__ = __webpack_require__.O(__webpack_exports__);\n"],"names":["render","_ctx","_cache","$props","$setup","$data","$options","_component_YellowSubmarine","id","this","_bodyMesh","createBody","Game","scene","_haloMesh","createHalo","_light","createLight","configMaterials","body","CreateSphere","diameter","_diameter","segments","infiniteDistance","isPickable","position","_defaultPosition","halo","direction","activeCamera","subtract","normalize","light","negate","intensity","_intensity","shadowEnabled","parent","diffuse","_diffuse","specular","_specular","glowLayer","bodyMaterial","emissiveColor","_emissiveColor","diffuseColor","specularColor","material","haloMaterial","alpha","bodyMesh","_hemiLight","createHemiLight","Up","isEnabled","shadowGenerator","useBlurExponentialShadowMap","blurKernel","onBeforeRenderObservable","add","dir","absolutePosition","Zero","CelestialBody","HemisphericCelestialBody","ShadersRepository","SkyBox","_instance","_mesh","CreateBox","size","_shaderMaterial","vertex","fragment","attributes","uniforms","samplers","setFloat","Sky","instance","dayNightCycle","timeOfTheDay","_daySkyboxTexture","CreateFromImages","coordinatesMode","SKYBOX_MODE","_nightSkyboxTexture","setTexture","backFaceCulling","setColor3","sky","_sun","sun","_moon","moon","_time","engine","getDeltaTime","updateBody","updateLight","updateMoonLight","time","sunAngle","Math","PI","moonAngle","sunRadius","length","moonRadius","inclination","sunX","cos","sunY","sin","sunZ","moonInclination","moonX","moonY","moonZ","sunPos","sunHeight","y","normalized","max","min","smooth","pow","setEnabled","sunsetColor","FromHexString","Lerp","White","hemi","hemiLight","dayColor","nightColor","ambientColor","moonPos","moonHeight","deepNightColor","Sun","Moon","_skybox","_dayNightCycle","DayNightCycle","value","ReflectiveToonWaterMaterial","_scene","_material","shaderMaterialName","needAlphaTesting","_depthRenderer","enableDepthRenderer","undefined","_depthMap","getDepthMap","_renderListPredicate","m","renderListPredicate","setVector4","setVector2","window","innerWidth","innerHeight","addEventListener","mirrorTexture","mirrorPlane","FromPositionAndNormal","Down","customRenderTargets","push","_geometryBufferRenderer","enableGeometryBufferRenderer","enableNormal","_gBuffer","getGBuffer","cameraNormalTexture","textures","NORMAL_TEXTURE_TYPE","Sea","_seaMesh","CreateGround","width","height","subdivisions","_invisiblePlane","_invisiblePlaneBody","STATIC","_invisiblePlaneShape","type","BOX","parameters","mesh","extents","shape","setMassProperties","mass","ConfigurableCamera","_arcRotateCamera","deltaTimeInSeconds","update","_cameraConfiguration","cameraParameter","oldCameraParameter","jumpToTarget","deltaTimeInSec","updatePosition","updateRotation","target","targetPosition","wantedAlpha","beta","wantedBeta","radius","distanceFromTarget","_positionLerpFactor","lowerRadiusLimit","upperRadiusLimit","FromDegrees","LerpAngle","FromRadians","degrees","_rotationLerpFactor","radians","_target","_offset","rotateByQuaternionToRef","absoluteRotationQuaternion","Identity","offset","_wantedAlpha","_wantedBeta","_currentLowerBetaLimit","_currentUpperBetaLimit","_distanceFromTarget","InteractionManager","onInteractionAvailable","onInteractionUnavailable","Player","onPlayerPressedAKey","eventData","KEYDOWN","_currentInteraction","event","code","executeInteraction","interaction","makeInteractionUnavailable","notifyObservers","simplifiedCode","_code","_simplifiedCode","makeInteractionAvailable","AbstractInteraction","path","options","ms","Promise","resolve","setTimeout","param","style","italic","BBTag","bold","color","newStyle","parsedSize","parseInt","isNaN","Map","initRegistry","_registry","set","ItalicTag","BoldTag","ColorTag","SizeTag","input","match","tagStack","styleStack","cursor","currentStyle","regex","exec","full","name","isClosing","startsWith","idx","index","text","slice","last","pop","previousStyle","TagClass","get","tagInstance","onOpen","ctx","defaultFontSize","horizontalPadding","parser","BBParser","maxWidth","parseBBCode","map","s","lines","splitLines","fontSize","font","measureText","currentLine","currentWidth","segment","segWidth","getTextWidth","parts","split","part","trim","partWidth","lineHeight","textBlockHorizontalPadding","blocks","linesPanels","forEach","lineSegments","row","isVertical","horizontalAlignment","HORIZONTAL_ALIGNMENT_CENTER","verticalAlignment","VERTICAL_ALIGNMENT_BOTTOM","tb","applyStyle","textWrapping","resizeToFit","addControl","padding","fontWeight","fontStyle","paddingLeft","paddingRight","_advanceRequested","speed","skipped","i","Utils","sleep","initContainer","initStack","initTriangle","_layoutManager","TextLayoutManager","canvas","document","createElement","getContext","TEXT_DEFAULT_FONT_SIZE","TEXT_BLOCK_HORIZONTAL_PADDING","_textAnimator","TextAnimator","Conversation","onAnyConversationStart","conv","_container","isVisible","conversationProvider","linkWithMesh","linkOffsetY","CONTAINER_OFFSET_Y","onAnyConversationEnd","_stopBlink","onAnyDialogueStart","dialog","showText","TEXT_SPEED","_isTextFullyDisplayed","CONTAINER_WIDTH","cornerRadius","CONTAINER_CORNER_RADIUS","thickness","CONTAINER_THICKNESS","CONTAINER_COLOR","background","CONTAINER_BACKGROUND","TEXT_PADDING","_verticalStack","paddingBottom","_triangle","TRIANGLE_IMAGE_PATH","TRIANGLE_SIZE","HORIZONTAL_ALIGNMENT_RIGHT","DialogueInteractionUI","resetAdvance","clearControls","advanceObserver","onAdvanceDialogueRequested","requestAdvance","canvasWidth","querySelector","clientWidth","containerPixelWidth","layout","maxFontSize","TEXT_LINE_SPACING","createTextBlocks","linePanel","contentHeight","totalHeight","TEXT_EXTRA_CONTAINER_MARGIN","animateBlocks","advanceRequested","b","remove","_startBlink","isTextFullyDisplayed","TRIANGLE_BLINK_INTERVAL","UI","_conversation","next","DialogueInteraction","NextDialogueInteraction","_conversationProvider","_rootNode","_onEnding","node","_currentNode","execute","onDialogueStart","root","onConversationStart","enterNode","_nextInteraction","makeAvailable","cameraConfiguration","nextNode","endConversation","makeUnavailable","onConversationEnd","playerCameraConfiguration","initializeCameraParameter","registerKeyboardInputs","registerMouseMovementInputs","disableMovement","enableMovement","_onCameraRotationObservable","_onPlayerPressedAKey","_playerCameraConfiguration","_isForwardPressed","_isMovementEnabled","_isBackwardPressed","_isLeftPressed","_isRightPressed","onKeyboardObservable","isGameFocused","state","onPointerObservable","pointerInfo","movementX","screen","movementY","updateCameraParameter","Submarine","meshCreationPromise","then","currentLowerBetaLimit","currentUpperBetaLimit","_horizontalCameraSensitivity","_verticalCameraSensitivity","CameraConfiguration","_nodeMaterialPromise","ParseFromFileAsync","nodeMaterial","_nodeMaterial","maxSimultaneousLights","saturationMultiplier","build","getBlockByName","numberOfSteps","luminanceEasingFactor","indexOfRefraction","albedoColor","albedoTexture","texture","opacity","metallic","metallicTexture","roughness","roughnessTexture","emission","emissionColor","emissionTexture","transparencyMode","pbrMaterial","emissiveIntensity","emissiveTexture","needDepthPrePass","cullBackFaces","alphaMode","disableDepthWrite","disableColorWrite","forceDepthWrite","depthFunction","Grappler","updateGrappledObject","object","_currentGrappledObject","_grapplerLength","_owner","submarine","_localOffsetWithSubmarine","positionWithOffset","getObjectCenterWorld","transformNode","grappledObjectPosition","physicsBody","fromGrapplerToObject","distance","pullingDirection","normalizeToNew","scale","applyForce","_pullingForce","SoundManager","_SFXVolume","_UIVolume","_MUSICVolume","headphone","_audioEngine","unlockAsync","listener","onReadyObservable","playSFX","loop","autoplay","playMUSIC","url","volume","sound","Started","fadeIn","play","load","spatialSound","spatial","attach","maxDistance","distanceModel","console","log","_SFXsounds","SFXVolume","_UIsounds","UIVolume","_MUSICsounds","MUSICVolume","targetVolume","duration","stepTime","steps","currentStep","interval","setInterval","clearInterval","initialVolume","stop","fadeOutAndStop","_grappler","createMesh","owner","_spotLight","createSpotlight","addVolumetricLight","mapLimit","_physicsAggregate","pos","clone","x","z","setLinearVelocity","getLinearVelocity","copyFrom","keysDown","Set","key","has","KEYUP","delete","stopSFX","grappledObject","ball","grappleObject","letGoOfObject","ImportMeshAsync","result","rootMesh","meshes","childMeshes","getChildMeshes","mat","CartoonShaderMaterial","assignMaterial","configureFromPBRMaterial","mergedMesh","MergeMeshes","friction","restitution","setMotionType","DYNAMIC","inertia","centerOfMass","setLinearDamping","setAngularDamping","getCollisionObservable","receiveShadows","spotLight","enabled","camera","lightEmitter","vl","exposure","decay","weight","density","updateRotationSpeed","updateMovementSpeed","isForwardPressed","isBackwardPressed","forward","_movementForce","isRightPressed","isLeftPressed","right","_rotationForce","isMoveForwardPressed","isMoveBackwardPressed","isTurnRightPressed","isTurnLeftPressed","_name","_discovered","_detectionZone","detectionZone","onMeshEnter","KeyZone","onAnyKeyZoneEntered","discovered","_disabled","zone","World","addMeshToDetect","physicsAggregate","debug","_zone","visibility","_meshToDetect","onMeshExit","checkAll","intersectsMesh","checkDetection","MeshDetectionZone","startConversation","WorldInteraction","_transformNode","_playerDetectionZone","setSignals","conversation","_startConversationInteraction","StartConversationInteraction","isInZone","isInProgress","CreateCylinder","_text","_nextNode","AbstractDialogueNode","SimpleDialogueNode","current","say","onEnding","currentStepIndex","_id","_state","_currentStepIndex","_steps","stopQuest","validate","description","condition","_socle","templeBall","currentBall","letGoOfBall","grabBall","placeBall","_ballTransformNode","_placeTempleBallInteraction","PlaceTempleBallInteraction","_removeTempleBallInteraction","RemoveTempleBallInteraction","_socleDetectionZone","SphericalDetectionZone","meshImportedPromise","physicsShape","MESH","_currentBall","_lockConstraint","addConstraint","socle","dispose","_validColor","_grabbableObject","TemplePuzzle","registerBall","onPlacedOnSocle","TempleBall","onAnyBallPlacedOnAnySocle","_physicsShape","SPHERE","cellMaterial","_physicsBody","_grappleInteraction","GrappleInteraction","hasAnObjectGrappled","rotation","_upperRightSocle","createSocle","_middleRightSocle","Purple","_lowerRightSocle","Blue","_lowerMiddleSocle","Green","_lowerLeftSocle","Red","_middleLeftSocle","_upperLeftSocle","Gray","_upperMiddleSocle","Yellow","_centerSocle","grayBall","yellowBall","_ball","onBallPlacedOnSocle","validColor","Socle","isAllBallPlacedOnASocle","checkConfiguration","onPuzzleResolved","onPuzzleRejected","numberOfPlaced","socleValidColor","equals","Array","quests","QuestFactory","createTalkToPedro","createTempleQuest","quest","Quest","QuestStep","createAll","QuestManager","nextStep","find","_panel","VERTICAL_ALIGNMENT_CENTER","spacing","hide","show","JournalUI","_journalEntry","container","VERTICAL_ALIGNMENT_TOP","questGrid","addColumnDefinition","titleText","paddingTop","textHorizontalAlignment","HORIZONTAL_ALIGNMENT_LEFT","textVerticalAlignment","stepText","line","entry","includes","refresh","pedro","NPC","loadMesh","CylindricalDetectionZone","diameterTop","diameterBottom","ConversationBuilder","setOnEnding","addEntryToQuest","getQuest","updateCurrentStepStatus","fox","scientific","scribe","rabbit","steleInteractionZone","_steleInteractionZone","conversationBuilder","_transformIsland","island","_dolphinPosition","disablePreStep","addOnce","NPCFactory","createPedro","templeTransform","temple","_templePosition","rotate","WORLD","stele","Stele","aggregate","banquiseTransform","banquise","standardMat","diffuseTexture","_banquisePosition","createFox","callBack","archipelTransform","archipel","_archipelPosition","createRabbit","poulpeTransform","poulpe","_poulpePosition","createScribe","phareTransform","phare","_pharePosition","createGirl","girl","_sea","_submarine","_sky","KeyZoneFactory","createDolphinIsland","createTemple","createBanquise","createPhare","createPoulpe","createArchipel","scaleY","scaleX","rec1","label1","rec2","label2","_textBlock","keyzone","_mainMenu","createSliderWithLabel","backButton","MainMenuUI","createButton","controlNode","labelText","initialValue","onChange","label","slider","minimum","maximum","thumbWidth","thumbColor","borderColor","valueLabel","round","toString","onValueChangedObservable","_optionMenuUI","OptionsMenuUI","playButton","onPlayPressed","optionsButton","onOptionsPressed","onQuitPressed","optionsMenuUI","_canvas","callback","button","CreateSimpleButton","toLowerCase","textBlock","onPointerEnterObservable","onPointerOutObservable","onPointerUpObservable","requestPointerLock","activeQuests","getAllActiveQuests","createSeparator","separator","CreateFullscreenUI","WorldInteractionUI","IslandsUI","QuestUI","_ui","_worldInteractionUI","_dialogueInteractionUI","_islandsUI","_mainMenuUI","_optionsMenuUI","_questUI","_journalUI","_havok","_engine","enablePhysics","_interactionManager","_camera","_world","_player","_soundManager","_uiManager","UIManager","_questManager","updateFocusState","pointerLockElement","runRenderLoop","resize","_isGameFocused","onGameFocusChange","uiManager","showMainMenu","props","msg","String","mounted","getElementById","havok","havokPlugin","__exports__","components","YellowSubmarine","App","mount","__webpack_module_cache__","__webpack_require__","moduleId","cachedModule","exports","module","__webpack_modules__","deferred","O","chunkIds","fn","priority","notFulfilled","Infinity","fulfilled","j","Object","keys","every","splice","r","d","definition","o","defineProperty","enumerable","g","globalThis","Function","e","obj","prop","prototype","hasOwnProperty","call","Symbol","toStringTag","p","baseURI","self","location","href","installedChunks","chunkId","webpackJsonpCallback","parentChunkLoadingFunction","data","moreModules","runtime","some","chunkLoadingGlobal","bind","__webpack_exports__"],"sourceRoot":""}